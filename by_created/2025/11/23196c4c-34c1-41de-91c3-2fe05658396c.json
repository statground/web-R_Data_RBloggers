{
  "uuid": "23196c4c-34c1-41de-91c3-2fe05658396c",
  "created_at": "2025-11-17 20:41:05",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2009/03/enhanced-tidy-source-preserve-some-comments/",
    "crawled_at": "2025-11-17T10:41:04.682747",
    "external_links": [
      {
        "href": "http://yihui.name/en/2009/03/enhanced-tidy-source/",
        "text": "Keep on Fighting! » R Language"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "http://cran.r-project.org/web/packages/animation/index.html",
        "text": "animation"
      },
      {
        "href": "http://animation.yihui.name/animation:misc#tidy_up_r_source",
        "text": "tidy.source()wiki page"
      },
      {
        "href": "http://yihui.name/en/wp-content/uploads/1238508996_0.r",
        "text": "Downdload the R code here"
      },
      {
        "href": "http://yihui.name/en/2007/09/process-of-minimization-by-gradient-descent/",
        "text": "Process of Minimization by Gradient Descent (2D)"
      },
      {
        "href": "http://yihui.name/en/2007/08/tidy-up-your-r-code/",
        "text": "Tidy up your R code"
      },
      {
        "href": "http://yihui.name/en/2009/11/create-animations-in-pdf-documents-using-r/",
        "text": "Create Animations in PDF Documents Using R"
      },
      {
        "href": "http://yihui.name/en/2009/10/50000-revisions-committed-to-r/",
        "text": "50000 Revisions Committed to R"
      },
      {
        "href": "http://yihui.name/en/2009/09/how-to-import-ms-excel-data-into-r/",
        "text": "How to Import MS Excel Data into R"
      },
      {
        "href": "http://yihui.name/en/2009/03/enhanced-tidy-source/",
        "text": "Keep on Fighting! » R Language"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Enhanced tidy.source() (Preserve Some Comments) | R-bloggers",
    "images": [],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/yihui-xie/",
        "text": "Yihui Xie"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/tag/parse/",
        "text": "parse()"
      },
      {
        "href": "https://www.r-bloggers.com/tag/r-code/",
        "text": "R code"
      },
      {
        "href": "https://www.r-bloggers.com/tag/r-language/",
        "text": "R Language"
      },
      {
        "href": "https://www.r-bloggers.com/tag/r-programming/",
        "text": "R Programming"
      },
      {
        "href": "https://www.r-bloggers.com/tag/tidy-source/",
        "text": "tidy.source()"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-112 post type-post status-publish format-standard hentry category-r-bloggers tag-parse tag-r-code tag-r-language tag-r-programming tag-tidy-source\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Enhanced tidy.source() (Preserve Some Comments)</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">March 31, 2009</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/yihui-xie/\">Yihui Xie</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<p class=\"syndicated-attribution\"><!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"http://yihui.name/en/2009/03/enhanced-tidy-source/\"> Keep on Fighting! » R Language</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div></p>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.0--><p>After a few hours’ work, I modified the function <code>tidy.source()</code> in the <a href=\"http://cran.r-project.org/web/packages/animation/index.html\" rel=\"nofollow\" target=\"_blank\" title=\"http://cran.r-project.org/web/packages/animation/index.html\">animation</a> package so that it can preserve <em>complete</em> comment lines. See the <a href=\"http://animation.yihui.name/animation:misc#tidy_up_r_source\" rel=\"nofollow\" target=\"_blank\" title=\"http://animation.yihui.name/animation:misc#tidy_up_r_source\"><code>tidy.source()</code> wiki page</a> for example.</p>\n<span class=\"download\"><a href=\"http://yihui.name/en/wp-content/uploads/1238508996_0.r\" rel=\"nofollow\" target=\"_blank\">Downdload the R code here</a></span>\n<pre>tidy.source &lt;- function(source = \"clipboard\", keep.comment = TRUE,\n  keep.blank.line = FALSE, begin.comment, end.comment, ...) {\n  # parse and deparse the code\n  tidy.block = function(block.text) {\n      exprs = parse(text = block.text)\n      n = length(exprs)\n      res = character(n)\n      for (i in 1:n) {\n        dep = paste(deparse(exprs[i]), collapse = \"\\n\")\n        res[i] = substring(dep, 12, nchar(dep) - 1)\n      }\n      return(res)\n  }\n  text.lines = readLines(source, warn = FALSE)\n  if (keep.comment) {\n      # identifier for comments\n      identifier = function() paste(sample(LETTERS), collapse = \"\")\n      if (missing(begin.comment))\n        begin.comment = identifier()\n      if (missing(end.comment))\n        end.comment = identifier()\n      # remove leading and trailing white spaces\n      text.lines = gsub(\"^[[:space:]]+|[[:space:]]+$\", \"\",\n        text.lines)\n      # make sure the identifiers are not in the code\n      # or the original code might be modified\n      while (length(grep(sprintf(\"%s|%s\", begin.comment, end.comment),\n        text.lines))) {\n        begin.comment = identifier()\n        end.comment = identifier()\n      }\n      head.comment = substring(text.lines, 1, 1) == \"#\"\n      # add identifiers to comment lines to cheat R parser\n      if (any(head.comment)) {\n        text.lines[head.comment] = gsub(\"\\\"\", \"\\'\", text.lines[head.comment])\n        text.lines[head.comment] = sprintf(\"%s=\\\"%s%s\\\"\",\n          begin.comment, text.lines[head.comment], end.comment)\n      }\n      # keep blank lines?\n      blank.line = text.lines == \"\"\n      if (any(blank.line) &amp; keep.blank.line)\n        text.lines[blank.line] = sprintf(\"%s=\\\"%s\\\"\", begin.comment,\n          end.comment)\n      text.tidy = tidy.block(text.lines)\n      # remove the identifiers\n      text.tidy = gsub(sprintf(\"%s = \\\"|%s\\\"\", begin.comment,\n        end.comment), \"\", text.tidy)\n  }\n  else {\n      text.tidy = tidy.block(text.lines)\n  }\n  cat(paste(text.tidy, collapse = \"\\n\"), \"\\n\", ...)\n  invisible(text.tidy)\n}</pre>\n<p>Note that inline comments will still be removed. I don’t want to spend more time on dealing with inline comments any more.</p>\n<h2 class=\"related_post_title\">Related Posts</h2><ul class=\"related_post\"><li><a href=\"http://yihui.name/en/2007/09/process-of-minimization-by-gradient-descent/\" rel=\"nofollow\" target=\"_blank\" title=\"Process of Minimization by Gradient Descent (2D)\">Process of Minimization by Gradient Descent (2D)</a></li><li><a href=\"http://yihui.name/en/2007/08/tidy-up-your-r-code/\" rel=\"nofollow\" target=\"_blank\" title=\"Tidy up your R code\">Tidy up your R code</a></li><li><a href=\"http://yihui.name/en/2009/11/create-animations-in-pdf-documents-using-r/\" rel=\"nofollow\" target=\"_blank\" title=\"Create Animations in PDF Documents Using R\">Create Animations in PDF Documents Using R</a></li><li><a href=\"http://yihui.name/en/2009/10/50000-revisions-committed-to-r/\" rel=\"nofollow\" target=\"_blank\" title=\"50000 Revisions Committed to R\">50000 Revisions Committed to R</a></li><li><a href=\"http://yihui.name/en/2009/09/how-to-import-ms-excel-data-into-r/\" rel=\"nofollow\" target=\"_blank\" title=\"How to Import MS Excel Data into R\">How to Import MS Excel Data into R</a></li></ul>\n\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.0-->\n<p class=\"syndicated-attribution\"><div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"http://yihui.name/en/2009/03/enhanced-tidy-source/\"> Keep on Fighting! » R Language</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div></p> </div>\n<div class=\"post-tags clearfix\"><ul><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/parse/\" rel=\"tag\">parse()</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/r-code/\" rel=\"tag\">R code</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/r-language/\" rel=\"tag\">R Language</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/r-programming/\" rel=\"tag\">R Programming</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/tidy-source/\" rel=\"tag\">tidy.source()</a></li></ul></div></article>",
    "main_text": "Enhanced tidy.source() (Preserve Some Comments)\nPosted on\nMarch 31, 2009\nby\nYihui Xie\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nKeep on Fighting! » R Language\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nAfter a few hours’ work, I modified the function\ntidy.source()\nin the\nanimation\npackage so that it can preserve\ncomplete\ncomment lines. See the\ntidy.source()\nwiki page\nfor example.\nDowndload the R code here\ntidy.source <- function(source = \"clipboard\", keep.comment = TRUE,\n  keep.blank.line = FALSE, begin.comment, end.comment, ...) {\n  # parse and deparse the code\n  tidy.block = function(block.text) {\n      exprs = parse(text = block.text)\n      n = length(exprs)\n      res = character(n)\n      for (i in 1:n) {\n        dep = paste(deparse(exprs[i]), collapse = \"\\n\")\n        res[i] = substring(dep, 12, nchar(dep) - 1)\n      }\n      return(res)\n  }\n  text.lines = readLines(source, warn = FALSE)\n  if (keep.comment) {\n      # identifier for comments\n      identifier = function() paste(sample(LETTERS), collapse = \"\")\n      if (missing(begin.comment))\n        begin.comment = identifier()\n      if (missing(end.comment))\n        end.comment = identifier()\n      # remove leading and trailing white spaces\n      text.lines = gsub(\"^[[:space:]]+|[[:space:]]+$\", \"\",\n        text.lines)\n      # make sure the identifiers are not in the code\n      # or the original code might be modified\n      while (length(grep(sprintf(\"%s|%s\", begin.comment, end.comment),\n        text.lines))) {\n        begin.comment = identifier()\n        end.comment = identifier()\n      }\n      head.comment = substring(text.lines, 1, 1) == \"#\"\n      # add identifiers to comment lines to cheat R parser\n      if (any(head.comment)) {\n        text.lines[head.comment] = gsub(\"\\\"\", \"\\'\", text.lines[head.comment])\n        text.lines[head.comment] = sprintf(\"%s=\\\"%s%s\\\"\",\n          begin.comment, text.lines[head.comment], end.comment)\n      }\n      # keep blank lines?\n      blank.line = text.lines == \"\"\n      if (any(blank.line) & keep.blank.line)\n        text.lines[blank.line] = sprintf(\"%s=\\\"%s\\\"\", begin.comment,\n          end.comment)\n      text.tidy = tidy.block(text.lines)\n      # remove the identifiers\n      text.tidy = gsub(sprintf(\"%s = \\\"|%s\\\"\", begin.comment,\n        end.comment), \"\", text.tidy)\n  }\n  else {\n      text.tidy = tidy.block(text.lines)\n  }\n  cat(paste(text.tidy, collapse = \"\\n\"), \"\\n\", ...)\n  invisible(text.tidy)\n}\nNote that inline comments will still be removed. I don’t want to spend more time on dealing with inline comments any more.\nRelated Posts\nProcess of Minimization by Gradient Descent (2D)\nTidy up your R code\nCreate Animations in PDF Documents Using R\n50000 Revisions Committed to R\nHow to Import MS Excel Data into R\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nKeep on Fighting! » R Language\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nparse()\nR code\nR Language\nR Programming\ntidy.source()",
    "meta_description": "After a few hours’ work, I modified the function tidy.source() in the animation package so that it can preserve complete comment lines. See the tidy.source() wiki page for example. tidy.source",
    "meta_keywords": "parse(),r code,r language,r programming,tidy.source()",
    "og_description": "After a few hours’ work, I modified the function tidy.source() in the animation package so that it can preserve complete comment lines. See the tidy.source() wiki page for example. tidy.source",
    "og_image": "https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png",
    "og_title": "Enhanced tidy.source() (Preserve Some Comments) | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 2.5,
    "sitemap_lastmod": "2009-03-31T14:25:31+00:00",
    "twitter_description": "After a few hours’ work, I modified the function tidy.source() in the animation package so that it can preserve complete comment lines. See the tidy.source() wiki page for example. tidy.source",
    "twitter_title": "Enhanced tidy.source() (Preserve Some Comments) | R-bloggers",
    "url": "https://www.r-bloggers.com/2009/03/enhanced-tidy-source-preserve-some-comments/",
    "word_count": 494
  }
}