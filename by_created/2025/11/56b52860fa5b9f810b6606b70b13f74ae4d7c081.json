{
  "id": "56b52860fa5b9f810b6606b70b13f74ae4d7c081",
  "url": "https://www.r-bloggers.com/2025/02/demystifying-geom_bar-how-ggplot2-automatically-counts-and-transforms-data/",
  "created_at_utc": "2025-11-22T19:59:16Z",
  "data": null,
  "raw_original": {
    "uuid": "43cb18bc-2add-4e55-a7ed-22a41a5365d8",
    "created_at": "2025-11-22 19:59:16",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2025/02/demystifying-geom_bar-how-ggplot2-automatically-counts-and-transforms-data/",
      "crawled_at": "2025-11-22T10:54:17.632035",
      "external_links": [
        {
          "href": "https://www.codingthepast.com/2025/02/24/geom_bar.html",
          "text": "coding-the-past"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://github.com/sharonhoward/ll-coroners/blob/master/coroners_inquests/wa_coroners_inquests_v1-1.tsv",
          "text": "a dataset"
        },
        {
          "href": "https://www.londonlives.org/",
          "text": "London Lives 1690-1800: Crime, Poverty and Social Policy in the Metropolis"
        },
        {
          "href": "https://forcats.tidyverse.org/",
          "text": "forcats package"
        },
        {
          "href": "https://yjunechoe.github.io/posts/2020-09-26-demystifying-stat-layers-ggplot2/",
          "text": "this brilliant explanation"
        },
        {
          "href": "https://sharonhoward.org/",
          "text": "Sharon Howard"
        },
        {
          "href": "https://www.codingthepast.com/2025/02/24/geom_bar.html",
          "text": "coding-the-past"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Demystifying geom_bar() – How ggplot2 Automatically Counts and Transforms Data | R-bloggers",
      "images": [
        {
          "alt": "geom_bar plot",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "geom_bar plot",
          "base64": null,
          "src": "https://i0.wp.com/www.codingthepast.com/assets/images/lesson_26_01.png?w=578&ssl=1"
        },
        {
          "alt": "Statistical transformation in ggplot2",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Statistical transformation in ggplot2",
          "base64": null,
          "src": "https://i1.wp.com/www.codingthepast.com/assets/images/lesson_26_02.png?w=578&ssl=1"
        },
        {
          "alt": "reorder geom_bar",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "reorder geom_bar",
          "base64": null,
          "src": "https://i1.wp.com/www.codingthepast.com/assets/images/lesson_26_03.png?w=578&ssl=1"
        },
        {
          "alt": "stacked geom_bar",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "stacked geom_bar",
          "base64": null,
          "src": "https://i0.wp.com/www.codingthepast.com/assets/images/lesson_26_04.png?w=578&ssl=1"
        },
        {
          "alt": "percent stacked geom_bar",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "percent stacked geom_bar",
          "base64": null,
          "src": "https://i2.wp.com/www.codingthepast.com/assets/images/lesson_26_05.png?w=578&ssl=1"
        },
        {
          "alt": "percent stacked geom_bar for suicide cases",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "percent stacked geom_bar for suicide cases",
          "base64": null,
          "src": "https://i0.wp.com/www.codingthepast.com/assets/images/lesson_26_06.png?w=578&ssl=1"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/ponne-bruno/",
          "text": "Ponne, Bruno"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-390789 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Demystifying geom_bar() – How ggplot2 Automatically Counts and Transforms Data</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">February 23, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/ponne-bruno/\">Ponne, Bruno</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://www.codingthepast.com/2025/02/24/geom_bar.html\"> coding-the-past</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47--><p><br/></p>\n<p><strong>ggplot2</strong> is a powerful and well-known data visualization package for R. But do you know what <strong>gg</strong> stands for? It actually refers to the <strong>Grammar of Graphics</strong>, a conceptual framework for understanding and constructing graphs. The core idea behind the Grammar of Graphics is that a plot consists of multiple layers.</p>\n<p><br/></p>\n<p>The most well-known layers are <strong>geometries</strong> — the geometric forms that represent data in a plot — and <strong>aesthetic mappings</strong>, which connect data to specific visual properties. A lesser-known but equally important layer is the <strong>statistical layer</strong>, which transforms the original data to enable specific types of plots. This may sound complex at first, but it’s actually quite intuitive. In this lesson, we will explore how <code>geom_bar()</code> applies a statistical transformation to make bar plots simpler and more straightforward.</p>\n<p><br/></p>\n<h2 id=\"1-how-does-geom_bar-work-by-default\">1. How does geom_bar work by default?</h2>\n<p>To exemplify geom_bar’s default behavior, we will use <a href=\"https://github.com/sharonhoward/ll-coroners/blob/master/coroners_inquests/wa_coroners_inquests_v1-1.tsv\" rel=\"nofollow\" target=\"_blank\">a dataset</a> about Westminster inquests conducted between 1760 and 1799. \nThese inquests document investigations into deaths that occurred under sudden, unexplained, or suspicious circumstances. To learn more, please visit the project webpage <a href=\"https://www.londonlives.org/\" rel=\"nofollow\" target=\"_blank\">London Lives 1690-1800: Crime, Poverty and Social Policy in the Metropolis</a>.</p>\n<p><br/></p>\n<p>The first step is to load the data using <code>read_tsv()</code>, a function from the <code>readr</code> package used to read <em>tab-separated values</em>. The verdict variable tells us the conclusion of the investigation, which could be, for example that the death was a homicide or a suicide. \nTo simplify our analysis we unify ‘suicide (delirious)’, ‘suicide (felo de se)’, and ‘suicide (insane)’ into a single category: ‘suicide’. We also filter out observations where the verdict or gender is missing.</p>\n<p><br/></p>\n<p><span class=\"material-symbols-outlined\" data-cf-modified-9b3f02169f713d9126c6728d-=\"\" id=\"copy-button\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; copyCode('code-26-1')\">\n  content_copy\n  <span class=\"tooltiptext\">Copy</span>\n</span></p>\n<div id=\"code-26-1\">\n<figure class=\"highlight\"><pre>library(readr)\nlibrary(dplyr)\nlibrary(ggplot2)\n\ndf &lt;- read_tsv(\"wa_coroners_inquests_v1-1.tsv\")\n\ndf_prep &lt;- df %&gt;% \n  filter(verdict != \"-\") %&gt;% \n  filter(gender %in% c(\"m\", \"f\")) %&gt;% \n  mutate(verdict = recode(verdict, \"suicide (delirious)\" = \"suicide\",\n                          \"suicide (felo de se)\" = \"suicide\",\n                          \"suicide (insane)\" = \"suicide\"))</pre></figure>\n</div>\n<p><br/></p>\n<p>Each row of <code>df_prep</code> contains data about the investigation of one death, including the date, gender, and verdict. \nWe would like to have a first overview about the verdicts to determine how many deaths were classified as homicide, suicide, accidental, etc. \nThe default behavior of geom_bar makes it very easy to visualize this information:</p>\n<p><br/></p>\n<p><span class=\"material-symbols-outlined\" data-cf-modified-9b3f02169f713d9126c6728d-=\"\" id=\"copy-button\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; copyCode('code-26-2')\">\n  content_copy\n  <span class=\"tooltiptext\">Copy</span>\n</span></p>\n<div id=\"code-26-2\">\n<figure class=\"highlight\"><pre>theme_set(theme_bw()) # chooses a lighter ggplot2 theme: theme_bw()\n\nggplot(data = df_prep)+\n    geom_bar(aes(x=verdict))</pre></figure>\n</div>\n<p><br/></p>\n<p><img alt=\"geom_bar plot\" data-lazy-src=\"https://i0.wp.com/www.codingthepast.com/assets/images/lesson_26_01.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"geom_bar plot\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.codingthepast.com/assets/images/lesson_26_01.png?w=578&amp;ssl=1\"/></noscript></p>\n<p><br/></p>\n<p>Why does this work if we mapped a categorical variable to x? Where does ggplot2 get the count for each cause of death? \nWell, every geometry in ggplot2 has an associated default statistical transformation that tells ggplot whether it should consider the raw input data or whether it should first transform the dataset and then plot it. \nIn the case of geom_bar, the default stat is “count”. That means ggplot will create a second dataframe with the values of verdict and their respective frequency/count, as shown in the figure below.</p>\n<p><br/></p>\n<p><img alt=\"Statistical transformation in ggplot2\" data-lazy-src=\"https://i1.wp.com/www.codingthepast.com/assets/images/lesson_26_02.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"Statistical transformation in ggplot2\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/www.codingthepast.com/assets/images/lesson_26_02.png?w=578&amp;ssl=1\"/></noscript></p>\n<p><br/></p>\n<p>As you can see, ggplot2 does this work for you. But what if your data has already been transformed? In that case, you need to explicitly set <code>geom_bar(aes(x=verdict, y = count), stat = \"identity\")</code>. If stat is set to “identity”, then ggplot takes the raw input data and does not perform any transformation. In that case, note that an x and y are necessary.</p>\n<p><br/></p>\n<div class=\"text-note\">\n<span class=\"material-symbols-outlined\">\n        tips_and_updates\n    </span>\n<span class=\"text-note-title\">  </span>\n<div class=\"text-note-content\">  You can use the command `layer_data(plot = last_plot(), i = 1L)` to check out the data ggplot transformed for you. Use this command after the plot command. It will get the transformed data from the last plot, regarding i = 1L, or the first layer of our plot (geom_bar in this case).\n        \n    </div>\n</div>\n<p><br/></p>\n<hr/>\n<p><br/></p>\n<h2 id=\"2-how-to-reorder-geom_bar\">2. How to reorder geom_bar?</h2>\n<p>One improvement we can make to our plot is to reorder the verdicts so that the most frequent one comes first. This can be done with the help of the <a href=\"https://forcats.tidyverse.org/\" rel=\"nofollow\" target=\"_blank\">forcats package</a>. One of its functions, <code>fct_infreq()</code>, reorders a variable based on the frequency of its values (largest first).</p>\n<p><br/></p>\n<p><span class=\"material-symbols-outlined\" data-cf-modified-9b3f02169f713d9126c6728d-=\"\" id=\"copy-button\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; copyCode('code-26-3')\">\n  content_copy\n  <span class=\"tooltiptext\">Copy</span>\n</span></p>\n<div id=\"code-26-3\">\n<figure class=\"highlight\"><pre>ggplot(data = df_prep)+\n    geom_bar(aes(x=fct_infreq(verdict)))</pre></figure>\n</div>\n<p><br/></p>\n<p><br/></p>\n<p><img alt=\"reorder geom_bar\" data-lazy-src=\"https://i1.wp.com/www.codingthepast.com/assets/images/lesson_26_03.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"reorder geom_bar\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/www.codingthepast.com/assets/images/lesson_26_03.png?w=578&amp;ssl=1\"/></noscript></p>\n<p><br/></p>\n<hr/>\n<p><br/></p>\n<h2 id=\"3-stacked-and-percent-stacked-geom_bar\">3. Stacked and percent stacked geom_bar</h2>\n<p>Imagine now that you would like to investigate how the verdicts compare across genders, highlighting the cases involving female individuals. \nThis can easily be achieved by mapping gender to the fill aesthetics. The result is two bars on top of each other, one referring to male and other to female.</p>\n<p><br/></p>\n<p>In the code below, we also make our plot more visually attractive by changing the colors, legend title, and labels. Moreover, we adjust the axis labels.</p>\n<p><br/></p>\n<p><span class=\"material-symbols-outlined\" data-cf-modified-9b3f02169f713d9126c6728d-=\"\" id=\"copy-button\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; copyCode('code-26-4')\">\n  content_copy\n  <span class=\"tooltiptext\">Copy</span>\n</span></p>\n<div id=\"code-26-4\">\n<figure class=\"highlight\"><pre>ggplot(data = df_prep)+\n    geom_bar(aes(x=fct_infreq(verdict), fill = gender))+\n    scale_fill_manual(name = \"\", values = c(\"#f79326\", \"gray\"), labels = c(\"Female\", \"Male\"))+\n    labs(x = \"\", y = \"Number of Cases\")</pre></figure>\n</div>\n<p><br/></p>\n<p><img alt=\"stacked geom_bar\" data-lazy-src=\"https://i0.wp.com/www.codingthepast.com/assets/images/lesson_26_04.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"stacked geom_bar\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.codingthepast.com/assets/images/lesson_26_04.png?w=578&amp;ssl=1\"/></noscript></p>\n<p><br/></p>\n<p>The stacked bar chart above results from the default <code>position = \"stack\"</code> configuration. \nTo better visualize the distribution of female and male cases for each cause of death (verdict), we can display the percentages instead of absolute counts. \nThis approach makes it easier to see in which verdict category females have a higher proportion.\nTo achieve this, you need to change position to <code>position = \"fill\"</code> in geom_bar().</p>\n<p><br/></p>\n<p><span class=\"material-symbols-outlined\" data-cf-modified-9b3f02169f713d9126c6728d-=\"\" id=\"copy-button\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; copyCode('code-26-5')\">\n  content_copy\n  <span class=\"tooltiptext\">Copy</span>\n</span></p>\n<div id=\"code-26-5\">\n<figure class=\"highlight\"><pre>ggplot(data = df_prep)+\n    geom_bar(aes(x=fct_infreq(verdict), fill = gender), position = \"fill\")+\n    scale_fill_manual(name = \"\", values = c(\"#f79326\", \"gray\"), labels = c(\"Female\", \"Male\"))+\n    labs(x = \"\", y = \"Percentage\")</pre></figure>\n</div>\n<p><br/></p>\n<p><img alt=\"percent stacked geom_bar\" data-lazy-src=\"https://i2.wp.com/www.codingthepast.com/assets/images/lesson_26_05.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"percent stacked geom_bar\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/www.codingthepast.com/assets/images/lesson_26_05.png?w=578&amp;ssl=1\"/></noscript></p>\n<p><br/></p>\n<p>Now it is clearer that, among all causes of death, homicides have the highest proportion of women. Moreover, the smallest percentage of female cases corresponds to accidental deaths.</p>\n<p><br/></p>\n<hr/>\n<p><br/></p>\n<h2 id=\"4-use-stat_bin-to-group-observations-by-date\">4. Use stat_bin to group observations by date</h2>\n<p>Further examining the data, you want to study how the proportion of suicide cases among women has evolved over time. \nOne way to do this is by filtering only suicide verdicts and visualizing the proportion of female suicide cases across time. \nSince we have data spanning multiple years, it is a good idea to group them into bins and count the cases within each period. \nThis can be done using stat_bin(), which works similarly to geom_bar() but groups data into bins.</p>\n<p><br/>\nSince our dataset is in a tidy format — where each row represents a single case — we can count the number of occurrences within a specific bin to determine how many cases fall into each time interval. That’s why we set x to doc_date, the date of the investigation. Additionally, we can specify the number of bins by setting a value for the bins parameter. In the code below, we set bins = 10. We also set color = “white” to create white borders around the bars. Apart from these modifications, the code remains the same as in the geom_bar() example above.</p>\n<p><br/></p>\n<p><span class=\"material-symbols-outlined\" data-cf-modified-9b3f02169f713d9126c6728d-=\"\" id=\"copy-button\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; copyCode('code-26-6')\">\n  content_copy\n  <span class=\"tooltiptext\">Copy</span>\n</span></p>\n<div id=\"code-26-6\">\n<figure class=\"highlight\"><pre>ggplot(data = df_prep_2)+\n    stat_bin(aes(x=doc_date, fill = gender), \n             position = \"fill\", \n             bins = 10, \n             color = \"white\")+\n    scale_fill_manual(name = \"\", values = c(\"#f79326\", \"gray\"), labels = c(\"Female\", \"Male\"))+\n    labs(x = \"\", y = \"Percentage\")</pre></figure>\n</div>\n<p><br/></p>\n<p><img alt=\"percent stacked geom_bar for suicide cases\" data-lazy-src=\"https://i0.wp.com/www.codingthepast.com/assets/images/lesson_26_06.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"percent stacked geom_bar for suicide cases\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.codingthepast.com/assets/images/lesson_26_06.png?w=578&amp;ssl=1\"/></noscript></p>\n<p><br/></p>\n<p>The plot shows a slight decreasing trend in the proportion of female suicide cases between 1760 and 1800. It also highlights that, throughout the entire period, males accounted for at least 60% of suicide cases.</p>\n<p><br/></p>\n<p>I would love to hear any feedback or suggestions for improving the plots above. Feel free to share your thoughts or ask any questions in the comments below! Happy coding!</p>\n<p><br/></p>\n<hr/>\n<p><br/></p>\n<h1 id=\"conclusions\">Conclusions</h1>\n<ul class=\"conclusion-list\">\n<li>geom_bar and stat_bin are powerful tools to depict frequencies of subgroups in your data;</li>\n<li>The geom_bar <code>stat</code> and <code>position</code> parameters allow users to plot several kinds of bar plots, turning geom_bar into a versatile visualization tool.</li>\n</ul>\n<p><br/></p>\n<hr/>\n<p><br/></p>\n<p>**I would like to thank June Choe for <a href=\"https://yjunechoe.github.io/posts/2020-09-26-demystifying-stat-layers-ggplot2/\" rel=\"nofollow\" target=\"_blank\">this brilliant explanation</a> about stat_layers in ggplot2.\nAlso, thanks a lot to <a href=\"https://sharonhoward.org/\" rel=\"nofollow\" target=\"_blank\">Sharon Howard</a> for preparing this instigating dataset and for making it available.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://www.codingthepast.com/2025/02/24/geom_bar.html\"> coding-the-past</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
      "main_text": "Demystifying geom_bar() – How ggplot2 Automatically Counts and Transforms Data\nPosted on\nFebruary 23, 2025\nby\nPonne, Bruno\nin\nR bloggers\n| 0 Comments\n[This article was first published on\ncoding-the-past\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nggplot2\nis a powerful and well-known data visualization package for R. But do you know what\ngg\nstands for? It actually refers to the\nGrammar of Graphics\n, a conceptual framework for understanding and constructing graphs. The core idea behind the Grammar of Graphics is that a plot consists of multiple layers.\nThe most well-known layers are\ngeometries\n— the geometric forms that represent data in a plot — and\naesthetic mappings\n, which connect data to specific visual properties. A lesser-known but equally important layer is the\nstatistical layer\n, which transforms the original data to enable specific types of plots. This may sound complex at first, but it’s actually quite intuitive. In this lesson, we will explore how\ngeom_bar()\napplies a statistical transformation to make bar plots simpler and more straightforward.\n1. How does geom_bar work by default?\nTo exemplify geom_bar’s default behavior, we will use\na dataset\nabout Westminster inquests conducted between 1760 and 1799. \nThese inquests document investigations into deaths that occurred under sudden, unexplained, or suspicious circumstances. To learn more, please visit the project webpage\nLondon Lives 1690-1800: Crime, Poverty and Social Policy in the Metropolis\n.\nThe first step is to load the data using\nread_tsv()\n, a function from the\nreadr\npackage used to read\ntab-separated values\n. The verdict variable tells us the conclusion of the investigation, which could be, for example that the death was a homicide or a suicide. \nTo simplify our analysis we unify ‘suicide (delirious)’, ‘suicide (felo de se)’, and ‘suicide (insane)’ into a single category: ‘suicide’. We also filter out observations where the verdict or gender is missing.\ncontent_copy\nCopy\nlibrary(readr)\nlibrary(dplyr)\nlibrary(ggplot2)\n\ndf <- read_tsv(\"wa_coroners_inquests_v1-1.tsv\")\n\ndf_prep <- df %>% \n  filter(verdict != \"-\") %>% \n  filter(gender %in% c(\"m\", \"f\")) %>% \n  mutate(verdict = recode(verdict, \"suicide (delirious)\" = \"suicide\",\n                          \"suicide (felo de se)\" = \"suicide\",\n                          \"suicide (insane)\" = \"suicide\"))\nEach row of\ndf_prep\ncontains data about the investigation of one death, including the date, gender, and verdict. \nWe would like to have a first overview about the verdicts to determine how many deaths were classified as homicide, suicide, accidental, etc. \nThe default behavior of geom_bar makes it very easy to visualize this information:\ncontent_copy\nCopy\ntheme_set(theme_bw()) # chooses a lighter ggplot2 theme: theme_bw()\n\nggplot(data = df_prep)+\n    geom_bar(aes(x=verdict))\nWhy does this work if we mapped a categorical variable to x? Where does ggplot2 get the count for each cause of death? \nWell, every geometry in ggplot2 has an associated default statistical transformation that tells ggplot whether it should consider the raw input data or whether it should first transform the dataset and then plot it. \nIn the case of geom_bar, the default stat is “count”. That means ggplot will create a second dataframe with the values of verdict and their respective frequency/count, as shown in the figure below.\nAs you can see, ggplot2 does this work for you. But what if your data has already been transformed? In that case, you need to explicitly set\ngeom_bar(aes(x=verdict, y = count), stat = \"identity\")\n. If stat is set to “identity”, then ggplot takes the raw input data and does not perform any transformation. In that case, note that an x and y are necessary.\ntips_and_updates\nYou can use the command `layer_data(plot = last_plot(), i = 1L)` to check out the data ggplot transformed for you. Use this command after the plot command. It will get the transformed data from the last plot, regarding i = 1L, or the first layer of our plot (geom_bar in this case).\n2. How to reorder geom_bar?\nOne improvement we can make to our plot is to reorder the verdicts so that the most frequent one comes first. This can be done with the help of the\nforcats package\n. One of its functions,\nfct_infreq()\n, reorders a variable based on the frequency of its values (largest first).\ncontent_copy\nCopy\nggplot(data = df_prep)+\n    geom_bar(aes(x=fct_infreq(verdict)))\n3. Stacked and percent stacked geom_bar\nImagine now that you would like to investigate how the verdicts compare across genders, highlighting the cases involving female individuals. \nThis can easily be achieved by mapping gender to the fill aesthetics. The result is two bars on top of each other, one referring to male and other to female.\nIn the code below, we also make our plot more visually attractive by changing the colors, legend title, and labels. Moreover, we adjust the axis labels.\ncontent_copy\nCopy\nggplot(data = df_prep)+\n    geom_bar(aes(x=fct_infreq(verdict), fill = gender))+\n    scale_fill_manual(name = \"\", values = c(\"#f79326\", \"gray\"), labels = c(\"Female\", \"Male\"))+\n    labs(x = \"\", y = \"Number of Cases\")\nThe stacked bar chart above results from the default\nposition = \"stack\"\nconfiguration. \nTo better visualize the distribution of female and male cases for each cause of death (verdict), we can display the percentages instead of absolute counts. \nThis approach makes it easier to see in which verdict category females have a higher proportion.\nTo achieve this, you need to change position to\nposition = \"fill\"\nin geom_bar().\ncontent_copy\nCopy\nggplot(data = df_prep)+\n    geom_bar(aes(x=fct_infreq(verdict), fill = gender), position = \"fill\")+\n    scale_fill_manual(name = \"\", values = c(\"#f79326\", \"gray\"), labels = c(\"Female\", \"Male\"))+\n    labs(x = \"\", y = \"Percentage\")\nNow it is clearer that, among all causes of death, homicides have the highest proportion of women. Moreover, the smallest percentage of female cases corresponds to accidental deaths.\n4. Use stat_bin to group observations by date\nFurther examining the data, you want to study how the proportion of suicide cases among women has evolved over time. \nOne way to do this is by filtering only suicide verdicts and visualizing the proportion of female suicide cases across time. \nSince we have data spanning multiple years, it is a good idea to group them into bins and count the cases within each period. \nThis can be done using stat_bin(), which works similarly to geom_bar() but groups data into bins.\nSince our dataset is in a tidy format — where each row represents a single case — we can count the number of occurrences within a specific bin to determine how many cases fall into each time interval. That’s why we set x to doc_date, the date of the investigation. Additionally, we can specify the number of bins by setting a value for the bins parameter. In the code below, we set bins = 10. We also set color = “white” to create white borders around the bars. Apart from these modifications, the code remains the same as in the geom_bar() example above.\ncontent_copy\nCopy\nggplot(data = df_prep_2)+\n    stat_bin(aes(x=doc_date, fill = gender), \n             position = \"fill\", \n             bins = 10, \n             color = \"white\")+\n    scale_fill_manual(name = \"\", values = c(\"#f79326\", \"gray\"), labels = c(\"Female\", \"Male\"))+\n    labs(x = \"\", y = \"Percentage\")\nThe plot shows a slight decreasing trend in the proportion of female suicide cases between 1760 and 1800. It also highlights that, throughout the entire period, males accounted for at least 60% of suicide cases.\nI would love to hear any feedback or suggestions for improving the plots above. Feel free to share your thoughts or ask any questions in the comments below! Happy coding!\nConclusions\ngeom_bar and stat_bin are powerful tools to depict frequencies of subgroups in your data;\nThe geom_bar\nstat\nand\nposition\nparameters allow users to plot several kinds of bar plots, turning geom_bar into a versatile visualization tool.\n**I would like to thank June Choe for\nthis brilliant explanation\nabout stat_layers in ggplot2.\nAlso, thanks a lot to\nSharon Howard\nfor preparing this instigating dataset and for making it available.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\ncoding-the-past\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "ggplot2 is a powerful and well-known data visualization package for R. But do you know what gg stands for? It actually refers to the Grammar of Graphics, a conceptual framework for understanding and constructing graphs. The core idea behind the Gramm...",
      "meta_keywords": null,
      "og_description": "ggplot2 is a powerful and well-known data visualization package for R. But do you know what gg stands for? It actually refers to the Grammar of Graphics, a conceptual framework for understanding and constructing graphs. The core idea behind the Gramm...",
      "og_image": "https://www.codingthepast.com/assets/images/lesson_26_01.png",
      "og_title": "Demystifying geom_bar() – How ggplot2 Automatically Counts and Transforms Data | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 6.9,
      "sitemap_lastmod": null,
      "twitter_description": "ggplot2 is a powerful and well-known data visualization package for R. But do you know what gg stands for? It actually refers to the Grammar of Graphics, a conceptual framework for understanding and constructing graphs. The core idea behind the Gramm...",
      "twitter_title": "Demystifying geom_bar() – How ggplot2 Automatically Counts and Transforms Data | R-bloggers",
      "url": "https://www.r-bloggers.com/2025/02/demystifying-geom_bar-how-ggplot2-automatically-counts-and-transforms-data/",
      "word_count": 1381
    }
  }
}