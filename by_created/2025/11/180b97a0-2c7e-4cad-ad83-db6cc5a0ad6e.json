{
  "uuid": "180b97a0-2c7e-4cad-ad83-db6cc5a0ad6e",
  "created_at": "2025-11-22 19:58:54",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2025/04/extending-the-theta-forecasting-method-to-glms-and-attention/",
    "crawled_at": "2025-11-22T10:51:05.220386",
    "external_links": [
      {
        "href": "https://thierrymoudiki.github.io//blog/2025/04/08/r/python/glm-thetaf",
        "text": "T. Moudiki's Webpage - R"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://r-packages.techtonique.net/",
        "text": "aheadpackage"
      },
      {
        "href": "https://en.wikipedia.org/wiki/Attention_(machine_learning)",
        "text": "attention mechanism"
      },
      {
        "href": "https://colab.research.google.com/github/thierrymoudiki/notebooks/blob/main/Python/2025_04_08_theta_attention_Tourism2010.ipynb",
        "text": null
      },
      {
        "href": "https://thierrymoudiki.github.io//blog/2025/04/08/r/python/glm-thetaf",
        "text": "T. Moudiki's Webpage - R"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Extending the Theta forecasting method to GLMs and attention | R-bloggers",
    "images": [
      {
        "alt": "image-title-here",
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": "image-title-here",
        "base64": null,
        "src": "https://i2.wp.com/thierrymoudiki.github.io/images/2025-04-08/2025-04-08-image1.png?w=578&ssl=1"
      },
      {
        "alt": "Open In Colab",
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": "Open In Colab",
        "base64": "data:image/jpeg;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTE3IiBoZWlnaHQ9IjIwIj48bGluZWFyR3JhZGllbnQgaWQ9ImIiIHgyPSIwIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjYmJiIiBzdG9wLW9wYWNpdHk9Ii4xIi8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLW9wYWNpdHk9Ii4xIi8+PC9saW5lYXJHcmFkaWVudD48Y2xpcFBhdGggaWQ9ImEiPjxyZWN0IHdpZHRoPSIxMTciIGhlaWdodD0iMjAiIHJ4PSIzIiBmaWxsPSIjZmZmIi8+PC9jbGlwUGF0aD48ZyBjbGlwLXBhdGg9InVybCgjYSkiPjxwYXRoIGZpbGw9IiM1NTUiIGQ9Ik0wIDBoMzB2MjBIMHoiLz48cGF0aCBmaWxsPSIjMDA3ZWM2IiBkPSJNMzAgMGg4N3YyMEgzMHoiLz48cGF0aCBmaWxsPSJ1cmwoI2IpIiBkPSJNMCAwaDExN3YyMEgweiIvPjwvZz48ZyBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iRGVqYVZ1IFNhbnMsVmVyZGFuYSxHZW5ldmEsc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMTAiPjxzdmcgeD0iNHB4IiB5PSIwcHgiIHdpZHRoPSIyMnB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9Ii0yIDAgMjggMjQiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmO2JvcmRlci1yYWRpdXM6IDFweDsiPjxwYXRoIHN0eWxlPSJmaWxsOiNlODcxMGE7IiBkPSJNMS45NzcsMTYuNzdjLTIuNjY3LTIuMjc3LTIuNjA1LTcuMDc5LDAtOS4zNTdDMi45MTksOC4wNTcsMy41MjIsOS4wNzUsNC40OSw5LjY5MWMtMS4xNTIsMS42LTEuMTQ2LDMuMjAxLTAuMDA0LDQuODAzQzMuNTIyLDE1LjExMSwyLjkxOCwxNi4xMjYsMS45NzcsMTYuNzd6Ii8+PHBhdGggc3R5bGU9ImZpbGw6I2Y5YWIwMDsiIGQ9Ik0xMi4yNTcsMTcuMTE0Yy0xLjc2Ny0xLjYzMy0yLjQ4NS0zLjY1OC0yLjExOC02LjAyYzAuNDUxLTIuOTEsMi4xMzktNC44OTMsNC45NDYtNS42NzhjMi41NjUtMC43MTgsNC45NjQtMC4yMTcsNi44NzgsMS44MTljLTAuODg0LDAuNzQzLTEuNzA3LDEuNTQ3LTIuNDM0LDIuNDQ2QzE4LjQ4OCw4LjgyNywxNy4zMTksOC40MzUsMTYsOC44NTZjLTIuNDA0LDAuNzY3LTMuMDQ2LDMuMjQxLTEuNDk0LDUuNjQ0Yy0wLjI0MSwwLjI3NS0wLjQ5MywwLjU0MS0wLjcyMSwwLjgyNkMxMy4yOTUsMTUuOTM5LDEyLjUxMSwxNi4zLDEyLjI1NywxNy4xMTR6Ii8+PHBhdGggc3R5bGU9ImZpbGw6I2U4NzEwYTsiIGQ9Ik0xOS41MjksOS42ODJjMC43MjctMC44OTksMS41NS0xLjcwMywyLjQzNC0yLjQ0NmMyLjcwMywyLjc4MywyLjcwMSw3LjAzMS0wLjAwNSw5Ljc2NGMtMi42NDgsMi42NzQtNi45MzYsMi43MjUtOS43MDEsMC4xMTVjMC4yNTQtMC44MTQsMS4wMzgtMS4xNzUsMS41MjgtMS43ODhjMC4yMjgtMC4yODUsMC40OC0wLjU1MiwwLjcyMS0wLjgyNmMxLjA1MywwLjkxNiwyLjI1NCwxLjI2OCwzLjYsMC44M0MyMC41MDIsMTQuNTUxLDIxLjE1MSwxMS45MjcsMTkuNTI5LDkuNjgyeiIvPjxwYXRoIHN0eWxlPSJmaWxsOiNmOWFiMDA7IiBkPSJNNC40OSw5LjY5MUMzLjUyMiw5LjA3NSwyLjkxOSw4LjA1NywxLjk3Nyw3LjQxM2MyLjIwOS0yLjM5OCw1LjcyMS0yLjk0Miw4LjQ3Ni0xLjM1NWMwLjU1NSwwLjMyLDAuNzE5LDAuNjA2LDAuMjg1LDEuMTI4Yy0wLjE1NywwLjE4OC0wLjI1OCwwLjQyMi0wLjM5MSwwLjYzMWMtMC4yOTksMC40Ny0wLjUwOSwxLjA2Ny0wLjkyOSwxLjM3MUM4LjkzMyw5LjUzOSw4LjUyMyw4Ljg0Nyw4LjAyMSw4Ljc0NkM2LjY3Myw4LjQ3NSw1LjUwOSw4Ljc4Nyw0LjQ5LDkuNjkxeiIvPjxwYXRoIHN0eWxlPSJmaWxsOiNmOWFiMDA7IiBkPSJNMS45NzcsMTYuNzdjMC45NDEtMC42NDQsMS41NDUtMS42NTksMi41MDktMi4yNzdjMS4zNzMsMS4xNTIsMi44NSwxLjQzMyw0LjQ1LDAuNDk5YzAuMzMyLTAuMTk0LDAuNTAzLTAuMDg4LDAuNjczLDAuMTljMC4zODYsMC42MzUsMC43NTMsMS4yODUsMS4xODEsMS44OWMwLjM0LDAuNDgsMC4yMjIsMC43MTUtMC4yNTMsMS4wMDZDNy44NCwxOS43Myw0LjIwNSwxOS4xODgsMS45NzcsMTYuNzd6Ii8+PC9zdmc+PHRleHQgeD0iMjQ1IiB5PSIxNDAiIHRyYW5zZm9ybT0ic2NhbGUoLjEpIiB0ZXh0TGVuZ3RoPSIzMCI+IDwvdGV4dD48dGV4dCB4PSI3MjUiIHk9IjE1MCIgZmlsbD0iIzAxMDEwMSIgZmlsbC1vcGFjaXR5PSIuMyIgdHJhbnNmb3JtPSJzY2FsZSguMSkiIHRleHRMZW5ndGg9Ijc3MCI+T3BlbiBpbiBDb2xhYjwvdGV4dD48dGV4dCB4PSI3MjUiIHk9IjE0MCIgdHJhbnNmb3JtPSJzY2FsZSguMSkiIHRleHRMZW5ndGg9Ijc3MCI+T3BlbiBpbiBDb2xhYjwvdGV4dD48L2c+IDwvc3ZnPgo=",
        "src": "https://colab.research.google.com/assets/colab-badge.svg"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/t-moudiki/",
        "text": "T. Moudiki"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-391740 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Extending the Theta forecasting method to GLMs and attention</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">April 7, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/t-moudiki/\">T. Moudiki</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://thierrymoudiki.github.io//blog/2025/04/08/r/python/glm-thetaf\"> T. Moudiki's Webpage - R</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47--><p>In the new version (<code>v0.18.0</code>) of the <a href=\"https://r-packages.techtonique.net/\" rel=\"nofollow\" target=\"_blank\"><code>ahead</code> package</a>, I have extended the <code>forecast::thetaf</code> function to support Generalized Linear Models (GLMs) and added an <a href=\"https://en.wikipedia.org/wiki/Attention_(machine_learning)\" rel=\"nofollow\" target=\"_blank\">attention mechanism</a>.</p>\n<p>Attention is widely used in current neural networks (because they tend to forget; blame it on the gradients ðŸ™‚ ) to focus on specific parts of the input data when making predictions.</p>\n<p>In this case, it helps the model to learn which parts of the time series are more important for forecasting, by using weighted averages of the past observations.</p>\n<p>More on this later <strong>in a paper</strong>. A link to a notebook containing Python and R examples is provided at the end of this post.</p>\n<h1 id=\"1---r-version\">1 â€“ R version</h1>\n<p>Start with:</p>\n<pre>options(repos = c(\n    techtonique = \"https://r-packages.techtonique.net\",\n    CRAN = \"https://cloud.r-project.org\"\n))\ninstall.packages(\"ahead\")\n</pre>\n<h1 id=\"1---1---usaccdeaths\">1 â€“ 1 â€“ USAccDeaths</h1>\n<pre>library(forecast)\nlibrary(ahead)\n\n# glm.nb\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::glm.nb, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::glm.nb, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# glm\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=stats::glm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=stats::glm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# rlm\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::rlm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::rlm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# lqs\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::lqs, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::lqs, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# lm\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=stats::lm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=stats::lm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# gam\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=gam::gam, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=gam::gam, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# rq\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=quantreg::rq, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=quantreg::rq, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n</pre>\n<h1 id=\"1---2---airpassengers\">1 - 2 - AirPassengers</h1>\n<pre># glm.nb\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::glm.nb, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::glm.nb, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# glm\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=stats::glm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=stats::glm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# rlm\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::rlm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::rlm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# lm\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=stats::lm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=stats::lm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# lqs\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::lqs, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::lqs, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# gam\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=gam::gam, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=gam::gam, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# rq\npar(mfrow=c(2,1))\nobj1 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=quantreg::rq, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 &lt;- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=quantreg::rq, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n</pre>\n<h1 id=\"2---python-version\">2 - Python version</h1>\n<pre>from rpy2.robjects.packages import importr\nfrom rpy2.robjects import r\nimport rpy2.robjects as ro\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom rpy2.robjects import pandas2ri\n\n# Import required R packages\nahead = importr('ahead')\nmass = importr('MASS')\nbase = importr('base')\nstats = importr('stats')\n\n# Get the data and fit the model\nwith localconverter(ro.default_converter):\n    # Get AirPassengers data\n    data = r('USAccDeaths')\n    data = np.array(data)\n    \n    # Fit the model\n    fit = r('''\n        suppressWarnings(\n            ahead::glmthetaf(\n                USAccDeaths, \n                h=25L, \n                fit_func=MASS::glm.nb, \n                attention=TRUE, \n                type_pi=\"conformal-split\", \n                method=\"adj\"\n            )\n        )\n    ''')\n    \n    # Extract predictions and intervals\n    forecasts = np.array(fit.rx2('mean'))\n    lower = np.array(fit.rx2('lower'))\n    upper = np.array(fit.rx2('upper'))\n\n# Create time indices\ntime_train = np.arange(len(data))\ntime_test = np.arange(len(data), len(data) + len(forecasts))\n\n# Create the plot\nplt.figure(figsize=(12, 6))\n\n# Plot training data\nplt.plot(time_train, data, 'b-', label='Observed', alpha=0.7)\n\n# Plot forecasts and prediction intervals\nplt.plot(time_test, forecasts, 'r--', label='Forecast')\nplt.fill_between(time_test, lower, upper, \n                 color='r', alpha=0.2, \n                 label='95% Prediction Interval')\n\n# Customize the plot\nplt.title('USAccDeaths Forecast with Attention')\nplt.xlabel('Time')\nplt.ylabel('-')\nplt.legend()\nplt.grid(True, alpha=0.3)\n\n# Show the plot\nplt.tight_layout()\nplt.show()\n</pre>\n<p><img alt=\"image-title-here\" data-lazy-src=\"https://i2.wp.com/thierrymoudiki.github.io/images/2025-04-08/2025-04-08-image1.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"image-title-here\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/thierrymoudiki.github.io/images/2025-04-08/2025-04-08-image1.png?w=578&amp;ssl=1\"/></noscript></p>\n<p><a href=\"https://colab.research.google.com/github/thierrymoudiki/notebooks/blob/main/Python/2025_04_08_theta_attention_Tourism2010.ipynb\" rel=\"nofollow\" target=\"_blank\">\n<img alt=\"Open In Colab\" data-lazy-src=\"https://colab.research.google.com/assets/colab-badge.svg\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"Open In Colab\" src=\"https://colab.research.google.com/assets/colab-badge.svg\"/></noscript>\n</a></p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://thierrymoudiki.github.io//blog/2025/04/08/r/python/glm-thetaf\"> T. Moudiki's Webpage - R</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
    "main_text": "Extending the Theta forecasting method to GLMs and attention\nPosted on\nApril 7, 2025\nby\nT. Moudiki\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nT. Moudiki's Webpage - R\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nIn the new version (\nv0.18.0\n) of the\nahead\npackage\n, I have extended the\nforecast::thetaf\nfunction to support Generalized Linear Models (GLMs) and added an\nattention mechanism\n.\nAttention is widely used in current neural networks (because they tend to forget; blame it on the gradients ðŸ™‚ ) to focus on specific parts of the input data when making predictions.\nIn this case, it helps the model to learn which parts of the time series are more important for forecasting, by using weighted averages of the past observations.\nMore on this later\nin a paper\n. A link to a notebook containing Python and R examples is provided at the end of this post.\n1 â€“ R version\nStart with:\noptions(repos = c(\n    techtonique = \"https://r-packages.techtonique.net\",\n    CRAN = \"https://cloud.r-project.org\"\n))\ninstall.packages(\"ahead\")\n1 â€“ 1 â€“ USAccDeaths\nlibrary(forecast)\nlibrary(ahead)\n\n# glm.nb\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::glm.nb, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::glm.nb, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# glm\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=stats::glm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=stats::glm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# rlm\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::rlm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::rlm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# lqs\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::lqs, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=MASS::lqs, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# lm\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=stats::lm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=stats::lm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# gam\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=gam::gam, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=gam::gam, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# rq\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=quantreg::rq, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(USAccDeaths, h=25L, fit_func=quantreg::rq, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n1 - 2 - AirPassengers\n# glm.nb\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::glm.nb, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::glm.nb, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# glm\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=stats::glm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=stats::glm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# rlm\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::rlm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::rlm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# lm\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=stats::lm, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=stats::lm, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# lqs\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::lqs, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=MASS::lqs, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# gam\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=gam::gam, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=gam::gam, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n\n# rq\npar(mfrow=c(2,1))\nobj1 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=quantreg::rq, attention = TRUE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj1, main=\"With attention\")\nobj2 <- suppressWarnings(ahead::glmthetaf(AirPassengers, h=25L, fit_func=quantreg::rq, attention = FALSE, type_pi = \"conformal-split\", method = \"adj\"))\nplot(obj2, main=\"Without attention\")\n2 - Python version\nfrom rpy2.robjects.packages import importr\nfrom rpy2.robjects import r\nimport rpy2.robjects as ro\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom rpy2.robjects import pandas2ri\n\n# Import required R packages\nahead = importr('ahead')\nmass = importr('MASS')\nbase = importr('base')\nstats = importr('stats')\n\n# Get the data and fit the model\nwith localconverter(ro.default_converter):\n    # Get AirPassengers data\n    data = r('USAccDeaths')\n    data = np.array(data)\n    \n    # Fit the model\n    fit = r('''\n        suppressWarnings(\n            ahead::glmthetaf(\n                USAccDeaths, \n                h=25L, \n                fit_func=MASS::glm.nb, \n                attention=TRUE, \n                type_pi=\"conformal-split\", \n                method=\"adj\"\n            )\n        )\n    ''')\n    \n    # Extract predictions and intervals\n    forecasts = np.array(fit.rx2('mean'))\n    lower = np.array(fit.rx2('lower'))\n    upper = np.array(fit.rx2('upper'))\n\n# Create time indices\ntime_train = np.arange(len(data))\ntime_test = np.arange(len(data), len(data) + len(forecasts))\n\n# Create the plot\nplt.figure(figsize=(12, 6))\n\n# Plot training data\nplt.plot(time_train, data, 'b-', label='Observed', alpha=0.7)\n\n# Plot forecasts and prediction intervals\nplt.plot(time_test, forecasts, 'r--', label='Forecast')\nplt.fill_between(time_test, lower, upper, \n                 color='r', alpha=0.2, \n                 label='95% Prediction Interval')\n\n# Customize the plot\nplt.title('USAccDeaths Forecast with Attention')\nplt.xlabel('Time')\nplt.ylabel('-')\nplt.legend()\nplt.grid(True, alpha=0.3)\n\n# Show the plot\nplt.tight_layout()\nplt.show()\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nT. Moudiki's Webpage - R\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "Python and R examples of use of the Theta model for GLMs and attention (context)",
    "meta_keywords": null,
    "og_description": "Python and R examples of use of the Theta model for GLMs and attention (context)",
    "og_image": "https://thierrymoudiki.github.io/images/2025-04-08/2025-04-08-image1.png",
    "og_title": "Extending the Theta forecasting method to GLMs and attention | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 6,
    "sitemap_lastmod": null,
    "twitter_description": "Python and R examples of use of the Theta model for GLMs and attention (context)",
    "twitter_title": "Extending the Theta forecasting method to GLMs and attention | R-bloggers",
    "url": "https://www.r-bloggers.com/2025/04/extending-the-theta-forecasting-method-to-glms-and-attention/",
    "word_count": 1207
  }
}