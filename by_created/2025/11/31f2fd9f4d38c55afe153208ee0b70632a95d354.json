{
  "id": "31f2fd9f4d38c55afe153208ee0b70632a95d354",
  "url": "https://www.r-bloggers.com/2025/10/inequality-and-homicide-within-country-and-between-country-by-ellis2013nz/",
  "created_at_utc": "2025-11-22T19:57:28Z",
  "data": null,
  "raw_original": {
    "uuid": "1bc2466d-29f7-41a1-8272-64efffd66ed9",
    "created_at": "2025-11-22 19:57:28",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2025/10/inequality-and-homicide-within-country-and-between-country-by-ellis2013nz/",
      "crawled_at": "2025-11-22T10:41:45.638850",
      "external_links": [
        {
          "href": "https://freerangestats.info/blog/2025/10/18/homicide-and-gini",
          "text": "free range statistics - R"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://mastodon.sdf.org/@dlakelan/115055789165555934",
          "text": "this post (toot?) on Mastodon"
        },
        {
          "href": "https://github.com/ellisp/blog-source/blob/master/_working/0303-homicide-inequality.R",
          "text": "found on GitHub"
        },
        {
          "href": "https://freerangestats.info/blog/2025/10/18/homicide-and-gini",
          "text": "free range statistics - R"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Inequality and homicide, within-country and between country by @ellis2013nz | R-bloggers",
      "images": [
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i2.wp.com/freerangestats.info/img/0303-scatter.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/freerangestats.info/img/0303-number-obs.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i1.wp.com/freerangestats.info/img/0303-faceted.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i2.wp.com/freerangestats.info/img/0303-country-level-ranef.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/freerangestats.info/img/0303-scatter-final.png?w=450&ssl=1"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/free-range-statistics-r/",
          "text": "free range statistics - R"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-396176 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Inequality and homicide, within-country and between country by @ellis2013nz</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">October 17, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/free-range-statistics-r/\">free range statistics - R</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://freerangestats.info/blog/2025/10/18/homicide-and-gini\"> free range statistics - R</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47--><p>So this is a blog post about making and finding an error in modelling strategy, in an apparently simple situation.</p>\n<p>I saw <a href=\"https://mastodon.sdf.org/@dlakelan/115055789165555934\" rel=\"nofollow\" target=\"_blank\">this post (toot?) on Mastodon</a> from Daniel Lakens mentioning in passing that “On the other hand, the homicide rate across the world is well modeled as exp(k * income_gini_coefficient).” This struck me as worth checking; So I did! It turns out it is more or less correct.</p>\n<p>Here is a chart I drew of homicides per 100,000 population on the vertical axis versus income or consumption inequality on the horizontal. Consumption is the preferred way to measure poverty and inequality in poorer countries in particular, so in this data, which comes from the World Bank, it is used when available.</p>\n<object data=\"https://freerangestats.info/img/0303-scatter.svg\" type=\"image/svg+xml\" width=\"450\"><img data-lazy-src=\"https://i2.wp.com/freerangestats.info/img/0303-scatter.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i2.wp.com/freerangestats.info/img/0303-scatter.png?w=450&amp;ssl=1\"/></noscript></object>\n<p>It’s not a big point, but the model implied by Professor Lakens would be a straight diagonal line, what you’d get if you just used <code>geom_smooth(method = lm, formula = y ~ x - 1)</code>. I haven’t shown his, but two slightly more complex models.</p>\n<p>Here’s the code that downloads the data, fits those models and draws the chart. A few things to note:</p>\n<ul>\n<li>There’s a bit of fancy footwork to define which countries I label on the chart, and in the end also a few I chose manually and ad hoc because I was interested in them.</li>\n<li>While the y axis in this plot uses a logarithm transform, for the model itself I transformed the response variable not with a logarithm but with a BoxCox transformation that still works when countries have zero homicides in a particular year. I toyed with alternatives like using a generalized linear model with a log link (which still works when data is observed to be zero, because it will be predicted/expected to be slightly more) but decided to avoid this so I could use <code>lme</code> which lets me specify autocorrelated error terms.</li>\n<li>Because the model and plot are both a bit complex I set out my own prediction grid and calculate expected values and crude (ie assuming asymptotic normality) confidence intervals rather than using <code>marginaleffects</code> package to get me something out of the box.</li>\n<li>The ribbons drawn are showing the expected homicide rate for the country with random country effect closest to zero, which happens to be Czechia with the data at the time of writing (17 October 2025).</li>\n<li>The ribbons are also based on the assumption that the hypothetical country they refer to has an average inequality (over all years for which there are observations) as shown on the horizontal axis. This point is pretty crucial.</li>\n</ul>\n<figure class=\"highlight\"><pre>library(tidyverse)\nlibrary(WDI)\nlibrary(nlme)\nlibrary(forecast) # for chosing box cox parameters\nlibrary(AICcmodavg) # for predictSE with lmer\nlibrary(ggrepel)\nlibrary(GGally)\n\n# Analysis to follow up this remark:\n# https://mastodon.sdf.org/@dlakelan/115055789165555934\n# \"On the other hand, the homicide rate across the world \n#  is well modeled as exp(k * income_gini_coefficient).\"\n\n#--------Download World Bank data and prep it------------\n# These searches were used to find series with a lot of data for country-year combinations:\n# WDIsearch(\"homicide\")\n# WDIsearch(\"Gini\")\n\n# Metadata for SI.POV.GINI at https://data360files.worldbank.org/data360-data/metadata/WB_WDI/WB_WDI_SI_POV_GINI.pdf\n# Key points include:\n# * individuals (not household)\n# * adjusted for household size\n# * can be income or consumption depending on what was available\n\nd &lt;- WDI(indicator = c(homicide = \"VC.IHR.PSRC.P5\", \n                              gini = \"SI.POV.GINI\")) |&gt; \n  as_tibble()\n\n# Countries we are going to want to highlight in our chart\nhighlights &lt;- c(\"United States\", \"Russian Federation\", \n                  \"Samoa\", \"Australia\", \"United Kingdom\",\n                  \"Fiji\", \"Mexico\", \"Papua New Guinea\")\n\n# There are a few country-years with zero homicides so can't use a simple\n# logarithm transformation, but can have a Box-Cox that has a similar result\n# Choose a lambda that gives a distribution after the transformation where\n# changes are relatively stable in absolute terms:\nlambda &lt;- forecast::BoxCox.lambda(d$homicide)\n\n# version of the data we will use for plotting and modelling:\nd2 &lt;- d |&gt; \n  drop_na() |&gt; \n  group_by(country) |&gt; \n  mutate(type = ifelse(year == max(year), \"Latest\", \"Earlier\")) |&gt; \n  mutate(ctry_avg_gini = mean(gini)) |&gt; \n  ungroup() |&gt; \n  mutate(label = ifelse(type == \"Latest\" &amp; (gini &gt; 53 | homicide &gt; 35 | \n                                 gini &lt; 26 | homicide &lt; 0.26 | country %in% highlights),\n                        country, \"\"),\n         hom_tran = BoxCox(homicide, lambda = lambda),\n         country = as.factor(country))  |&gt; \n  arrange(year)\n\n#------------Modelling and predictions (for drawing 95% confidence intervals on charts)----\n# you could have random slopes too but a fair number of countries have only one\n# or two observations\n# see https://www.frontiersin.org/journals/education/articles/10.3389/feduc.2017.00058/full\n# for example which says you want at least 6 observations per group to have\n# a random slope. Not sure how many you need, but 1 isn't enough :)\n\n# Barchart of number of observations per country, used later in the blog post\np1 &lt;- d2 |&gt; \n  count(country, name = \"n_obs\") |&gt; \n  count(n_obs, name = \"n_countries\") |&gt; \n  ggplot(aes(x = n_obs, y = n_countries)) +\n  geom_col(fill = \"steelblue\") +\n  labs(x = \"Number of observations (ie years)\",\n       y = \"Number of countries\",\n      title = \"Complete data for Gini coefficient and homicide rates\")\n\nprint(p1)\n\n# super simple model, not mentioned in the actual blog post\nmodel1 &lt;- lm(hom_tran ~ gini, data = filter(d2, type == \"Latest\"))\n\n# multilevel model with a country random intercept, and inequality only at the lowest level\nmodel2 &lt;- lme(hom_tran ~ gini, random = ~1  | country, \n                    data = d2, correlation = corAR1())\n\n\n# multilevel model with country random intercept and countries' average inequality, as well\n# as the lowest level (country-year) granularity inequality:\nmodel3 &lt;- lme(hom_tran ~ gini + ctry_avg_gini, random = ~1  | country, \n                    data = d2, correlation = corAR1())\n\n# Fairly high (and similar) coefficients, about 0.11, but for differ\nsummary(model1) # 0.12 for gini\nsummary(model3) # 0.11 for ctry_avg_gini; gini not significant\n\n# Relatively low coefficients - the country randomness \n# soaks up a lot of the randomness:\nsummary(model2) # gini not significant\n\n# Is the average random country effect basically zero? - check:\nstopifnot(round(mean(ranef(model2)[[1]]), 10) == 0)\nstopifnot(round(mean(ranef(model3)[[1]]), 10) == 0)\n\n# Find the country with random effect closest to zero. Needed for predictions\n# to draw an average country ribbon on the chart, even though the country effect\n# is actually not taken into account in predictSE\navg_country &lt;- ranef(model3) |&gt; \n  arrange(abs(`(Intercept)`)) |&gt; \n  slice(1) |&gt; \n  row.names()\n\npred_grid &lt;- tibble(gini = 20:65, \n                    ctry_avg_gini = 20:65, \n                    country = avg_country)\n\npse1 &lt;- predict(model1, newdata = pred_grid, se = TRUE)\npse2 &lt;- predictSE(model2, newdata = pred_grid, se = TRUE)\npse3 &lt;- predictSE(model3, newdata = pred_grid, se = TRUE)\n\n\npred_grid &lt;- pred_grid |&gt; \n  mutate(predicted1 = pse1$fit,\n         lower1 = predicted1 - 1.96 * pse1$se.fit,\n        upper1 = predicted1 + 1.96 * pse1$se.fit) |&gt; \n  mutate(predicted2 = pse2$fit,\n         lower2 = predicted2 - 1.96 * pse2$se.fit,\n        upper2 = predicted2 + 1.96 * pse2$se.fit) |&gt; \n  mutate(predicted3 = pse3$fit,\n         lower3 = predicted3 - 1.96 * pse3$se.fit,\n        upper3 = predicted3 + 1.96 * pse3$se.fit) |&gt; \n  mutate(across(predicted1:upper3, function(x){InvBoxCox(x, lambda = lambda)}))\n\n#------------------Draw chart--------------------\n\nmod_cols &lt;- c(\"purple\", \"darkgreen\", \"brown\", \"pink\")\n\np2 &lt;- d2 |&gt; \n  ggplot(aes(x = gini, y = homicide)) +\n  scale_y_log10() +\n  xlim(18, 70) +\n  scale_shape_manual(values = c(1, 19)) +\n  scale_colour_manual(values = c(\"steelblue\", \"black\")) +\n  labs(x = \"Inequality (Gini coefficient), based on individual income or in some cases, consumption. Higher means more inequality.\",\n       y = \"Homicide rate (per 100,000)\",\n      colour = \"Observation year:\",\n      shape = \"Observation year:\",\n      title = \"Higher inequality countries have more homicides.\",\n      caption = \"Source: World Bank, World Development Indicators, series VC.IHR.PSRC.P5 and SI.POV.GINI. Analysis by freerangestats.info.\") \n  \n  \np2a &lt;- p2 +\n  # model2 - just country-year level data, country random effect\n  geom_ribbon(data = pred_grid, aes(ymin = lower2, ymax = upper2, y = NA), \n                fill = mod_cols[2], alpha = 0.2) +\n  \n  #model3 - country-year but also country average data, country random effect\n  geom_ribbon(data = pred_grid, aes(ymin = lower3, ymax = upper3, y = NA), \n                fill = mod_cols[3], alpha = 0.2) +\n  \n  geom_point(aes(shape = type, colour = type)) +\n  geom_label_repel(aes(label = label), max.overlaps = Inf, colour = \"grey10\", size = 2.8,\n                   seed = 123, label.size = unit(0, \"mm\"), fill = rgb(0,0,0, 0.04))  +\n  # annotations - text and arrows - for models 2 and 3\n  annotate(\"text\", x = 61.5, y = 0.9, colour = mod_cols[2], hjust = 0, vjust = 1,\n               label = str_wrap(\"Model with no such average country inequality effect.\", 24)) +\n  annotate(\"text\", x = 61.5, y = 200, colour = mod_cols[3], hjust = 0, vjust = 1,\n               label = str_wrap(\"Model including an effect for average inequality in each \n                                country over time.\", 26)) +\n  \n  annotate(\"segment\", x = 64, xend = 64, y = 1, yend = 2, colour = mod_cols[2], \n            arrow = arrow(length = unit(2, \"mm\"))) +\n  annotate(\"segment\", x = 64, xend = 64, y = 75, yend = 45, colour = mod_cols[3], \n            arrow = arrow(length = unit(2, \"mm\"))) +\n  \n  labs(subtitle = \"Selected countries highlighted. \nShaded ribbons show 95% confidence interval of mixed effects models with random country effect and autocorrelated error terms.\",\n)\n\nprint(p2a)</pre></figure>\n<p>In fact at first I just had that green line—<code>model2</code> in the code—which is pretty flat. I was naturally struck at how it doesn’t seem to go through the data points. At first I thought this was because I was so clever, and had incorporated a country level random effect, and allowed autocorrelation over time for the multiple observations of each country. That is, I thought I’d revealed some fundamental truth of a non-relationship where more naive modelling appeared to show a relationship.</p>\n<p>To extract that model—the one with the green line that’s conspicuously under the data—from the mess of code above, it’s <code>model2</code> and it looks like this:</p>\n<figure class=\"highlight\"><pre>model2 &lt;- lme(hom_tran ~ gini, random = ~1  | country, \n                    data = d2, correlation = corAR1())</pre></figure>\n<p>This seemed like the really obvious thing to fit for me. Why not just some ordinary least squares thing? Because many of the countries have multiple observations, as we see in this plot (which was created in the code chunk we’ve already seen above):</p>\n<object data=\"https://freerangestats.info/img/0303-number-obs.svg\" type=\"image/svg+xml\" width=\"450\"><img data-lazy-src=\"https://i0.wp.com/freerangestats.info/img/0303-number-obs.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i0.wp.com/freerangestats.info/img/0303-number-obs.png?w=450&amp;ssl=1\"/></noscript></object>\n<p>I would say that the thing that is most often done in this situation is to filter the data down to just one observation per country—perhaps by taking the latest observation for each country, or the one that is closest to some year that is chosen precisely because most countries have an observation in that year or close to it.</p>\n<p>That seemed like a sad waste of data to me (although in my code above you can see that I did fit such a model, <code>model1</code>, and if you want to look at it, it avoids the problem I’m about to talk about!). So my thinking was to use all the data in a mixed effects model, with a random intercept at the country level to allow for the fact that each new observation on a country, while definitely worth <em>something</em>, isn’t worth as much as an independent observation because it’s going to be similar to the other observations for that country. To do this even better, as well as the country level random intercept I throw in an autocorrelation of the residuals, showing that the values in one year are expected to be correlated with those in the previous year (as indeed they turn out to be).</p>\n<p>That’s all well and good but in this case it backfired on me. When I first drew this plot, with only the green line of <code>model2</code> showing, I thought “Oh that’s cool, when we correct for the fact that many of these observations are low-value repeats of the same country’s previous observations, it turns out there’s very little relationship between inequality and homicide after all”. But more thinking, and looking at some residuals, and comparing it to the more positive results from the much simpler <code>model1</code>, quickly made me realise I was barking badly up the wrong tree.</p>\n<p>The problem is best illustrated by this chart that I drew at some point along the way. I realised that as I have a random intercept that is different for each country, the expected value for that country from the model will vary very much by country. But then the modelling of homicide on inequality will start from that point—the model will be seeking to explain variance in homicide rates <em>in this particular</em> country based on its observations.</p>\n<object data=\"https://freerangestats.info/img/0303-faceted.svg\" type=\"image/svg+xml\" width=\"450\"><img data-lazy-src=\"https://i1.wp.com/freerangestats.info/img/0303-faceted.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i1.wp.com/freerangestats.info/img/0303-faceted.png?w=450&amp;ssl=1\"/></noscript></object>\n<p>If we had a random slope as well, the result would look closer to the dark grey lines in these plots—a different relationship for each country. But I hadn’t done this, because I judged there just weren’t enough observations per country for a random slope (many countries in fact have a single observation—economic inequality is difficult and costly to measure, needing a special household consumption survey if possible). So my models look more like the pale red ribbon shown here:</p>\n<p>What’s happening is that we have two things going on:</p>\n<ul>\n<li>Inequality <em>between</em> countries does quite a good job of explaining differences in homicide rates.</li>\n<li><em>Within</em> each country that has observations over multiple years, there is much less relationship between the two variables; and where there is a relationship, it differs country by country. For example, judging by the the black dot representing the most recent point, Australia and the United States look to have gotten more unequal over time but less homicides; Mexico has gotten less unequal and more homicides; whereas Russia, Ukraine and the UK have had decreases in both inequality and homicides. In other words, for Russia, Ukraine and the UK, the within-country data matches the between-country positive rleationship between inequality and homicide, but Australia, USA and Mexico have a negative relationship between the two variables.</li>\n</ul>\n<p>Another way of looking at this is to say that the random country intercept absorbs the variance in homicide that could be instead explained by that country’s enduring average inequality. But we don’t have “enduring, average inequality” as a variable in model2. If we calculate a proxy for that the obvious way (average of the inequality values we have for that country, disregarding the fact that they come from different years for each country), we can look at the relationship between this “enduring inequality” and the country intercepts in <code>model2</code>, and we see a strong positive relationship. That’s the middle left panel (a scatter plot) in the chart below, as well as the middle top correlation (0.608, well different from zero).</p>\n<object data=\"https://freerangestats.info/img/0303-country-level-ranef.svg\" type=\"image/svg+xml\" width=\"450\"><img data-lazy-src=\"https://i2.wp.com/freerangestats.info/img/0303-country-level-ranef.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i2.wp.com/freerangestats.info/img/0303-country-level-ranef.png?w=450&amp;ssl=1\"/></noscript></object>\n<p>The other variable in that scatter plot matrix is the country effects from <code>model3</code>, which has been specified like this:</p>\n<figure class=\"highlight\"><pre>model3 &lt;- lme(hom_tran ~ gini + ctry_avg_gini, random = ~1  | country, \n                    data = d2, correlation = corAR1())</pre></figure>\n<p>The difference from <code>model2</code> is that now we have <code>ctry_avg_gini</code> there as our estimate of enduring average country inequality. We still have <code>gini</code>, which is the value of inequality that varies for this country year by year. That will pick up the average within-country effect.</p>\n<p>In the scatterplot matrix above we can see that once we include each country’s average inequality in the model, there is no relationship between that variable and the country level random effects. This is to be expected, precisely because the model fitting process is designed to achieve this.</p>\n<p>Here’s the summary results for <code>model3</code>:</p>\n<pre>&gt; summary(model3)\nLinear mixed-effects model fit by REML\n  Data: d2 \n       AIC      BIC   logLik\n  2542.301 2574.914 -1265.15\n\nRandom effects:\n Formula: ~1 | country\n        (Intercept)  Residual\nStdDev:   0.8371227 0.7065144\n\nCorrelation Structure: AR(1)\n Formula: ~1 | country \n Parameter estimate(s):\n      Phi \n0.7574314 \nFixed effects:  hom_tran ~ gini + ctry_avg_gini \n                  Value Std.Error   DF   t-value p-value\n(Intercept)   -3.193199 0.3950271 1554 -8.083494  0.0000\ngini           0.007850 0.0056463 1554  1.390213  0.1647\nctry_avg_gini  0.113641 0.0117143  141  9.701081  0.0000\n Correlation: \n              (Intr) gini  \ngini           0.001       \nctry_avg_gini -0.858 -0.482\n\nStandardized Within-Group Residuals:\n         Min           Q1          Med           Q3          Max \n-11.47176745  -0.44184320  -0.04595294   0.42362704   3.06647091 \n\nNumber of Observations: 1698\nNumber of Groups: 143 \n\n</pre>\n<p>We see the strong effect of average country-level inequality effect, and no significant evidence of an effect of inequality within countries. Interesting! But beyond my scope today to go into that.</p>\n<p>Finally I want to finish off with a clean plot of my best model and the phenomenon under question—the strong empirical relationship between economic inequality in a country and the homicide rate.</p>\n<object data=\"https://freerangestats.info/img/0303-scatter-final.svg\" type=\"image/svg+xml\" width=\"450\"><img data-lazy-src=\"https://i0.wp.com/freerangestats.info/img/0303-scatter-final.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i0.wp.com/freerangestats.info/img/0303-scatter-final.png?w=450&amp;ssl=1\"/></noscript></object>\n<p>Here’s the code for that final clean plot:</p>\n<figure class=\"highlight\"><pre>p2b &lt;- p2 +\n  \n  #model3 - country-year but also country average data, country random effect\n  geom_ribbon(data = pred_grid, aes(ymin = lower3, ymax = upper3, y = NA), \n                fill = mod_cols[3], alpha = 0.2) +\n  \n  geom_point(aes(shape = type, colour = type)) +\n  geom_label_repel(aes(label = label), max.overlaps = Inf, colour = \"grey10\", size = 2.8,\n                   seed = 123, label.size = unit(0, \"mm\"), fill = rgb(0,0,0, 0.04)) \n\nprint(p2b)</pre></figure>\n<p>Note that this builds on the object <code>p2</code> that was the basis of the first plot, the one showing both <code>model2</code> and <code>model3</code>, to avoid repetition.</p>\n<p>And here’s the code for the playing around with residuals at different levels and drawing that facet plot version with 12 selected countries:</p>\n<figure class=\"highlight\"><pre>#---------------residuals from model2 and model3---------------\n\n# Individual level residuals - plot not used in blog\np3 &lt;- d2 |&gt; \n  mutate(`Residuals from Model 2` = residuals(model2),\n          `Residuals from Model 3` = residuals(model3)) |&gt; \n  select(gini, `Residuals from Model 2`, `Residuals from Model 3`) |&gt; \n  gather(variable, value, -gini) |&gt; \n  ggplot(aes(x = gini, y = value)) +\n  facet_wrap(~variable) +\n  geom_point() +\n  labs(x = \"Inequality\",\n       y = \"Residuals (on Box-Cox transformed scale)\",\n       title = \"Residuals from two mixed-effects models of homicide\",\n       subtitle = \"Residuals at the most granular level ie year-country are uncorrelated with inequality\")\n\nsvg_png(p3, \"..https://freerangestats.info/img/0303-residuals\", w = 8, h = 4)\n\n# out of curiousity what are those low outlier residuals? - Iceland and Malta\nround(sort(residuals(model2)),2)[1:5]\nround(sort(residuals(model3)),2)[1:5]\n\n# Country level effects plot - pairs plot used in blog\np4 &lt;- function(){\n  p &lt;- d2 |&gt; \n  distinct(country, ctry_avg_gini) |&gt; \n  arrange(country) |&gt; \n  mutate(`Country effects in Model 2` = ranef(model2)[[1]],\n         `Country effects in Model 3` = ranef(model3)[[1]]) |&gt; \n  select(-country) |&gt; \n  rename(`Countries' average inequality` = ctry_avg_gini) |&gt; \n  ggpairs() +\n  labs(title = \"Comparison of country-level random effects in two models\",\n      subtitle = \"Model 3 has a fixed effect for countries' average inequality; Model 2 doesn't.\nThe country-level residuals are correlated with this variable in Model 2, but not Model 3.\")\n \n    print(p)\n}\n\np4()\n\n\n#---------------further illustrations - facets----------------------\nd3 &lt;- d2 |&gt; \n  filter(country %in% c(highlights, \"South Africa\", \"France\", \"Japan\", \"Ukraine\")) |&gt; \n  group_by(country) |&gt; \n  summarise(r = coef(lm(log10(homicide) ~ gini))[2]) |&gt; \n  mutate(r = replace_na(r, 0)) |&gt; \n  mutate(country = fct_reorder(country, r) |&gt;  fct_drop()) |&gt; \n  arrange(country)\n\n\npred_grid2 &lt;- d2 |&gt; \n  filter(country %in% d3$country) |&gt; \n  distinct(country, ctry_avg_gini) |&gt; \n  expand_grid(gini = 20:70)\n\n# Note that predictSE excludes random country effect....\nmore_preds2 &lt;- predictSE(model2, newdata = pred_grid2, se = TRUE)\nmore_preds3 &lt;- predictSE(model3, newdata = pred_grid2, se = TRUE)\n\n\npred_grid2 &lt;- pred_grid2 |&gt; \n  mutate(predicted2 = more_preds2$fit,\n         lower2 = predicted2 - 1.96 * more_preds2$se.fit,\n         upper2 = predicted2 + 1.96 * more_preds2$se.fit,\n         predicted3 = more_preds3$fit,\n         lower3 = predicted3 - 1.96 * more_preds3$se.fit,\n        upper3 = predicted3 + 1.96 * more_preds3$se.fit) |&gt; \n  mutate(across(predicted2:upper3, function(x){InvBoxCox(x, lambda = lambda)}))\n\n\n\np5 &lt;- d2 |&gt; \n  mutate(country = factor(country, levels = levels(d3$country))) |&gt; \n  drop_na() |&gt; \n  ggplot(aes(x = gini, y = homicide)) +\n  scale_y_log10(label = comma, limits = c(0.1, 100)) +\n  xlim(18, 70) +\n  scale_shape_manual(values = c(1, 19)) +\n  scale_colour_manual(values = c(\"steelblue\", \"black\")) +\n  geom_ribbon(data = pred_grid2, aes(ymin = lower3, ymax = upper3, y = NA), \n                fill = mod_cols[3], alpha = 0.2) +\n  geom_smooth(method = lm, se = FALSE, colour = \"grey50\", fullrange = TRUE, linewidth = 0.5) +\n  geom_point(aes(shape = type, colour = type)) +\n  facet_wrap(~country, ncol = 3)  +\n  labs(x = \"Inequality (Gini coefficient), based on individual income or in some cases, consumption. Higher means more inequality.\",\n       y = \"Homicide rate (per 100,000)\",\n      colour = \"Observation year:\",\n      shape = \"Observation year:\",\n      title = \"Higher inequality countries have more homicides.\",\n      subtitle = \"But for any given country, the relationship over time may well be the reverse.\nPale ribbons show a model's confidence interval for homicide for a country's average over time level of inequality.\nDark line shows simple model fit to just this country's data.\",\n      caption = \"Source: World Bank, World Development Indicators, series VC.IHR.PSRC.P5 and SI.POV.GINI. Analysis by freerangestats.info.\") \n  \nprint(p5)</pre></figure>\n<p>The full set of code, in sequence, can be <a href=\"https://github.com/ellisp/blog-source/blob/master/_working/0303-homicide-inequality.R\" rel=\"nofollow\" target=\"_blank\">found on GitHub</a> if the above presentaiton is confusing.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://freerangestats.info/blog/2025/10/18/homicide-and-gini\"> free range statistics - R</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
      "main_text": "Inequality and homicide, within-country and between country by @ellis2013nz\nPosted on\nOctober 17, 2025\nby\nfree range statistics - R\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nfree range statistics - R\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nSo this is a blog post about making and finding an error in modelling strategy, in an apparently simple situation.\nI saw\nthis post (toot?) on Mastodon\nfrom Daniel Lakens mentioning in passing that “On the other hand, the homicide rate across the world is well modeled as exp(k * income_gini_coefficient).” This struck me as worth checking; So I did! It turns out it is more or less correct.\nHere is a chart I drew of homicides per 100,000 population on the vertical axis versus income or consumption inequality on the horizontal. Consumption is the preferred way to measure poverty and inequality in poorer countries in particular, so in this data, which comes from the World Bank, it is used when available.\nIt’s not a big point, but the model implied by Professor Lakens would be a straight diagonal line, what you’d get if you just used\ngeom_smooth(method = lm, formula = y ~ x - 1)\n. I haven’t shown his, but two slightly more complex models.\nHere’s the code that downloads the data, fits those models and draws the chart. A few things to note:\nThere’s a bit of fancy footwork to define which countries I label on the chart, and in the end also a few I chose manually and ad hoc because I was interested in them.\nWhile the y axis in this plot uses a logarithm transform, for the model itself I transformed the response variable not with a logarithm but with a BoxCox transformation that still works when countries have zero homicides in a particular year. I toyed with alternatives like using a generalized linear model with a log link (which still works when data is observed to be zero, because it will be predicted/expected to be slightly more) but decided to avoid this so I could use\nlme\nwhich lets me specify autocorrelated error terms.\nBecause the model and plot are both a bit complex I set out my own prediction grid and calculate expected values and crude (ie assuming asymptotic normality) confidence intervals rather than using\nmarginaleffects\npackage to get me something out of the box.\nThe ribbons drawn are showing the expected homicide rate for the country with random country effect closest to zero, which happens to be Czechia with the data at the time of writing (17 October 2025).\nThe ribbons are also based on the assumption that the hypothetical country they refer to has an average inequality (over all years for which there are observations) as shown on the horizontal axis. This point is pretty crucial.\nlibrary(tidyverse)\nlibrary(WDI)\nlibrary(nlme)\nlibrary(forecast) # for chosing box cox parameters\nlibrary(AICcmodavg) # for predictSE with lmer\nlibrary(ggrepel)\nlibrary(GGally)\n\n# Analysis to follow up this remark:\n# https://mastodon.sdf.org/@dlakelan/115055789165555934\n# \"On the other hand, the homicide rate across the world \n#  is well modeled as exp(k * income_gini_coefficient).\"\n\n#--------Download World Bank data and prep it------------\n# These searches were used to find series with a lot of data for country-year combinations:\n# WDIsearch(\"homicide\")\n# WDIsearch(\"Gini\")\n\n# Metadata for SI.POV.GINI at https://data360files.worldbank.org/data360-data/metadata/WB_WDI/WB_WDI_SI_POV_GINI.pdf\n# Key points include:\n# * individuals (not household)\n# * adjusted for household size\n# * can be income or consumption depending on what was available\n\nd <- WDI(indicator = c(homicide = \"VC.IHR.PSRC.P5\", \n                              gini = \"SI.POV.GINI\")) |> \n  as_tibble()\n\n# Countries we are going to want to highlight in our chart\nhighlights <- c(\"United States\", \"Russian Federation\", \n                  \"Samoa\", \"Australia\", \"United Kingdom\",\n                  \"Fiji\", \"Mexico\", \"Papua New Guinea\")\n\n# There are a few country-years with zero homicides so can't use a simple\n# logarithm transformation, but can have a Box-Cox that has a similar result\n# Choose a lambda that gives a distribution after the transformation where\n# changes are relatively stable in absolute terms:\nlambda <- forecast::BoxCox.lambda(d$homicide)\n\n# version of the data we will use for plotting and modelling:\nd2 <- d |> \n  drop_na() |> \n  group_by(country) |> \n  mutate(type = ifelse(year == max(year), \"Latest\", \"Earlier\")) |> \n  mutate(ctry_avg_gini = mean(gini)) |> \n  ungroup() |> \n  mutate(label = ifelse(type == \"Latest\" & (gini > 53 | homicide > 35 | \n                                 gini < 26 | homicide < 0.26 | country %in% highlights),\n                        country, \"\"),\n         hom_tran = BoxCox(homicide, lambda = lambda),\n         country = as.factor(country))  |> \n  arrange(year)\n\n#------------Modelling and predictions (for drawing 95% confidence intervals on charts)----\n# you could have random slopes too but a fair number of countries have only one\n# or two observations\n# see https://www.frontiersin.org/journals/education/articles/10.3389/feduc.2017.00058/full\n# for example which says you want at least 6 observations per group to have\n# a random slope. Not sure how many you need, but 1 isn't enough :)\n\n# Barchart of number of observations per country, used later in the blog post\np1 <- d2 |> \n  count(country, name = \"n_obs\") |> \n  count(n_obs, name = \"n_countries\") |> \n  ggplot(aes(x = n_obs, y = n_countries)) +\n  geom_col(fill = \"steelblue\") +\n  labs(x = \"Number of observations (ie years)\",\n       y = \"Number of countries\",\n      title = \"Complete data for Gini coefficient and homicide rates\")\n\nprint(p1)\n\n# super simple model, not mentioned in the actual blog post\nmodel1 <- lm(hom_tran ~ gini, data = filter(d2, type == \"Latest\"))\n\n# multilevel model with a country random intercept, and inequality only at the lowest level\nmodel2 <- lme(hom_tran ~ gini, random = ~1  | country, \n                    data = d2, correlation = corAR1())\n\n# multilevel model with country random intercept and countries' average inequality, as well\n# as the lowest level (country-year) granularity inequality:\nmodel3 <- lme(hom_tran ~ gini + ctry_avg_gini, random = ~1  | country, \n                    data = d2, correlation = corAR1())\n\n# Fairly high (and similar) coefficients, about 0.11, but for differ\nsummary(model1) # 0.12 for gini\nsummary(model3) # 0.11 for ctry_avg_gini; gini not significant\n\n# Relatively low coefficients - the country randomness \n# soaks up a lot of the randomness:\nsummary(model2) # gini not significant\n\n# Is the average random country effect basically zero? - check:\nstopifnot(round(mean(ranef(model2)[[1]]), 10) == 0)\nstopifnot(round(mean(ranef(model3)[[1]]), 10) == 0)\n\n# Find the country with random effect closest to zero. Needed for predictions\n# to draw an average country ribbon on the chart, even though the country effect\n# is actually not taken into account in predictSE\navg_country <- ranef(model3) |> \n  arrange(abs(`(Intercept)`)) |> \n  slice(1) |> \n  row.names()\n\npred_grid <- tibble(gini = 20:65, \n                    ctry_avg_gini = 20:65, \n                    country = avg_country)\n\npse1 <- predict(model1, newdata = pred_grid, se = TRUE)\npse2 <- predictSE(model2, newdata = pred_grid, se = TRUE)\npse3 <- predictSE(model3, newdata = pred_grid, se = TRUE)\n\npred_grid <- pred_grid |> \n  mutate(predicted1 = pse1$fit,\n         lower1 = predicted1 - 1.96 * pse1$se.fit,\n        upper1 = predicted1 + 1.96 * pse1$se.fit) |> \n  mutate(predicted2 = pse2$fit,\n         lower2 = predicted2 - 1.96 * pse2$se.fit,\n        upper2 = predicted2 + 1.96 * pse2$se.fit) |> \n  mutate(predicted3 = pse3$fit,\n         lower3 = predicted3 - 1.96 * pse3$se.fit,\n        upper3 = predicted3 + 1.96 * pse3$se.fit) |> \n  mutate(across(predicted1:upper3, function(x){InvBoxCox(x, lambda = lambda)}))\n\n#------------------Draw chart--------------------\n\nmod_cols <- c(\"purple\", \"darkgreen\", \"brown\", \"pink\")\n\np2 <- d2 |> \n  ggplot(aes(x = gini, y = homicide)) +\n  scale_y_log10() +\n  xlim(18, 70) +\n  scale_shape_manual(values = c(1, 19)) +\n  scale_colour_manual(values = c(\"steelblue\", \"black\")) +\n  labs(x = \"Inequality (Gini coefficient), based on individual income or in some cases, consumption. Higher means more inequality.\",\n       y = \"Homicide rate (per 100,000)\",\n      colour = \"Observation year:\",\n      shape = \"Observation year:\",\n      title = \"Higher inequality countries have more homicides.\",\n      caption = \"Source: World Bank, World Development Indicators, series VC.IHR.PSRC.P5 and SI.POV.GINI. Analysis by freerangestats.info.\") \n  \n  \np2a <- p2 +\n  # model2 - just country-year level data, country random effect\n  geom_ribbon(data = pred_grid, aes(ymin = lower2, ymax = upper2, y = NA), \n                fill = mod_cols[2], alpha = 0.2) +\n  \n  #model3 - country-year but also country average data, country random effect\n  geom_ribbon(data = pred_grid, aes(ymin = lower3, ymax = upper3, y = NA), \n                fill = mod_cols[3], alpha = 0.2) +\n  \n  geom_point(aes(shape = type, colour = type)) +\n  geom_label_repel(aes(label = label), max.overlaps = Inf, colour = \"grey10\", size = 2.8,\n                   seed = 123, label.size = unit(0, \"mm\"), fill = rgb(0,0,0, 0.04))  +\n  # annotations - text and arrows - for models 2 and 3\n  annotate(\"text\", x = 61.5, y = 0.9, colour = mod_cols[2], hjust = 0, vjust = 1,\n               label = str_wrap(\"Model with no such average country inequality effect.\", 24)) +\n  annotate(\"text\", x = 61.5, y = 200, colour = mod_cols[3], hjust = 0, vjust = 1,\n               label = str_wrap(\"Model including an effect for average inequality in each \n                                country over time.\", 26)) +\n  \n  annotate(\"segment\", x = 64, xend = 64, y = 1, yend = 2, colour = mod_cols[2], \n            arrow = arrow(length = unit(2, \"mm\"))) +\n  annotate(\"segment\", x = 64, xend = 64, y = 75, yend = 45, colour = mod_cols[3], \n            arrow = arrow(length = unit(2, \"mm\"))) +\n  \n  labs(subtitle = \"Selected countries highlighted. \nShaded ribbons show 95% confidence interval of mixed effects models with random country effect and autocorrelated error terms.\",\n)\n\nprint(p2a)\nIn fact at first I just had that green line—\nmodel2\nin the code—which is pretty flat. I was naturally struck at how it doesn’t seem to go through the data points. At first I thought this was because I was so clever, and had incorporated a country level random effect, and allowed autocorrelation over time for the multiple observations of each country. That is, I thought I’d revealed some fundamental truth of a non-relationship where more naive modelling appeared to show a relationship.\nTo extract that model—the one with the green line that’s conspicuously under the data—from the mess of code above, it’s\nmodel2\nand it looks like this:\nmodel2 <- lme(hom_tran ~ gini, random = ~1  | country, \n                    data = d2, correlation = corAR1())\nThis seemed like the really obvious thing to fit for me. Why not just some ordinary least squares thing? Because many of the countries have multiple observations, as we see in this plot (which was created in the code chunk we’ve already seen above):\nI would say that the thing that is most often done in this situation is to filter the data down to just one observation per country—perhaps by taking the latest observation for each country, or the one that is closest to some year that is chosen precisely because most countries have an observation in that year or close to it.\nThat seemed like a sad waste of data to me (although in my code above you can see that I did fit such a model,\nmodel1\n, and if you want to look at it, it avoids the problem I’m about to talk about!). So my thinking was to use all the data in a mixed effects model, with a random intercept at the country level to allow for the fact that each new observation on a country, while definitely worth\nsomething\n, isn’t worth as much as an independent observation because it’s going to be similar to the other observations for that country. To do this even better, as well as the country level random intercept I throw in an autocorrelation of the residuals, showing that the values in one year are expected to be correlated with those in the previous year (as indeed they turn out to be).\nThat’s all well and good but in this case it backfired on me. When I first drew this plot, with only the green line of\nmodel2\nshowing, I thought “Oh that’s cool, when we correct for the fact that many of these observations are low-value repeats of the same country’s previous observations, it turns out there’s very little relationship between inequality and homicide after all”. But more thinking, and looking at some residuals, and comparing it to the more positive results from the much simpler\nmodel1\n, quickly made me realise I was barking badly up the wrong tree.\nThe problem is best illustrated by this chart that I drew at some point along the way. I realised that as I have a random intercept that is different for each country, the expected value for that country from the model will vary very much by country. But then the modelling of homicide on inequality will start from that point—the model will be seeking to explain variance in homicide rates\nin this particular\ncountry based on its observations.\nIf we had a random slope as well, the result would look closer to the dark grey lines in these plots—a different relationship for each country. But I hadn’t done this, because I judged there just weren’t enough observations per country for a random slope (many countries in fact have a single observation—economic inequality is difficult and costly to measure, needing a special household consumption survey if possible). So my models look more like the pale red ribbon shown here:\nWhat’s happening is that we have two things going on:\nInequality\nbetween\ncountries does quite a good job of explaining differences in homicide rates.\nWithin\neach country that has observations over multiple years, there is much less relationship between the two variables; and where there is a relationship, it differs country by country. For example, judging by the the black dot representing the most recent point, Australia and the United States look to have gotten more unequal over time but less homicides; Mexico has gotten less unequal and more homicides; whereas Russia, Ukraine and the UK have had decreases in both inequality and homicides. In other words, for Russia, Ukraine and the UK, the within-country data matches the between-country positive rleationship between inequality and homicide, but Australia, USA and Mexico have a negative relationship between the two variables.\nAnother way of looking at this is to say that the random country intercept absorbs the variance in homicide that could be instead explained by that country’s enduring average inequality. But we don’t have “enduring, average inequality” as a variable in model2. If we calculate a proxy for that the obvious way (average of the inequality values we have for that country, disregarding the fact that they come from different years for each country), we can look at the relationship between this “enduring inequality” and the country intercepts in\nmodel2\n, and we see a strong positive relationship. That’s the middle left panel (a scatter plot) in the chart below, as well as the middle top correlation (0.608, well different from zero).\nThe other variable in that scatter plot matrix is the country effects from\nmodel3\n, which has been specified like this:\nmodel3 <- lme(hom_tran ~ gini + ctry_avg_gini, random = ~1  | country, \n                    data = d2, correlation = corAR1())\nThe difference from\nmodel2\nis that now we have\nctry_avg_gini\nthere as our estimate of enduring average country inequality. We still have\ngini\n, which is the value of inequality that varies for this country year by year. That will pick up the average within-country effect.\nIn the scatterplot matrix above we can see that once we include each country’s average inequality in the model, there is no relationship between that variable and the country level random effects. This is to be expected, precisely because the model fitting process is designed to achieve this.\nHere’s the summary results for\nmodel3\n:\n> summary(model3)\nLinear mixed-effects model fit by REML\n  Data: d2 \n       AIC      BIC   logLik\n  2542.301 2574.914 -1265.15\n\nRandom effects:\n Formula: ~1 | country\n        (Intercept)  Residual\nStdDev:   0.8371227 0.7065144\n\nCorrelation Structure: AR(1)\n Formula: ~1 | country \n Parameter estimate(s):\n      Phi \n0.7574314 \nFixed effects:  hom_tran ~ gini + ctry_avg_gini \n                  Value Std.Error   DF   t-value p-value\n(Intercept)   -3.193199 0.3950271 1554 -8.083494  0.0000\ngini           0.007850 0.0056463 1554  1.390213  0.1647\nctry_avg_gini  0.113641 0.0117143  141  9.701081  0.0000\n Correlation: \n              (Intr) gini  \ngini           0.001       \nctry_avg_gini -0.858 -0.482\n\nStandardized Within-Group Residuals:\n         Min           Q1          Med           Q3          Max \n-11.47176745  -0.44184320  -0.04595294   0.42362704   3.06647091 \n\nNumber of Observations: 1698\nNumber of Groups: 143\nWe see the strong effect of average country-level inequality effect, and no significant evidence of an effect of inequality within countries. Interesting! But beyond my scope today to go into that.\nFinally I want to finish off with a clean plot of my best model and the phenomenon under question—the strong empirical relationship between economic inequality in a country and the homicide rate.\nHere’s the code for that final clean plot:\np2b <- p2 +\n  \n  #model3 - country-year but also country average data, country random effect\n  geom_ribbon(data = pred_grid, aes(ymin = lower3, ymax = upper3, y = NA), \n                fill = mod_cols[3], alpha = 0.2) +\n  \n  geom_point(aes(shape = type, colour = type)) +\n  geom_label_repel(aes(label = label), max.overlaps = Inf, colour = \"grey10\", size = 2.8,\n                   seed = 123, label.size = unit(0, \"mm\"), fill = rgb(0,0,0, 0.04)) \n\nprint(p2b)\nNote that this builds on the object\np2\nthat was the basis of the first plot, the one showing both\nmodel2\nand\nmodel3\n, to avoid repetition.\nAnd here’s the code for the playing around with residuals at different levels and drawing that facet plot version with 12 selected countries:\n#---------------residuals from model2 and model3---------------\n\n# Individual level residuals - plot not used in blog\np3 <- d2 |> \n  mutate(`Residuals from Model 2` = residuals(model2),\n          `Residuals from Model 3` = residuals(model3)) |> \n  select(gini, `Residuals from Model 2`, `Residuals from Model 3`) |> \n  gather(variable, value, -gini) |> \n  ggplot(aes(x = gini, y = value)) +\n  facet_wrap(~variable) +\n  geom_point() +\n  labs(x = \"Inequality\",\n       y = \"Residuals (on Box-Cox transformed scale)\",\n       title = \"Residuals from two mixed-effects models of homicide\",\n       subtitle = \"Residuals at the most granular level ie year-country are uncorrelated with inequality\")\n\nsvg_png(p3, \"..https://freerangestats.info/img/0303-residuals\", w = 8, h = 4)\n\n# out of curiousity what are those low outlier residuals? - Iceland and Malta\nround(sort(residuals(model2)),2)[1:5]\nround(sort(residuals(model3)),2)[1:5]\n\n# Country level effects plot - pairs plot used in blog\np4 <- function(){\n  p <- d2 |> \n  distinct(country, ctry_avg_gini) |> \n  arrange(country) |> \n  mutate(`Country effects in Model 2` = ranef(model2)[[1]],\n         `Country effects in Model 3` = ranef(model3)[[1]]) |> \n  select(-country) |> \n  rename(`Countries' average inequality` = ctry_avg_gini) |> \n  ggpairs() +\n  labs(title = \"Comparison of country-level random effects in two models\",\n      subtitle = \"Model 3 has a fixed effect for countries' average inequality; Model 2 doesn't.\nThe country-level residuals are correlated with this variable in Model 2, but not Model 3.\")\n \n    print(p)\n}\n\np4()\n\n#---------------further illustrations - facets----------------------\nd3 <- d2 |> \n  filter(country %in% c(highlights, \"South Africa\", \"France\", \"Japan\", \"Ukraine\")) |> \n  group_by(country) |> \n  summarise(r = coef(lm(log10(homicide) ~ gini))[2]) |> \n  mutate(r = replace_na(r, 0)) |> \n  mutate(country = fct_reorder(country, r) |>  fct_drop()) |> \n  arrange(country)\n\npred_grid2 <- d2 |> \n  filter(country %in% d3$country) |> \n  distinct(country, ctry_avg_gini) |> \n  expand_grid(gini = 20:70)\n\n# Note that predictSE excludes random country effect....\nmore_preds2 <- predictSE(model2, newdata = pred_grid2, se = TRUE)\nmore_preds3 <- predictSE(model3, newdata = pred_grid2, se = TRUE)\n\npred_grid2 <- pred_grid2 |> \n  mutate(predicted2 = more_preds2$fit,\n         lower2 = predicted2 - 1.96 * more_preds2$se.fit,\n         upper2 = predicted2 + 1.96 * more_preds2$se.fit,\n         predicted3 = more_preds3$fit,\n         lower3 = predicted3 - 1.96 * more_preds3$se.fit,\n        upper3 = predicted3 + 1.96 * more_preds3$se.fit) |> \n  mutate(across(predicted2:upper3, function(x){InvBoxCox(x, lambda = lambda)}))\n\np5 <- d2 |> \n  mutate(country = factor(country, levels = levels(d3$country))) |> \n  drop_na() |> \n  ggplot(aes(x = gini, y = homicide)) +\n  scale_y_log10(label = comma, limits = c(0.1, 100)) +\n  xlim(18, 70) +\n  scale_shape_manual(values = c(1, 19)) +\n  scale_colour_manual(values = c(\"steelblue\", \"black\")) +\n  geom_ribbon(data = pred_grid2, aes(ymin = lower3, ymax = upper3, y = NA), \n                fill = mod_cols[3], alpha = 0.2) +\n  geom_smooth(method = lm, se = FALSE, colour = \"grey50\", fullrange = TRUE, linewidth = 0.5) +\n  geom_point(aes(shape = type, colour = type)) +\n  facet_wrap(~country, ncol = 3)  +\n  labs(x = \"Inequality (Gini coefficient), based on individual income or in some cases, consumption. Higher means more inequality.\",\n       y = \"Homicide rate (per 100,000)\",\n      colour = \"Observation year:\",\n      shape = \"Observation year:\",\n      title = \"Higher inequality countries have more homicides.\",\n      subtitle = \"But for any given country, the relationship over time may well be the reverse.\nPale ribbons show a model's confidence interval for homicide for a country's average over time level of inequality.\nDark line shows simple model fit to just this country's data.\",\n      caption = \"Source: World Bank, World Development Indicators, series VC.IHR.PSRC.P5 and SI.POV.GINI. Analysis by freerangestats.info.\") \n  \nprint(p5)\nThe full set of code, in sequence, can be\nfound on GitHub\nif the above presentaiton is confusing.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nfree range statistics - R\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "So this is a blog post about making and finding an error in modelling strategy, in an apparently simple situation. I saw this post (toot?) on Mastodon from Daniel Lakens mentioning in passing that “On the other hand, the homicide rate across the world...",
      "meta_keywords": null,
      "og_description": "So this is a blog post about making and finding an error in modelling strategy, in an apparently simple situation. I saw this post (toot?) on Mastodon from Daniel Lakens mentioning in passing that “On the other hand, the homicide rate across the world...",
      "og_image": "https://freerangestats.info/img/0303-scatter.png",
      "og_title": "Inequality and homicide, within-country and between country by @ellis2013nz | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 17.2,
      "sitemap_lastmod": null,
      "twitter_description": "So this is a blog post about making and finding an error in modelling strategy, in an apparently simple situation. I saw this post (toot?) on Mastodon from Daniel Lakens mentioning in passing that “On the other hand, the homicide rate across the world...",
      "twitter_title": "Inequality and homicide, within-country and between country by @ellis2013nz | R-bloggers",
      "url": "https://www.r-bloggers.com/2025/10/inequality-and-homicide-within-country-and-between-country-by-ellis2013nz/",
      "word_count": 3450
    }
  }
}