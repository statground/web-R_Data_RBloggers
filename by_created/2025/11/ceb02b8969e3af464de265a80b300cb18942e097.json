{
  "id": "ceb02b8969e3af464de265a80b300cb18942e097",
  "url": "https://www.r-bloggers.com/2024/12/importance-sampling/",
  "created_at_utc": "2025-11-22T19:59:34Z",
  "data": null,
  "raw_original": {
    "uuid": "0c0eee94-b4b4-4659-8fa0-fa79be9edd8b",
    "created_at": "2025-11-22 19:59:34",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2024/12/importance-sampling/",
      "crawled_at": "2025-11-22T10:56:30.492541",
      "external_links": [
        {
          "href": "https://cbowdon.github.io/posts/importance-sampling/",
          "text": "Chris Bowdon"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://www.sumsar.net/blog/2015/11/a-bayesian-model-to-calculate-whether-my-wife-is-pregnant/",
          "text": "this excellent blog on predicting a pregnancy"
        },
        {
          "href": "https://www.sumsar.net/blog/2013/12/shaping_up_laplace_approximation/",
          "text": "other blog"
        },
        {
          "href": "https://david-salazar.github.io/posts/bayesian-statistics/2020-06-27-bayesian-data-analysis-week-4-importance-sampling.html",
          "text": "this blog post"
        },
        {
          "href": "https://cbowdon.github.io/posts/importance-sampling/",
          "text": "Chris Bowdon"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Importance Sampling | R-bloggers",
      "images": [
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAVGaJIrvddhDNq0TvmZS+qxkAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAgdY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxutHFvxQAAAABJRU5ErkJggg==",
          "src": "https://latex.codecogs.com/png.latex?%5Ctheta"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAANBAMAAABiGeI2AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAMrsiRO92q2ZUEM2JmfLO1I4AAAAJcEhZcwAADsQAAA7EAZUrDhsAAABMSURBVAgdY2BgYBB6DCQYWAJAJFsBiGRqAJF8BkB+5lQgS4OhnIGBQ4GhjIGBtYEhkIHBzoDxAQODHAObggMDK8PqAw0MLDcn3lgAAEoSDEDJF3rwAAAAAElFTkSuQmCC",
          "src": "https://latex.codecogs.com/png.latex?d"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAATBAMAAAAkFJMsAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAid2Zu3Yyq+8iRGbNVBAzgK+nAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABKklEQVQYGU2NvUoDURCFv8gmm7ura/wpLRYfQOILyG3Fwi0UQRQDPkBS+ADbWAmazjIBG0GEBKxFX0BtRQJprF2wSgrx7N4NemFmzpxv5g6U79PVZlGqRV7+bqh2FLXdroWFYTcquKeGal+JWywMjeUj7xYTpflccSBgYjLXtluyihF2BLwkyqi8yTtRsJ0nJgJfY5MR5CfPcitV7I9SgSPC2PXn8pD2Bn5HYH1pTeMZmKl88wQP+InAlLkBXEIoGNQELqi3sOaHniY3wJf3HsWYCW2wQcqKQAr1BjQlahl7gTbiSN/koNfHH/AiHT2HuhH7fd20VF43V6/GHMPN6PRR4O5QC6Huu3ddVuuqNy57ZqoEszl92nQjJdiaLcD9fxC2/oBx0jlqfgGX5kGMBN0SmAAAAABJRU5ErkJggg==",
          "src": "https://latex.codecogs.com/png.latex?L(d%7C%5Ctheta)"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i2.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-6-1.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-7-1.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-9-1.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-12-1.png?w=450&ssl=1"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/chris-bowdon/",
          "text": "Chris Bowdon"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-393297 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Importance Sampling</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">December 22, 2024</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/chris-bowdon/\">Chris Bowdon</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://cbowdon.github.io/posts/importance-sampling/\"> Chris Bowdon</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<p>The aim of this post is to teach myself basic Bayesian methods. I’ll set up a toy example problem and solve it.</p>\n<p>Let’s assume we have a natural event that happens with a variable periodicity e.g. a woman’s menstrual cycle. I’m drawing from <a href=\"https://www.sumsar.net/blog/2015/11/a-bayesian-model-to-calculate-whether-my-wife-is-pregnant/\" rel=\"nofollow\" target=\"_blank\">this excellent blog on predicting a pregnancy</a>, but doing a much simpler model because I am but a baby myself.</p>\n<p>The aim here is to see if we can find the mean period of the cycle given some samples and priors for the average cycle. First, priors from the blog linked above:</p>\n<div class=\"cell\">\n<pre># a normal distribution for the mean days between period starts\nprior_mean_mu &lt;- 27.7\nprior_mean_sd &lt;- 2.4\n# a half-normal distribution for the SD of days between period starts\nprior_sd_mu &lt;- 1.6\nprior_sd_sd &lt;- 2.05</pre>\n</div>\n<p>We will set the true mean and SD (the params, <img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Ctheta\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Ctheta\"/></noscript>, that we’re looking for) and simulate some sample data, <img data-lazy-src=\"https://latex.codecogs.com/png.latex?d\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?d\"/></noscript>.</p>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Code</summary>\n<pre>library(tidyverse)\nset.seed(42)</pre>\n</details>\n</div>\n<div class=\"cell\">\n<pre>true_mu &lt;- 26.3\ntrue_sd &lt;- 1.9\n\nsample_periods &lt;- rnorm(12, true_mu, true_sd)</pre>\n</div>\n<p>For importance sampling we need a likelihood function, <img data-lazy-src=\"https://latex.codecogs.com/png.latex?L(d%7C%5Ctheta)\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?L(d%7C%5Ctheta)\"/></noscript>. Make the model a normal distribution and this is simply the probability density. We take the log of the likelihood because the numbers could be very small and subject to numerical error.</p>\n<div class=\"cell\">\n<pre>log_likelihood &lt;- function(sample_periods, mean_period, sd_period) {\n  sum(dnorm(sample_periods, mean_period, sd_period, log = TRUE))\n}</pre>\n</div>\n<p>A little sanity check: the likelihood of the true parameters should be greater than the likelihood of the priors, for a large enough dataset.</p>\n<div class=\"cell\">\n<pre>ten_year_sample &lt;- rnorm(120, true_mu, true_sd)\nlog_likelihood(ten_year_sample, true_mu, true_sd) &gt; log_likelihood(ten_year_sample, prior_mean_mu, prior_mean_sd)</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre>[1] TRUE</pre>\n</div>\n</div>\n<section class=\"level2\" id=\"importance-sampling-to-fit-the-model\">\n<h2 class=\"anchored\" data-anchor-id=\"importance-sampling-to-fit-the-model\">Importance sampling to fit the model</h2>\n<blockquote class=\"blockquote\">\n<p>Importance sampling is a Monte Carlo method that is very easy to setup and that can work well if (1) the parameters space is small and (2) the priors are not too dissimilar from the posterior.</p>\n</blockquote>\n<p>I know that both these conditions are true in my toy example.</p>\n<p>First we must sample from the prior.</p>\n<div class=\"cell\">\n<pre>n_samples &lt;- 100000\nprior &lt;- tibble(\n  mu_period = rnorm(n_samples, prior_mean_mu, prior_mean_sd),\n  sd_period = abs(rnorm(n_samples, 0, prior_sd_sd))\n)\n\nggplot(prior) +\n  aes(x = mu_period) +\n  geom_histogram(alpha=0.5, colour=\"black\", linewidth=0.1, fill=\"dodgerblue4\")</pre>\n<div class=\"cell-output cell-output-stderr\">\n<pre>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</pre>\n</div>\n<div class=\"cell-output-display\">\n<div>\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i2.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-6-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-6-1.png?w=450&amp;ssl=1\"/></noscript></p>\n</figure>\n</div>\n</div>\n</div>\n<div class=\"cell\">\n<pre>ggplot(prior) +\n  aes(x = sd_period) +\n  geom_histogram(alpha=0.5, colour=\"black\", linewidth=0.1, fill=\"dodgerblue4\")</pre>\n<div class=\"cell-output cell-output-stderr\">\n<pre>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</pre>\n</div>\n<div class=\"cell-output-display\">\n<div>\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i0.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-7-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-7-1.png?w=450&amp;ssl=1\"/></noscript></p>\n</figure>\n</div>\n</div>\n</div>\n<p>Then we weight each draw by its likelihood.</p>\n<div class=\"cell\">\n<pre>weights &lt;- sapply(1:n_samples, function(i) {\n  log_likelihood(sample_periods, prior$mu_period[i], prior$sd_period[i])\n})</pre>\n</div>\n<p>Then we resample the prior by this weighting.</p>\n<div class=\"cell\">\n<pre># n.b. sample will normalise the weights\nposterior &lt;- prior[sample(n_samples, replace = TRUE, prob = exp(weights)), ]\n\ndf &lt;- bind_rows(\n  mutate(prior, dist = \"prior\"),\n  mutate(posterior, dist = \"posterior\")\n) |&gt;\n  pivot_longer(c(mu_period, sd_period), names_to = \"param\", values_to = \"value\")\n\nggplot(df) +\n  aes(x = value, fill = dist) +\n  facet_wrap(vars(param), scales = \"free\") +\n  scale_fill_manual(values=c(\"dodgerblue1\", \"dodgerblue4\")) +\n  geom_histogram(alpha = 0.5, colour=\"black\", linewidth=0.1, position = \"identity\")</pre>\n<div class=\"cell-output cell-output-stderr\">\n<pre>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</pre>\n</div>\n<div class=\"cell-output-display\">\n<div>\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i0.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-9-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-9-1.png?w=450&amp;ssl=1\"/></noscript></p>\n</figure>\n</div>\n</div>\n</div>\n<p>Hey Doctor, would you look at that! The posterior is much tighter and closer to the true values.</p>\n<div class=\"cell\">\n<pre>posterior |&gt; summarise(mu = mean(mu_period), sd = mean(sd_period))</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 1 × 2\n     mu    sd\n  &lt;dbl&gt; &lt;dbl&gt;\n1  27.7  1.88</pre>\n</div>\n</div>\n<p>How does that compare to simply taking the mean and SD of the sample data?</p>\n<div class=\"cell\">\n<pre>tibble(\n    mu = mean(sample_periods),\n    sd = sd(sample_periods)\n)</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 1 × 2\n     mu    sd\n  &lt;dbl&gt; &lt;dbl&gt;\n1  27.7  1.75</pre>\n</div>\n</div>\n<p>It’s not highly convincing in this case. I ran this a few times and it seemed that the SD estimation seemed to be closer to the true value than the SD of the sample, but the mean was rarely different. This is probably because it’s a very simple model and importance sampling is rather overkill.</p>\n</section>\n<section class=\"level2\" id=\"proposal-distribution-isnt-necessarily-the-prior\">\n<h2 class=\"anchored\" data-anchor-id=\"proposal-distribution-isnt-necessarily-the-prior\">Proposal distribution isn’t necessarily the prior</h2>\n<p>In Bååth’s <a href=\"https://www.sumsar.net/blog/2013/12/shaping_up_laplace_approximation/\" rel=\"nofollow\" target=\"_blank\">other blog</a> on importance sampling he explains that we are looking at the ratio of the likelihood of getting our sample from the target distribution relative to getting it from the proposal distribution (then normalised to form a new estimate of the target distribution).</p>\n<p>If the proposal distribution is thinner at the ends than the target distribution, this is suboptimal because we will have fewer samples there. So a T distribution is a useful proposal for a normal target, because it has fatter tails (as controlled by the <code>df</code> degrees of freedom parameter).</p>\n<p>We could choose a very sloppy proposal like a uniform distribution, but in that case we are suboptimal in terms of how quickly we explore the space. We would have a relatively high number of samples in the tails compared to the peak. Bååth has a neat method of using a Laplacian approximation as a proposal.</p>\n</section>\n<section class=\"level2\" id=\"quick-look-at-another-example\">\n<h2 class=\"anchored\" data-anchor-id=\"quick-look-at-another-example\">Quick look at another example</h2>\n<p>Now an example from <a href=\"https://david-salazar.github.io/posts/bayesian-statistics/2020-06-27-bayesian-data-analysis-week-4-importance-sampling.html\" rel=\"nofollow\" target=\"_blank\">this blog post</a>. This one uses a T as the proposal.</p>\n<div class=\"cell\">\n<pre>approx_samples &lt;- rt(100, df = 3)  # T with 3 deg free is our approximation to posterior\napprox_density &lt;- dt(approx_samples, df = 3, log = TRUE)  # get the prob density for each\nunnormalised_posterior &lt;- dnorm(approx_samples, log = TRUE, sd = sqrt(3))  # convert to actual posterior\n\n# weights are then...\nlog_imp_weights &lt;- unnormalised_posterior - approx_density\ndata.frame(log_imp_weights) %&gt;% \n  ggplot(aes(exp(log_imp_weights))) +\n  geom_density(fill = \"dodgerblue4\", alpha = 0.5) +\n  labs(title = \"Importance weights\",\n       subtitle = \"Approximating a normal with a t distribution\")</pre>\n<div class=\"cell-output-display\">\n<div>\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i0.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-12-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/cbowdon.github.io/posts/importance-sampling/index_files/figure-html/unnamed-chunk-12-1.png?w=450&amp;ssl=1\"/></noscript></p>\n</figure>\n</div>\n</div>\n<pre># normalise...\nweights &lt;- exp(log_imp_weights) / sum(exp(log_imp_weights))\n\nmean_estimate &lt;- sum(approx_samples * weights)</pre>\n</div>\n<p>The point of using the Student T distribution as the proposal is to have a proposal with better coverage of the tails.</p>\n</section>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://cbowdon.github.io/posts/importance-sampling/\"> Chris Bowdon</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
      "main_text": "Importance Sampling\nPosted on\nDecember 22, 2024\nby\nChris Bowdon\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nChris Bowdon\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nThe aim of this post is to teach myself basic Bayesian methods. I’ll set up a toy example problem and solve it.\nLet’s assume we have a natural event that happens with a variable periodicity e.g. a woman’s menstrual cycle. I’m drawing from\nthis excellent blog on predicting a pregnancy\n, but doing a much simpler model because I am but a baby myself.\nThe aim here is to see if we can find the mean period of the cycle given some samples and priors for the average cycle. First, priors from the blog linked above:\n# a normal distribution for the mean days between period starts\nprior_mean_mu <- 27.7\nprior_mean_sd <- 2.4\n# a half-normal distribution for the SD of days between period starts\nprior_sd_mu <- 1.6\nprior_sd_sd <- 2.05\nWe will set the true mean and SD (the params,\n, that we’re looking for) and simulate some sample data,\n.\nCode\nlibrary(tidyverse)\nset.seed(42)\ntrue_mu <- 26.3\ntrue_sd <- 1.9\n\nsample_periods <- rnorm(12, true_mu, true_sd)\nFor importance sampling we need a likelihood function,\n. Make the model a normal distribution and this is simply the probability density. We take the log of the likelihood because the numbers could be very small and subject to numerical error.\nlog_likelihood <- function(sample_periods, mean_period, sd_period) {\n  sum(dnorm(sample_periods, mean_period, sd_period, log = TRUE))\n}\nA little sanity check: the likelihood of the true parameters should be greater than the likelihood of the priors, for a large enough dataset.\nten_year_sample <- rnorm(120, true_mu, true_sd)\nlog_likelihood(ten_year_sample, true_mu, true_sd) > log_likelihood(ten_year_sample, prior_mean_mu, prior_mean_sd)\n[1] TRUE\nImportance sampling to fit the model\nImportance sampling is a Monte Carlo method that is very easy to setup and that can work well if (1) the parameters space is small and (2) the priors are not too dissimilar from the posterior.\nI know that both these conditions are true in my toy example.\nFirst we must sample from the prior.\nn_samples <- 100000\nprior <- tibble(\n  mu_period = rnorm(n_samples, prior_mean_mu, prior_mean_sd),\n  sd_period = abs(rnorm(n_samples, 0, prior_sd_sd))\n)\n\nggplot(prior) +\n  aes(x = mu_period) +\n  geom_histogram(alpha=0.5, colour=\"black\", linewidth=0.1, fill=\"dodgerblue4\")\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\nggplot(prior) +\n  aes(x = sd_period) +\n  geom_histogram(alpha=0.5, colour=\"black\", linewidth=0.1, fill=\"dodgerblue4\")\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\nThen we weight each draw by its likelihood.\nweights <- sapply(1:n_samples, function(i) {\n  log_likelihood(sample_periods, prior$mu_period[i], prior$sd_period[i])\n})\nThen we resample the prior by this weighting.\n# n.b. sample will normalise the weights\nposterior <- prior[sample(n_samples, replace = TRUE, prob = exp(weights)), ]\n\ndf <- bind_rows(\n  mutate(prior, dist = \"prior\"),\n  mutate(posterior, dist = \"posterior\")\n) |>\n  pivot_longer(c(mu_period, sd_period), names_to = \"param\", values_to = \"value\")\n\nggplot(df) +\n  aes(x = value, fill = dist) +\n  facet_wrap(vars(param), scales = \"free\") +\n  scale_fill_manual(values=c(\"dodgerblue1\", \"dodgerblue4\")) +\n  geom_histogram(alpha = 0.5, colour=\"black\", linewidth=0.1, position = \"identity\")\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\nHey Doctor, would you look at that! The posterior is much tighter and closer to the true values.\nposterior |> summarise(mu = mean(mu_period), sd = mean(sd_period))\n# A tibble: 1 × 2\n     mu    sd\n  <dbl> <dbl>\n1  27.7  1.88\nHow does that compare to simply taking the mean and SD of the sample data?\ntibble(\n    mu = mean(sample_periods),\n    sd = sd(sample_periods)\n)\n# A tibble: 1 × 2\n     mu    sd\n  <dbl> <dbl>\n1  27.7  1.75\nIt’s not highly convincing in this case. I ran this a few times and it seemed that the SD estimation seemed to be closer to the true value than the SD of the sample, but the mean was rarely different. This is probably because it’s a very simple model and importance sampling is rather overkill.\nProposal distribution isn’t necessarily the prior\nIn Bååth’s\nother blog\non importance sampling he explains that we are looking at the ratio of the likelihood of getting our sample from the target distribution relative to getting it from the proposal distribution (then normalised to form a new estimate of the target distribution).\nIf the proposal distribution is thinner at the ends than the target distribution, this is suboptimal because we will have fewer samples there. So a T distribution is a useful proposal for a normal target, because it has fatter tails (as controlled by the\ndf\ndegrees of freedom parameter).\nWe could choose a very sloppy proposal like a uniform distribution, but in that case we are suboptimal in terms of how quickly we explore the space. We would have a relatively high number of samples in the tails compared to the peak. Bååth has a neat method of using a Laplacian approximation as a proposal.\nQuick look at another example\nNow an example from\nthis blog post\n. This one uses a T as the proposal.\napprox_samples <- rt(100, df = 3)  # T with 3 deg free is our approximation to posterior\napprox_density <- dt(approx_samples, df = 3, log = TRUE)  # get the prob density for each\nunnormalised_posterior <- dnorm(approx_samples, log = TRUE, sd = sqrt(3))  # convert to actual posterior\n\n# weights are then...\nlog_imp_weights <- unnormalised_posterior - approx_density\ndata.frame(log_imp_weights) %>% \n  ggplot(aes(exp(log_imp_weights))) +\n  geom_density(fill = \"dodgerblue4\", alpha = 0.5) +\n  labs(title = \"Importance weights\",\n       subtitle = \"Approximating a normal with a t distribution\")\n# normalise...\nweights <- exp(log_imp_weights) / sum(exp(log_imp_weights))\n\nmean_estimate <- sum(approx_samples * weights)\nThe point of using the Student T distribution as the proposal is to have a proposal with better coverage of the tails.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nChris Bowdon\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "The aim of this post is to teach myself basic Bayesian methods. I’ll set up a toy example problem and solve it. Let’s assume we have a natural event that happens with a variable periodicity e.g. a woman’s menstrual cycle. I’m drawing from t...",
      "meta_keywords": null,
      "og_description": "The aim of this post is to teach myself basic Bayesian methods. I’ll set up a toy example problem and solve it. Let’s assume we have a natural event that happens with a variable periodicity e.g. a woman’s menstrual cycle. I’m drawing from t...",
      "og_image": "https://latex.codecogs.com/png.latex?%5Ctheta",
      "og_title": "Importance Sampling | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 5.2,
      "sitemap_lastmod": null,
      "twitter_description": "The aim of this post is to teach myself basic Bayesian methods. I’ll set up a toy example problem and solve it. Let’s assume we have a natural event that happens with a variable periodicity e.g. a woman’s menstrual cycle. I’m drawing from t...",
      "twitter_title": "Importance Sampling | R-bloggers",
      "url": "https://www.r-bloggers.com/2024/12/importance-sampling/",
      "word_count": 1039
    }
  }
}