{
  "id": "adcfb2b0399dd9b98a4047b20cf048d768ab1c98",
  "url": "https://www.r-bloggers.com/2025/04/working-with-ordinal-ranks-in-marginaleffects/",
  "created_at_utc": "2025-11-22T19:58:43Z",
  "data": null,
  "raw_original": {
    "uuid": "26fd813f-09f7-4994-9c4e-57eaf708603b",
    "created_at": "2025-11-22 19:58:43",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2025/04/working-with-ordinal-ranks-in-marginaleffects/",
      "crawled_at": "2025-11-22T10:49:38.102205",
      "external_links": [
        {
          "href": "https://blog.msbstats.info/posts/2025-05-01-ordinal-ranks-with-marginaleffects/",
          "text": "Stat's What It's All About"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://bsky.app/profile/happonen.bsky.social/post/3lo4fl3nlz22w",
          "text": "often"
        },
        {
          "href": "https://rvlenth.github.io/emmeans/articles/models.html#O",
          "text": "mode = \"mean.class\""
        },
        {
          "href": "https://solomonkurz.netlify.app/blog/2022-07-18-sum-score-effect-sizes-for-multilevel-bayesian-cumulative-probit-models/#pomp-differences",
          "text": "Solomon Kurz’s excellent blog post"
        },
        {
          "href": "https://mc-stan.org/posterior/articles/rvar.html",
          "text": "rvar"
        },
        {
          "href": "https://blog.msbstats.info/posts/2025-05-01-ordinal-ranks-with-marginaleffects/",
          "text": "Stat's What It's All About"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Working with Ordinal Ranks in {marginaleffects} | R-bloggers",
      "images": [
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAJoAAAA2BAMAAADND52xAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZiJUic0yEN3vq0R2mbvQvSoYAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADDUlEQVRYCe1WTWjTYBh+2qRNtqxr1qGIONeDjs0f1g50HpxkbjpUGEW8KRhRFBG2DDxsaG2H4q5FweFpHXiQqVDnPHlY3bzpYAqerDrZ1cOmok5h8UuTr2kKXbOmN/dCvvd5n+95nybfl58CNiM6jKEem9rSMnYegdIqu4ra0IBdqQ2dv0myobIruTwVtyu1odsSvGlDZVcyjk12pTZ091Al25DZk1xfRvNJe9IN1f+3AmMr97UYU1U15fzqG1d1D/dWdcG5W60qGibRb87duLGcSYdzN0z/piasQlFh7vtVyBSrWXW+2FSOFxI5WAqc/V5KATZZUkIFQ2qQwmLZQ3eqmMDkGTViFha0l1SvNcYva6OrLgCmvg3My6OYmuxMkSKt8db4/MOsD87UmcvIJFEjaXPTOJcGwujEOB4ggxa03SJX/xgvtFn4JrSQshi8+RRw7ct4q7Pa2IBX2aLXe5HswxFZqYmg3RWB//y1USHoiuMw+YmCcKujlBHI7h1HmPuqE66MfqKnrnAhoHkl5BeBKhGxS+SDDn5xW4o25uXGP7miJoknpHhkEA/1vKp37VhqVYDWIBrhCQGxoKGypmrzHqkN4S6ZTOgCV0bSgPCzl4zEINEPcOQ4gxixjRHSlSSDZd3gkQilh18R4q4kF38qa7WxbuwCn5JRDSHNBxHgZWKxj8zyMvaLI5rOEhNm1a94ZHGE+bCHXAnInrISyR6Rl0MQnoXh7gor7q464A2hs0WEAEuQjcrFXP0M3BHf6Syxi4wnyMErzGxOYQWsaK2BA4rJfCGQFfm+kEmtifjCf1feO3l67fXEDwwy7+Q8cg3oCxRMtqRMwrtEsC9wgcuY3PrQMJWzwPO8h4zS68q1EpU3UOAgf6K90b8UlZ+N24PbvV1NlO9CO6fJh9QIiXLl57mPuVDKd9nodLgCN9K6AXfIoVG2vdp4TBntBeg4qqjDTgqc5EFhs95eEbeOydmr3d3dPaiI23tj3SrjdnvRWKdKnBsX72jSr7TZyeobvV4pms5C4VjhK97q/g/8H7F92Y43WwAAAABJRU5ErkJggg==",
          "src": "https://latex.codecogs.com/png.latex?%0Ascore_i%20=%20%5Csum_%7Bk=1%7D%5E%7BK%7D%7Bp_%7Bik%7D%5Ctimes%20k%7D%0A"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAL0AAAAlBAMAAADlzPUtAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAid2ZuzKrVCJmEO9Eds0xWRQzAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADaUlEQVRIDeWWy2sTURTGv0mbTDJJGqlKqQuxoghuquCDKtKAVeiqA7510RRfCEEDgjbFx7ToolTM0EU1BelsRSEFFVEURvAFRUx1VbDYf6AYEPuyot+dJjpjSydp68oDc+fce875zX3MnDnAv5HAmn/DLVBDsYL2X90D6duQb7VCHlqJF2+rTSQvO9fvbeo835aOY/8EtQum0+jeS6IaZ9CCXehCa40U82VDfzEyWe8TDAAToNbvTnR6rFaN8AjaAiOIHLr/NKR1Q9Jk3e4TMZVpZAzyqU3ZLcXoHd8TEeKCOjJHpU3AuuSnmbCXDZRG6hFNTN3iayiZj/ZcygBSGvpQkYAyMWtS5E8tmE9kfzOg8BoVECVHfo/jGYvi+xDKejTc9qiBGK6Qux7yEY9hf0BE46Ly+zOzvMqvyxtUTmo4vYOOld/YVHw1IdVu3rLHHkk99CYJf1XS8FelgWEOtF/sxU27k7c+vm/s1bmT+8YOCM2krTwGmfvYY6DDAMKPOXSFR4e9wFWNdzepdnHgC6FMQooBUpT8US7lvcmYSSCj8+4mG12cmlV4xzFgcPk54MZxQG5mx8uNak64wWmv0+Z36gPKnipP6CSQ+grg6Ad2AnzYTmP+0KKsJ4ABVRKfgjgGvRtI7GbHF0XoUVEAF6eH6eFV8ETpVcYp6+8hQ5xxsPHOoME7sO0UpcVSF9D4p0VQZBmbYAxKImVc94vFpEw2ztzCgdJF7DPflCybzxpkI6ImrJ8bj2WW/CxVyPaNCExQzP85TxXBS4Yvxs5ZXkshHkFG2Yh1ouRXVIn0CNSIYSu3LG7/UwkBUjaAvw3giFgP0yP84+wFnLmFIyWL1HTaipGGBjV+wWv1sCp92QqsGBPPdeSWktnuAW65xZ0wv4dbbpk7mp9okeKWW+bGvJ57+L8YLRRQSA8i0BTtsj6T/Mr3T9zafrfH9DZp1OIL3I58ARVOhKMoX+YzbBjlB47poX7WKEKzGUpR8wWUFPPmoDzrdYSyshJFFWsIq8Zy2IrtMNgqENCZ44/DZFhI1FYNIqewaNNm+NQMDixA8gWOv+Uw+deiDoKgLhE/qPtzKrKsBmyyNHyrgMqo8pRehnumDS827vf+ZDS7pWi9UEAF6t5+fFerHntg/AllZVUfP8jKiuUVNWH4BaFaTeuGfjJNAAAAAElFTkSuQmCC",
          "src": "https://latex.codecogs.com/png.latex?%0APOMP_i%20=%20%5Cfrac%7Bscore_i%20-%20%5Ctext%7Bmin%7D%7D%7B%5Ctext%7Bmax%7D%20-%20%5Ctext%7Bmin%7D%7D%0A"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/stats-what-its-all-about/",
          "text": "Stat's What It's All About"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-392213 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Working with Ordinal Ranks in {marginaleffects}</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">April 30, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/stats-what-its-all-about/\">Stat's What It's All About</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://blog.msbstats.info/posts/2025-05-01-ordinal-ranks-with-marginaleffects/\"> Stat's What It's All About</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<p>Given an ordinal regression model, it is relatively easy to get class-wise predictions – the conditional predicted probability of each level of the outcome. However, <a href=\"https://bsky.app/profile/happonen.bsky.social/post/3lo4fl3nlz22w\" rel=\"nofollow\" target=\"_blank\">often</a>, one might be interested in summarizing effects not on the class-wise probability scale (nor on the latent scale), but instead on the <em>rank</em> scale – the expected ordinal level, expressed as a single number.</p>\n<p>The <code>{emmeans}</code> package has the <a href=\"https://rvlenth.github.io/emmeans/articles/models.html#O\" rel=\"nofollow\" target=\"_blank\"><code>mode = \"mean.class\"</code></a> that does just this.</p>\n<p>Let’s see how we can do this in <code>{marginaleffects}</code> by utilizing the powerful <code>hypothesis=</code> argument.</p>\n<section class=\"level1\" id=\"fit-a-model\">\n<h1>Fit a model</h1>\n<div class=\"cell\">\n<pre>library(tidyverse)\n\nlibrary(marginaleffects)\n\nbfi &lt;- psych::bfi |&gt; \n  mutate(\n    gender = factor(gender),\n    A1 = ordered(A1)\n  ) |&gt; \n  drop_na(A1, age, gender)\n\nnrow(bfi)\n#&gt; [1] 2784\n\nfit &lt;- MASS::polr(A1 ~ age + gender, \n                  data = bfi,\n                  Hess = TRUE)</pre>\n</div>\n</section>\n<section class=\"level1\" id=\"class-wise-predictions\">\n<h1>Class-Wise Predictions</h1>\n<div class=\"cell\">\n<pre>pr1 &lt;- predictions(fit, variables = \"gender\")\npr1\n#&gt; \n#&gt;  Group Estimate Std. Error     z Pr(&gt;|z|)     S   2.5 % 97.5 %\n#&gt;      1   0.1800    0.01136 15.85   &lt;0.001 185.5 0.15777 0.2023\n#&gt;      1   0.1886    0.01128 16.71   &lt;0.001 205.9 0.16649 0.2107\n#&gt;      1   0.1843    0.01132 16.28   &lt;0.001 195.6 0.16210 0.2065\n#&gt;      1   0.1843    0.01132 16.28   &lt;0.001 195.6 0.16210 0.2065\n#&gt;      1   0.1843    0.01132 16.28   &lt;0.001 195.6 0.16210 0.2065\n#&gt; --- 33398 rows omitted. See ?print.marginaleffects --- \n#&gt;      6   0.0289    0.00335  8.64   &lt;0.001 57.3 0.02234 0.0355\n#&gt;      6   0.0231    0.00264  8.78   &lt;0.001 59.1 0.01798 0.0283\n#&gt;      6   0.0219    0.00250  8.76   &lt;0.001 58.8 0.01699 0.0268\n#&gt;      6   0.0207    0.00238  8.71   &lt;0.001 58.1 0.01604 0.0254\n#&gt;      6   0.0121    0.00165  7.35   &lt;0.001 42.2 0.00891 0.0154\n#&gt; Type:  probs\n\nnrow(pr1) # original data * 2 (counterfactual gender) * 6 (levels of A1)\n#&gt; [1] 33408</pre>\n</div>\n<p>For each observation in the original data frame we now have 12 predictions:<br/>\n- 2 counterfactual predictions for the two levels of gender, times<br/>\n- 6 (arguably also counterfactual) predictions for each of the possible outcome levels.</p>\n</section>\n<section class=\"level1\" id=\"sum-scores-mean-rank\">\n<h1>Sum-scores (mean rank)</h1>\n<p>We can average the class <em>ranks</em> by their predicted probability to obtain “sum scores”:</p>\n<p><img data-lazy-src=\"https://latex.codecogs.com/png.latex?%0Ascore_i%20=%20%5Csum_%7Bk=1%7D%5E%7BK%7D%7Bp_%7Bik%7D%5Ctimes%20k%7D%0A\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%0Ascore_i%20=%20%5Csum_%7Bk=1%7D%5E%7BK%7D%7Bp_%7Bik%7D%5Ctimes%20k%7D%0A\"/></noscript> And we can do this for each row in the counterfactual data frame (marked by the <code>rowidcf</code> variable):</p>\n<div class=\"cell\">\n<pre>sum_score &lt;- function(x) {\n  x |&gt; \n    arrange(rowidcf, group, gender) |&gt; \n    # for each counterfactual row and level of gender\n    summarise(\n      term = \"sum score\",\n      estimate = sum(estimate * (1:6)), \n      \n      .by = c(rowidcf, gender)\n    )\n}\n\npr2 &lt;- predictions(fit, variables = \"gender\", \n                   hypothesis = sum_score)\npr2\n#&gt; \n#&gt;  Estimate Std. Error    z Pr(&gt;|z|)   S 2.5 % 97.5 %\n#&gt;      3.02     0.0583 51.8   &lt;0.001 Inf  2.90   3.13\n#&gt;      2.51     0.0451 55.6   &lt;0.001 Inf  2.42   2.60\n#&gt;      2.97     0.0553 53.7   &lt;0.001 Inf  2.86   3.08\n#&gt;      2.46     0.0415 59.4   &lt;0.001 Inf  2.38   2.55\n#&gt;      3.00     0.0568 52.8   &lt;0.001 Inf  2.88   3.11\n#&gt; --- 5558 rows omitted. See ?print.marginaleffects --- \n#&gt;      2.24     0.0305 73.4   &lt;0.001   Inf  2.18   2.30\n#&gt;      2.67     0.0473 56.4   &lt;0.001   Inf  2.57   2.76\n#&gt;      2.20     0.0304 72.2   &lt;0.001   Inf  2.14   2.26\n#&gt;      2.26     0.0645 35.0   &lt;0.001 890.8  2.13   2.38\n#&gt;      1.85     0.0457 40.6   &lt;0.001   Inf  1.77   1.94\n#&gt; Term: sum score\n#&gt; Type:  probs\n\nnrow(pr2) # original data * 2 (counterfactual gender)\n#&gt; [1] 5568</pre>\n</div>\n<p>As expected, we now have 2 predictions for each observation in the original data frame: - 2 counterfactual predictions for the two levels of gender</p>\n<p>Note that we could have also computed the mean rank for the two levels of gender, or literally anything else. But here I am trying to mimic the basic behavior of the <code>avg_/comparisons()</code> functions by keeping with the workflow:</p>\n<ol type=\"1\">\n<li>Compute observation wise counterfactual predictions</li>\n<li>Contrast them for each observation</li>\n<li>(Possibly) average them</li>\n</ol>\n<p>So let’s get those contrasts!</p>\n<section class=\"level2\" id=\"contrast-the-ranks\">\n<h2 class=\"anchored\" data-anchor-id=\"contrast-the-ranks\">Contrast the ranks</h2>\n<div class=\"cell\">\n<pre>sum_score.contr &lt;- function(x) {\n  # same as before, and...\n  sum_score(x) |&gt; \n    # compute a single contrast for each counterfactual row\n    summarise(\n      term = \"gender (2-1)\",\n      estimate = estimate[gender == \"2\"] - estimate[gender == \"1\"], \n      \n      .by = rowidcf\n    )\n}</pre>\n</div>\n<p>This function will compute a difference between the rank for each gender <em>for each</em> observation.</p>\n<div class=\"cell\">\n<pre>pr3 &lt;- predictions(fit, variables = \"gender\", \n                   hypothesis = sum_score.contr)\npr3\n#&gt; \n#&gt;  Estimate Std. Error     z Pr(&gt;|z|)    S  2.5 % 97.5 %\n#&gt;    -0.511     0.0588 -8.68   &lt;0.001 57.8 -0.626 -0.395\n#&gt;    -0.506     0.0584 -8.67   &lt;0.001 57.7 -0.621 -0.392\n#&gt;    -0.509     0.0586 -8.68   &lt;0.001 57.8 -0.623 -0.394\n#&gt;    -0.509     0.0586 -8.68   &lt;0.001 57.8 -0.623 -0.394\n#&gt;    -0.509     0.0586 -8.68   &lt;0.001 57.8 -0.623 -0.394\n#&gt; --- 2774 rows omitted. See ?print.marginaleffects --- \n#&gt;    -0.504     0.0582 -8.67   &lt;0.001 57.6 -0.618 -0.390\n#&gt;    -0.483     0.0560 -8.62   &lt;0.001 57.1 -0.593 -0.373\n#&gt;    -0.477     0.0554 -8.61   &lt;0.001 56.9 -0.586 -0.368\n#&gt;    -0.471     0.0548 -8.59   &lt;0.001 56.7 -0.578 -0.363\n#&gt;    -0.403     0.0488 -8.26   &lt;0.001 52.6 -0.499 -0.307\n#&gt; Term: gender (2-1)\n#&gt; Type:  probs\n\nnrow(pr3) # original data\n#&gt; [1] 2784</pre>\n</div>\n</section>\n<section class=\"level2\" id=\"average-contrast\">\n<h2 class=\"anchored\" data-anchor-id=\"average-contrast\">Average Contrast</h2>\n<p>Finally, we can get the <em>average</em> difference:</p>\n<div class=\"cell\">\n<pre># average contrast \navg_sum_score.contr &lt;- function(x) {\n  sum_score.contr(x) |&gt; \n    summarise(\n      term = \"avg. gender (2-1)\",\n      estimate = mean(estimate)\n    )\n}\n\npredictions(fit, variables = \"gender\", \n            hypothesis = avg_sum_score.contr)\n#&gt; \n#&gt;  Estimate Std. Error     z Pr(&gt;|z|)    S  2.5 % 97.5 %\n#&gt;    -0.474     0.0551 -8.61   &lt;0.001 56.9 -0.582 -0.366\n#&gt; \n#&gt; Term: avg. gender (2-1)\n#&gt; Type:  probs</pre>\n</div>\n</section>\n</section>\n<section class=\"level1\" id=\"pomp\">\n<h1>POMP</h1>\n<p>POMP (percent of maximum possible) are a for of standardized units for Likert-type items (see <a href=\"https://solomonkurz.netlify.app/blog/2022-07-18-sum-score-effect-sizes-for-multilevel-bayesian-cumulative-probit-models/#pomp-differences\" rel=\"nofollow\" target=\"_blank\">Solomon Kurz’s excellent blog post</a> for more – better – info).</p>\n<p>These are linear transformations of the ranks described above:</p>\n<p><img data-lazy-src=\"https://latex.codecogs.com/png.latex?%0APOMP_i%20=%20%5Cfrac%7Bscore_i%20-%20%5Ctext%7Bmin%7D%7D%7B%5Ctext%7Bmax%7D%20-%20%5Ctext%7Bmin%7D%7D%0A\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%0APOMP_i%20=%20%5Cfrac%7Bscore_i%20-%20%5Ctext%7Bmin%7D%7D%7B%5Ctext%7Bmax%7D%20-%20%5Ctext%7Bmin%7D%7D%0A\"/></noscript> We can obtain POMPs for each row in the counterfactual data frame by further processing the sum-scores:</p>\n<div class=\"cell\">\n<pre>POMP &lt;- function(x) {\n  sum_score(x) |&gt; \n    mutate(\n      estimate = 100 * (estimate - 1) / (6 - 1)\n    )\n}\n\npredictions(fit, variables = \"gender\", \n            hypothesis = POMP)\n#&gt; \n#&gt;  Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %\n#&gt;      40.4      1.166 34.6   &lt;0.001 870.6  38.1   42.7\n#&gt;      30.2      0.902 33.5   &lt;0.001 812.8  28.4   31.9\n#&gt;      39.4      1.107 35.6   &lt;0.001 920.9  37.3   41.6\n#&gt;      29.3      0.829 35.3   &lt;0.001 905.5  27.7   30.9\n#&gt;      39.9      1.135 35.1   &lt;0.001 896.3  37.7   42.1\n#&gt; --- 5558 rows omitted. See ?print.marginaleffects --- \n#&gt;      24.7      0.609 40.6   &lt;0.001   Inf  23.5   25.9\n#&gt;      33.3      0.945 35.3   &lt;0.001 902.9  31.5   35.2\n#&gt;      23.9      0.608 39.3   &lt;0.001   Inf  22.7   25.1\n#&gt;      25.2      1.289 19.5   &lt;0.001 279.4  22.6   27.7\n#&gt;      17.1      0.914 18.7   &lt;0.001 256.9  15.3   18.9\n#&gt; Term: sum score\n#&gt; Type:  probs</pre>\n</div>\n<p>And likewise get contrasts -</p>\n<div class=\"cell\">\n<pre>POMP.contr &lt;- function(x) {\n  POMP(x) |&gt; \n    summarise(\n      term = \"gender (2-1)\",\n      estimate = estimate[gender == \"2\"] - estimate[gender == \"1\"], \n      \n      .by = rowidcf\n    )\n}\n\npredictions(fit, variables = \"gender\", \n            hypothesis = sum_score.contr)\n#&gt; \n#&gt;  Estimate Std. Error     z Pr(&gt;|z|)    S  2.5 % 97.5 %\n#&gt;    -0.511     0.0588 -8.68   &lt;0.001 57.8 -0.626 -0.395\n#&gt;    -0.506     0.0584 -8.67   &lt;0.001 57.7 -0.621 -0.392\n#&gt;    -0.509     0.0586 -8.68   &lt;0.001 57.8 -0.623 -0.394\n#&gt;    -0.509     0.0586 -8.68   &lt;0.001 57.8 -0.623 -0.394\n#&gt;    -0.509     0.0586 -8.68   &lt;0.001 57.8 -0.623 -0.394\n#&gt; --- 2774 rows omitted. See ?print.marginaleffects --- \n#&gt;    -0.504     0.0582 -8.67   &lt;0.001 57.6 -0.618 -0.390\n#&gt;    -0.483     0.0560 -8.62   &lt;0.001 57.1 -0.593 -0.373\n#&gt;    -0.477     0.0554 -8.61   &lt;0.001 56.9 -0.586 -0.368\n#&gt;    -0.471     0.0548 -8.59   &lt;0.001 56.7 -0.578 -0.363\n#&gt;    -0.403     0.0488 -8.26   &lt;0.001 52.6 -0.499 -0.307\n#&gt; Term: gender (2-1)\n#&gt; Type:  probs</pre>\n</div>\n<p>And average contrasts -</p>\n<div class=\"cell\">\n<pre># average contrast \navg_POMP.contr &lt;- function(x) {\n  POMP.contr(x) |&gt; \n    summarise(\n      term = \"avg. gender (2-1)\",\n      estimate = mean(estimate)\n    )\n}\n\npredictions(fit, variables = \"gender\", \n            hypothesis = avg_POMP.contr)\n#&gt; \n#&gt;  Estimate Std. Error     z Pr(&gt;|z|)    S 2.5 % 97.5 %\n#&gt;     -9.49        1.1 -8.61   &lt;0.001 56.9 -11.6  -7.33\n#&gt; \n#&gt; Term: avg. gender (2-1)\n#&gt; Type:  probs</pre>\n</div>\n</section>\n<section class=\"level1\" id=\"a-note-for-bayesians\">\n<h1>A note for Bayesians</h1>\n<p>Hey, Bayesians, how are you doing?</p>\n<p>I have some bad news: <code>{marginaleffects}</code> does not support <code>hypothesis=&lt;function&gt;</code>.</p>\n<p>But I also have some good news! You can basically do all of this by getting the posterior draws in an <a href=\"https://mc-stan.org/posterior/articles/rvar.html\" rel=\"nofollow\" target=\"_blank\"><code>rvar</code></a> format, and then directly manipulating the posterior(s) - so the examples above should basically work out of the box.</p>\n<p>For example:</p>\n<div class=\"cell\">\n<pre>library(brms)\nlibrary(posterior)\n\nfit_b &lt;- brm(A1 ~ age + gender, \n             data = bfi,\n             family = cumulative(),\n             prior = NULL) # obviously this is a bad prior\n\npr1_b &lt;- predictions(fit_b, variables = \"gender\")</pre>\n</div>\n<p>We just need to adapt the function(s) written above to work properly with <code>rvar</code>s. I’ve marked</p>\n<div class=\"cell\">\n<pre>avg_POMP.contr_b &lt;- function(x) {\n  x |&gt; \n    arrange(rowidcf, group, gender) |&gt; \n    # for each counterfactual row and level of gender\n    summarise(\n      term = \"sum score\",\n      # estimate = sum(estimate * (1:6)), \n1      estimate = rvar_sum(rvar * (1:6)),\n      \n      .by = c(rowidcf, gender)\n    ) |&gt; \n    # POMP\n    mutate(\n      estimate = 100 * (estimate - 1) / (6 - 1)\n    ) |&gt; \n    # contrasts\n    summarise(\n      term = \"gender (2-1)\",\n      estimate = estimate[gender == \"2\"] - estimate[gender == \"1\"], \n      \n      .by = rowidcf\n    ) |&gt; \n    # average\n    summarise(\n      term = \"avg. gender (2-1)\",\n      # estimate = mean(estimate)\n2      estimate = rvar_mean(estimate)\n    )\n}\n\nget_draws(pr1_b, shape = \"rvar\") |&gt;\n  avg_POMP.contr_b()\n#&gt;                term   estimate\n#&gt; 1 avg. gender (2-1) -9.4 ± 1.1</pre>\n<div class=\"cell-annotation\">\n<dl class=\"code-annotation-container-grid\">\n<dt data-target-annotation=\"1\" data-target-cell=\"annotated-cell-11\">1</dt>\n<dd>\n<span data-code-annotation=\"1\" data-code-cell=\"annotated-cell-11\" data-code-lines=\"8\">Use the <code>rvar</code> column and the <code>rvar_sum()</code> function (instead of <code>sum()</code>)</span>\n</dd>\n<dt data-target-annotation=\"2\" data-target-cell=\"annotated-cell-11\">2</dt>\n<dd>\n<span data-code-annotation=\"2\" data-code-cell=\"annotated-cell-11\" data-code-lines=\"27\">Use the <code>rvar_mean()</code> function (instead of <code>mean()</code>)</span>\n</dd>\n</dl>\n</div>\n</div>\n</section>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://blog.msbstats.info/posts/2025-05-01-ordinal-ranks-with-marginaleffects/\"> Stat's What It's All About</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
      "main_text": "Working with Ordinal Ranks in {marginaleffects}\nPosted on\nApril 30, 2025\nby\nStat's What It's All About\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nStat's What It's All About\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nGiven an ordinal regression model, it is relatively easy to get class-wise predictions – the conditional predicted probability of each level of the outcome. However,\noften\n, one might be interested in summarizing effects not on the class-wise probability scale (nor on the latent scale), but instead on the\nrank\nscale – the expected ordinal level, expressed as a single number.\nThe\n{emmeans}\npackage has the\nmode = \"mean.class\"\nthat does just this.\nLet’s see how we can do this in\n{marginaleffects}\nby utilizing the powerful\nhypothesis=\nargument.\nFit a model\nlibrary(tidyverse)\n\nlibrary(marginaleffects)\n\nbfi <- psych::bfi |> \n  mutate(\n    gender = factor(gender),\n    A1 = ordered(A1)\n  ) |> \n  drop_na(A1, age, gender)\n\nnrow(bfi)\n#> [1] 2784\n\nfit <- MASS::polr(A1 ~ age + gender, \n                  data = bfi,\n                  Hess = TRUE)\nClass-Wise Predictions\npr1 <- predictions(fit, variables = \"gender\")\npr1\n#> \n#>  Group Estimate Std. Error     z Pr(>|z|)     S   2.5 % 97.5 %\n#>      1   0.1800    0.01136 15.85   <0.001 185.5 0.15777 0.2023\n#>      1   0.1886    0.01128 16.71   <0.001 205.9 0.16649 0.2107\n#>      1   0.1843    0.01132 16.28   <0.001 195.6 0.16210 0.2065\n#>      1   0.1843    0.01132 16.28   <0.001 195.6 0.16210 0.2065\n#>      1   0.1843    0.01132 16.28   <0.001 195.6 0.16210 0.2065\n#> --- 33398 rows omitted. See ?print.marginaleffects --- \n#>      6   0.0289    0.00335  8.64   <0.001 57.3 0.02234 0.0355\n#>      6   0.0231    0.00264  8.78   <0.001 59.1 0.01798 0.0283\n#>      6   0.0219    0.00250  8.76   <0.001 58.8 0.01699 0.0268\n#>      6   0.0207    0.00238  8.71   <0.001 58.1 0.01604 0.0254\n#>      6   0.0121    0.00165  7.35   <0.001 42.2 0.00891 0.0154\n#> Type:  probs\n\nnrow(pr1) # original data * 2 (counterfactual gender) * 6 (levels of A1)\n#> [1] 33408\nFor each observation in the original data frame we now have 12 predictions:\n- 2 counterfactual predictions for the two levels of gender, times\n- 6 (arguably also counterfactual) predictions for each of the possible outcome levels.\nSum-scores (mean rank)\nWe can average the class\nranks\nby their predicted probability to obtain “sum scores”:\nAnd we can do this for each row in the counterfactual data frame (marked by the\nrowidcf\nvariable):\nsum_score <- function(x) {\n  x |> \n    arrange(rowidcf, group, gender) |> \n    # for each counterfactual row and level of gender\n    summarise(\n      term = \"sum score\",\n      estimate = sum(estimate * (1:6)), \n      \n      .by = c(rowidcf, gender)\n    )\n}\n\npr2 <- predictions(fit, variables = \"gender\", \n                   hypothesis = sum_score)\npr2\n#> \n#>  Estimate Std. Error    z Pr(>|z|)   S 2.5 % 97.5 %\n#>      3.02     0.0583 51.8   <0.001 Inf  2.90   3.13\n#>      2.51     0.0451 55.6   <0.001 Inf  2.42   2.60\n#>      2.97     0.0553 53.7   <0.001 Inf  2.86   3.08\n#>      2.46     0.0415 59.4   <0.001 Inf  2.38   2.55\n#>      3.00     0.0568 52.8   <0.001 Inf  2.88   3.11\n#> --- 5558 rows omitted. See ?print.marginaleffects --- \n#>      2.24     0.0305 73.4   <0.001   Inf  2.18   2.30\n#>      2.67     0.0473 56.4   <0.001   Inf  2.57   2.76\n#>      2.20     0.0304 72.2   <0.001   Inf  2.14   2.26\n#>      2.26     0.0645 35.0   <0.001 890.8  2.13   2.38\n#>      1.85     0.0457 40.6   <0.001   Inf  1.77   1.94\n#> Term: sum score\n#> Type:  probs\n\nnrow(pr2) # original data * 2 (counterfactual gender)\n#> [1] 5568\nAs expected, we now have 2 predictions for each observation in the original data frame: - 2 counterfactual predictions for the two levels of gender\nNote that we could have also computed the mean rank for the two levels of gender, or literally anything else. But here I am trying to mimic the basic behavior of the\navg_/comparisons()\nfunctions by keeping with the workflow:\nCompute observation wise counterfactual predictions\nContrast them for each observation\n(Possibly) average them\nSo let’s get those contrasts!\nContrast the ranks\nsum_score.contr <- function(x) {\n  # same as before, and...\n  sum_score(x) |> \n    # compute a single contrast for each counterfactual row\n    summarise(\n      term = \"gender (2-1)\",\n      estimate = estimate[gender == \"2\"] - estimate[gender == \"1\"], \n      \n      .by = rowidcf\n    )\n}\nThis function will compute a difference between the rank for each gender\nfor each\nobservation.\npr3 <- predictions(fit, variables = \"gender\", \n                   hypothesis = sum_score.contr)\npr3\n#> \n#>  Estimate Std. Error     z Pr(>|z|)    S  2.5 % 97.5 %\n#>    -0.511     0.0588 -8.68   <0.001 57.8 -0.626 -0.395\n#>    -0.506     0.0584 -8.67   <0.001 57.7 -0.621 -0.392\n#>    -0.509     0.0586 -8.68   <0.001 57.8 -0.623 -0.394\n#>    -0.509     0.0586 -8.68   <0.001 57.8 -0.623 -0.394\n#>    -0.509     0.0586 -8.68   <0.001 57.8 -0.623 -0.394\n#> --- 2774 rows omitted. See ?print.marginaleffects --- \n#>    -0.504     0.0582 -8.67   <0.001 57.6 -0.618 -0.390\n#>    -0.483     0.0560 -8.62   <0.001 57.1 -0.593 -0.373\n#>    -0.477     0.0554 -8.61   <0.001 56.9 -0.586 -0.368\n#>    -0.471     0.0548 -8.59   <0.001 56.7 -0.578 -0.363\n#>    -0.403     0.0488 -8.26   <0.001 52.6 -0.499 -0.307\n#> Term: gender (2-1)\n#> Type:  probs\n\nnrow(pr3) # original data\n#> [1] 2784\nAverage Contrast\nFinally, we can get the\naverage\ndifference:\n# average contrast \navg_sum_score.contr <- function(x) {\n  sum_score.contr(x) |> \n    summarise(\n      term = \"avg. gender (2-1)\",\n      estimate = mean(estimate)\n    )\n}\n\npredictions(fit, variables = \"gender\", \n            hypothesis = avg_sum_score.contr)\n#> \n#>  Estimate Std. Error     z Pr(>|z|)    S  2.5 % 97.5 %\n#>    -0.474     0.0551 -8.61   <0.001 56.9 -0.582 -0.366\n#> \n#> Term: avg. gender (2-1)\n#> Type:  probs\nPOMP\nPOMP (percent of maximum possible) are a for of standardized units for Likert-type items (see\nSolomon Kurz’s excellent blog post\nfor more – better – info).\nThese are linear transformations of the ranks described above:\nWe can obtain POMPs for each row in the counterfactual data frame by further processing the sum-scores:\nPOMP <- function(x) {\n  sum_score(x) |> \n    mutate(\n      estimate = 100 * (estimate - 1) / (6 - 1)\n    )\n}\n\npredictions(fit, variables = \"gender\", \n            hypothesis = POMP)\n#> \n#>  Estimate Std. Error    z Pr(>|z|)     S 2.5 % 97.5 %\n#>      40.4      1.166 34.6   <0.001 870.6  38.1   42.7\n#>      30.2      0.902 33.5   <0.001 812.8  28.4   31.9\n#>      39.4      1.107 35.6   <0.001 920.9  37.3   41.6\n#>      29.3      0.829 35.3   <0.001 905.5  27.7   30.9\n#>      39.9      1.135 35.1   <0.001 896.3  37.7   42.1\n#> --- 5558 rows omitted. See ?print.marginaleffects --- \n#>      24.7      0.609 40.6   <0.001   Inf  23.5   25.9\n#>      33.3      0.945 35.3   <0.001 902.9  31.5   35.2\n#>      23.9      0.608 39.3   <0.001   Inf  22.7   25.1\n#>      25.2      1.289 19.5   <0.001 279.4  22.6   27.7\n#>      17.1      0.914 18.7   <0.001 256.9  15.3   18.9\n#> Term: sum score\n#> Type:  probs\nAnd likewise get contrasts -\nPOMP.contr <- function(x) {\n  POMP(x) |> \n    summarise(\n      term = \"gender (2-1)\",\n      estimate = estimate[gender == \"2\"] - estimate[gender == \"1\"], \n      \n      .by = rowidcf\n    )\n}\n\npredictions(fit, variables = \"gender\", \n            hypothesis = sum_score.contr)\n#> \n#>  Estimate Std. Error     z Pr(>|z|)    S  2.5 % 97.5 %\n#>    -0.511     0.0588 -8.68   <0.001 57.8 -0.626 -0.395\n#>    -0.506     0.0584 -8.67   <0.001 57.7 -0.621 -0.392\n#>    -0.509     0.0586 -8.68   <0.001 57.8 -0.623 -0.394\n#>    -0.509     0.0586 -8.68   <0.001 57.8 -0.623 -0.394\n#>    -0.509     0.0586 -8.68   <0.001 57.8 -0.623 -0.394\n#> --- 2774 rows omitted. See ?print.marginaleffects --- \n#>    -0.504     0.0582 -8.67   <0.001 57.6 -0.618 -0.390\n#>    -0.483     0.0560 -8.62   <0.001 57.1 -0.593 -0.373\n#>    -0.477     0.0554 -8.61   <0.001 56.9 -0.586 -0.368\n#>    -0.471     0.0548 -8.59   <0.001 56.7 -0.578 -0.363\n#>    -0.403     0.0488 -8.26   <0.001 52.6 -0.499 -0.307\n#> Term: gender (2-1)\n#> Type:  probs\nAnd average contrasts -\n# average contrast \navg_POMP.contr <- function(x) {\n  POMP.contr(x) |> \n    summarise(\n      term = \"avg. gender (2-1)\",\n      estimate = mean(estimate)\n    )\n}\n\npredictions(fit, variables = \"gender\", \n            hypothesis = avg_POMP.contr)\n#> \n#>  Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n#>     -9.49        1.1 -8.61   <0.001 56.9 -11.6  -7.33\n#> \n#> Term: avg. gender (2-1)\n#> Type:  probs\nA note for Bayesians\nHey, Bayesians, how are you doing?\nI have some bad news:\n{marginaleffects}\ndoes not support\nhypothesis=<function>\n.\nBut I also have some good news! You can basically do all of this by getting the posterior draws in an\nrvar\nformat, and then directly manipulating the posterior(s) - so the examples above should basically work out of the box.\nFor example:\nlibrary(brms)\nlibrary(posterior)\n\nfit_b <- brm(A1 ~ age + gender, \n             data = bfi,\n             family = cumulative(),\n             prior = NULL) # obviously this is a bad prior\n\npr1_b <- predictions(fit_b, variables = \"gender\")\nWe just need to adapt the function(s) written above to work properly with\nrvar\ns. I’ve marked\navg_POMP.contr_b <- function(x) {\n  x |> \n    arrange(rowidcf, group, gender) |> \n    # for each counterfactual row and level of gender\n    summarise(\n      term = \"sum score\",\n      # estimate = sum(estimate * (1:6)), \n1      estimate = rvar_sum(rvar * (1:6)),\n      \n      .by = c(rowidcf, gender)\n    ) |> \n    # POMP\n    mutate(\n      estimate = 100 * (estimate - 1) / (6 - 1)\n    ) |> \n    # contrasts\n    summarise(\n      term = \"gender (2-1)\",\n      estimate = estimate[gender == \"2\"] - estimate[gender == \"1\"], \n      \n      .by = rowidcf\n    ) |> \n    # average\n    summarise(\n      term = \"avg. gender (2-1)\",\n      # estimate = mean(estimate)\n2      estimate = rvar_mean(estimate)\n    )\n}\n\nget_draws(pr1_b, shape = \"rvar\") |>\n  avg_POMP.contr_b()\n#>                term   estimate\n#> 1 avg. gender (2-1) -9.4 ± 1.1\n1\nUse the\nrvar\ncolumn and the\nrvar_sum()\nfunction (instead of\nsum()\n)\n2\nUse the\nrvar_mean()\nfunction (instead of\nmean()\n)\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nStat's What It's All About\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "Given an ordinal regression model, it is relatively easy to get class-wise predictions - the conditional predicted probability of each level of the outcome. However, often, one might be interested in summarizing effects not on the class-wise pro...",
      "meta_keywords": null,
      "og_description": "Given an ordinal regression model, it is relatively easy to get class-wise predictions - the conditional predicted probability of each level of the outcome. However, often, one might be interested in summarizing effects not on the class-wise pro...",
      "og_image": "https://latex.codecogs.com/png.latex?score_i%20=%20%5Csum_%7Bk=1%7D%5E%7BK%7D%7Bp_%7Bik%7D%5Ctimes%20k%7D",
      "og_title": "Working with Ordinal Ranks in {marginaleffects} | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 9.1,
      "sitemap_lastmod": null,
      "twitter_description": "Given an ordinal regression model, it is relatively easy to get class-wise predictions - the conditional predicted probability of each level of the outcome. However, often, one might be interested in summarizing effects not on the class-wise pro...",
      "twitter_title": "Working with Ordinal Ranks in {marginaleffects} | R-bloggers",
      "url": "https://www.r-bloggers.com/2025/04/working-with-ordinal-ranks-in-marginaleffects/",
      "word_count": 1822
    }
  }
}