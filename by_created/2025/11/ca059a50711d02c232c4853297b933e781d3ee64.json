{
  "id": "ca059a50711d02c232c4853297b933e781d3ee64",
  "url": "https://www.r-bloggers.com/2023/11/rethinking-packages-functions-preloading-in-webr-0-2-2/",
  "created_at_utc": "2025-11-17T20:39:12Z",
  "data": null,
  "raw_original": {
    "uuid": "43190dfb-3285-490c-a77b-2335fa9e8883",
    "created_at": "2025-11-17 20:39:12",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2023/11/rethinking-packages-functions-preloading-in-webr-0-2-2/",
      "crawled_at": "2025-11-17T09:54:19.720393",
      "external_links": [
        {
          "href": "https://colinfay.me/rethinking-packages-and-functions-preloading-in-webr-0.2.2/",
          "text": "Colin Fay"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://colinfay.me/calling-webr-from-expressjs/",
          "text": "Using webR in an Express JS REST API"
        },
        {
          "href": "https://colinfay.me/old-faithful-express-bootstrap-webr/",
          "text": "The Old Faithful Geyser Data shiny app with webR, Bootstrap & ExpressJS"
        },
        {
          "href": "https://colinfay.me/preloading-your-r-packages-in-webr-in-an-express-js-api/",
          "text": "Preloading your R packages in webR in an Express JS API"
        },
        {
          "href": "https://colinfay.me/using-own-functions-in-webr-node-js/",
          "text": "Using my own R functions in webR in an Express JS API, and thoughts on building web apps with Node & webR"
        },
        {
          "href": "https://colinfay.me/preloading-your-r-packages-in-webr-in-an-express-js-api/",
          "text": "Preloading your R packages in webR in an Express JS API"
        },
        {
          "href": "https://github.com/r-wasm/webr/issues/260",
          "text": "Github issue"
        },
        {
          "href": "https://colinfay.me/using-own-functions-in-webr-node-js",
          "text": "Using my own R functions in webR in an Express JS API, and thoughts on building web apps with Node & webR"
        },
        {
          "href": "https://www.npmjs.com/package/webrtools",
          "text": "webrtools"
        },
        {
          "href": "https://colinfay.me/using-own-functions-in-webr-node-js/",
          "text": "Using my own R functions in webR in an Express JS API, and thoughts on building web apps with Node & webR"
        },
        {
          "href": "https://github.com/ColinFay/webr-examples/tree/main/webr-preload-funs",
          "text": "ColinFay/webr-examples/"
        },
        {
          "href": "https://docs.r-wasm.org/webr/latest/mounting.html#emscripten-filesystem-images",
          "text": "here"
        },
        {
          "href": "https://colinfay.me/rethinking-packages-and-functions-preloading-in-webr-0.2.2/",
          "text": "Colin Fay"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Rethinking packages & functions preloading in webR 0.2.2 | R-bloggers",
      "images": [],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/colin-fay/",
          "text": "Colin Fay"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-380286 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Rethinking packages &amp; functions preloading in webR 0.2.2</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">November 20, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/colin-fay/\">Colin Fay</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://colinfay.me/rethinking-packages-and-functions-preloading-in-webr-0.2.2/\"> Colin Fay</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9--><p>This post is the fifth one of a series of post about webR:</p>\n<ul>\n<li><a href=\"https://colinfay.me/calling-webr-from-expressjs/\" rel=\"nofollow\" target=\"_blank\">Using webR in an Express JS REST API</a></li>\n<li><a href=\"https://colinfay.me/old-faithful-express-bootstrap-webr/\" rel=\"nofollow\" target=\"_blank\">The Old Faithful Geyser Data shiny app with webR, Bootstrap &amp; ExpressJS</a></li>\n<li><a href=\"https://colinfay.me/preloading-your-r-packages-in-webr-in-an-express-js-api/\" rel=\"nofollow\" target=\"_blank\">Preloading your R packages in webR in an Express JS API</a></li>\n<li><a href=\"https://colinfay.me/using-own-functions-in-webr-node-js/\" rel=\"nofollow\" target=\"_blank\">Using my own R functions in webR in an Express JS API, and thoughts on building web apps with Node &amp; webR</a></li>\n<li>Rethinking webR package &amp; functions preloading with webR 0.2.2</li>\n</ul>\n<blockquote>\n<p>Note: the first post of this series explaining roughly what webR is, I wonâ€™t introduce it again here.</p>\n</blockquote>\n<p>When I wrote my blogpost about <a href=\"https://colinfay.me/preloading-your-r-packages-in-webr-in-an-express-js-api/\" rel=\"nofollow\" target=\"_blank\">Preloading your R packages in webR in an Express JS API</a>, I mentioned that there was no native way to preload things in the webR filesystem â€” meaning that you had to reinstall all the R packages whenever the app was launched (and reported it in a <a href=\"https://github.com/r-wasm/webr/issues/260\" rel=\"nofollow\" target=\"_blank\">Github issue</a>).\nThis also meant that I couldnâ€™t easily take my own functions and run them in the webR environment, as described in <a href=\"https://colinfay.me/using-own-functions-in-webr-node-js\" rel=\"nofollow\" target=\"_blank\">Using my own R functions in webR in an Express JS API, and thoughts on building web apps with Node &amp; webR</a>.\nThese needs made me write the <a href=\"https://www.npmjs.com/package/webrtools\" rel=\"nofollow\" target=\"_blank\">webrtools</a> NodeJS package, to do just that:</p>\n<ul>\n<li>Download the R packages compiled for webR, to a local folder</li>\n<li>Bundle them in the webR lib (by reading the folder tree and reproducing it in webR filesystem)</li>\n<li>Load your local package to access its functions in webR</li>\n</ul>\n<p>The last webR version now exposes Emscriptenâ€™s <code>FS.mount</code>, so this makes the process easier, as there is now no need to read the file tree and recreate it: the folder from the server can be mounted into webR filesystem.</p>\n<p>That implied some rework (now integrated to <code>webrtools</code>) :</p>\n<ul>\n<li>Use <code>webR.FS.mkdir</code> to create a local lib: the module canâ€™t mount the package library into the libPath as is, because it would overwrite the already bundled library (in other words, if you mount into a folder that is not empty, the content from the server overwrites the content from webR).</li>\n<li>Use <code>webR.FS.mount</code> to mount the local directory into the newly created library</li>\n<li>Ensure that this new library is in the libPath()</li>\n</ul>\n<p>Here is the new code for <code>loadPackages</code>, bundled into <code>webrtools</code>:</p>\n<pre>async function loadPackages(webR, dirPath, libName = \"webr_packages\") {\n  // Create a custom lib so that we don't have to worry about\n  // overwriting any packages that are already installed.\n  await webR.FS.mkdir(`/usr/lib/R/${libName}`)\n  // Mount the custom lib\n  await webR.FS.mount(\"NODEFS\", { root: dirPath }, `/usr/lib/R/${libName}`);\n  // Add the custom lib to the R search path\n  await webR.evalR(`.libPaths(c('/usr/lib/R/${libName}', .libPaths()))`);\n}\n</pre>\n<p>Iâ€™ve also decided to deprecate the <code>loadFolder</code> function, as it is now native with <code>webR.FS.mkdir</code> + <code>webR.FS.mount</code>.</p>\n<p>So here is a rewrite of the app from <a href=\"https://colinfay.me/using-own-functions-in-webr-node-js/\" rel=\"nofollow\" target=\"_blank\">Using my own R functions in webR in an Express JS API, and thoughts on building web apps with Node &amp; webR</a>.</p>\n<pre>const app = require('express')()\nconst path = require('path');\nconst { loadPackages } = require('webrtools');\nconst { WebR } = require('webr');\n\n(async () =&gt; {\n  globalThis.webR = new WebR();\n  await globalThis.webR.init();\n\n  console.log(\"ðŸš€ webR is ready ðŸš€\");\n\n  await loadPackages(\n    globalThis.webR,\n    path.join(__dirname, 'webr_packages')\n  )\n\n  await globalThis.webR.FS.mkdir(\"/home/rfuns\")\n\n  await globalThis.webR.FS.mount(\n    \"NODEFS\",\n    {\n      root: path.join(__dirname, 'rfuns')\n    },\n    \"/home/rfuns\"\n  )\n\n  console.log(\"ðŸ“¦ Packages written to webR ðŸ“¦\");\n\n  // see https://github.com/r-wasm/webr/issues/292\n  await globalThis.webR.evalR(\"options(expressions=1000)\")\n  await globalThis.webR.evalR(\"pkgload::load_all('/home/rfuns')\");\n\n  app.listen(3000, '0.0.0.0', () =&gt; {\n    console.log('http://localhost:3000')\n  })\n\n})();\n\napp.get('/', async (req, res) =&gt; {\n  let result = await globalThis.webR.evalR(\n    'unique_species()'\n  );\n  try {\n    let js_res = await result.toJs()\n    res.send(js_res.values)\n  } finally {\n    webR.destroy(result);\n  }\n\n})\n\napp.get('/:n', async (req, res) =&gt; {\n  let result = await globalThis.webR.evalR(\n    'star_wars_by_species(n)',\n    { env: { n: req.params.n } }\n  );\n  try {\n    const result_js = await result.toJs();\n    res.send(result_js)\n  } finally {\n    webR.destroy(result);\n  }\n});\n</pre>\n<p>Full code is at <a href=\"https://github.com/ColinFay/webr-examples/tree/main/webr-preload-funs\" rel=\"nofollow\" target=\"_blank\">ColinFay/webr-examples/</a>.</p>\n<p>Further exploration to be done: webR now bundles a way to package a file system in a file, which can then be downloaded and mounted into the runtime, as described <a href=\"https://docs.r-wasm.org/webr/latest/mounting.html#emscripten-filesystem-images\" rel=\"nofollow\" target=\"_blank\">here</a>.\nThis might come handy for our current structure, but Iâ€™ll have to explore it a bit more.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://colinfay.me/rethinking-packages-and-functions-preloading-in-webr-0.2.2/\"> Colin Fay</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
      "main_text": "Rethinking packages & functions preloading in webR 0.2.2\nPosted on\nNovember 20, 2023\nby\nColin Fay\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nColin Fay\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nThis post is the fifth one of a series of post about webR:\nUsing webR in an Express JS REST API\nThe Old Faithful Geyser Data shiny app with webR, Bootstrap & ExpressJS\nPreloading your R packages in webR in an Express JS API\nUsing my own R functions in webR in an Express JS API, and thoughts on building web apps with Node & webR\nRethinking webR package & functions preloading with webR 0.2.2\nNote: the first post of this series explaining roughly what webR is, I wonâ€™t introduce it again here.\nWhen I wrote my blogpost about\nPreloading your R packages in webR in an Express JS API\n, I mentioned that there was no native way to preload things in the webR filesystem â€” meaning that you had to reinstall all the R packages whenever the app was launched (and reported it in a\nGithub issue\n).\nThis also meant that I couldnâ€™t easily take my own functions and run them in the webR environment, as described in\nUsing my own R functions in webR in an Express JS API, and thoughts on building web apps with Node & webR\n.\nThese needs made me write the\nwebrtools\nNodeJS package, to do just that:\nDownload the R packages compiled for webR, to a local folder\nBundle them in the webR lib (by reading the folder tree and reproducing it in webR filesystem)\nLoad your local package to access its functions in webR\nThe last webR version now exposes Emscriptenâ€™s\nFS.mount\n, so this makes the process easier, as there is now no need to read the file tree and recreate it: the folder from the server can be mounted into webR filesystem.\nThat implied some rework (now integrated to\nwebrtools\n) :\nUse\nwebR.FS.mkdir\nto create a local lib: the module canâ€™t mount the package library into the libPath as is, because it would overwrite the already bundled library (in other words, if you mount into a folder that is not empty, the content from the server overwrites the content from webR).\nUse\nwebR.FS.mount\nto mount the local directory into the newly created library\nEnsure that this new library is in the libPath()\nHere is the new code for\nloadPackages\n, bundled into\nwebrtools\n:\nasync function loadPackages(webR, dirPath, libName = \"webr_packages\") {\n  // Create a custom lib so that we don't have to worry about\n  // overwriting any packages that are already installed.\n  await webR.FS.mkdir(`/usr/lib/R/${libName}`)\n  // Mount the custom lib\n  await webR.FS.mount(\"NODEFS\", { root: dirPath }, `/usr/lib/R/${libName}`);\n  // Add the custom lib to the R search path\n  await webR.evalR(`.libPaths(c('/usr/lib/R/${libName}', .libPaths()))`);\n}\nIâ€™ve also decided to deprecate the\nloadFolder\nfunction, as it is now native with\nwebR.FS.mkdir\n+\nwebR.FS.mount\n.\nSo here is a rewrite of the app from\nUsing my own R functions in webR in an Express JS API, and thoughts on building web apps with Node & webR\n.\nconst app = require('express')()\nconst path = require('path');\nconst { loadPackages } = require('webrtools');\nconst { WebR } = require('webr');\n\n(async () => {\n  globalThis.webR = new WebR();\n  await globalThis.webR.init();\n\n  console.log(\"ðŸš€ webR is ready ðŸš€\");\n\n  await loadPackages(\n    globalThis.webR,\n    path.join(__dirname, 'webr_packages')\n  )\n\n  await globalThis.webR.FS.mkdir(\"/home/rfuns\")\n\n  await globalThis.webR.FS.mount(\n    \"NODEFS\",\n    {\n      root: path.join(__dirname, 'rfuns')\n    },\n    \"/home/rfuns\"\n  )\n\n  console.log(\"ðŸ“¦ Packages written to webR ðŸ“¦\");\n\n  // see https://github.com/r-wasm/webr/issues/292\n  await globalThis.webR.evalR(\"options(expressions=1000)\")\n  await globalThis.webR.evalR(\"pkgload::load_all('/home/rfuns')\");\n\n  app.listen(3000, '0.0.0.0', () => {\n    console.log('http://localhost:3000')\n  })\n\n})();\n\napp.get('/', async (req, res) => {\n  let result = await globalThis.webR.evalR(\n    'unique_species()'\n  );\n  try {\n    let js_res = await result.toJs()\n    res.send(js_res.values)\n  } finally {\n    webR.destroy(result);\n  }\n\n})\n\napp.get('/:n', async (req, res) => {\n  let result = await globalThis.webR.evalR(\n    'star_wars_by_species(n)',\n    { env: { n: req.params.n } }\n  );\n  try {\n    const result_js = await result.toJs();\n    res.send(result_js)\n  } finally {\n    webR.destroy(result);\n  }\n});\nFull code is at\nColinFay/webr-examples/\n.\nFurther exploration to be done: webR now bundles a way to package a file system in a file, which can then be downloaded and mounted into the runtime, as described\nhere\n.\nThis might come handy for our current structure, but Iâ€™ll have to explore it a bit more.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nColin Fay\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "This post is the fifth one of a series of post about webR: Using webR in an Express JS REST API The Old Faithful Geyser Data shiny app with webR, Bootstrap & ExpressJS Preloading your R packages in webR in an Express JS API Using my own R...",
      "meta_keywords": null,
      "og_description": "This post is the fifth one of a series of post about webR: Using webR in an Express JS REST API The Old Faithful Geyser Data shiny app with webR, Bootstrap & ExpressJS Preloading your R packages in webR in an Express JS API Using my own R...",
      "og_image": "https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png",
      "og_title": "Rethinking packages & functions preloading in webR 0.2.2 | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 4.3,
      "sitemap_lastmod": "2023-11-21T00:00:00+00:00",
      "twitter_description": "This post is the fifth one of a series of post about webR: Using webR in an Express JS REST API The Old Faithful Geyser Data shiny app with webR, Bootstrap & ExpressJS Preloading your R packages in webR in an Express JS API Using my own R...",
      "twitter_title": "Rethinking packages & functions preloading in webR 0.2.2 | R-bloggers",
      "url": "https://www.r-bloggers.com/2023/11/rethinking-packages-functions-preloading-in-webr-0-2-2/",
      "word_count": 853
    }
  }
}