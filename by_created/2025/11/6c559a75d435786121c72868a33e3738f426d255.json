{
  "id": "6c559a75d435786121c72868a33e3738f426d255",
  "url": "https://www.r-bloggers.com/2024/01/r-universe-now-builds-macos-arm64-binaries-for-use-on-apple-silicon-aka-m1-m2-m3-systems/",
  "created_at_utc": "2025-11-17T20:38:35Z",
  "data": null,
  "raw_original": {
    "uuid": "774a8b40-98a7-41ea-a877-fb80572e1436",
    "created_at": "2025-11-17 20:38:35",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2024/01/r-universe-now-builds-macos-arm64-binaries-for-use-on-apple-silicon-aka-m1-m2-m3-systems/",
      "crawled_at": "2025-11-17T09:18:18.000348",
      "external_links": [
        {
          "href": "https://ropensci.org/blog/2024/01/14/runiverse-arm64/",
          "text": "rOpenSci - open tools for open science"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://r-universe.dev/",
          "text": "R-universe"
        },
        {
          "href": "https://ropensci.org/blog/2024/01/14/runiverse-arm64/example-arrow.png",
          "text": null
        },
        {
          "href": "https://ropensci.org/blog/2024/01/14/runiverse-arm64/macos-cross.png",
          "text": null
        },
        {
          "href": "https://mac.r-project.org/tools/",
          "text": "universal gfortran 12.2"
        },
        {
          "href": "https://mac.r-project.org/bin/darwin20/arm64/",
          "text": "system libs"
        },
        {
          "href": "https://www.gnu.org/software/autoconf/manual/autoconf-2.68/html_node/Specifying-Target-Triplets.html",
          "text": "needed by autoconf scripts"
        },
        {
          "href": "https://github.com/r-universe-org/build-and-check/blob/v1/macos-cross/action.yml",
          "text": "macos-cross workflow"
        },
        {
          "href": "https://github.com/r-universe-org/prepare-macos/tree/master/shims",
          "text": "shims"
        },
        {
          "href": "https://github.com/r-universe-org/prepare-macos/blob/master/shims/cargo.sh",
          "text": "cargo shim"
        },
        {
          "href": "https://stat.ethz.ch/pipermail/r-sig-mac/2024-January/014912.html",
          "text": "built with strict linking"
        },
        {
          "href": "https://github.com/r-universe-org/help/issues",
          "text": "open an issue"
        },
        {
          "href": "https://en.wikipedia.org/wiki/Universal_binary",
          "text": "universal binaries"
        },
        {
          "href": "https://ropensci.org/blog/2024/01/14/runiverse-arm64/",
          "text": "rOpenSci - open tools for open science"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "R-universe now builds MacOS ARM64 binaries for use on Apple Silicon (aka M1/M2/M3) systems | R-bloggers",
      "images": [
        {
          "alt": "Screenshot of r-universe apache arrow homepage",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Screenshot of r-universe apache arrow homepage",
          "base64": null,
          "src": "https://i2.wp.com/ropensci.org/blog/2024/01/14/runiverse-arm64/example-arrow.png?w=578&ssl=1"
        },
        {
          "alt": "Screenshot of GitHub Actions output",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Screenshot of GitHub Actions output",
          "base64": null,
          "src": "https://i0.wp.com/ropensci.org/blog/2024/01/14/runiverse-arm64/macos-cross.png?w=578&ssl=1"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/ropensci-open-tools-for-open-science/",
          "text": "rOpenSci - open tools for open science"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-381500 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">R-universe now builds MacOS ARM64 binaries for use on Apple Silicon (aka M1/M2/M3) systems</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">January 13, 2024</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/ropensci-open-tools-for-open-science/\">rOpenSci - open tools for open science</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://ropensci.org/blog/2024/01/14/runiverse-arm64/\"> rOpenSci - open tools for open science</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<h2>\nAbstract / TLDR\n</h2><p><a href=\"https://r-universe.dev/\" rel=\"nofollow\" target=\"_blank\">R-universe</a> now provides MacOS arm64 binaries for all R packages. This means that MacOS users on Apple Silicon hardware (aka M1/M2/M3) can install the very latest builds of any R package without the need for any compilation:</p>\n<pre>install.packages('arrow',\n repos = c('https://apache.r-universe.dev', 'https://cloud.r-project.org'))\n</pre><p>R-universe uses cross-compiling for arm64 binaries, though this should not make much of a difference for package authors and R users. Packages with C/C++/Fortran/Rust code are all supported.</p>\n<h2>\nWhy cross compiling\n</h2><p>Because GitHub Actions currently does not offer arm64 runners for OSS projects, the arm64 binaries are cross-compiled on the MacOS intel runners. The cross build environment is set up to mimic a native arm64 machine, such that most R packages do not need any modification to work. We found only a small number of packages with a buggy configure script that may need a fix to allow cross-compilation.</p>\n<p>The r-universe workflow only builds arm64 binaries when needed, i.e. for packages that include compiled code (C/C++/Fortran/Rust). Packages that do not include any compiled code are portable by design, so for these packages the binaries built for MacOS on intel are served both in the x86_64 and arm64 cranlike repositories, without the need for an additional cross compile step.</p>\n<p>Just like CRAN, the r-universe package homepage shows a link to the <code>r-4.3-x86_64</code> and <code>r-4.3-arm64</code> binaries. Packages without compiled code have a <code>r-4.3-any</code> binary which is used for either architecture.</p>\n<div class=\"box\">\n<figure>\n<div class=\"img\">\n<img alt=\"Screenshot of r-universe apache arrow homepage\" data-lazy-src=\"https://i2.wp.com/ropensci.org/blog/2024/01/14/runiverse-arm64/example-arrow.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"Screenshot of r-universe apache arrow homepage\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/ropensci.org/blog/2024/01/14/runiverse-arm64/example-arrow.png?w=578&amp;ssl=1\"/></noscript>\n</div>\n<a href=\"https://ropensci.org/blog/2024/01/14/runiverse-arm64/example-arrow.png\" rel=\"nofollow\" target=\"_blank\"></a>\n</figure>\n</div>\n<p>To have a look at the build logs, click on the little apple icon next to these links. Alternatively, you can use the <code>/buildlog</code> shortlink, for example <code>https://apache.r-universe.dev/arrow/buildlog</code> will take you to the latest arrow builds.</p>\n<p>On this page you can find the arm64 build log specifically by expanding the <code>r-release-macos</code> job and then under the section “Cross Compile for MacOS ARM64”. If this section is disabled, it means it was skipped because this package does not have compiled code, and does not need cross compilation.</p>\n<div class=\"box\">\n<figure>\n<div class=\"img\">\n<img alt=\"Screenshot of GitHub Actions output\" data-lazy-src=\"https://i0.wp.com/ropensci.org/blog/2024/01/14/runiverse-arm64/macos-cross.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"Screenshot of GitHub Actions output\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/ropensci.org/blog/2024/01/14/runiverse-arm64/macos-cross.png?w=578&amp;ssl=1\"/></noscript>\n</div>\n<a href=\"https://ropensci.org/blog/2024/01/14/runiverse-arm64/macos-cross.png\" rel=\"nofollow\" target=\"_blank\"></a>\n</figure>\n</div>\n<h2>\nSome technical details\n</h2><p>For those interested how the cross compilation is set up, here are the main ingredients:</p>\n<ul>\n<li>The standard MacOS Xcode toolchains are used to cross compile C/C++ code by passing the <code>-arch arm64</code> flag to clang and clang++.</li>\n<li>The <a href=\"https://mac.r-project.org/tools/\" rel=\"nofollow\" target=\"_blank\">universal gfortran 12.2</a> version from CRAN (thanks to Simon Urbanek) is used to cross compile fortran code, also by passing <code>gfortran -arch arm64</code>.</li>\n<li>The same collection of <a href=\"https://mac.r-project.org/bin/darwin20/arm64/\" rel=\"nofollow\" target=\"_blank\">system libs</a> used by CRAN is preinstalled in the build environment.</li>\n<li>R packages with a configure script are built with <code>--configure-args=\"--build=x86_64-apple-darwin20 --host=aarch64-apple-darwin20\"</code>. These flags are <a href=\"https://www.gnu.org/software/autoconf/manual/autoconf-2.68/html_node/Specifying-Target-Triplets.html\" rel=\"nofollow\" target=\"_blank\">needed by autoconf scripts</a>, but other packages can use them as well.</li>\n<li>The r-universe <a href=\"https://github.com/r-universe-org/build-and-check/blob/v1/macos-cross/action.yml\" rel=\"nofollow\" target=\"_blank\">macos-cross workflow</a> overrides some more files and variables to target arm64.</li>\n<li>We put some shell <a href=\"https://github.com/r-universe-org/prepare-macos/tree/master/shims\" rel=\"nofollow\" target=\"_blank\">shims</a> on the PATH to help packages that shell out to <code>uname</code> or <code>arch</code> to determine the architecture.</li>\n<li>A clever <a href=\"https://github.com/r-universe-org/prepare-macos/blob/master/shims/cargo.sh\" rel=\"nofollow\" target=\"_blank\">cargo shim</a> is used to override the default cargo build target to <code>aarch64-apple-darwin</code> and copy outputs to the expected directory after the build.</li>\n<li>Packages are <a href=\"https://stat.ethz.ch/pipermail/r-sig-mac/2024-January/014912.html\" rel=\"nofollow\" target=\"_blank\">built with strict linking</a> (without the <code>-undefined dynamic_lookup</code> flag).</li>\n</ul>\n<p>With this setup, almost any R package can be built in the cross environment exactly the same way they do on normal arm64 hardware. But if your package does not work and you need some help fixing it, please feel free to <a href=\"https://github.com/r-universe-org/help/issues\" rel=\"nofollow\" target=\"_blank\">open an issue</a>.</p>\n<h2>\nUniversal binaries\n</h2><p>Finally, some R packages download precompiled binaries for libraries too big or complicated to build on the fly. It is safest to distribute such libraries in the form of <a href=\"https://en.wikipedia.org/wiki/Universal_binary\" rel=\"nofollow\" target=\"_blank\">universal binaries</a> which contain both the x86_64 and arm64 libs. This way your download script does not need to make any guesses about the target architecture it is building for: the same libs can be linked on either target.</p>\n<p>Creating a universal binary can be done for both static and dynamic libraries and is really easy. If you have a <code>x86_64</code> and <code>arm64</code> version of <code>libfoo.a</code> you can glue them together with lipo:</p>\n<pre>lipo -create x86_64/libfoo.a arm64/libfoo.a -output universal/libfoo.a\n</pre><p>And this new <code>libfoo.a</code> can be used when building either for intel or arm. Again if you need any help with this feel free to reach out.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://ropensci.org/blog/2024/01/14/runiverse-arm64/\"> rOpenSci - open tools for open science</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
      "main_text": "R-universe now builds MacOS ARM64 binaries for use on Apple Silicon (aka M1/M2/M3) systems\nPosted on\nJanuary 13, 2024\nby\nrOpenSci - open tools for open science\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nrOpenSci - open tools for open science\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nAbstract / TLDR\nR-universe\nnow provides MacOS arm64 binaries for all R packages. This means that MacOS users on Apple Silicon hardware (aka M1/M2/M3) can install the very latest builds of any R package without the need for any compilation:\ninstall.packages('arrow',\n repos = c('https://apache.r-universe.dev', 'https://cloud.r-project.org'))\nR-universe uses cross-compiling for arm64 binaries, though this should not make much of a difference for package authors and R users. Packages with C/C++/Fortran/Rust code are all supported.\nWhy cross compiling\nBecause GitHub Actions currently does not offer arm64 runners for OSS projects, the arm64 binaries are cross-compiled on the MacOS intel runners. The cross build environment is set up to mimic a native arm64 machine, such that most R packages do not need any modification to work. We found only a small number of packages with a buggy configure script that may need a fix to allow cross-compilation.\nThe r-universe workflow only builds arm64 binaries when needed, i.e. for packages that include compiled code (C/C++/Fortran/Rust). Packages that do not include any compiled code are portable by design, so for these packages the binaries built for MacOS on intel are served both in the x86_64 and arm64 cranlike repositories, without the need for an additional cross compile step.\nJust like CRAN, the r-universe package homepage shows a link to the\nr-4.3-x86_64\nand\nr-4.3-arm64\nbinaries. Packages without compiled code have a\nr-4.3-any\nbinary which is used for either architecture.\nTo have a look at the build logs, click on the little apple icon next to these links. Alternatively, you can use the\n/buildlog\nshortlink, for example\nhttps://apache.r-universe.dev/arrow/buildlog\nwill take you to the latest arrow builds.\nOn this page you can find the arm64 build log specifically by expanding the\nr-release-macos\njob and then under the section “Cross Compile for MacOS ARM64”. If this section is disabled, it means it was skipped because this package does not have compiled code, and does not need cross compilation.\nSome technical details\nFor those interested how the cross compilation is set up, here are the main ingredients:\nThe standard MacOS Xcode toolchains are used to cross compile C/C++ code by passing the\n-arch arm64\nflag to clang and clang++.\nThe\nuniversal gfortran 12.2\nversion from CRAN (thanks to Simon Urbanek) is used to cross compile fortran code, also by passing\ngfortran -arch arm64\n.\nThe same collection of\nsystem libs\nused by CRAN is preinstalled in the build environment.\nR packages with a configure script are built with\n--configure-args=\"--build=x86_64-apple-darwin20 --host=aarch64-apple-darwin20\"\n. These flags are\nneeded by autoconf scripts\n, but other packages can use them as well.\nThe r-universe\nmacos-cross workflow\noverrides some more files and variables to target arm64.\nWe put some shell\nshims\non the PATH to help packages that shell out to\nuname\nor\narch\nto determine the architecture.\nA clever\ncargo shim\nis used to override the default cargo build target to\naarch64-apple-darwin\nand copy outputs to the expected directory after the build.\nPackages are\nbuilt with strict linking\n(without the\n-undefined dynamic_lookup\nflag).\nWith this setup, almost any R package can be built in the cross environment exactly the same way they do on normal arm64 hardware. But if your package does not work and you need some help fixing it, please feel free to\nopen an issue\n.\nUniversal binaries\nFinally, some R packages download precompiled binaries for libraries too big or complicated to build on the fly. It is safest to distribute such libraries in the form of\nuniversal binaries\nwhich contain both the x86_64 and arm64 libs. This way your download script does not need to make any guesses about the target architecture it is building for: the same libs can be linked on either target.\nCreating a universal binary can be done for both static and dynamic libraries and is really easy. If you have a\nx86_64\nand\narm64\nversion of\nlibfoo.a\nyou can glue them together with lipo:\nlipo -create x86_64/libfoo.a arm64/libfoo.a -output universal/libfoo.a\nAnd this new\nlibfoo.a\ncan be used when building either for intel or arm. Again if you need any help with this feel free to reach out.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nrOpenSci - open tools for open science\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "Abstract / TLDR R-universe now provides MacOS arm64 binaries for all R packages. This means that MacOS users on Apple Silicon hardware (aka M1/M2/M3) can install the very latest builds of any R package without the need for any compilation: install.packages('arrow', repos = c('https://apache.r-universe.dev', 'https://cloud.r-project.org')) R-universe uses cross-compiling for arm64 binaries, though this should not make much of a difference for package authors and R users. Packages with C/C++/Fortran/Rust code are all supported. Why cross compiling Because GitHub Actions currently does not offer arm64 runners for OSS projects, the arm64 binaries are cross-compiled on the MacOS intel runners. The cross build environment is set up to mimic a native arm64 machine, such that most R packages do not need any modification to work. We found only a small number of packages with a buggy configure script that may need a fix to allow cross-compilation. The r-universe workflow only builds arm64 binaries when needed, i.e. for packages that include compiled code (C/C++/Fortran/Rust). Packages that do not include any compiled code are portable by design, so for these packages the binaries built for MacOS on intel are served both in the x86_64 and arm64 cranlike repositories, without the need for an additional cross compile step. Just like CRAN, the r-universe package homepage shows a link to the r-4.3-x86_64 and r-4.3-arm64 binaries. Packages without compiled code have a r-4.3-any binary which is used for either architecture. To have a look at the build logs, click on the little apple icon next to these links. Alternatively, you can use the /buildlog shortlink, for example https://apache.r-universe.dev/arrow/buildlog will take you to the latest arrow builds. On this page you can find the arm64 build log specifically by expanding the r-release-macos job and then under the section “Cross Compile for MacOS ARM64”. If this section is disabled, it means it was skipped because this package does not have compiled code, and does not need cross compilation. Some technical details For those interested how the cross compilation is set up, here are the main ingredients: The standard MacOS Xcode toolchains are used to cross compile C/C++ code by passing the -arch arm64 flag to clang and clang++. The universal gfortran 12.2 version from CRAN (thanks to Simon Urbanek) is used to cross compile fortran code, also by passing gfortran -arch arm64. The same collection of system libs used by CRAN is preinstalled in the build environment. R packages with a configure script are built with --configure-args=\"--build=x86_64-apple-darwin20 --host=aarch64-apple-darwin20\". These flags are needed by autoconf scripts, but other packages can use them as well. The r-universe macos-cross workflow overrides some more files and variables to target arm64. We put some shell shims on the PATH to help packages that shell out to uname or arch to determine the architecture. A clever cargo shim is used to override the default cargo build target to aarch64-apple-darwin and copy outputs to the expected directory after the build. Packages are built with strict linking (without the -undefined dynamic_lookup flag). With this setup, almost any R package can be built in the cross environment exactly the same way they do on normal arm64 hardware. But if your package does not work and you need some help fixing it, please feel free to open an issue. Universal binaries Finally, some R packages download precompiled binaries for libraries too big or complicated to build on the fly. It is safest to distribute such libraries in the form of universal binaries which contain both the x86_64 and arm64 libs. This way your download script does not need to make any guesses about the target architecture it is building for: the same libs can be linked on either target. Creating a universal binary can be done for both static and dynamic libraries and is really easy. If you have a x86_64 and arm64 version of libfoo.a you can glue them together with lipo: lipo -create x86_64/libfoo.a arm64/libfoo.a -output universal/libfoo.a And this new libfoo.a can be used when building either for intel or arm. Again if you need any help with this feel free to reach out.",
      "meta_keywords": null,
      "og_description": "Abstract / TLDR R-universe now provides MacOS arm64 binaries for all R packages. This means that MacOS users on Apple Silicon hardware (aka M1/M2/M3) can install the very latest builds of any R package without the need for any compilation: install.packages('arrow', repos = c('https://apache.r-universe.dev', 'https://cloud.r-project.org')) R-universe uses cross-compiling for arm64 binaries, though this should not make much of a difference for package authors and R users. Packages with C/C++/Fortran/Rust code are all supported. Why cross compiling Because GitHub Actions currently does not offer arm64 runners for OSS projects, the arm64 binaries are cross-compiled on the MacOS intel runners. The cross build environment is set up to mimic a native arm64 machine, such that most R packages do not need any modification to work. We found only a small number of packages with a buggy configure script that may need a fix to allow cross-compilation. The r-universe workflow only builds arm64 binaries when needed, i.e. for packages that include compiled code (C/C++/Fortran/Rust). Packages that do not include any compiled code are portable by design, so for these packages the binaries built for MacOS on intel are served both in the x86_64 and arm64 cranlike repositories, without the need for an additional cross compile step. Just like CRAN, the r-universe package homepage shows a link to the r-4.3-x86_64 and r-4.3-arm64 binaries. Packages without compiled code have a r-4.3-any binary which is used for either architecture. To have a look at the build logs, click on the little apple icon next to these links. Alternatively, you can use the /buildlog shortlink, for example https://apache.r-universe.dev/arrow/buildlog will take you to the latest arrow builds. On this page you can find the arm64 build log specifically by expanding the r-release-macos job and then under the section “Cross Compile for MacOS ARM64”. If this section is disabled, it means it was skipped because this package does not have compiled code, and does not need cross compilation. Some technical details For those interested how the cross compilation is set up, here are the main ingredients: The standard MacOS Xcode toolchains are used to cross compile C/C++ code by passing the -arch arm64 flag to clang and clang++. The universal gfortran 12.2 version from CRAN (thanks to Simon Urbanek) is used to cross compile fortran code, also by passing gfortran -arch arm64. The same collection of system libs used by CRAN is preinstalled in the build environment. R packages with a configure script are built with --configure-args=\"--build=x86_64-apple-darwin20 --host=aarch64-apple-darwin20\". These flags are needed by autoconf scripts, but other packages can use them as well. The r-universe macos-cross workflow overrides some more files and variables to target arm64. We put some shell shims on the PATH to help packages that shell out to uname or arch to determine the architecture. A clever cargo shim is used to override the default cargo build target to aarch64-apple-darwin and copy outputs to the expected directory after the build. Packages are built with strict linking (without the -undefined dynamic_lookup flag). With this setup, almost any R package can be built in the cross environment exactly the same way they do on normal arm64 hardware. But if your package does not work and you need some help fixing it, please feel free to open an issue. Universal binaries Finally, some R packages download precompiled binaries for libraries too big or complicated to build on the fly. It is safest to distribute such libraries in the form of universal binaries which contain both the x86_64 and arm64 libs. This way your download script does not need to make any guesses about the target architecture it is building for: the same libs can be linked on either target. Creating a universal binary can be done for both static and dynamic libraries and is really easy. If you have a x86_64 and arm64 version of libfoo.a you can glue them together with lipo: lipo -create x86_64/libfoo.a arm64/libfoo.a -output universal/libfoo.a And this new libfoo.a can be used when building either for intel or arm. Again if you need any help with this feel free to reach out.",
      "og_image": "https://ropensci.org/blog/2024/01/14/runiverse-arm64/example-arrow.png",
      "og_title": "R-universe now builds MacOS ARM64 binaries for use on Apple Silicon (aka M1/M2/M3) systems | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 4.5,
      "sitemap_lastmod": "2024-01-14T00:00:00+00:00",
      "twitter_description": "Abstract / TLDR R-universe now provides MacOS arm64 binaries for all R packages. This means that MacOS users on Apple Silicon hardware (aka M1/M2/M3) can install the very latest builds of any R package without the need for any compilation: install.packages('arrow', repos = c('https://apache.r-universe.dev', 'https://cloud.r-project.org')) R-universe uses cross-compiling for arm64 binaries, though this should not make much of a difference for package authors and R users. Packages with C/C++/Fortran/Rust code are all supported. Why cross compiling Because GitHub Actions currently does not offer arm64 runners for OSS projects, the arm64 binaries are cross-compiled on the MacOS intel runners. The cross build environment is set up to mimic a native arm64 machine, such that most R packages do not need any modification to work. We found only a small number of packages with a buggy configure script that may need a fix to allow cross-compilation. The r-universe workflow only builds arm64 binaries when needed, i.e. for packages that include compiled code (C/C++/Fortran/Rust). Packages that do not include any compiled code are portable by design, so for these packages the binaries built for MacOS on intel are served both in the x86_64 and arm64 cranlike repositories, without the need for an additional cross compile step. Just like CRAN, the r-universe package homepage shows a link to the r-4.3-x86_64 and r-4.3-arm64 binaries. Packages without compiled code have a r-4.3-any binary which is used for either architecture. To have a look at the build logs, click on the little apple icon next to these links. Alternatively, you can use the /buildlog shortlink, for example https://apache.r-universe.dev/arrow/buildlog will take you to the latest arrow builds. On this page you can find the arm64 build log specifically by expanding the r-release-macos job and then under the section “Cross Compile for MacOS ARM64”. If this section is disabled, it means it was skipped because this package does not have compiled code, and does not need cross compilation. Some technical details For those interested how the cross compilation is set up, here are the main ingredients: The standard MacOS Xcode toolchains are used to cross compile C/C++ code by passing the -arch arm64 flag to clang and clang++. The universal gfortran 12.2 version from CRAN (thanks to Simon Urbanek) is used to cross compile fortran code, also by passing gfortran -arch arm64. The same collection of system libs used by CRAN is preinstalled in the build environment. R packages with a configure script are built with --configure-args=\"--build=x86_64-apple-darwin20 --host=aarch64-apple-darwin20\". These flags are needed by autoconf scripts, but other packages can use them as well. The r-universe macos-cross workflow overrides some more files and variables to target arm64. We put some shell shims on the PATH to help packages that shell out to uname or arch to determine the architecture. A clever cargo shim is used to override the default cargo build target to aarch64-apple-darwin and copy outputs to the expected directory after the build. Packages are built with strict linking (without the -undefined dynamic_lookup flag). With this setup, almost any R package can be built in the cross environment exactly the same way they do on normal arm64 hardware. But if your package does not work and you need some help fixing it, please feel free to open an issue. Universal binaries Finally, some R packages download precompiled binaries for libraries too big or complicated to build on the fly. It is safest to distribute such libraries in the form of universal binaries which contain both the x86_64 and arm64 libs. This way your download script does not need to make any guesses about the target architecture it is building for: the same libs can be linked on either target. Creating a universal binary can be done for both static and dynamic libraries and is really easy. If you have a x86_64 and arm64 version of libfoo.a you can glue them together with lipo: lipo -create x86_64/libfoo.a arm64/libfoo.a -output universal/libfoo.a And this new libfoo.a can be used when building either for intel or arm. Again if you need any help with this feel free to reach out.",
      "twitter_title": "R-universe now builds MacOS ARM64 binaries for use on Apple Silicon (aka M1/M2/M3) systems | R-bloggers",
      "url": "https://www.r-bloggers.com/2024/01/r-universe-now-builds-macos-arm64-binaries-for-use-on-apple-silicon-aka-m1-m2-m3-systems/",
      "word_count": 904
    }
  }
}