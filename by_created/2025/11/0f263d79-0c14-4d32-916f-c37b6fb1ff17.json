{
  "uuid": "0f263d79-0c14-4d32-916f-c37b6fb1ff17",
  "created_at": "2025-11-17 20:39:01",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2023/12/repeated-measures-and-subsampling-with-perennial-crops/",
    "crawled_at": "2025-11-17T09:42:09.588400",
    "external_links": [
      {
        "href": "https://www.statforbiology.com/2023/stat_lmm_perennialcropssubsampling/",
        "text": "R on The broken bridge between biologists and statisticians"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://www.statforbiology.com/2023/stat_lmm_perennialcrops/",
        "text": "see here"
      },
      {
        "href": "https://www.statforbiology.com/2023/stat_lmm_subsampling_tkw/",
        "text": "see here"
      },
      {
        "href": "https://twitter.com/onofriandreapg?ref_src=twsrc%5Etfw",
        "text": "Follow@onofriandreapg"
      },
      {
        "href": "https://www.statforbiology.com/2023/stat_lmm_perennialcropssubsampling/",
        "text": "R on The broken bridge between biologists and statisticians"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Repeated measures and subsampling with perennial crops | R-bloggers",
    "images": [],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/r-on-the-broken-bridge-between-biologists-and-stat/",
        "text": "R on The broken bridge between biologists and statisticians"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection#ef8e818b9d8a8ec1808180899d86af9a81869f88c1869b",
        "text": "[email protected]"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-380639 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Repeated measures and subsampling with perennial crops</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">December 3, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/r-on-the-broken-bridge-between-biologists-and-stat/\">R on The broken bridge between biologists and statisticians</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://www.statforbiology.com/2023/stat_lmm_perennialcropssubsampling/\"> R on The broken bridge between biologists and statisticians</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<p>In a recent post, I have talked about repeated measures, for a case where measurements were taken repeatedly in the same plots across years <a href=\"https://www.statforbiology.com/2023/stat_lmm_perennialcrops/\" rel=\"nofollow\" target=\"_blank\">see here</a>. Previously, in another post, I had talked about subsampling, for a case where several random samples were taken from the same plot <a href=\"https://www.statforbiology.com/2023/stat_lmm_subsampling_tkw/\" rel=\"nofollow\" target=\"_blank\">see here</a>.</p>\n<p>Repeated measures and subsampling are vastly different: in the first case I am specifically interested in the ‘evolution’ of the response over time (or space, sometimes). In the second case (subsampling), I only want to improve the precision/accuracy of my measurements, by taking multiple random samples in each plot.</p>\n<p>In this post, I decided to consider a situation where we have both repeated measures and subsampling. I have been prompted to work on this post by a colleague, that is struggling to find the appropriate model for such a situation; I hope that I can lend him/her a hand to get over this (thanks for your request, Gal!).</p>\n<p>Let’s consider the dataset below, that refers to the yield of lucerne genotypes in three consecutive years, taken from the same plots in a single experiment lasting for three years. The situation is similar to that of my previous post, but, in this case, in each year, we took two subsamples of 1 m<sup>2</sup> from each plot to obtain two separate yield measurements.</p>\n<pre>rm(list = ls())\nlibrary(nlme)\nlibrary(dplyr)\nfilePath &lt;- \"https://www.casaonofri.it/_datasets/alfalfa3years_subs.csv\"\ndataset &lt;- read.csv(filePath)\ndataset[,1:4] &lt;- lapply(dataset[,1:4],\n                        function(col) factor(col))\nhead(dataset)\n##   Block Genotype Year SubSample     Yield\n## 1     1 4cascine 2006         1  5.967228\n## 2     1 4cascine 2006         2  5.021836\n## 3     1 4cascine 2007         1 11.319587\n## 4     1 4cascine 2007         2 11.917985\n## 5     1 4cascine 2008         1 10.534574\n## 6     1 4cascine 2008         2 10.374413</pre>\n<p>For this dataset, we need to consider that the observations taken in different years come from the same plots (repeated measures), so that there are three ‘subplots in time’. In each of these subplots (i.e., in each year), we take two subsamples. By considering this, we can follow the usual rules to build the model (Piepho et al., 2004):</p>\n<ol style=\"list-style-type: decimal\">\n<li>Consider one single year and build the treatment model</li>\n<li>Consider one single year and build the block model</li>\n<li>Consider that the ‘plot’ factor in the block model references the randomisation units, i.e. those units which received the the genotypes by a randomisation process. Assign to this plot factor a random effect.</li>\n<li>Include the year factor into the model and combine the year with all the effects in the treatment model, by crossing or nesting as appropriate.</li>\n<li>Excluding the terms for randomisation units, nest the year in all the other terms in the block model.</li>\n<li>Combine random effects for randomisation units with the repeated factor, by using the colon operator, in order to derive the correct error terms to accommodate correlation structures.</li>\n<li>Introduce subsamples, nested within plots and within years. These subsamples must receive a random effect, because they were randomly sampled.</li>\n</ol>\n<p>The models at the different steps are as follows (with R notation):</p>\n<ol style=\"list-style-type: decimal\">\n<li>treatment model: YIELD ~ GENOTYPE</li>\n<li>block model: YIELD ~ BLOCK + BLOCK:PLOT</li>\n<li>block model: YIELD ~ BLOCK + (1|BLOCK:PLOT)</li>\n<li>treatment model: YIELD ~ GENOTYPE * YEAR</li>\n<li>block model: YIELD ~ BLOCK + BLOCK:YEAR + (1|BLOCK:PLOT)</li>\n<li>block model: YIELD ~ BLOCK + BLOCK:YEAR + (1|BLOCK:PLOT) + (1|BLOCK:PLOT:YEAR)</li>\n<li>block model: YIELD ~ BLOCK + BLOCK:YEAR + (1|BLOCK:PLOT) + (1|BLOCK:PLOT:YEAR) + (1|BLOCK:PLOT:YEAR:SUBSAMPLES)</li>\n</ol>\n<p>In this case, we take the block, year and genotype effects as fixed (but you can change this as you please), so that the final model is:</p>\n<p>YIELD ~ GENOTYPE * YEAR + BLOCK + BLOCK:YEAR + (1|BLOCK:PLOT) + (1|BLOCK:PLOT:YEAR) + (1|BLOCK:PLOT:YEAR:SUBSAMPLE)</p>\n<p>where the last term does not need to be fitted in R, as it is the residual term, that is fitted by default.</p>\n<p>We start the analysis by building a new variable to uniquely identify each plot; it is easy, if we think that yield values taken for the same genotype in the same block must have been taken in the same plot. Although this is not strictly necessary, we build another variable to uniquely identify, in each plot, the three ‘subplots in time’, within which subsamples were taken (this facilitates the fitting process in R).</p>\n<pre># Reference the plots\ndataset$Plot &lt;- dataset$Block:dataset$Genotype\ndataset$Subplot &lt;- dataset$Plot:dataset$Year</pre>\n<p>Now we can fit the model with the <code>lme()</code> function (we also show the fit with the <code>lmer()</code> function, just in case):</p>\n<pre>mod &lt;- lme(Yield ~ Block + Block:Year + Genotype*Year, \n           random = ~1|Plot/Subplot,\n           data = dataset)\nanova(mod)\n##               numDF denDF  F-value p-value\n## (Intercept)       1   240 7374.988  &lt;.0001\n## Block             3    57    0.241  0.8676\n## Genotype         19    57    2.361  0.0066\n## Year              2   114 3124.566  &lt;.0001\n## Block:Year        6   114    7.192  &lt;.0001\n## Year:Genotype    38   114    2.524  0.0001\n# library(lme4)\n# mod1 &lt;- lmer(Yield ~ Genotype*Year + Block + Block:Year\n#              + (1|Plot) + (1|Subplot), \n#              data = dataset)</pre>\n<p>As we said in our previous post, the above mixed model analyses regards the design as a sort of ‘split-plot in time’ with sub-replicates and it is not necessarily correct, as it assumes that the within-plot correlation is the same for all pairs of observations, regardless of their distance in time. Further analyses might be necessary to assess whether serial correlation structures are necessary.</p>\n<p>Please, also note that the above model works equally well with annual crops, if we repeat the experiment in several years by using exactly the same plots.</p>\n<p>Thanks for reading and happy coding!</p>\n<p>Andrea Onofri<br/>\nDepartment of Agricultural, Food and Environmental Sciences<br/>\nUniversity of Perugia (Italy)<br/>\n<a href=\"/cdn-cgi/l/email-protection#ef8e818b9d8a8ec1808180899d86af9a81869f88c1869b\" rel=\"nofollow\" target=\"_blank\"><span class=\"__cf_email__\" data-cfemail=\"d9b8b7bdabbcb8f7b6b7b6bfabb099acb7b0a9bef7b0ad\">[email protected]</span></a></p>\n<a class=\"twitter-follow-button\" data-show-count=\"false\" href=\"https://twitter.com/onofriandreapg?ref_src=twsrc%5Etfw\" rel=\"nofollow\" target=\"_blank\">Follow <span class=\"citation\">@onofriandreapg</span></a>\n\n<hr>\n<div class=\"section level1\" id=\"reference\">\n<h1>Reference</h1>\n<ol style=\"list-style-type: decimal\">\n<li>Piepho, H.-P., Büchse, A., Richter, C., 2004. A Mixed Modelling Approach for Randomized Experiments with Repeated Measures. Journal of Agronomy and Crop Science 190, 230–247.</li>\n</ol>\n</div>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://www.statforbiology.com/2023/stat_lmm_perennialcropssubsampling/\"> R on The broken bridge between biologists and statisticians</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div> </hr></div>\n</article>",
    "main_text": "Repeated measures and subsampling with perennial crops\nPosted on\nDecember 3, 2023\nby\nR on The broken bridge between biologists and statisticians\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nR on The broken bridge between biologists and statisticians\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nIn a recent post, I have talked about repeated measures, for a case where measurements were taken repeatedly in the same plots across years\nsee here\n. Previously, in another post, I had talked about subsampling, for a case where several random samples were taken from the same plot\nsee here\n.\nRepeated measures and subsampling are vastly different: in the first case I am specifically interested in the ‘evolution’ of the response over time (or space, sometimes). In the second case (subsampling), I only want to improve the precision/accuracy of my measurements, by taking multiple random samples in each plot.\nIn this post, I decided to consider a situation where we have both repeated measures and subsampling. I have been prompted to work on this post by a colleague, that is struggling to find the appropriate model for such a situation; I hope that I can lend him/her a hand to get over this (thanks for your request, Gal!).\nLet’s consider the dataset below, that refers to the yield of lucerne genotypes in three consecutive years, taken from the same plots in a single experiment lasting for three years. The situation is similar to that of my previous post, but, in this case, in each year, we took two subsamples of 1 m\n2\nfrom each plot to obtain two separate yield measurements.\nrm(list = ls())\nlibrary(nlme)\nlibrary(dplyr)\nfilePath <- \"https://www.casaonofri.it/_datasets/alfalfa3years_subs.csv\"\ndataset <- read.csv(filePath)\ndataset[,1:4] <- lapply(dataset[,1:4],\n                        function(col) factor(col))\nhead(dataset)\n##   Block Genotype Year SubSample     Yield\n## 1     1 4cascine 2006         1  5.967228\n## 2     1 4cascine 2006         2  5.021836\n## 3     1 4cascine 2007         1 11.319587\n## 4     1 4cascine 2007         2 11.917985\n## 5     1 4cascine 2008         1 10.534574\n## 6     1 4cascine 2008         2 10.374413\nFor this dataset, we need to consider that the observations taken in different years come from the same plots (repeated measures), so that there are three ‘subplots in time’. In each of these subplots (i.e., in each year), we take two subsamples. By considering this, we can follow the usual rules to build the model (Piepho et al., 2004):\nConsider one single year and build the treatment model\nConsider one single year and build the block model\nConsider that the ‘plot’ factor in the block model references the randomisation units, i.e. those units which received the the genotypes by a randomisation process. Assign to this plot factor a random effect.\nInclude the year factor into the model and combine the year with all the effects in the treatment model, by crossing or nesting as appropriate.\nExcluding the terms for randomisation units, nest the year in all the other terms in the block model.\nCombine random effects for randomisation units with the repeated factor, by using the colon operator, in order to derive the correct error terms to accommodate correlation structures.\nIntroduce subsamples, nested within plots and within years. These subsamples must receive a random effect, because they were randomly sampled.\nThe models at the different steps are as follows (with R notation):\ntreatment model: YIELD ~ GENOTYPE\nblock model: YIELD ~ BLOCK + BLOCK:PLOT\nblock model: YIELD ~ BLOCK + (1|BLOCK:PLOT)\ntreatment model: YIELD ~ GENOTYPE * YEAR\nblock model: YIELD ~ BLOCK + BLOCK:YEAR + (1|BLOCK:PLOT)\nblock model: YIELD ~ BLOCK + BLOCK:YEAR + (1|BLOCK:PLOT) + (1|BLOCK:PLOT:YEAR)\nblock model: YIELD ~ BLOCK + BLOCK:YEAR + (1|BLOCK:PLOT) + (1|BLOCK:PLOT:YEAR) + (1|BLOCK:PLOT:YEAR:SUBSAMPLES)\nIn this case, we take the block, year and genotype effects as fixed (but you can change this as you please), so that the final model is:\nYIELD ~ GENOTYPE * YEAR + BLOCK + BLOCK:YEAR + (1|BLOCK:PLOT) + (1|BLOCK:PLOT:YEAR) + (1|BLOCK:PLOT:YEAR:SUBSAMPLE)\nwhere the last term does not need to be fitted in R, as it is the residual term, that is fitted by default.\nWe start the analysis by building a new variable to uniquely identify each plot; it is easy, if we think that yield values taken for the same genotype in the same block must have been taken in the same plot. Although this is not strictly necessary, we build another variable to uniquely identify, in each plot, the three ‘subplots in time’, within which subsamples were taken (this facilitates the fitting process in R).\n# Reference the plots\ndataset$Plot <- dataset$Block:dataset$Genotype\ndataset$Subplot <- dataset$Plot:dataset$Year\nNow we can fit the model with the\nlme()\nfunction (we also show the fit with the\nlmer()\nfunction, just in case):\nmod <- lme(Yield ~ Block + Block:Year + Genotype*Year, \n           random = ~1|Plot/Subplot,\n           data = dataset)\nanova(mod)\n##               numDF denDF  F-value p-value\n## (Intercept)       1   240 7374.988  <.0001\n## Block             3    57    0.241  0.8676\n## Genotype         19    57    2.361  0.0066\n## Year              2   114 3124.566  <.0001\n## Block:Year        6   114    7.192  <.0001\n## Year:Genotype    38   114    2.524  0.0001\n# library(lme4)\n# mod1 <- lmer(Yield ~ Genotype*Year + Block + Block:Year\n#              + (1|Plot) + (1|Subplot), \n#              data = dataset)\nAs we said in our previous post, the above mixed model analyses regards the design as a sort of ‘split-plot in time’ with sub-replicates and it is not necessarily correct, as it assumes that the within-plot correlation is the same for all pairs of observations, regardless of their distance in time. Further analyses might be necessary to assess whether serial correlation structures are necessary.\nPlease, also note that the above model works equally well with annual crops, if we repeat the experiment in several years by using exactly the same plots.\nThanks for reading and happy coding!\nAndrea Onofri\nDepartment of Agricultural, Food and Environmental Sciences\nUniversity of Perugia (Italy)\n[email protected]\nFollow\n@onofriandreapg\nReference\nPiepho, H.-P., Büchse, A., Richter, C., 2004. A Mixed Modelling Approach for Randomized Experiments with Repeated Measures. Journal of Agronomy and Crop Science 190, 230–247.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nR on The broken bridge between biologists and statisticians\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "In a recent post, I have talked about repeated measures, for a case where measurements were taken repeatedly in the same plots across years see here. Previously, in another post, I had talked about subsampling, for a case where several random sample...",
    "meta_keywords": null,
    "og_description": "In a recent post, I have talked about repeated measures, for a case where measurements were taken repeatedly in the same plots across years see here. Previously, in another post, I had talked about subsampling, for a case where several random sample...",
    "og_image": "https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png",
    "og_title": "Repeated measures and subsampling with perennial crops | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 5.7,
    "sitemap_lastmod": "2023-12-04T00:00:00+00:00",
    "twitter_description": "In a recent post, I have talked about repeated measures, for a case where measurements were taken repeatedly in the same plots across years see here. Previously, in another post, I had talked about subsampling, for a case where several random sample...",
    "twitter_title": "Repeated measures and subsampling with perennial crops | R-bloggers",
    "url": "https://www.r-bloggers.com/2023/12/repeated-measures-and-subsampling-with-perennial-crops/",
    "word_count": 1144
  }
}