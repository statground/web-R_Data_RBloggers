{
  "id": "65c0b11c5231919fe99d20be6edab1ffc2edba67",
  "url": "https://www.r-bloggers.com/2024/01/using-great-circle-distance-to-determine-twin-cities/",
  "created_at_utc": "2025-11-17T20:38:42Z",
  "data": null,
  "raw_original": {
    "uuid": "2d58a4e8-2f73-49de-a347-90a1eb59d44a",
    "created_at": "2025-11-17 20:38:42",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2024/01/using-great-circle-distance-to-determine-twin-cities/",
      "crawled_at": "2025-11-17T09:24:50.225901",
      "external_links": [
        {
          "href": "https://onlinecollegemathteacher.blogspot.com/2024/01/using-great-circle-distance-to.html",
          "text": "Online College Math Teacher"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://i2.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvldPxrGCMu8D-Mys590vLhq274_mEvuyTHex_72ebLkyCU7QnLC2-Zrbe9ROudqyrz3ZJOeRDdBwing8u5vVd8Y7MnJnMOJl2DqKsCjWM7ip5RlvtvEQeveBHH86ec8YiRdSRSNQBfzh27T7kRTRRJx9-j1ZGkuEhanaCf2BTCXdmCtBqsJvJazaBEvo/s758/Killebrew.png?ssl=1",
          "text": null
        },
        {
          "href": "https://mathwithbaddrawings.com/",
          "text": "https://mathwithbaddrawings.com/"
        },
        {
          "href": "https://simplemaps.com/data/us-cities",
          "text": "https://simplemaps.com/data/us-cities"
        },
        {
          "href": "https://www.census.gov/data/tables/time-series/demo/popest/2020s-total-cities-and-towns.html",
          "text": "https://www.census.gov/data/tables/time-series/demo/popest/2020s-total-cities-and-towns.html"
        },
        {
          "href": "about:invalid#zSoyz",
          "text": "https://www.distancecalculator.net/"
        },
        {
          "href": "https://i1.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh6q_ajylDep6LYSRlT86B3YgrgowAA9Z7DBQy6pN3REyOHnWQ6Flc5hJozTd43QAnujlPu13V1SRcgAGkryYLkTNto0YeWKiCZktZXEOXmfEEBH0q7j3en6Eceme6AbrtV9lkFzmVfvpUK_88NzV61NW8t5trVqvuyrBhZ6xk9AHqix_d9fyEicsX57jc/s1485/map1.png?ssl=1",
          "text": null
        },
        {
          "href": "https://simplemaps.com/data/us-cities",
          "text": "https://simplemaps.com/data/us-cities"
        },
        {
          "href": "about:invalid#zSoyz",
          "text": "https://www.mapdevelopers.com/reverse_geocode_tool.php"
        },
        {
          "href": "https://www.mapdevelopers.com/reverse_geocode_tool.php?lat=40.694300&lng=-73.924900&zoom=12",
          "text": "https://www.mapdevelopers.com/reverse_geocode_tool.php?lat=40.694300&lng=-73.924900&zoom=12"
        },
        {
          "href": "https://i2.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEivYnEVfpV4VNSrQY-ewRtkgpvvPeLJjTZA8OVfYUyJwaPs59xWMEPpI9ZEPzCHG2IHS9GwEYE0FEjXdcOEdRzDvL1OY6Fqzedv9IbyTupm54KUc_JKpVdgSr8e-c-H-rpJzeL7r9q1VK-Skn1Nf0RdsBt4UfWWrBjjiJ7o8bhmw3Ed1-UXWm0ANK-HnDk/s824/map2.png?ssl=1",
          "text": null
        },
        {
          "href": "https://i0.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjuZ6Ox-EBkutAUPJ3ppuuyEitvk7VU06Aof4_-dQpxi0779WALW1ouDFDAyiKoblA0QA0ZQBKE1GkENfZbFKhfkxkPVrMrGJchEB9H6vK57bBGzxaHnUOOp3Vt0s71w01sD2PMzW6hXLeQKuwt0fLmAdB4yK9Z6y548xPZ4UhrT8IHe4z2gJdzdl_825A/s935/citytable.png?ssl=1",
          "text": null
        },
        {
          "href": "https://en.wikipedia.org/wiki/Twin_cities",
          "text": "https://en.wikipedia.org/wiki/Twin_cities"
        },
        {
          "href": "https://onlinecollegemathteacher.blogspot.com/2024/01/using-great-circle-distance-to.html",
          "text": "Online College Math Teacher"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Using great circle distance to determine Twin Cities | R-bloggers",
      "images": [
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i1.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvldPxrGCMu8D-Mys590vLhq274_mEvuyTHex_72ebLkyCU7QnLC2-Zrbe9ROudqyrz3ZJOeRDdBwing8u5vVd8Y7MnJnMOJl2DqKsCjWM7ip5RlvtvEQeveBHH86ec8YiRdSRSNQBfzh27T7kRTRRJx9-j1ZGkuEhanaCf2BTCXdmCtBqsJvJazaBEvo/s320/Killebrew.png?resize=450%2C320&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i2.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh6q_ajylDep6LYSRlT86B3YgrgowAA9Z7DBQy6pN3REyOHnWQ6Flc5hJozTd43QAnujlPu13V1SRcgAGkryYLkTNto0YeWKiCZktZXEOXmfEEBH0q7j3en6Eceme6AbrtV9lkFzmVfvpUK_88NzV61NW8t5trVqvuyrBhZ6xk9AHqix_d9fyEicsX57jc/s400/map1.png?resize=450%2C908&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i2.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEivYnEVfpV4VNSrQY-ewRtkgpvvPeLJjTZA8OVfYUyJwaPs59xWMEPpI9ZEPzCHG2IHS9GwEYE0FEjXdcOEdRzDvL1OY6Fqzedv9IbyTupm54KUc_JKpVdgSr8e-c-H-rpJzeL7r9q1VK-Skn1Nf0RdsBt4UfWWrBjjiJ7o8bhmw3Ed1-UXWm0ANK-HnDk/s400/map2.png?resize=400%2C781&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i1.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjuZ6Ox-EBkutAUPJ3ppuuyEitvk7VU06Aof4_-dQpxi0779WALW1ouDFDAyiKoblA0QA0ZQBKE1GkENfZbFKhfkxkPVrMrGJchEB9H6vK57bBGzxaHnUOOp3Vt0s71w01sD2PMzW6hXLeQKuwt0fLmAdB4yK9Z6y548xPZ4UhrT8IHe4z2gJdzdl_825A/s600/citytable.png?resize=450%2C238&ssl=1"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/jerry-tuttle/",
          "text": "Jerry Tuttle"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-381235 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Using great circle distance to determine Twin Cities</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">January 2, 2024</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/jerry-tuttle/\">Jerry Tuttle</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://onlinecollegemathteacher.blogspot.com/2024/01/using-great-circle-distance-to.html\"> Online College Math Teacher</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9--><font size=\"5\">\n<div class=\"separator\" style=\"clear: both;\"><a href=\"https://i2.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvldPxrGCMu8D-Mys590vLhq274_mEvuyTHex_72ebLkyCU7QnLC2-Zrbe9ROudqyrz3ZJOeRDdBwing8u5vVd8Y7MnJnMOJl2DqKsCjWM7ip5RlvtvEQeveBHH86ec8YiRdSRSNQBfzh27T7kRTRRJx9-j1ZGkuEhanaCf2BTCXdmCtBqsJvJazaBEvo/s758/Killebrew.png?ssl=1\" rel=\"nofollow\" style=\"display: block; padding: 1em 0; text-align: center; \" target=\"_blank\"><img alt=\"\" border=\"0\" data-lazy-src=\"https://i1.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvldPxrGCMu8D-Mys590vLhq274_mEvuyTHex_72ebLkyCU7QnLC2-Zrbe9ROudqyrz3ZJOeRDdBwing8u5vVd8Y7MnJnMOJl2DqKsCjWM7ip5RlvtvEQeveBHH86ec8YiRdSRSNQBfzh27T7kRTRRJx9-j1ZGkuEhanaCf2BTCXdmCtBqsJvJazaBEvo/s320/Killebrew.png?resize=450%2C320&amp;ssl=1\" data-original-height=\"758\" data-original-width=\"450\" data-recalc-dims=\"1\" height=\"320\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" border=\"0\" data-original-height=\"758\" data-original-width=\"450\" data-recalc-dims=\"1\" height=\"320\" src=\"https://i1.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvldPxrGCMu8D-Mys590vLhq274_mEvuyTHex_72ebLkyCU7QnLC2-Zrbe9ROudqyrz3ZJOeRDdBwing8u5vVd8Y7MnJnMOJl2DqKsCjWM7ip5RlvtvEQeveBHH86ec8YiRdSRSNQBfzh27T7kRTRRJx9-j1ZGkuEhanaCf2BTCXdmCtBqsJvJazaBEvo/s320/Killebrew.png?resize=450%2C320&amp;ssl=1\"/></noscript></a></div>\n \nIn the US we think of Minneapolis and St. Paul as the Twin Cities, but Ben Olin, author of Math with Bad Drawings, <a href=\"https://mathwithbaddrawings.com/\" rel=\"nofollow\" target=\"_blank\">https://mathwithbaddrawings.com/</a>, posed this data science question:  Which U.S. cities are the true twin cities?  He imposed three conditions:  <br/>\n<ol type=\"1\">\n<li>the cities must be at most 10 miles apart,</li>\n<li>each city must have at least 200,000 people, and \n<li>the populations have to be within a ratio of 2:1.</li>\n</li></ol>\n\nThis seemed like a nice data analysis problem, so I searched for a dataset containing both population and location.  Interestingly, each of population and location has its nuances, and I learned a lot more from this problem than I expected.<p>\n\nI found <a href=\"https://simplemaps.com/data/us-cities\" rel=\"nofollow\" target=\"_blank\">https://simplemaps.com/data/us-cities</a> has a dataset of 30,844 cities containing latitude, longitude, and population.  However, when Minneapolis’ population came out as 2.9 million, Ben recognized that the population was shown for the broader metropolitan area, not the city proper.  I got a second dataset of populations of city propers from <a href=\"https://www.census.gov/data/tables/time-series/demo/popest/2020s-total-cities-and-towns.html\" rel=\"nofollow\" target=\"_blank\">https://www.census.gov/data/tables/time-series/demo/popest/2020s-total-cities-and-towns.html</a>, I joined the two datasets, and I used the populations from the second database.<p>\n\nHow do you measure the distance between two cities?  This is not as simple a question as it sounds.<p>\n\nAs a start, I used<a href=\"about:invalid#zSoyz\" rel=\"nofollow\" target=\"_blank\"> https://www.distancecalculator.net/</a> and entered two cities I am familiar with, New York, NY and Hoboken, NJ.  That website calculated a distance of 2.39 miles, and it provided a map.  The site further clarified that it used the great circle distance formula.  So this raises two questions:  How does it decide which two points to measure from, and what is a great circle distance? <p>\n\nHoboken has an area of 1.97 square miles, so it probably doesn’t matter too much which point in Hoboken to use.  New York City has an area of 472.43 square miles, so it does matter which point to use.  It is not obvious which point it used, and it certainly did not use the closest point, but from other work, I believe it used City Hall or something close. <p>\n<div class=\"separator\" style=\"clear: both;\"><a href=\"https://i1.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh6q_ajylDep6LYSRlT86B3YgrgowAA9Z7DBQy6pN3REyOHnWQ6Flc5hJozTd43QAnujlPu13V1SRcgAGkryYLkTNto0YeWKiCZktZXEOXmfEEBH0q7j3en6Eceme6AbrtV9lkFzmVfvpUK_88NzV61NW8t5trVqvuyrBhZ6xk9AHqix_d9fyEicsX57jc/s1485/map1.png?ssl=1\" rel=\"nofollow\" style=\"display: block; padding: 1em 0; text-align: center; \" target=\"_blank\"><img alt=\"\" border=\"0\" data-lazy-src=\"https://i2.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh6q_ajylDep6LYSRlT86B3YgrgowAA9Z7DBQy6pN3REyOHnWQ6Flc5hJozTd43QAnujlPu13V1SRcgAGkryYLkTNto0YeWKiCZktZXEOXmfEEBH0q7j3en6Eceme6AbrtV9lkFzmVfvpUK_88NzV61NW8t5trVqvuyrBhZ6xk9AHqix_d9fyEicsX57jc/s400/map1.png?resize=450%2C908&amp;ssl=1\" data-original-height=\"908\" data-original-width=\"450\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"\" border=\"0\" data-original-height=\"908\" data-original-width=\"450\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh6q_ajylDep6LYSRlT86B3YgrgowAA9Z7DBQy6pN3REyOHnWQ6Flc5hJozTd43QAnujlPu13V1SRcgAGkryYLkTNto0YeWKiCZktZXEOXmfEEBH0q7j3en6Eceme6AbrtV9lkFzmVfvpUK_88NzV61NW8t5trVqvuyrBhZ6xk9AHqix_d9fyEicsX57jc/s400/map1.png?resize=450%2C908&amp;ssl=1\" width=\"450\"/></noscript></a></div>\n\n\nAlthough some sites will measure distance between two cities as driving distance, it is more common to use great circle distance, which is the shortest distance along the surface of a sphere.  The earth is not exactly a sphere, but it is approximately a sphere. <p>\n\nLatitude and longitude is a coordinate system to describe any point on the earth’s surface.  Lines of latitude are horizontal lines parallel to the Equator, and represent how far north or south a point is from the Equator.  Lines of longitude represent how far a point is east or west from a vertical line called the Prime Meridian that runs through Greenwich, England.  Both latitude and longitude are measured in degrees, which are broken down into smaller units called minutes and seconds.  For convenience they are also expressed in decimal degrees.  If D is degrees, M is minutes, and S is seconds, then the conversion to decimal degree uses D + M/60 + S/3600. <p>\n\nWhen we use trig functions to calculate distances, we need to convert decimal degrees to radians by multiplying by  π / 180.  We also need to know the radius of the earth which is 3963.0 miles. <p>\n\nIf point A is (lat1, long1) in decimals and point B is (lat2, long2) in decimals, then the distance formula d is the great-circle distance on a perfect sphere using the haversine distance formula, which is derived from principles of three-dimensional spherical trigonometry including the spherical law of cosines.  A haversine of an angle θ is defined as hav(θ) = sin<sup>2</sup>(θ/2), and this concept is used in the derivation. <p>\n\nd = ACOS(SIN(PI()*[Lat_start]/180.0)*SIN(PI()*[Lat_end]/180.0)+COS(PI()*[Lat_start]/180.0)\n*COS(PI()*[Lat_end]/180.0)*COS(PI()*[Long_start]/180.0-PI()*[Long_end]/180.0))*3963 <p>\n\n\n\n\nAs I mentioned, I used <a href=\"https://simplemaps.com/data/us-cities\" rel=\"nofollow\" target=\"_blank\">https://simplemaps.com/data/us-cities</a> which contains  cities with their latitude and longitude, and I applied the above distance formulas to pairs of cities.  But I was still curious about the  choice of a latitude and longitude for a particular city.  That file lists New York City as (40.6943, -73.9249). Another website that finds a street address from a decimal latitude and longitude,<a href=\"about:invalid#zSoyz\" rel=\"nofollow\" target=\"_blank\"> https://www.mapdevelopers.com/reverse_geocode_tool.php</a> ,  lists the address of  (40.6943, -73.9249) as 871 Bushwick Avenue, Brooklyn, which is some distance from City Hall, but does not appear to be the centroid of  New York City either.\nWikipedia’s choice of latitude and longitude for New York City is 42 Park Row which is close to City Hall.<p> \n\nThe following map from  <a href=\"https://www.mapdevelopers.com/reverse_geocode_tool.php?lat=40.694300&amp;lng=-73.924900&amp;zoom=12\" rel=\"nofollow\" target=\"_blank\">https://www.mapdevelopers.com/reverse_geocode_tool.php?lat=40.694300&amp;lng=-73.924900&amp;zoom=12</a>  shows the approximate location of 871 Bushwick Avenue, Brooklyn. <p>\n<div class=\"separator\" style=\"clear: both;\"><a href=\"https://i2.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEivYnEVfpV4VNSrQY-ewRtkgpvvPeLJjTZA8OVfYUyJwaPs59xWMEPpI9ZEPzCHG2IHS9GwEYE0FEjXdcOEdRzDvL1OY6Fqzedv9IbyTupm54KUc_JKpVdgSr8e-c-H-rpJzeL7r9q1VK-Skn1Nf0RdsBt4UfWWrBjjiJ7o8bhmw3Ed1-UXWm0ANK-HnDk/s824/map2.png?ssl=1\" rel=\"nofollow\" style=\"display: block; padding: 1em 0; text-align: center; \" target=\"_blank\"><img alt=\"\" border=\"0\" data-lazy-src=\"https://i2.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEivYnEVfpV4VNSrQY-ewRtkgpvvPeLJjTZA8OVfYUyJwaPs59xWMEPpI9ZEPzCHG2IHS9GwEYE0FEjXdcOEdRzDvL1OY6Fqzedv9IbyTupm54KUc_JKpVdgSr8e-c-H-rpJzeL7r9q1VK-Skn1Nf0RdsBt4UfWWrBjjiJ7o8bhmw3Ed1-UXWm0ANK-HnDk/s400/map2.png?resize=400%2C781&amp;ssl=1\" data-original-height=\"781\" data-original-width=\"450\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"400\"/><noscript><img alt=\"\" border=\"0\" data-original-height=\"781\" data-original-width=\"450\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEivYnEVfpV4VNSrQY-ewRtkgpvvPeLJjTZA8OVfYUyJwaPs59xWMEPpI9ZEPzCHG2IHS9GwEYE0FEjXdcOEdRzDvL1OY6Fqzedv9IbyTupm54KUc_JKpVdgSr8e-c-H-rpJzeL7r9q1VK-Skn1Nf0RdsBt4UfWWrBjjiJ7o8bhmw3Ed1-UXWm0ANK-HnDk/s400/map2.png?resize=400%2C781&amp;ssl=1\" width=\"400\"/></noscript></a></div>\n\n\n \n\n\nI joined the dataset of locations with the populations of city propers from the second dataset, and I applied Ben’s three conditions.  This produced 8 pairs of cities, and of course this list uses the first dataset’s choice of a city’s latitude and longitude and the distances resulting from that.  Different choices of latitude and longitude produce a different list. <p>\n<div class=\"separator\" style=\"clear: both;\"><a href=\"https://i0.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjuZ6Ox-EBkutAUPJ3ppuuyEitvk7VU06Aof4_-dQpxi0779WALW1ouDFDAyiKoblA0QA0ZQBKE1GkENfZbFKhfkxkPVrMrGJchEB9H6vK57bBGzxaHnUOOp3Vt0s71w01sD2PMzW6hXLeQKuwt0fLmAdB4yK9Z6y548xPZ4UhrT8IHe4z2gJdzdl_825A/s935/citytable.png?ssl=1\" rel=\"nofollow\" style=\"display: block; padding: 1em 0; text-align: center; \" target=\"_blank\"><img alt=\"\" border=\"0\" data-lazy-src=\"https://i1.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjuZ6Ox-EBkutAUPJ3ppuuyEitvk7VU06Aof4_-dQpxi0779WALW1ouDFDAyiKoblA0QA0ZQBKE1GkENfZbFKhfkxkPVrMrGJchEB9H6vK57bBGzxaHnUOOp3Vt0s71w01sD2PMzW6hXLeQKuwt0fLmAdB4yK9Z6y548xPZ4UhrT8IHe4z2gJdzdl_825A/s600/citytable.png?resize=450%2C238&amp;ssl=1\" data-original-height=\"238\" data-original-width=\"450\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"\" border=\"0\" data-original-height=\"238\" data-original-width=\"450\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjuZ6Ox-EBkutAUPJ3ppuuyEitvk7VU06Aof4_-dQpxi0779WALW1ouDFDAyiKoblA0QA0ZQBKE1GkENfZbFKhfkxkPVrMrGJchEB9H6vK57bBGzxaHnUOOp3Vt0s71w01sD2PMzW6hXLeQKuwt0fLmAdB4yK9Z6y548xPZ4UhrT8IHe4z2gJdzdl_825A/s600/citytable.png?resize=450%2C238&amp;ssl=1\" width=\"450\"/></noscript></a></div> <p>\n  \nOf these pairs, I actually like Hialeah and Miami as the true twin cities.  Besides meeting the original three criteria, they both share the same large ethnic population and they share a public transportation system. <p>\n  \nWikipedia has a much larger list of twin cities <a href=\"https://en.wikipedia.org/wiki/Twin_cities\" rel=\"nofollow\" target=\"_blank\">https://en.wikipedia.org/wiki/Twin_cities</a>, but they did not necessarily use Ben Olin’s three criteria.  Also, Ben’s problem is for US cities only, and Wikipedia has several pairs of Canada-US and Mexico-US cities that I had not thought about. <p>\n  \nHere is the R code I used: <p>\n  \ndf1 &lt;- read.csv(\"https://raw.githubusercontent.com/fcas80/jt_files/main/uscities.csv\")   <br/>\ndf1 &lt;- subset(df1, select = c(city, lat, lng, state_name))    <br/>\nn1 &lt;- nrow(df1)   # 30844   <br/>\n<br/>\nlibrary(“readxl”)   <br/>\ndf2 &lt;- read_excel(\"https://raw.githubusercontent.com/fcas80/jt_files/main/censuspop.xlsx\", mode = \"wb\", skip = 3)   <br/>\ndf2 &lt;- df2[ -c(1,4:6) ]   <br/>\ncolnames(df2) &lt;- c(\"city\", \"pop\")   <br/>\n# city appears as format Los Angeles city, California   <br/>\ndf2$state &lt;- gsub(\".*\\\\, \", \"\", df2$city)  # extract state: everything after comma blank   <br/>\ndf2$city &lt;- gsub(\"\\\\,.*\", \"\", df2$city)    # extract everything before comma   <br/>\ndf2$city &lt;- gsub(\" city*\", \"\", df2$city)  # delete: blank city   <br/>\n<br/>\ndf = merge(x=df1, y=df2, by=”city”,all=TRUE)   <br/>\ndf &lt;- na.omit(df)   <br/>\ndf &lt;- df[df$pop &gt;= 200000, ]    <br/>\ndf &lt;- df[df$state_name == df$state, ]    # delete improper merge same city in 2 states   <br/>\ndf &lt;- subset(df, select = -c(state_name, state))   <br/>\nn &lt;- nrow(df)   # 112   <br/>\n<br/>\nkount &lt;- 1   <br/>\ndf11 &lt;- data.frame()   <br/>\nfor (i in 1:n){   <br/>\n      Lat_start &lt;- df[i,2]   <br/>\n         Long_start &lt;- df[i,3]   <br/>\n         for (j in 1:n){   <br/>\n            Lat_end &lt;- df[j,2]   <br/>\n                 Long_end &lt;- df[j,3]   <br/>\n            dist_miles &lt;- acos(sin(pi*(Lat_start)/180.0)*sin(pi*(Lat_end)/180.0)+    <br/>\n              cos(pi*(Lat_start)/180.0)*cos(pi*(Lat_end)/180.0)*cos(pi*    <br/>\n            (Long_start)/180.0-pi*(Long_end)/180.0))*3963   <br/>\n              cos(pi*(Lat_start)/180.0)*cos(pi*(Lat_end)/180.0)*cos(pi*(Long_start)/180.0-pi*    <br/>\n            (Long_end)/180.0))*3963   <br/>\n                 dist_miles &lt;- round(dist_miles, 0)   <br/>\n                 pop_ratio &lt;- round(max(df[i,4]/df[j,4], df[j,4]/df[i,4]),1)   <br/>\n                 if (df[i,1] != df[j,1] &amp; dist_miles &gt; 0 &amp; dist_miles &lt;= 10 &amp; pop_ratio &lt;= 2){   <br/>\n                    df11[kount,1] &lt;- df[i,1]   <br/>\n                    df11[kount,2] &lt;- df[j,1]   <br/>\n                    df11[kount,3] &lt;- dist_miles   <br/>\n                    df11[kount,4] &lt;- df[i,4]   <br/>\n                    df11[kount,5] &lt;- df[j,4]   <br/>\n                    df11[kount,6] &lt;- pop_ratio   <br/>\n                    df11[kount,7] &lt;- df[i,4] + df[j,4]   <br/>\n                    kount &lt;- kount + 1   <br/>\n                 }    <br/> \n        }   <br/>\n}   <br/>\ncolnames(df11) &lt;- c(\"City1\", \"City2\", \"Dist\", \"Pop1\", \"Pop2\", \"Ratio\", \"TotPop\")   <br/>\ndf11 &lt;- df11[!duplicated(df11$TotPop), ]   # remove duplicates   <br/>\ndf11 &lt;- df11[ -c(7) ]   <br/>\ndf11 &lt;- data.frame(df11, row.names = NULL)   # renumber rows consecutively   <br/>\ndf11   <br/><br/>\n</p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></font>\n<p>\n<p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://onlinecollegemathteacher.blogspot.com/2024/01/using-great-circle-distance-to.html\"> Online College Math Teacher</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </p></p></div>\n</article>",
      "main_text": "Using great circle distance to determine Twin Cities\nPosted on\nJanuary 2, 2024\nby\nJerry Tuttle\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nOnline College Math Teacher\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nIn the US we think of Minneapolis and St. Paul as the Twin Cities, but Ben Olin, author of Math with Bad Drawings,\nhttps://mathwithbaddrawings.com/\n, posed this data science question:  Which U.S. cities are the true twin cities?  He imposed three conditions:\nthe cities must be at most 10 miles apart,\neach city must have at least 200,000 people, and\nthe populations have to be within a ratio of 2:1.\nThis seemed like a nice data analysis problem, so I searched for a dataset containing both population and location.  Interestingly, each of population and location has its nuances, and I learned a lot more from this problem than I expected.\nI found\nhttps://simplemaps.com/data/us-cities\nhas a dataset of 30,844 cities containing latitude, longitude, and population.  However, when Minneapolis’ population came out as 2.9 million, Ben recognized that the population was shown for the broader metropolitan area, not the city proper.  I got a second dataset of populations of city propers from\nhttps://www.census.gov/data/tables/time-series/demo/popest/2020s-total-cities-and-towns.html\n, I joined the two datasets, and I used the populations from the second database.\nHow do you measure the distance between two cities?  This is not as simple a question as it sounds.\nAs a start, I used\nhttps://www.distancecalculator.net/\nand entered two cities I am familiar with, New York, NY and Hoboken, NJ.  That website calculated a distance of 2.39 miles, and it provided a map.  The site further clarified that it used the great circle distance formula.  So this raises two questions:  How does it decide which two points to measure from, and what is a great circle distance?\nHoboken has an area of 1.97 square miles, so it probably doesn’t matter too much which point in Hoboken to use.  New York City has an area of 472.43 square miles, so it does matter which point to use.  It is not obvious which point it used, and it certainly did not use the closest point, but from other work, I believe it used City Hall or something close.\nAlthough some sites will measure distance between two cities as driving distance, it is more common to use great circle distance, which is the shortest distance along the surface of a sphere.  The earth is not exactly a sphere, but it is approximately a sphere.\nLatitude and longitude is a coordinate system to describe any point on the earth’s surface.  Lines of latitude are horizontal lines parallel to the Equator, and represent how far north or south a point is from the Equator.  Lines of longitude represent how far a point is east or west from a vertical line called the Prime Meridian that runs through Greenwich, England.  Both latitude and longitude are measured in degrees, which are broken down into smaller units called minutes and seconds.  For convenience they are also expressed in decimal degrees.  If D is degrees, M is minutes, and S is seconds, then the conversion to decimal degree uses D + M/60 + S/3600.\nWhen we use trig functions to calculate distances, we need to convert decimal degrees to radians by multiplying by  π / 180.  We also need to know the radius of the earth which is 3963.0 miles.\nIf point A is (lat1, long1) in decimals and point B is (lat2, long2) in decimals, then the distance formula d is the great-circle distance on a perfect sphere using the haversine distance formula, which is derived from principles of three-dimensional spherical trigonometry including the spherical law of cosines.  A haversine of an angle θ is defined as hav(θ) = sin\n2\n(θ/2), and this concept is used in the derivation.\nd = ACOS(SIN(PI()*[Lat_start]/180.0)*SIN(PI()*[Lat_end]/180.0)+COS(PI()*[Lat_start]/180.0)\n*COS(PI()*[Lat_end]/180.0)*COS(PI()*[Long_start]/180.0-PI()*[Long_end]/180.0))*3963\nAs I mentioned, I used\nhttps://simplemaps.com/data/us-cities\nwhich contains  cities with their latitude and longitude, and I applied the above distance formulas to pairs of cities.  But I was still curious about the  choice of a latitude and longitude for a particular city.  That file lists New York City as (40.6943, -73.9249). Another website that finds a street address from a decimal latitude and longitude,\nhttps://www.mapdevelopers.com/reverse_geocode_tool.php\n,  lists the address of  (40.6943, -73.9249) as 871 Bushwick Avenue, Brooklyn, which is some distance from City Hall, but does not appear to be the centroid of  New York City either.\nWikipedia’s choice of latitude and longitude for New York City is 42 Park Row which is close to City Hall.\nThe following map from\nhttps://www.mapdevelopers.com/reverse_geocode_tool.php?lat=40.694300&lng=-73.924900&zoom=12\nshows the approximate location of 871 Bushwick Avenue, Brooklyn.\nI joined the dataset of locations with the populations of city propers from the second dataset, and I applied Ben’s three conditions.  This produced 8 pairs of cities, and of course this list uses the first dataset’s choice of a city’s latitude and longitude and the distances resulting from that.  Different choices of latitude and longitude produce a different list.\nOf these pairs, I actually like Hialeah and Miami as the true twin cities.  Besides meeting the original three criteria, they both share the same large ethnic population and they share a public transportation system.\nWikipedia has a much larger list of twin cities\nhttps://en.wikipedia.org/wiki/Twin_cities\n, but they did not necessarily use Ben Olin’s three criteria.  Also, Ben’s problem is for US cities only, and Wikipedia has several pairs of Canada-US and Mexico-US cities that I had not thought about.\nHere is the R code I used:\ndf1 <- read.csv(\"https://raw.githubusercontent.com/fcas80/jt_files/main/uscities.csv\")\ndf1 <- subset(df1, select = c(city, lat, lng, state_name))\nn1 <- nrow(df1)   # 30844\nlibrary(“readxl”)\ndf2 <- read_excel(\"https://raw.githubusercontent.com/fcas80/jt_files/main/censuspop.xlsx\", mode = \"wb\", skip = 3)\ndf2 <- df2[ -c(1,4:6) ]\ncolnames(df2) <- c(\"city\", \"pop\")\n# city appears as format Los Angeles city, California\ndf2$state <- gsub(\".*\\\\, \", \"\", df2$city)  # extract state: everything after comma blank\ndf2$city <- gsub(\"\\\\,.*\", \"\", df2$city)    # extract everything before comma\ndf2$city <- gsub(\" city*\", \"\", df2$city)  # delete: blank city\ndf = merge(x=df1, y=df2, by=”city”,all=TRUE)\ndf <- na.omit(df)\ndf <- df[df$pop >= 200000, ]\ndf <- df[df$state_name == df$state, ]    # delete improper merge same city in 2 states\ndf <- subset(df, select = -c(state_name, state))\nn <- nrow(df)   # 112\nkount <- 1\ndf11 <- data.frame()\nfor (i in 1:n){\nLat_start <- df[i,2]\nLong_start <- df[i,3]\nfor (j in 1:n){\nLat_end <- df[j,2]\nLong_end <- df[j,3]\ndist_miles <- acos(sin(pi*(Lat_start)/180.0)*sin(pi*(Lat_end)/180.0)+\ncos(pi*(Lat_start)/180.0)*cos(pi*(Lat_end)/180.0)*cos(pi*\n(Long_start)/180.0-pi*(Long_end)/180.0))*3963\ncos(pi*(Lat_start)/180.0)*cos(pi*(Lat_end)/180.0)*cos(pi*(Long_start)/180.0-pi*\n(Long_end)/180.0))*3963\ndist_miles <- round(dist_miles, 0)\npop_ratio <- round(max(df[i,4]/df[j,4], df[j,4]/df[i,4]),1)\nif (df[i,1] != df[j,1] & dist_miles > 0 & dist_miles <= 10 & pop_ratio <= 2){\ndf11[kount,1] <- df[i,1]\ndf11[kount,2] <- df[j,1]\ndf11[kount,3] <- dist_miles\ndf11[kount,4] <- df[i,4]\ndf11[kount,5] <- df[j,4]\ndf11[kount,6] <- pop_ratio\ndf11[kount,7] <- df[i,4] + df[j,4]\nkount <- kount + 1\n}\n}\n}\ncolnames(df11) <- c(\"City1\", \"City2\", \"Dist\", \"Pop1\", \"Pop2\", \"Ratio\", \"TotPop\")\ndf11 <- df11[!duplicated(df11$TotPop), ]   # remove duplicates\ndf11 <- df11[ -c(7) ]\ndf11 <- data.frame(df11, row.names = NULL)   # renumber rows consecutively\ndf11\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nOnline College Math Teacher\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "In the US we think of Minneapolis and St. Paul as the Twin Cities, but Ben Olin, author of Math with Bad Drawings, https://mathwithbaddrawings.com/, posed this data science question: Which U.S. cities are the true twin cities? He imposed three c...",
      "meta_keywords": null,
      "og_description": "In the US we think of Minneapolis and St. Paul as the Twin Cities, but Ben Olin, author of Math with Bad Drawings, https://mathwithbaddrawings.com/, posed this data science question: Which U.S. cities are the true twin cities? He imposed three c...",
      "og_image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvldPxrGCMu8D-Mys590vLhq274_mEvuyTHex_72ebLkyCU7QnLC2-Zrbe9ROudqyrz3ZJOeRDdBwing8u5vVd8Y7MnJnMOJl2DqKsCjWM7ip5RlvtvEQeveBHH86ec8YiRdSRSNQBfzh27T7kRTRRJx9-j1ZGkuEhanaCf2BTCXdmCtBqsJvJazaBEvo/s320/Killebrew.png",
      "og_title": "Using great circle distance to determine Twin Cities | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 7.3,
      "sitemap_lastmod": "2024-01-02T22:16:07+00:00",
      "twitter_description": "In the US we think of Minneapolis and St. Paul as the Twin Cities, but Ben Olin, author of Math with Bad Drawings, https://mathwithbaddrawings.com/, posed this data science question: Which U.S. cities are the true twin cities? He imposed three c...",
      "twitter_title": "Using great circle distance to determine Twin Cities | R-bloggers",
      "url": "https://www.r-bloggers.com/2024/01/using-great-circle-distance-to-determine-twin-cities/",
      "word_count": 1453
    }
  }
}