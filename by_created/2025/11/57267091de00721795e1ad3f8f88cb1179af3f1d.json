{
  "id": "57267091de00721795e1ad3f8f88cb1179af3f1d",
  "url": "https://www.r-bloggers.com/2023/11/powerquery-puzzle-solved-with-r-2/",
  "created_at_utc": "2025-11-17T20:39:06Z",
  "data": null,
  "raw_original": {
    "uuid": "af159a52-0d87-45f8-a227-9f363154b7e0",
    "created_at": "2025-11-17 20:39:06",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2023/11/powerquery-puzzle-solved-with-r-2/",
      "crawled_at": "2025-11-17T09:47:04.801246",
      "external_links": [
        {
          "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-1fd00984f764",
          "text": "Numbers around us - Medium"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://www.linkedin.com/posts/excelbi_powerquerychallenge-daxchallenge-m-activity-7134032291835617280-x2-A?utm_source=share&utm_medium=member_desktop",
          "text": "content"
        },
        {
          "href": "https://lnkd.in/dj7CM_pF",
          "text": "file"
        },
        {
          "href": "https://www.linkedin.com/posts/excelbi_powerquerychallenge-daxchallenge-m-activity-7134390317272711168-QwJJ?utm_source=share&utm_medium=member_desktop",
          "text": "content"
        },
        {
          "href": "https://lnkd.in/dCK9yc6K",
          "text": "file"
        },
        {
          "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-1fd00984f764",
          "text": "PowerQuery Puzzle solved with R"
        },
        {
          "href": "https://medium.com/number-around-us",
          "text": "Numbers around us"
        },
        {
          "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-1fd00984f764",
          "text": "Numbers around us - Medium"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "PowerQuery Puzzle solved with R | R-bloggers",
      "images": [
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i2.wp.com/cdn-images-1.medium.com/max/1024/1*mG6uBMboDLuAacPS0wAp7g.jpeg?w=578&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*X-gbD_N2GzWTJh6OIvBoow.png?w=578&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*iIRc6F_GU4iEFPHcKJk1vA.png?w=578&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": "data:application/octet-stream;base64,R0lGODlhAQABAO+/vQAA77+977+977+9AAAAIe+/vQQBAAAAACwAAAAAAQABAAACAkQBADs=",
          "src": "https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=1fd00984f764"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/numbers-around-us/",
          "text": "Numbers around us"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-380375 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">PowerQuery Puzzle solved with R</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">November 28, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/numbers-around-us/\">Numbers around us</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-1fd00984f764\"> Numbers around us - Medium</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9--><p># 133–134</p><figure><img alt=\"\" data-lazy-src=\"https://i2.wp.com/cdn-images-1.medium.com/max/1024/1*mG6uBMboDLuAacPS0wAp7g.jpeg?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/cdn-images-1.medium.com/max/1024/1*mG6uBMboDLuAacPS0wAp7g.jpeg?w=578&amp;ssl=1\"/></noscript></figure><p>This weekend brought us two stories, two puzzles which have to things in common: they are pretty hard and difficulties were both linked to time dimension.</p><h3>Puzzles:</h3><p>PQ_133: <a href=\"https://www.linkedin.com/posts/excelbi_powerquerychallenge-daxchallenge-m-activity-7134032291835617280-x2-A?utm_source=share&amp;utm_medium=member_desktop\" rel=\"nofollow\" target=\"_blank\">content</a> <a href=\"https://lnkd.in/dj7CM_pF\" rel=\"nofollow\" target=\"_blank\">file</a><br/>PQ_134: <a href=\"https://www.linkedin.com/posts/excelbi_powerquerychallenge-daxchallenge-m-activity-7134390317272711168-QwJJ?utm_source=share&amp;utm_medium=member_desktop\" rel=\"nofollow\" target=\"_blank\">content</a> <a href=\"https://lnkd.in/dCK9yc6K\" rel=\"nofollow\" target=\"_blank\">file</a></p><h3>PQ_133</h3><figure><img alt=\"\" data-lazy-src=\"https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*X-gbD_N2GzWTJh6OIvBoow.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*X-gbD_N2GzWTJh6OIvBoow.png?w=578&amp;ssl=1\"/></noscript></figure><p>In first puzzle we have data about electricity consumption measured in some points of time during two days across three meters. It shouldn’t be hard right? Yes, it could. Especially when one of the measurements crosses midnight. Let see what was difficult there.</p><h4>Load data and libraries</h4><pre>library(tidyverse)\nlibrary(readxl)\nlibrary(lubridate)\n\ninput = read_excel(\"PQ_Challenge_133.xlsx\", range = \"A1:E9\", col_types = c(\"date\", \"date\", \"numeric\", \"numeric\", \"numeric\"))\ntest = read_excel(\"PQ_Challenge_133.xlsx\", range = \"G1:J3\")</pre><p>There is one issue with reading time column, and that is why I had to add “many” years to it as first data manipulation.</p><h4>Prepare functions and mid-steps</h4><pre>df = input %&gt;%\n  mutate(Time = Time + years(124) - days(ifelse(day(Date) == 1, 60, 59))) %&gt;%\n  select(-Date) %&gt;%\n  pivot_longer(-Time, names_to = \"Meter\", values_to = \"Value\") %&gt;%\n  group_by(Meter) %&gt;%\n  arrange(Meter, Time) %&gt;%\n  mutate(end = lead(Time),\n         next_reading = lead(Value), \n         cross_midnight = ifelse(day(Time) != day(end), 1, 0), \n         duration = end-Time, \n         consumption = next_reading - Value ,\n         time_to_midnight = difftime( ceiling_date(Time, \"day\"),Time, units = \"hours\"))\n         )</pre><p>In this step I had some things to clean data and make auxiliary columns:<br/>– time of next reading;<br/>– flag if measurement is crossing midnight;<br/>– consumptions based on two consecutive measurements;<br/>– and time left to midnight.</p><p>But there is where we need to think little bit more. First of all we need to split data for crossing and not crossing midnight. Only for crossing ones we need to calculate proportion of time which happens before and after midnight, then somehow split this proportion into two time periods: before and after.</p><pre>df_cross = df %&gt;%\n  ungroup() %&gt;%\n  filter(cross_midnight == 1) %&gt;%\n  mutate(perc_of_dur = time_to_midnight/as.numeric(duration),\n         cons_before_midnight = consumption * perc_of_dur,\n         cons_after_midnight = consumption - cons_before_midnight) %&gt;%\n  select(Time, end, Meter, cons_before_midnight, cons_after_midnight) %&gt;%\n  pivot_longer(-c(Time, end, Meter), names_to = \"Midnight\", values_to = \"Consumption\") %&gt;%\n  mutate(Date_start = as.Date(Time),\n         Date_end = as.Date(end), \n         Date = if_else(Midnight == \"cons_before_midnight\", Date_start, Date_end),\n         Consumption = as.numeric(Consumption)) %&gt;%\n  select(Date, Meter, Consumption) </pre><p>Second part need just simple reshaping before bringing all data back together.</p><pre>df_else = df %&gt;%\n  ungroup() %&gt;%\n  filter(cross_midnight == 0) %&gt;%\n  select(Time, end, Meter, consumption) %&gt;%\n  pivot_longer(-c(Time, end, Meter), names_to = \"Midnight\", values_to = \"Consumption\") %&gt;%\n  mutate(Date = as.Date(Time)) %&gt;%\n  select(Date, Meter, Consumption)</pre><p>And then we can put it back in one data.frame and reshape it to be compared with provided solution. And it is.</p><pre>result = bind_rows(df_cross, df_else) %&gt;%\n  arrange(Date, Meter) %&gt;%\n  group_by(Date, Meter) %&gt;%\n  summarize(Consumption = round(sum(Consumption))) %&gt;%\n  pivot_wider(names_from = Meter, values_from = Consumption) %&gt;%\n  ungroup() %&gt;%\n  mutate(Date = as.POSIXct(Date))\n\nidentical(result, test)\n# [1] TRUE</pre><h3>PQ_134</h3><figure><img alt=\"\" data-lazy-src=\"https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*iIRc6F_GU4iEFPHcKJk1vA.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*iIRc6F_GU4iEFPHcKJk1vA.png?w=578&amp;ssl=1\"/></noscript></figure><p>Second puzzle was about stocks. We are provided with two tables: one with opening stock for first day in three stores, and one that has Ins and Outs from the stock for three consecutive days. What we need to find are closing stocks for each of those three days. I was trying with recursive calculations at first, but… I found out that there is another way. Lets find out!</p><h4>Load data and libraries</h4><pre>library(tidyverse)\nlibrary(readxl)\n\ninput1 = read_excel(\"PQ_Challenge_134.xlsx\", range = \"A1:D12\")\ninput2 = read_excel(\"PQ_Challenge_134.xlsx\", range = \"F1:G4\")\n\ntest = read_excel(\"PQ_Challenge_134.xlsx\", range = \"J1:N12\")</pre><p>input2 is about opening stocks, but we don’t really know for what date. But we can 100% sure to assume that we need first day from second table.</p><pre>opening = input2 %&gt;% \n  mutate(Date = min(input1$Date)) %&gt;%\n  rename(open = `Open Stock`)</pre><p>There is where magic begins… we can little bit transform opening df to have exactly the same structure like the second one. We have Date, open and store . We need IN and OUT. Let make it by changing open into IN and create empty OUT column. And then we can bind both tables together. Finally grouping data by Store and Date we can use cummulative sums to find daily stock moves and closing_stock. Finally we can compare it to provided solution.</p><pre>result &lt;- opening %&gt;%\n  rename(IN = open, OUT = integer(length(open))) %&gt;%\n  bind_rows(input1)  %&gt;%\n  group_by(Store) %&gt;%\n  arrange(Store, Date) %&gt;%\n  mutate(OUT = ifelse(is.na(OUT), 0, OUT),\n         closing_stock = cumsum(IN) - cumsum(OUT)) %&gt;%\n  ungroup() %&gt;%\n  filter(OUT != 0) %&gt;%\n  select(Store, Date, IN, OUT, `Closing Stock` = closing_stock)\n\nidentical(result, test)\n#&gt; [1] TRUE</pre><p>Second puzzle was easier, but also tricky to find good and suprisingly easy solution.</p><p>We’ve seen some nice puzzles considering time changes and it shows little bit out of the box thinking. Feel free to ask, like and share. <br/>Lets be in touch for next article about the functions.</p><img alt=\"\" data-lazy-src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=1fd00984f764\" height=\"1\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"1\"/><noscript><img alt=\"\" height=\"1\" loading=\"lazy\" src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=1fd00984f764\" width=\"1\"/></noscript><hr/><p><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-1fd00984f764\" rel=\"nofollow\" target=\"_blank\">PowerQuery Puzzle solved with R</a> was originally published in <a href=\"https://medium.com/number-around-us\" rel=\"nofollow\" target=\"_blank\">Numbers around us</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-1fd00984f764\"> Numbers around us - Medium</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
      "main_text": "PowerQuery Puzzle solved with R\nPosted on\nNovember 28, 2023\nby\nNumbers around us\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nNumbers around us - Medium\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\n# 133–134\nThis weekend brought us two stories, two puzzles which have to things in common: they are pretty hard and difficulties were both linked to time dimension.\nPuzzles:\nPQ_133:\ncontent\nfile\nPQ_134:\ncontent\nfile\nPQ_133\nIn first puzzle we have data about electricity consumption measured in some points of time during two days across three meters. It shouldn’t be hard right? Yes, it could. Especially when one of the measurements crosses midnight. Let see what was difficult there.\nLoad data and libraries\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(lubridate)\n\ninput = read_excel(\"PQ_Challenge_133.xlsx\", range = \"A1:E9\", col_types = c(\"date\", \"date\", \"numeric\", \"numeric\", \"numeric\"))\ntest = read_excel(\"PQ_Challenge_133.xlsx\", range = \"G1:J3\")\nThere is one issue with reading time column, and that is why I had to add “many” years to it as first data manipulation.\nPrepare functions and mid-steps\ndf = input %>%\n  mutate(Time = Time + years(124) - days(ifelse(day(Date) == 1, 60, 59))) %>%\n  select(-Date) %>%\n  pivot_longer(-Time, names_to = \"Meter\", values_to = \"Value\") %>%\n  group_by(Meter) %>%\n  arrange(Meter, Time) %>%\n  mutate(end = lead(Time),\n         next_reading = lead(Value), \n         cross_midnight = ifelse(day(Time) != day(end), 1, 0), \n         duration = end-Time, \n         consumption = next_reading - Value ,\n         time_to_midnight = difftime( ceiling_date(Time, \"day\"),Time, units = \"hours\"))\n         )\nIn this step I had some things to clean data and make auxiliary columns:\n– time of next reading;\n– flag if measurement is crossing midnight;\n– consumptions based on two consecutive measurements;\n– and time left to midnight.\nBut there is where we need to think little bit more. First of all we need to split data for crossing and not crossing midnight. Only for crossing ones we need to calculate proportion of time which happens before and after midnight, then somehow split this proportion into two time periods: before and after.\ndf_cross = df %>%\n  ungroup() %>%\n  filter(cross_midnight == 1) %>%\n  mutate(perc_of_dur = time_to_midnight/as.numeric(duration),\n         cons_before_midnight = consumption * perc_of_dur,\n         cons_after_midnight = consumption - cons_before_midnight) %>%\n  select(Time, end, Meter, cons_before_midnight, cons_after_midnight) %>%\n  pivot_longer(-c(Time, end, Meter), names_to = \"Midnight\", values_to = \"Consumption\") %>%\n  mutate(Date_start = as.Date(Time),\n         Date_end = as.Date(end), \n         Date = if_else(Midnight == \"cons_before_midnight\", Date_start, Date_end),\n         Consumption = as.numeric(Consumption)) %>%\n  select(Date, Meter, Consumption)\nSecond part need just simple reshaping before bringing all data back together.\ndf_else = df %>%\n  ungroup() %>%\n  filter(cross_midnight == 0) %>%\n  select(Time, end, Meter, consumption) %>%\n  pivot_longer(-c(Time, end, Meter), names_to = \"Midnight\", values_to = \"Consumption\") %>%\n  mutate(Date = as.Date(Time)) %>%\n  select(Date, Meter, Consumption)\nAnd then we can put it back in one data.frame and reshape it to be compared with provided solution. And it is.\nresult = bind_rows(df_cross, df_else) %>%\n  arrange(Date, Meter) %>%\n  group_by(Date, Meter) %>%\n  summarize(Consumption = round(sum(Consumption))) %>%\n  pivot_wider(names_from = Meter, values_from = Consumption) %>%\n  ungroup() %>%\n  mutate(Date = as.POSIXct(Date))\n\nidentical(result, test)\n# [1] TRUE\nPQ_134\nSecond puzzle was about stocks. We are provided with two tables: one with opening stock for first day in three stores, and one that has Ins and Outs from the stock for three consecutive days. What we need to find are closing stocks for each of those three days. I was trying with recursive calculations at first, but… I found out that there is another way. Lets find out!\nLoad data and libraries\nlibrary(tidyverse)\nlibrary(readxl)\n\ninput1 = read_excel(\"PQ_Challenge_134.xlsx\", range = \"A1:D12\")\ninput2 = read_excel(\"PQ_Challenge_134.xlsx\", range = \"F1:G4\")\n\ntest = read_excel(\"PQ_Challenge_134.xlsx\", range = \"J1:N12\")\ninput2 is about opening stocks, but we don’t really know for what date. But we can 100% sure to assume that we need first day from second table.\nopening = input2 %>% \n  mutate(Date = min(input1$Date)) %>%\n  rename(open = `Open Stock`)\nThere is where magic begins… we can little bit transform opening df to have exactly the same structure like the second one. We have Date, open and store . We need IN and OUT. Let make it by changing open into IN and create empty OUT column. And then we can bind both tables together. Finally grouping data by Store and Date we can use cummulative sums to find daily stock moves and closing_stock. Finally we can compare it to provided solution.\nresult <- opening %>%\n  rename(IN = open, OUT = integer(length(open))) %>%\n  bind_rows(input1)  %>%\n  group_by(Store) %>%\n  arrange(Store, Date) %>%\n  mutate(OUT = ifelse(is.na(OUT), 0, OUT),\n         closing_stock = cumsum(IN) - cumsum(OUT)) %>%\n  ungroup() %>%\n  filter(OUT != 0) %>%\n  select(Store, Date, IN, OUT, `Closing Stock` = closing_stock)\n\nidentical(result, test)\n#> [1] TRUE\nSecond puzzle was easier, but also tricky to find good and suprisingly easy solution.\nWe’ve seen some nice puzzles considering time changes and it shows little bit out of the box thinking. Feel free to ask, like and share.\nLets be in touch for next article about the functions.\nPowerQuery Puzzle solved with R\nwas originally published in\nNumbers around us\non Medium, where people are continuing the conversation by highlighting and responding to this story.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nNumbers around us - Medium\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "# 133–134This weekend brought us two stories, two puzzles which have to things in common: they are pretty hard and difficulties were both linked to time dimension.Puzzles:PQ_133: content filePQ_134: content filePQ_133In first puzzle we have data about ...",
      "meta_keywords": null,
      "og_description": "# 133–134This weekend brought us two stories, two puzzles which have to things in common: they are pretty hard and difficulties were both linked to time dimension.Puzzles:PQ_133: content filePQ_134: content filePQ_133In first puzzle we have data about ...",
      "og_image": "https://cdn-images-1.medium.com/max/1024/1*mG6uBMboDLuAacPS0wAp7g.jpeg",
      "og_title": "PowerQuery Puzzle solved with R | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 4.6,
      "sitemap_lastmod": "2023-11-28T13:40:30+00:00",
      "twitter_description": "# 133–134This weekend brought us two stories, two puzzles which have to things in common: they are pretty hard and difficulties were both linked to time dimension.Puzzles:PQ_133: content filePQ_134: content filePQ_133In first puzzle we have data about ...",
      "twitter_title": "PowerQuery Puzzle solved with R | R-bloggers",
      "url": "https://www.r-bloggers.com/2023/11/powerquery-puzzle-solved-with-r-2/",
      "word_count": 923
    }
  }
}