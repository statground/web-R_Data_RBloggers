{
  "uuid": "ec492532-ef4c-4da9-b678-49da4cdb0789",
  "created_at": "2025-11-22 19:59:01",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2025/03/learning-to-create-an-r-package-with-deliberate-redundancy-%f0%9f%a4%a3-a-note-for-myself/",
    "crawled_at": "2025-11-22T10:52:08.291823",
    "external_links": [
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/",
        "text": "r on Everyday Is A School Day"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#motivations",
        "text": null
      },
      {
        "href": "https://alecsalces.com/",
        "text": "Alec Wong"
      },
      {
        "href": "https://r-pkgs.org/",
        "text": "R Package"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#the-original-code",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#objectives",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#workflow",
        "text": "The Workflow"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#create",
        "text": "create_package()"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#git",
        "text": "use_git()"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#function",
        "text": "Write The Function"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#use_r",
        "text": "use_r()"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#load_all",
        "text": "load_all()"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#check",
        "text": "check()"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#description",
        "text": "Edit DESCRIPTION"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#license",
        "text": "use_mit_license()"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#roxygen2",
        "text": "Insert roxygen2 skeleton on function"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#document",
        "text": "document()"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#package",
        "text": "use_package()"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#last",
        "text": "check() again and install()"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#improvement",
        "text": "Further Improvement"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#split",
        "text": "Split Files ToChat.Randutils.R"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#testing",
        "text": "Add Unit Testing"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#ack",
        "text": "Acknowledgement"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#lessons",
        "text": "Lessons Learnt"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#workflow",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#create",
        "text": null
      },
      {
        "href": "https://r-pkgs.org/whole-game.html",
        "text": "Read here"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#git",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#function",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#use_r",
        "text": null
      },
      {
        "href": "https://style.tidyverse.org/files.html",
        "text": "read here more on Tidy style guide"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#load_all",
        "text": null
      },
      {
        "href": "https://r-pkgs.org/whole-game.html#sec-whole-game-load-all",
        "text": "here"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#check",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#description",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#license",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#roxygen2",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#document",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#package",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#last",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#improvement",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#split",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#chatr",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#utilsr",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#testing",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#test-chatr",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#ack",
        "text": null
      },
      {
        "href": "https://alecsalces.com/",
        "text": "Alec Wong"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/#lessons",
        "text": null
      },
      {
        "href": "https://r-pkgs.org/",
        "text": "read"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/",
        "text": "comment or visit my other blogs"
      },
      {
        "href": "https://bsky.app/profile/kenkoonwong.bsky.social",
        "text": "BlueSky"
      },
      {
        "href": "https://twitter.com/kenkoonwong/",
        "text": "twitter"
      },
      {
        "href": "https://github.com/kenkoonwong/",
        "text": "GitHub"
      },
      {
        "href": "https://med-mastodon.com/@kenkoonwong",
        "text": "Mastodon"
      },
      {
        "href": "https://www.kenkoonwong.com/contact/",
        "text": "contact me"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/rpackage1/",
        "text": "r on Everyday Is A School Day"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Learning To Create an R Package With Deliberate Redundancy ü§£ A Note For Myself | R-bloggers",
    "images": [
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i1.wp.com/www.kenkoonwong.com/blog/rpackage1/box.jpg?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/create_package_error.png?w=578&ssl=1"
      },
      {
        "alt": "image",
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": "image",
        "base64": null,
        "src": "https://i1.wp.com/www.kenkoonwong.com/blog/rpackage1/files.png?w=40%25&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/load_all.png?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i1.wp.com/www.kenkoonwong.com/blog/rpackage1/check.png?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/description.png?w=578&ssl=1"
      },
      {
        "alt": "image",
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": "image",
        "base64": null,
        "src": "https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/license.png?w=60%25&ssl=1"
      },
      {
        "alt": "image",
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": "image",
        "base64": null,
        "src": "https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/roxygen2.png?w=50%25&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/roxygen2_chunk.png?w=578&ssl=1"
      },
      {
        "alt": "image",
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": "image",
        "base64": null,
        "src": "https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/document.png?w=50%25&ssl=1"
      },
      {
        "alt": "image",
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": "image",
        "base64": null,
        "src": "https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/help.png?w=80%25&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/greenlight.png?w=578&ssl=1"
      },
      {
        "alt": "image",
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": "image",
        "base64": null,
        "src": "https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/test.png?w=50%25&ssl=1"
      },
      {
        "alt": "image",
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": "image",
        "base64": null,
        "src": "https://i0.wp.com/r-pkgs.org/diagrams/workflow.png?w=450&ssl=1"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/r-on-everyday-is-a-school-day/",
        "text": "r on Everyday Is A School Day"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-391392 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Learning To Create an R Package With Deliberate Redundancy ü§£ A Note For Myself</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">March 21, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/r-on-everyday-is-a-school-day/\">r on Everyday Is A School Day</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://www.kenkoonwong.com/blog/rpackage1/\"> r on Everyday Is A School Day</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47--><blockquote>\n<p>üôà Made a hilariously redundant R package for a simple OpenAI calls, but the real win was finally learning how to build an R package! üõ†Ô∏è Is it efficient? Absolutely not!Was it worth the time and experience? Yes! Will I do it again? Yes! Will it break? Yes! ü§£</p>\n</blockquote>\n<p><img alt=\"\" data-lazy-src=\"https://i1.wp.com/www.kenkoonwong.com/blog/rpackage1/box.jpg?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/www.kenkoonwong.com/blog/rpackage1/box.jpg?w=578&amp;ssl=1\"/></noscript></p>\n<h2 id=\"motivations\">Motivations\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#motivations\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>We‚Äôve been using a lot of LLM lately especially OpenAI GPT4omini via <code>reticulate</code>. Trying to load <code>reticulate</code> -&gt; import OpenAI -&gt; initialize it -&gt; insert API_key etc again and again whenever we want to use it for a new project or new script, that‚Äôs just very redundant, tedious and so on.</p>\n<p>Recently, with motivation from \n<a href=\"https://alecsalces.com/\" rel=\"nofollow\" target=\"_blank\"><code>Alec Wong</code></a> kindly recommending me to read \n<a href=\"https://r-pkgs.org/\" rel=\"nofollow\" target=\"_blank\">R Package</a> after I asked him a noob question ‚ÄúHow does one test and make changes of an existing R package and pull request?‚Äù ü§£ The book is great! I really enjoy the first part, it actually teaches you how to create an R package right from the get go! Before it dives into the details. I found that to be extremely refreshing, because you can easily create an MVP right upfront for personal use by following a workflow! üôå</p>\n<p>With the LLM in mind, and wanting to learn how to create an R package (ahem properly, best practice ü´°), why don‚Äôt we try to make our very own package called <code>myopenai</code> !? Alright, there is already a brilliant package called <code>ellmer</code>, and my current project is most likey redundant (hence the title), but what a better way to start learning? And we‚Äôre going to do it the inefficient way, via <code>reticulate</code> (this is when you see R experts shake their head of disbelief ü§≠) instead of the http API! ü§£ Join me in learning how to create an R Package!</p>\n<p>Seriously though, this is not an efficient way of using openAI API‚Ä¶ It‚Äôs for demonstration purposes only.</p>\n<h2 id=\"the-original-code\">The Original Code\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#the-original-code\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<pre>reticulate::use_virtualenv(\"openai\")\nlibrary(reticulate)\n\nopenai &lt;- import(\"openai\")\nOpenAI &lt;- openai$OpenAI\n\nclient = OpenAI(api_key = 'YOUR API KEY') ## change this to yours  \n\nresponse &lt;- client$chat$completions$create(\n  model = \"gpt-4o-mini\",\n  messages = list(dict(\n    role = \"system\",\n    content = \"You are a summarizer. Please summarize the following abstract. \n    Include statistics.Use emoji to shorten characters. The summary must not \n    exceed 200 characters‚Äîif you reach 200 characters, stop immediately. \n    Do not add any extra commentary or exceed the 200-character limit.\"\n  ), dict(\n    role = \"user\",\n    content = df_new[10,\"item_description\"] |&gt; pull()\n  )\n  ),\n  temperature = 0\n)\n\n(summary &lt;- response$choices[[1]]$message$content)\n</pre><p>The above was our previous code. Now we will use the above code, turn it into a function and hopefully at the end of the project we‚Äôll have a library called <code>myopenai</code> and we can call a function <code>chat()</code> and just need to insert the prompt, or pipe the prompt into the function.</p>\n<h2 id=\"objectives\">Objectives:\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#objectives\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#workflow\" rel=\"nofollow\" target=\"_blank\">The Workflow</a>\n<ul>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#create\" rel=\"nofollow\" target=\"_blank\">create_package()</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#git\" rel=\"nofollow\" target=\"_blank\">use_git()</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#function\" rel=\"nofollow\" target=\"_blank\">Write The Function</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#use_r\" rel=\"nofollow\" target=\"_blank\">use_r()</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#load_all\" rel=\"nofollow\" target=\"_blank\">load_all()</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#check\" rel=\"nofollow\" target=\"_blank\">check()</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#description\" rel=\"nofollow\" target=\"_blank\">Edit DESCRIPTION</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#license\" rel=\"nofollow\" target=\"_blank\">use_mit_license()</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#roxygen2\" rel=\"nofollow\" target=\"_blank\">Insert roxygen2 skeleton on function</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#document\" rel=\"nofollow\" target=\"_blank\">document()</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#package\" rel=\"nofollow\" target=\"_blank\">use_package()</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#last\" rel=\"nofollow\" target=\"_blank\">check() again and install()</a></li>\n</ul>\n</li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#improvement\" rel=\"nofollow\" target=\"_blank\">Further Improvement</a>\n<ul>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#split\" rel=\"nofollow\" target=\"_blank\">Split Files To <code>Chat.R</code> and <code>utils.R</code></a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#testing\" rel=\"nofollow\" target=\"_blank\">Add Unit Testing</a></li>\n</ul>\n</li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#ack\" rel=\"nofollow\" target=\"_blank\">Acknowledgement</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#lessons\" rel=\"nofollow\" target=\"_blank\">Lessons Learnt</a></li>\n</ul>\n<h2 id=\"workflow\">The Workflow\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#workflow\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>A quick note for myself:</p>\n<ol>\n<li>Load devtool, create_package()</li>\n<li>use_git(), will likely need restart</li>\n<li>load devtools again, write first function</li>\n<li>use_r(‚Äúfunction‚Äù), then insert function there</li>\n<li>load_all()</li>\n<li>check()</li>\n<li>edit DESCRIPTION</li>\n<li>use_mit_license()</li>\n<li>insert roxygen2 skeleton on function, edit</li>\n<li>document()</li>\n<li>since we need other packages, use_package()</li>\n<li>check()</li>\n</ol>\n<h2 id=\"create\"><code>usethis::create_package</code>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#create\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<pre>usethis::create_package(\"myopenai\")\n</pre><p><img alt=\"\" data-lazy-src=\"https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/create_package_error.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/create_package_error.png?w=578&amp;ssl=1\"/></noscript>\nYou might see something like this if you already have a <code>.git</code> on the working directory, try to create a package in a new directory that doesn‚Äôt have a parent directory with <code>.git</code> in it and it‚Äôll open to a new project session with basic, something like <code>usethiss::create_package(\"/Users/you/Document/myopenai\")</code>. You will notice that you have basic files such as.</p>\n<p align=\"center\">\n<img alt=\"image\" data-lazy-src=\"https://i1.wp.com/www.kenkoonwong.com/blog/rpackage1/files.png?w=40%25&amp;ssl=1\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"image\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://i1.wp.com/www.kenkoonwong.com/blog/rpackage1/files.png?w=40%25&amp;ssl=1\"/></noscript>\n</p>\n<p>\n<a href=\"https://r-pkgs.org/whole-game.html\" rel=\"nofollow\" target=\"_blank\">Read here</a> for what the directories or files represent.</p>\n<h2 id=\"git\"><code>use_git</code>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#git\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<pre>library(devtools)\n\nuse_git()\n</pre><p>You will receive 2 questions, basically if you want to use git for version control and also if you want to commit. Say yes to both. Then your project session will restart. Note that every time it restarts, you have to reload <code>devtools</code></p>\n<h2 id=\"function\">Write A Function\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#function\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>Haven‚Äôt figured out what is the best way to do this at yet, do we write a minimal functional code somewhere else and then copy it into project or just create an untitlted R script and write a minimal functional code before <code>use_r()</code> function? Anyway, for now just create an untitled script and start writing before we paste it in a more organized R file.</p>\n<pre>chat &lt;- function(prompt=\"how are you?\", system=\"\", temp=0, max_tokens = 500L) {\n  \n  ## If virtualenv does not exist, create and install openai\n  if (reticulate::virtualenv_exists(envname = \"openai\")==FALSE) {\n    reticulate::virtualenv_create(envname = \"openai\", packages = c(\"openai\"))\n    }\n  \n  ## Start Env\n  reticulate::use_virtualenv(\"openai\")\n  \n  ## Initialize OpenAI\n  OpenAI = reticulate::import(\"openai\")$OpenAI\n  client = OpenAI(api_key = \"YOUR API KEY\")\n\n  ## Prompt\n  response = client$chat$completions$create(\n    model = \"gpt-4o-mini\",\n    messages = list(reticulate::dict(\n      role = \"system\",\n      content = system\n    ),\n    reticulate::dict(\n      \"role\" = \"user\",\n      \"content\" = prompt\n    )),\n    temperature = temp,\n    max_tokens = max_tokens\n  )\n  \n  ## Response\n  message = response$choices[[1]]$message$content\n\n  return(message)\n}\n</pre><p>Alright, the above code is quite similar to our original, but at least now it‚Äôs a function and we have some default parameters inserted so when we call <code>chat()</code> without any parameters in it, it will at least return something. Note above is not the efficient at all, best to communicate with openAI API is still via <code>httr2</code>, you will have much less dependencies. Also, note that above is again, not to most defensive coding practice either but we can improve from there, including setting your API key in <code>.Rprofile</code>.</p>\n<h2 id=\"use_r\"><code>usethis::use_r()</code>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#use_r\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<pre>usethis::use_r(\"chat\")\n</pre><p>This will create a blank R file called <code>chat.R</code> in R folder. We then copy our minimal function code into this script. Do not run anything yet! That‚Äôs the next step. We don‚Äôt necessarily have to create an R script for every function. We should at least name it where it‚Äôs machine &amp; human readable, sort-friendly if date used \n<a href=\"https://style.tidyverse.org/files.html\" rel=\"nofollow\" target=\"_blank\">read here more on Tidy style guide</a>.</p>\n<p>About organization? It‚Äôs hard, like smart brevity</p>\n<blockquote>\n<p>It‚Äôs hard to describe exactly how you should organise your code across multiple files. I think the best rule of thumb is that if you can give a file a concise name that still evokes its contents, you‚Äôve arrived at a good organisation. But getting to that point is hard. -Tidyverse style guide</p>\n</blockquote>\n<h2 id=\"load_all\"><code>devtools::load_all()</code>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#load_all\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>On the console, enter the following:</p>\n<pre>devtools::load_all()\n</pre><p><img alt=\"\" data-lazy-src=\"https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/load_all.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/load_all.png?w=578&amp;ssl=1\"/></noscript></p>\n<p>This will make the entire package available / interactive. And that‚Äôs when we can test our function and debug if there is error. As you can see in the above image, when we call <code>chat()</code> it returned a response. The book explains the difference between <code>source</code> and <code>running as a library</code>, \n<a href=\"https://r-pkgs.org/whole-game.html#sec-whole-game-load-all\" rel=\"nofollow\" target=\"_blank\">here</a></p>\n<h2 id=\"check\"><code>devtools::check()</code>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#check\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<pre>devtools::check()\n</pre><p><img alt=\"\" data-lazy-src=\"https://i1.wp.com/www.kenkoonwong.com/blog/rpackage1/check.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/www.kenkoonwong.com/blog/rpackage1/check.png?w=578&amp;ssl=1\"/></noscript></p>\n<p>The function <code>check()</code> is essential because it runs comprehensive tests to ensure all components of an R package work correctly, catching issues early when they‚Äôre easier to fix. It validates that your package meets CRAN standards, maintaining code quality and preventing downstream problems for users. Regular checking establishes good development habits, especially before sharing your package with others or submitting it to repositories.</p>\n<p>The above image showed that we have 2 warnings, let‚Äôs fix it!</p>\n<h2 id=\"description\">Edit DESCRIPTION\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#description\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>Before we start to fix the 2 things above, let‚Äôs edit our DESCRIPTION.</p>\n<p><img alt=\"\" data-lazy-src=\"https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/description.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/description.png?w=578&amp;ssl=1\"/></noscript></p>\n<p>Feel free to edit title, description, author info</p>\n<h2 id=\"license\"><code>usethis::use_mit_license()</code>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#license\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<pre># if you already loaded `devtools` you can just\nuse_mit_license()\n</pre><p align=\"center\">\n<img alt=\"image\" data-lazy-src=\"https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/license.png?w=60%25&amp;ssl=1\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"image\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/license.png?w=60%25&amp;ssl=1\"/></noscript>\n</p>\n<h2 id=\"roxygen2\">Insert roxygen2 skeleton on function\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#roxygen2\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>Click on the chat function area, then go to <code>Code &gt; Insert Roxygen2 Skeleton</code></p>\n<p align=\"center\">\n<img alt=\"image\" data-lazy-src=\"https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/roxygen2.png?w=50%25&amp;ssl=1\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"image\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/roxygen2.png?w=50%25&amp;ssl=1\"/></noscript>\n</p>\n<p>Then it will look something like</p>\n<p><img alt=\"\" data-lazy-src=\"https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/roxygen2_chunk.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/roxygen2_chunk.png?w=578&amp;ssl=1\"/></noscript>\nThen you can edit it as such</p>\n<pre>#' GPT4omini chat convenience\n#'\n#' @param system System Prompt\n#' @param prompt User Prompt\n#' @param temp Temperature\n#' @param max_tokens Max Tokens\n#'\n#' @return String Response\n#' @export\n#'\n#' @examples\n#' chat(\"what is 2+2?\")\nchat &lt;- function(prompt=\"how are you?\", system=\"\", temp=0, max_tokens = 500L) {\n\n  ## If virtualenv does not exist, create and install openai\n  if (reticulate::virtualenv_exists(envname = \"openai\")==FALSE) {\n    reticulate::virtualenv_create(envname = \"openai\", packages = c(\"openai\"))\n  }\n</pre>\n<h2 id=\"document\"><code>devtools::document()</code>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#document\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p align=\"center\">\n<img alt=\"image\" data-lazy-src=\"https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/document.png?w=50%25&amp;ssl=1\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"image\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/document.png?w=50%25&amp;ssl=1\"/></noscript>\n</p>\n<p>The <code>document()</code> function converts roxygen2 comments in your R source files into proper R documentation files, specifically creating the <code>.Rd</code> files needed for help pages and updating the NAMESPACE file. This process transforms human-readable special comments into the formal documentation structure required by R, making your package‚Äôs functions discoverable and usable through the standard help system.</p>\n<p>and when you do this</p>\n<pre>?chat\n</pre><p>you will see this</p>\n<p align=\"center\">\n<img alt=\"image\" data-lazy-src=\"https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/help.png?w=80%25&amp;ssl=1\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"image\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/help.png?w=80%25&amp;ssl=1\"/></noscript>\n</p>\n<h2 id=\"package\"><code>usethis::use_package()</code>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#package\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<pre>usethis::use_package(\"reticulate\")\n</pre><p>The <code>use_package()</code> function formally declares dependencies by adding packages to the <code>Imports</code> field in your package‚Äôs DESCRIPTION file, allowing you to use functions from external packages like <code>reticulate</code>.</p>\n<h2 id=\"last\">Let‚Äôs Run <code>check()</code> Again and <code>install()</code>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#last\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<pre>devtools::check()\n</pre><p><img alt=\"\" data-lazy-src=\"https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/greenlight.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.kenkoonwong.com/blog/rpackage1/greenlight.png?w=578&amp;ssl=1\"/></noscript></p>\n<p>Yesh. Good sign!!!</p>\n<pre>devtools::install()\n</pre><p>and now you can go to Rstudio and the below code should work!</p>\n<pre>library(myopenai)\n\n\"what is 10 + 5?\" |&gt; chat()\n\n## [1] \"10 + 5 equals 15.\"\n</pre><p>üôåü§òü§© we did it!!!</p>\n<h2 id=\"improvement\">Further Improvement Of The Package\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#improvement\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<h3 id=\"split\">Split Files To <code>Chat.R</code> and <code>utils.R</code>\n<a href=\"https://www.kenkoonwong.com/blog/rpackage1/#split\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h3>\n<h4 id=\"chatr\">Chat.R\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#chatr\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>#' Set you Open API key\n#'\n#' @param key your API key\n#'\n#' @return set environment\n#' @export\n#'\n#' @examples\n#' \\dontrun{\n#' set_api_key(\"your-api-key-here\")\n#' }\nset_api_key &lt;- function(key=NULL) {\n  if (is.null(key)) { cli::cli_abort(\"Need to insert API key on key parameter\")}\n  if (!is.null(key)) {\n    key_old &lt;- Sys.getenv(\"OPENAI_KEY\")\n    if (key==key_old) { cli::cli_alert_warning(\"Your previous API key is the same as the one currently provided\") }\n\n    if (key!=key_old) {\n      set_env(key)\n      cli::cli_alert_success(\"New API Key Inserted\")\n      rstudioapi::restartSession()\n    }\n\n    if (key_old==\"\") {\n      set_env(key)\n      cli::cli_alert_success(\"API Key Inserted\")\n      rstudioapi::restartSession()\n    }\n  }\n}\n\n\n#' GPT4omini chat convenience\n#'\n#' @param system System Prompt\n#' @param prompt User Prompt\n#' @param temp Temperature\n#' @param max_tokens Max Tokens\n#' @param api_key use `set_api_key` to set it in R environment\n#'\n#' @return String Response\n#' @export\n#'\n#' @examples\n#' chat(\"what is 2+2?\")\nchat &lt;- function(prompt=\"how are you?\", system=\"\", temp=0, max_tokens = 500L, api_key = openai_api_key()) {\n\n  # check to see if virtualenv is installed\n  if (reticulate::virtualenv_exists(envname = \"openai\")==FALSE) {\n    reticulate::virtualenv_create(envname = \"openai\", packages = c(\"openai\"))\n    rstudioapi::restartSession()\n  }\n\n  # check to see if there is api_key set\n  if (api_key==\"\") { cli::cli_abort(\"No API key found. Need to insert API key by using {.code set_api_key()}\") }\n\n  ## Start Env\n  reticulate::use_virtualenv(\"openai\")\n\n  ## Initialize OpenAI\n  OpenAI = reticulate::import(\"openai\")$OpenAI\n  client = OpenAI(api_key = api_key)\n\n  ## Prompt\n  response = client$chat$completions$create(\n    model = \"gpt-4o-mini\",\n    messages = list(reticulate::dict(\n      role = \"system\",\n      content = system\n    ),\n    reticulate::dict(\n      \"role\" = \"user\",\n      \"content\" = prompt\n    )),\n    temperature = temp,\n    max_tokens = max_tokens\n  )\n\n  ## Response\n  message = response$choices[[1]]$message$content\n\n  return(message)\n}\n</pre>\n<h4 id=\"utilsr\">utils.R\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#utilsr\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>openai_api_key &lt;- function() {\n  key &lt;- Sys.getenv(\"OPENAI_KEY\")\n\n  if (key==\"\") { cli::cli_abort(\"No API key found. Need to insert API key by using {.code set_api_key()}\") }\n  else {\n    return(key)\n  }\n}\n\nset_env &lt;- function(key) {\n  renviron_path &lt;- file.path(Sys.getenv(\"HOME\"), \".Renviron\")\n\n  api_key_entry &lt;- paste0(\"OPENAI_KEY=\",key)\n\n  if (!file.exists(renviron_path)) {\n    file.create(renviron_path)\n  }\n  \n  # Read existing content\n  existing_content &lt;- readLines(renviron_path, warn = FALSE)\n\n  if (!any(grepl(\"^OPENAI_KEY=\", existing_content))) {\n    # Append the new entry\n    write(api_key_entry, renviron_path, append = TRUE)\n  } else {\n    # Replace existing entry\n    existing_content[grepl(\"^OPENAI_KEY=\", existing_content)] &lt;- api_key_entry\n    writeLines(existing_content, renviron_path)\n  }\n}\n</pre><p>Read more from the book to get an intuition of why we have <code>chat.R</code> and <code>utils.R</code>. Basically, you want functions that get exported to be in <code>chat.R</code> or similar R file, and supportive functions that are not exported to be in <code>utils.R</code>, instead of all functions in 1 file, mainly for readability / organization. That‚Äôs a really good idea.</p>\n<p>There are plenty more things to improve on. We can spend many hours revising this! Let‚Äôs move on to <code>testing</code></p>\n<h3 id=\"testing\">Add Unit Testing\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#testing\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h3>\n<pre>use_test(\"chat\")\n</pre><p>This will create another folder (<code>tests</code>) and file (<code>test-chat.R</code>).</p>\n<h4 id=\"test-chatr\">test-chat.R\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#test-chatr\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>test_that(\"chat(\\\"2+2?\\\") make sure it returns 4\", {\n  expect_equal(chat(\"what is 2+2? return answer only\") |&gt; as.numeric(), 4)\n})\n</pre><p>We then enter something like the above to make sure it returns the answer we want to make sure it works. And it will look something like this after.</p>\n<pre>test()\n</pre><p align=\"center\">\n<img alt=\"image\" data-lazy-src=\"https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/test.png?w=50%25&amp;ssl=1\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"image\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://i2.wp.com/www.kenkoonwong.com/blog/rpackage1/test.png?w=50%25&amp;ssl=1\"/></noscript>\n</p>\n<p>üôåü§òü§© we did it!!!</p>\n<p>This is a great image of the actual workflow from the book.</p>\n<p align=\"center\">\n<img alt=\"image\" data-lazy-src=\"https://i0.wp.com/r-pkgs.org/diagrams/workflow.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"image\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://i0.wp.com/r-pkgs.org/diagrams/workflow.png?w=450&amp;ssl=1\"/></noscript>\n</p>\n<h2 id=\"ack\">Acknowledgement\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#ack\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>I am grateful of the book and also the style of putting the simple example right up front to stimulate curiosity and having the end in mind. That makes learning very inspirational. I also want to thank \n<a href=\"https://alecsalces.com/\" rel=\"nofollow\" target=\"_blank\"><code>Alec Wong</code></a> for guiding me to this book that pushed me to learn the workflow of creating an R package. Now I have some idea on how this works, it makes contributing to existing R packages a step closer!!! woo hoo!!! Not that I have much to contribute ü§£</p>\n<h2 id=\"lessons\">Lessons Learnt\n  <a href=\"https://www.kenkoonwong.com/blog/rpackage1/#lessons\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>Learnt R package workflow/best practice (highly recommend a \n<a href=\"https://r-pkgs.org/\" rel=\"nofollow\" target=\"_blank\">read</a>)</li>\n<li>Learnt <code>Sys.getenv</code>, and how to write it to R environment</li>\n<li>Learnt some basics of <code>cli</code> package</li>\n<li>Learnt <code>\\dontrun{}</code> on roxygen2 example so that it doesn‚Äôt execute the function. Before this my <code>set_api_key()</code> example kept setting OPENAI_KEY to <code>your-api-key-here</code> lol</li>\n<li>Learnt <code>grepl</code>, been always used to <code>str_detect</code> now at least we can use ReGex with base</li>\n</ul>\n<br/>\n<p>If you like this article:</p>\n<ul>\n<li>please feel free to send me a \n<a href=\"https://www.kenkoonwong.com/blog/\" rel=\"nofollow\" target=\"_blank\">comment or visit my other blogs</a></li>\n<li>please feel free to follow me on \n<a href=\"https://bsky.app/profile/kenkoonwong.bsky.social\" rel=\"nofollow\" target=\"_blank\">BlueSky</a>, \n<a href=\"https://twitter.com/kenkoonwong/\" rel=\"nofollow\" target=\"_blank\">twitter</a>, \n<a href=\"https://github.com/kenkoonwong/\" rel=\"nofollow\" target=\"_blank\">GitHub</a> or \n<a href=\"https://med-mastodon.com/@kenkoonwong\" rel=\"nofollow\" target=\"_blank\">Mastodon</a></li>\n<li>if you would like collaborate please feel free to \n<a href=\"https://www.kenkoonwong.com/contact/\" rel=\"nofollow\" target=\"_blank\">contact me</a></li>\n</ul>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://www.kenkoonwong.com/blog/rpackage1/\"> r on Everyday Is A School Day</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
    "main_text": "Learning To Create an R Package With Deliberate Redundancy ü§£ A Note For Myself\nPosted on\nMarch 21, 2025\nby\nr on Everyday Is A School Day\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nr on Everyday Is A School Day\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nüôà Made a hilariously redundant R package for a simple OpenAI calls, but the real win was finally learning how to build an R package! üõ†Ô∏è Is it efficient? Absolutely not!Was it worth the time and experience? Yes! Will I do it again? Yes! Will it break? Yes! ü§£\nMotivations\nWe‚Äôve been using a lot of LLM lately especially OpenAI GPT4omini via\nreticulate\n. Trying to load\nreticulate\n-> import OpenAI -> initialize it -> insert API_key etc again and again whenever we want to use it for a new project or new script, that‚Äôs just very redundant, tedious and so on.\nRecently, with motivation from\nAlec Wong\nkindly recommending me to read\nR Package\nafter I asked him a noob question ‚ÄúHow does one test and make changes of an existing R package and pull request?‚Äù ü§£ The book is great! I really enjoy the first part, it actually teaches you how to create an R package right from the get go! Before it dives into the details. I found that to be extremely refreshing, because you can easily create an MVP right upfront for personal use by following a workflow! üôå\nWith the LLM in mind, and wanting to learn how to create an R package (ahem properly, best practice ü´°), why don‚Äôt we try to make our very own package called\nmyopenai\n!? Alright, there is already a brilliant package called\nellmer\n, and my current project is most likey redundant (hence the title), but what a better way to start learning? And we‚Äôre going to do it the inefficient way, via\nreticulate\n(this is when you see R experts shake their head of disbelief ü§≠) instead of the http API! ü§£ Join me in learning how to create an R Package!\nSeriously though, this is not an efficient way of using openAI API‚Ä¶ It‚Äôs for demonstration purposes only.\nThe Original Code\nreticulate::use_virtualenv(\"openai\")\nlibrary(reticulate)\n\nopenai <- import(\"openai\")\nOpenAI <- openai$OpenAI\n\nclient = OpenAI(api_key = 'YOUR API KEY') ## change this to yours  \n\nresponse <- client$chat$completions$create(\n  model = \"gpt-4o-mini\",\n  messages = list(dict(\n    role = \"system\",\n    content = \"You are a summarizer. Please summarize the following abstract. \n    Include statistics.Use emoji to shorten characters. The summary must not \n    exceed 200 characters‚Äîif you reach 200 characters, stop immediately. \n    Do not add any extra commentary or exceed the 200-character limit.\"\n  ), dict(\n    role = \"user\",\n    content = df_new[10,\"item_description\"] |> pull()\n  )\n  ),\n  temperature = 0\n)\n\n(summary <- response$choices[[1]]$message$content)\nThe above was our previous code. Now we will use the above code, turn it into a function and hopefully at the end of the project we‚Äôll have a library called\nmyopenai\nand we can call a function\nchat()\nand just need to insert the prompt, or pipe the prompt into the function.\nObjectives:\nThe Workflow\ncreate_package()\nuse_git()\nWrite The Function\nuse_r()\nload_all()\ncheck()\nEdit DESCRIPTION\nuse_mit_license()\nInsert roxygen2 skeleton on function\ndocument()\nuse_package()\ncheck() again and install()\nFurther Improvement\nSplit Files To\nChat.R\nand\nutils.R\nAdd Unit Testing\nAcknowledgement\nLessons Learnt\nThe Workflow\nA quick note for myself:\nLoad devtool, create_package()\nuse_git(), will likely need restart\nload devtools again, write first function\nuse_r(‚Äúfunction‚Äù), then insert function there\nload_all()\ncheck()\nedit DESCRIPTION\nuse_mit_license()\ninsert roxygen2 skeleton on function, edit\ndocument()\nsince we need other packages, use_package()\ncheck()\nusethis::create_package\nusethis::create_package(\"myopenai\")\nYou might see something like this if you already have a\n.git\non the working directory, try to create a package in a new directory that doesn‚Äôt have a parent directory with\n.git\nin it and it‚Äôll open to a new project session with basic, something like\nusethiss::create_package(\"/Users/you/Document/myopenai\")\n. You will notice that you have basic files such as.\nRead here\nfor what the directories or files represent.\nuse_git\nlibrary(devtools)\n\nuse_git()\nYou will receive 2 questions, basically if you want to use git for version control and also if you want to commit. Say yes to both. Then your project session will restart. Note that every time it restarts, you have to reload\ndevtools\nWrite A Function\nHaven‚Äôt figured out what is the best way to do this at yet, do we write a minimal functional code somewhere else and then copy it into project or just create an untitlted R script and write a minimal functional code before\nuse_r()\nfunction? Anyway, for now just create an untitled script and start writing before we paste it in a more organized R file.\nchat <- function(prompt=\"how are you?\", system=\"\", temp=0, max_tokens = 500L) {\n  \n  ## If virtualenv does not exist, create and install openai\n  if (reticulate::virtualenv_exists(envname = \"openai\")==FALSE) {\n    reticulate::virtualenv_create(envname = \"openai\", packages = c(\"openai\"))\n    }\n  \n  ## Start Env\n  reticulate::use_virtualenv(\"openai\")\n  \n  ## Initialize OpenAI\n  OpenAI = reticulate::import(\"openai\")$OpenAI\n  client = OpenAI(api_key = \"YOUR API KEY\")\n\n  ## Prompt\n  response = client$chat$completions$create(\n    model = \"gpt-4o-mini\",\n    messages = list(reticulate::dict(\n      role = \"system\",\n      content = system\n    ),\n    reticulate::dict(\n      \"role\" = \"user\",\n      \"content\" = prompt\n    )),\n    temperature = temp,\n    max_tokens = max_tokens\n  )\n  \n  ## Response\n  message = response$choices[[1]]$message$content\n\n  return(message)\n}\nAlright, the above code is quite similar to our original, but at least now it‚Äôs a function and we have some default parameters inserted so when we call\nchat()\nwithout any parameters in it, it will at least return something. Note above is not the efficient at all, best to communicate with openAI API is still via\nhttr2\n, you will have much less dependencies. Also, note that above is again, not to most defensive coding practice either but we can improve from there, including setting your API key in\n.Rprofile\n.\nusethis::use_r()\nusethis::use_r(\"chat\")\nThis will create a blank R file called\nchat.R\nin R folder. We then copy our minimal function code into this script. Do not run anything yet! That‚Äôs the next step. We don‚Äôt necessarily have to create an R script for every function. We should at least name it where it‚Äôs machine & human readable, sort-friendly if date used\nread here more on Tidy style guide\n.\nAbout organization? It‚Äôs hard, like smart brevity\nIt‚Äôs hard to describe exactly how you should organise your code across multiple files. I think the best rule of thumb is that if you can give a file a concise name that still evokes its contents, you‚Äôve arrived at a good organisation. But getting to that point is hard. -Tidyverse style guide\ndevtools::load_all()\nOn the console, enter the following:\ndevtools::load_all()\nThis will make the entire package available / interactive. And that‚Äôs when we can test our function and debug if there is error. As you can see in the above image, when we call\nchat()\nit returned a response. The book explains the difference between\nsource\nand\nrunning as a library\n,\nhere\ndevtools::check()\ndevtools::check()\nThe function\ncheck()\nis essential because it runs comprehensive tests to ensure all components of an R package work correctly, catching issues early when they‚Äôre easier to fix. It validates that your package meets CRAN standards, maintaining code quality and preventing downstream problems for users. Regular checking establishes good development habits, especially before sharing your package with others or submitting it to repositories.\nThe above image showed that we have 2 warnings, let‚Äôs fix it!\nEdit DESCRIPTION\nBefore we start to fix the 2 things above, let‚Äôs edit our DESCRIPTION.\nFeel free to edit title, description, author info\nusethis::use_mit_license()\n# if you already loaded `devtools` you can just\nuse_mit_license()\nInsert roxygen2 skeleton on function\nClick on the chat function area, then go to\nCode > Insert Roxygen2 Skeleton\nThen it will look something like\nThen you can edit it as such\n#' GPT4omini chat convenience\n#'\n#' @param system System Prompt\n#' @param prompt User Prompt\n#' @param temp Temperature\n#' @param max_tokens Max Tokens\n#'\n#' @return String Response\n#' @export\n#'\n#' @examples\n#' chat(\"what is 2+2?\")\nchat <- function(prompt=\"how are you?\", system=\"\", temp=0, max_tokens = 500L) {\n\n  ## If virtualenv does not exist, create and install openai\n  if (reticulate::virtualenv_exists(envname = \"openai\")==FALSE) {\n    reticulate::virtualenv_create(envname = \"openai\", packages = c(\"openai\"))\n  }\ndevtools::document()\nThe\ndocument()\nfunction converts roxygen2 comments in your R source files into proper R documentation files, specifically creating the\n.Rd\nfiles needed for help pages and updating the NAMESPACE file. This process transforms human-readable special comments into the formal documentation structure required by R, making your package‚Äôs functions discoverable and usable through the standard help system.\nand when you do this\n?chat\nyou will see this\nusethis::use_package()\nusethis::use_package(\"reticulate\")\nThe\nuse_package()\nfunction formally declares dependencies by adding packages to the\nImports\nfield in your package‚Äôs DESCRIPTION file, allowing you to use functions from external packages like\nreticulate\n.\nLet‚Äôs Run\ncheck()\nAgain and\ninstall()\ndevtools::check()\nYesh. Good sign!!!\ndevtools::install()\nand now you can go to Rstudio and the below code should work!\nlibrary(myopenai)\n\n\"what is 10 + 5?\" |> chat()\n\n## [1] \"10 + 5 equals 15.\"\nüôåü§òü§© we did it!!!\nFurther Improvement Of The Package\nSplit Files To\nChat.R\nand\nutils.R\nChat.R\n#' Set you Open API key\n#'\n#' @param key your API key\n#'\n#' @return set environment\n#' @export\n#'\n#' @examples\n#' \\dontrun{\n#' set_api_key(\"your-api-key-here\")\n#' }\nset_api_key <- function(key=NULL) {\n  if (is.null(key)) { cli::cli_abort(\"Need to insert API key on key parameter\")}\n  if (!is.null(key)) {\n    key_old <- Sys.getenv(\"OPENAI_KEY\")\n    if (key==key_old) { cli::cli_alert_warning(\"Your previous API key is the same as the one currently provided\") }\n\n    if (key!=key_old) {\n      set_env(key)\n      cli::cli_alert_success(\"New API Key Inserted\")\n      rstudioapi::restartSession()\n    }\n\n    if (key_old==\"\") {\n      set_env(key)\n      cli::cli_alert_success(\"API Key Inserted\")\n      rstudioapi::restartSession()\n    }\n  }\n}\n\n#' GPT4omini chat convenience\n#'\n#' @param system System Prompt\n#' @param prompt User Prompt\n#' @param temp Temperature\n#' @param max_tokens Max Tokens\n#' @param api_key use `set_api_key` to set it in R environment\n#'\n#' @return String Response\n#' @export\n#'\n#' @examples\n#' chat(\"what is 2+2?\")\nchat <- function(prompt=\"how are you?\", system=\"\", temp=0, max_tokens = 500L, api_key = openai_api_key()) {\n\n  # check to see if virtualenv is installed\n  if (reticulate::virtualenv_exists(envname = \"openai\")==FALSE) {\n    reticulate::virtualenv_create(envname = \"openai\", packages = c(\"openai\"))\n    rstudioapi::restartSession()\n  }\n\n  # check to see if there is api_key set\n  if (api_key==\"\") { cli::cli_abort(\"No API key found. Need to insert API key by using {.code set_api_key()}\") }\n\n  ## Start Env\n  reticulate::use_virtualenv(\"openai\")\n\n  ## Initialize OpenAI\n  OpenAI = reticulate::import(\"openai\")$OpenAI\n  client = OpenAI(api_key = api_key)\n\n  ## Prompt\n  response = client$chat$completions$create(\n    model = \"gpt-4o-mini\",\n    messages = list(reticulate::dict(\n      role = \"system\",\n      content = system\n    ),\n    reticulate::dict(\n      \"role\" = \"user\",\n      \"content\" = prompt\n    )),\n    temperature = temp,\n    max_tokens = max_tokens\n  )\n\n  ## Response\n  message = response$choices[[1]]$message$content\n\n  return(message)\n}\nutils.R\nopenai_api_key <- function() {\n  key <- Sys.getenv(\"OPENAI_KEY\")\n\n  if (key==\"\") { cli::cli_abort(\"No API key found. Need to insert API key by using {.code set_api_key()}\") }\n  else {\n    return(key)\n  }\n}\n\nset_env <- function(key) {\n  renviron_path <- file.path(Sys.getenv(\"HOME\"), \".Renviron\")\n\n  api_key_entry <- paste0(\"OPENAI_KEY=\",key)\n\n  if (!file.exists(renviron_path)) {\n    file.create(renviron_path)\n  }\n  \n  # Read existing content\n  existing_content <- readLines(renviron_path, warn = FALSE)\n\n  if (!any(grepl(\"^OPENAI_KEY=\", existing_content))) {\n    # Append the new entry\n    write(api_key_entry, renviron_path, append = TRUE)\n  } else {\n    # Replace existing entry\n    existing_content[grepl(\"^OPENAI_KEY=\", existing_content)] <- api_key_entry\n    writeLines(existing_content, renviron_path)\n  }\n}\nRead more from the book to get an intuition of why we have\nchat.R\nand\nutils.R\n. Basically, you want functions that get exported to be in\nchat.R\nor similar R file, and supportive functions that are not exported to be in\nutils.R\n, instead of all functions in 1 file, mainly for readability / organization. That‚Äôs a really good idea.\nThere are plenty more things to improve on. We can spend many hours revising this! Let‚Äôs move on to\ntesting\nAdd Unit Testing\nuse_test(\"chat\")\nThis will create another folder (\ntests\n) and file (\ntest-chat.R\n).\ntest-chat.R\ntest_that(\"chat(\\\"2+2?\\\") make sure it returns 4\", {\n  expect_equal(chat(\"what is 2+2? return answer only\") |> as.numeric(), 4)\n})\nWe then enter something like the above to make sure it returns the answer we want to make sure it works. And it will look something like this after.\ntest()\nüôåü§òü§© we did it!!!\nThis is a great image of the actual workflow from the book.\nAcknowledgement\nI am grateful of the book and also the style of putting the simple example right up front to stimulate curiosity and having the end in mind. That makes learning very inspirational. I also want to thank\nAlec Wong\nfor guiding me to this book that pushed me to learn the workflow of creating an R package. Now I have some idea on how this works, it makes contributing to existing R packages a step closer!!! woo hoo!!! Not that I have much to contribute ü§£\nLessons Learnt\nLearnt R package workflow/best practice (highly recommend a\nread\n)\nLearnt\nSys.getenv\n, and how to write it to R environment\nLearnt some basics of\ncli\npackage\nLearnt\n\\dontrun{}\non roxygen2 example so that it doesn‚Äôt execute the function. Before this my\nset_api_key()\nexample kept setting OPENAI_KEY to\nyour-api-key-here\nlol\nLearnt\ngrepl\n, been always used to\nstr_detect\nnow at least we can use ReGex with base\nIf you like this article:\nplease feel free to send me a\ncomment or visit my other blogs\nplease feel free to follow me on\nBlueSky\n,\ntwitter\n,\nGitHub\nor\nMastodon\nif you would like collaborate please feel free to\ncontact me\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nr on Everyday Is A School Day\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "üôà Made a hilariously redundant R package for a simple OpenAI calls, but the real win was finally learning how to build an R package! üõ†Ô∏è Is it efficient? Absolutely not!Was it worth the time and experience? Yes! Will I do it again? Yes! Will it break? ...",
    "meta_keywords": null,
    "og_description": "üôà Made a hilariously redundant R package for a simple OpenAI calls, but the real win was finally learning how to build an R package! üõ†Ô∏è Is it efficient? Absolutely not!Was it worth the time and experience? Yes! Will I do it again? Yes! Will it break? ...",
    "og_image": "https://www.kenkoonwong.com/blog/rpackage1/box.jpg",
    "og_title": "Learning To Create an R Package With Deliberate Redundancy ü§£ A Note For Myself | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 11.7,
    "sitemap_lastmod": null,
    "twitter_description": "üôà Made a hilariously redundant R package for a simple OpenAI calls, but the real win was finally learning how to build an R package! üõ†Ô∏è Is it efficient? Absolutely not!Was it worth the time and experience? Yes! Will I do it again? Yes! Will it break? ...",
    "twitter_title": "Learning To Create an R Package With Deliberate Redundancy ü§£ A Note For Myself | R-bloggers",
    "url": "https://www.r-bloggers.com/2025/03/learning-to-create-an-r-package-with-deliberate-redundancy-%F0%9F%A4%A3-a-note-for-myself/",
    "word_count": 2337
  }
}