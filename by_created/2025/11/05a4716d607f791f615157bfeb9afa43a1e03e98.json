{
  "id": "05a4716d607f791f615157bfeb9afa43a1e03e98",
  "url": "https://www.r-bloggers.com/2025/02/calling-python-from-c-using-python-net/",
  "created_at_utc": "2025-11-22T19:59:18Z",
  "data": null,
  "raw_original": {
    "uuid": "3edb1350-5f5e-4044-b66e-9ae7b591034f",
    "created_at": "2025-11-22 19:59:18",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2025/02/calling-python-from-c-using-python-net/",
      "crawled_at": "2025-11-22T10:54:26.019338",
      "external_links": [
        {
          "href": "https://adam-gladstone.github.io/python-project/Calling-Python-from-C-using-PythonNET/",
          "text": "Adam’s Software Lab"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://github.com/pythonnet/pythonnet",
          "text": "Python.NET"
        },
        {
          "href": "https://github.com/Adam-Gladstone/PortfolioManager",
          "text": "PortfolioManager application"
        },
        {
          "href": "https://adam-gladstone.github.io/assets/images/portfolio_analysis.py",
          "text": "portfolio analysis script"
        },
        {
          "href": "https://medium.com/python-in-plain-english/building-an-investment-portfolio-management-app-with-python-a68c2841f04b",
          "text": "portfolio management app"
        },
        {
          "href": "https://github.com/CommunityToolkit/Windows",
          "text": "Windows Community Toolkit"
        },
        {
          "href": "https://adam-gladstone.github.io/assets/images/portfolio_analysis.py",
          "text": "portfolio_analysis.py"
        },
        {
          "href": "https://adam-gladstone.github.io/python-project/Calling-Python-from-C-using-PythonNET/",
          "text": "Adam’s Software Lab"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Calling Python from C# using Python.NET | R-bloggers",
      "images": [
        {
          "alt": "Portfolio Manager",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Portfolio Manager",
          "base64": null,
          "src": "https://i0.wp.com/adam-gladstone.github.io/assets/images/PortfolioAnalysisResults.png?w=578&ssl=1"
        },
        {
          "alt": "Python.NET Runtime",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Python.NET Runtime",
          "base64": null,
          "src": "https://i1.wp.com/adam-gladstone.github.io/assets/images/PythonNetRuntime.png?w=578&ssl=1"
        },
        {
          "alt": "Portfolio Analysis Parameters",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Portfolio Analysis Parameters",
          "base64": null,
          "src": "https://i0.wp.com/adam-gladstone.github.io/assets/images/PortfolioAnalysisParams.png?w=578&ssl=1"
        },
        {
          "alt": "Dynamic binding",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Dynamic binding",
          "base64": null,
          "src": "https://i1.wp.com/adam-gladstone.github.io/assets/images/PortfolioAnalysisDynamicModule.png?w=578&ssl=1"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/adam-gladstone/",
          "text": "Adam Gladstone"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-390752 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Calling Python from C# using Python.NET</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">February 20, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/adam-gladstone/\">Adam Gladstone</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://adam-gladstone.github.io/python-project/Calling-Python-from-C-using-PythonNET/\"> Adam’s Software Lab</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47--><h3 id=\"introduction\">Introduction</h3>\n<p>Recently, I’ve been using Python’s <strong>yfinance</strong> library to perform some simple portfolio analysis. Rather than using a Jupyter notebook to run the Python code and visualise the results, I thought it might be a nice idea to build a .NET desktop application using WinUI 3.0, XAML and C#. The application allows you to define a portfolio and manages the presentation of the results graphically. The underlying analysis is performed using Python. In order to call the Python code from C#, I use <a href=\"https://github.com/pythonnet/pythonnet\" rel=\"nofollow\" target=\"_blank\">Python.NET</a>. The purpose of this blog post is to describe how to use <strong>Python.NET</strong> to call Python functions from a C# application. The complete <a href=\"https://github.com/Adam-Gladstone/PortfolioManager\" rel=\"nofollow\" target=\"_blank\">PortfolioManager application</a> is available on github.</p>\n<p><img alt=\"Portfolio Manager\" data-lazy-src=\"https://i0.wp.com/adam-gladstone.github.io/assets/images/PortfolioAnalysisResults.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"Portfolio Manager\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/adam-gladstone.github.io/assets/images/PortfolioAnalysisResults.png?w=578&amp;ssl=1\"/></noscript></p>\n<p>The main advantage of this approach is that it allows access to Python’s extensive ecosystem from .NET. In this specific case, I wanted to build a simple portfolio management application while at the same time taking advantage of Python’s <strong>yfinance</strong> library to get the financial data I wanted and to use <strong>pandas</strong> and <strong>numpy</strong> to perform the calculations. I also wanted a slightly more real-world project using <strong>Python.NET</strong>. Information about this is somewhat limited and the examples are a little sketchy.</p>\n<h4 id=\"versions\">Versions</h4>\n<p>We use the following versions:</p>\n<ul>\n<li>Python 3.12</li>\n<li>yfinance 0.2.54</li>\n<li>Python.NET 3.0.5</li>\n</ul>\n<h4 id=\"the-python-api\">The Python API</h4>\n<p>To start off, I wrote a simple <a href=\"https://adam-gladstone.github.io/assets/images/portfolio_analysis.py\" rel=\"nofollow\" target=\"_blank\">portfolio analysis script</a>. The script is based on a <a href=\"https://medium.com/python-in-plain-english/building-an-investment-portfolio-management-app-with-python-a68c2841f04b\" rel=\"nofollow\" target=\"_blank\">portfolio management app</a> written in Python. However, I refactored the main functionality in order to separate the calculations and analysis from the (graphical) presentation layer. This allowed me to call the Python functions from C# to obtain the data and then process the (converted) data in the C# application.</p>\n<p>The API consists of four functions.</p>\n<ol>\n<li>\n<p><code>portfolio_returns(ticker_values, start_date, end_date)</code>\nThis function takes the user-supplied tickers (and values), start date and end date. The function computes the ticker weights and obtains the adjusted close prices (if available) for each ticker using the <strong>yfinance</strong> library. The function returns a dictionary with the ticker weights, a DataFrame containing the individual ticker returns, and the overall portfolio returns.</p>\n</li>\n<li>\n<p><code>perform_portfolio_analysis(data, ticker_weights, risk_free_rate)</code>\nThis function takes the portfolio returns DataFrame computed previously, the ticker weights, and a user-supplied risk free rate and uses this to calculate individual security returns, cumulative returns, volatility, and Sharpe Ratios. These are returned in a dictionary.</p>\n</li>\n<li>\n<p><code>benchmark_returns(benchmark, start_date, end_date)</code>\nThis function obtains the benchmark data from <strong>yfinance</strong> using the supplied parameters. It also returns a dictionary.</p>\n</li>\n<li>\n<p><code>portfolio_vs_benchmark(port_returns, benchmark_returns, risk_free_rate)</code>\nThis function calculates the cumulative returns, annualized volatility, and Sharpe Ratios for both the portfolio and the benchmark using the data obtained in the previous functions. It provides a side-by-side comparison to assess the portfolio’s performance relative to the benchmark.</p>\n</li>\n</ol>\n<p>These four functions define the API that is used by the .NET application.</p>\n<h4 id=\"the-net-application\">The .NET Application</h4>\n<h5 id=\"prerequisites\">Prerequisites</h5>\n<p>For the .NET application we first need to download and build Python.NET. The code is available from https://github.com/pythonnet/pythonnet. Once downloaded, open the solution file (<code>pythonnet.sln</code>), and select the <strong>Python.Runtime</strong> as the startup project. Then right-click and build the debug version. If the build is successful the <code>Python.Runtime.dll</code> will be located in the pythonnet directory under \\pythonnet\\runtime.</p>\n<h5 id=\"the-portfoliomanager-application\">The PortfolioManager Application</h5>\n<p>Having built the <code>Python.Runtime.dll</code>, we need to add it to the Portfolio Manager application. This is a WinUI 3.0 (C#/XAML) application which makes use of the <a href=\"https://github.com/CommunityToolkit/Windows\" rel=\"nofollow\" target=\"_blank\">Windows Community Toolkit</a> for dependency injection and the MVVM architecture. It also uses an Sqlite database to manage a collection of one or more portfolios.</p>\n<p>Aside from the test framework (<strong>PortfolioManager.Tests.MSTest</strong>), the solution consists of two main projects: the <strong>PortfolioManager</strong> and <strong>PortfolioManager.Core</strong>. The <strong>PortfolioManager</strong> project deals with the application logic, user settings, the views and the view models. The reusable logic and data models are located in the <strong>PortfolioManager.Core</strong> project. So we add the <code>Python.Runtime.dll</code> to the <strong>Dependencies</strong> here under the <strong>Assemblies</strong> node.</p>\n<p><img alt=\"Python.NET Runtime\" data-lazy-src=\"https://i1.wp.com/adam-gladstone.github.io/assets/images/PythonNetRuntime.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"Python.NET Runtime\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/adam-gladstone.github.io/assets/images/PythonNetRuntime.png?w=578&amp;ssl=1\"/></noscript></p>\n<h5 id=\"the-python-service\">The Python service</h5>\n<p>In the core library, we define a simple <code>IPythonService</code> interface that encapsulates the initialisation and the calls to the Python API.</p>\n<pre>public interface IPythonService\n{\n    void Initialize(string pythonDll);\n\n    bool RunPortfolioAnalysis(PortfolioItem portfolio);\n}\n</pre>\n<p>In the <strong>PortfolioManager</strong> project, in the App.xaml.cs, we add the <code>IPythonService</code> to the list of services to be activated</p>\n<pre>...\nservices.AddSingleton&lt;IPythonService, PythonService&gt;();\n</pre>\n<p>Finally, we pass an instance of the <code>IPythonService</code> into the <code>PortfolioDetailViewModel</code>. This view model manages the graphs output as a result of running the portfolio analysis. When the view is activated after clicking on the ‘Run’ button, the <code>PythonService</code> can be initialised and the view model can run the portfolio analysis based on the selected portfolio.</p>\n<pre>    public PortfolioDetailViewModel(IPythonService pythonService)\n    {\n        _pythonService = pythonService;\n\n        var settings = App.GetService&lt;SettingsViewModel&gt;();\n\n        var pythonDll = settings.PythonLibrary;\n        _pythonService.Initialize(pythonDll);\n\n\t\t//...\n    }\n</pre>\n<p>Initialisation of the <code>PythonService</code> consists of setting the path to the Python dll. This is configured via the application settings page. Additionally, we set up a couple of empty output streams to redirect any console output from the Python.Runtime.</p>\n<h4 id=\"portfolio-analysis\">Portfolio Analysis</h4>\n<p>The main function <code>RunPortfolioAnalysis</code> is called with the currently selected <code>PortfolioItem</code>. The <code>PortfolioItem</code> contains the user supplied parameters which have been obtained from the UI.</p>\n<p><img alt=\"Portfolio Analysis Parameters\" data-lazy-src=\"https://i0.wp.com/adam-gladstone.github.io/assets/images/PortfolioAnalysisParams.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"Portfolio Analysis Parameters\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/adam-gladstone.github.io/assets/images/PortfolioAnalysisParams.png?w=578&amp;ssl=1\"/></noscript></p>\n<p>The <code>RunPortfolioAnalysis</code> function loads the <a href=\"https://adam-gladstone.github.io/assets/images/portfolio_analysis.py\" rel=\"nofollow\" target=\"_blank\">portfolio_analysis.py</a> script and passes it to Python.NET, which creates a Python <code>module</code> object. The <code>module</code> object is used to access the script functions and variables. We use C#’s ‘dynamic’ keyword to delay the binding. We can see the available dynamically bound functions and parameters if we expand the <code>module</code> variable in the Watch window.</p>\n<p><img alt=\"Dynamic binding\" data-lazy-src=\"https://i1.wp.com/adam-gladstone.github.io/assets/images/PortfolioAnalysisDynamicModule.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"Dynamic binding\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/adam-gladstone.github.io/assets/images/PortfolioAnalysisDynamicModule.png?w=578&amp;ssl=1\"/></noscript></p>\n<p>The portfolio analysis proceeds by calling the Python functions using the user-supplied parameters and any intermediate results. Once these have been appropriately converted they are copied into the portfolio item’s data members.</p>\n<pre>\t...\n\tdynamic portfolioResults = module.portfolio_returns(tickers, startDate, endDate);\n\n\tvar pyTickerWeights = new PyDict(portfolioResults[\"weights\"]);\n\n\tportfolio.TickerWeights = Interop.Converters.ConvertTickerWeights(pyTickerWeights);\n\t...\n</pre>\n<p>In this snippet, the Python object <code>pyTickerWeights</code> is extracted from the dictionary returned from calling <code>module.portfolio_returns</code>. The Python ‘dict’ is converted into a C# <code>List&lt;TickerWeight&gt;</code>. The <code>ConvertTickerWeights</code> function just iterates over each ticker and obtains the corresponding weight. This is then assigned to the <code>TickerWeights</code> member of the portfolio item. The <code>TickerWeights</code> list is then used in a Pie Chart that displays the percentage allocation of tickers in the portfolio.</p>\n<p>Once the analysis is complete, the <code>PortfolioDetailViewModel</code> initialises the <code>PlotModel</code> with the data from the portfolio item, which then updates the graph view as it is bound to the specific <code>PlotModel</code>.</p>\n<p>It is worth highlighting that the performance is quite slow. There seem to be two main aspects to this:</p>\n<ol>\n<li>The initialisation of the Python engine seems to take some time, and perhaps this could be done once at startup.</li>\n<li>The <code>PortfolioDetailViewModel</code> renders six graphs with different datasets serially. It seems to me that this might be better refactored to use C# asynchronous processing.</li>\n</ol>\n<p>I am currently investigating both these issues.</p>\n<h4 id=\"the-interop-layer\">The interop layer</h4>\n<p>This layer provides facilities to convert between C# and Python types. Basic types (strings, ints, doubles etc.) are converted transparently. From C#, we use the <code>.ToPython()</code> extension method to convert to a Python object. And from Python, we use the <code>.AsManagedObject(typeof(T))</code> function to return a C# object which we can then cast. Converting from a pandas DataFrame or series can be somewhat more involved.</p>\n<h3 id=\"wrap-up\">Wrap-up</h3>\n<p>This blog post has described how to call Python functions from a C# desktop application using Python.NET. This arrangement (WinUI 3.0 C# front-end, Python.NET and Python) has the advantage of flexibility. The approach is quite generalisable. I could just as easily have created a TensorFlow model and called it from a C# application, if that had been my interest. On the other hand, the main disadvantage is the slow performance. This is an area that I am still currently investigating.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://adam-gladstone.github.io/python-project/Calling-Python-from-C-using-PythonNET/\"> Adam’s Software Lab</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
      "main_text": "Calling Python from C# using Python.NET\nPosted on\nFebruary 20, 2025\nby\nAdam Gladstone\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nAdam’s Software Lab\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nIntroduction\nRecently, I’ve been using Python’s\nyfinance\nlibrary to perform some simple portfolio analysis. Rather than using a Jupyter notebook to run the Python code and visualise the results, I thought it might be a nice idea to build a .NET desktop application using WinUI 3.0, XAML and C#. The application allows you to define a portfolio and manages the presentation of the results graphically. The underlying analysis is performed using Python. In order to call the Python code from C#, I use\nPython.NET\n. The purpose of this blog post is to describe how to use\nPython.NET\nto call Python functions from a C# application. The complete\nPortfolioManager application\nis available on github.\nThe main advantage of this approach is that it allows access to Python’s extensive ecosystem from .NET. In this specific case, I wanted to build a simple portfolio management application while at the same time taking advantage of Python’s\nyfinance\nlibrary to get the financial data I wanted and to use\npandas\nand\nnumpy\nto perform the calculations. I also wanted a slightly more real-world project using\nPython.NET\n. Information about this is somewhat limited and the examples are a little sketchy.\nVersions\nWe use the following versions:\nPython 3.12\nyfinance 0.2.54\nPython.NET 3.0.5\nThe Python API\nTo start off, I wrote a simple\nportfolio analysis script\n. The script is based on a\nportfolio management app\nwritten in Python. However, I refactored the main functionality in order to separate the calculations and analysis from the (graphical) presentation layer. This allowed me to call the Python functions from C# to obtain the data and then process the (converted) data in the C# application.\nThe API consists of four functions.\nportfolio_returns(ticker_values, start_date, end_date)\nThis function takes the user-supplied tickers (and values), start date and end date. The function computes the ticker weights and obtains the adjusted close prices (if available) for each ticker using the\nyfinance\nlibrary. The function returns a dictionary with the ticker weights, a DataFrame containing the individual ticker returns, and the overall portfolio returns.\nperform_portfolio_analysis(data, ticker_weights, risk_free_rate)\nThis function takes the portfolio returns DataFrame computed previously, the ticker weights, and a user-supplied risk free rate and uses this to calculate individual security returns, cumulative returns, volatility, and Sharpe Ratios. These are returned in a dictionary.\nbenchmark_returns(benchmark, start_date, end_date)\nThis function obtains the benchmark data from\nyfinance\nusing the supplied parameters. It also returns a dictionary.\nportfolio_vs_benchmark(port_returns, benchmark_returns, risk_free_rate)\nThis function calculates the cumulative returns, annualized volatility, and Sharpe Ratios for both the portfolio and the benchmark using the data obtained in the previous functions. It provides a side-by-side comparison to assess the portfolio’s performance relative to the benchmark.\nThese four functions define the API that is used by the .NET application.\nThe .NET Application\nPrerequisites\nFor the .NET application we first need to download and build Python.NET. The code is available from https://github.com/pythonnet/pythonnet. Once downloaded, open the solution file (\npythonnet.sln\n), and select the\nPython.Runtime\nas the startup project. Then right-click and build the debug version. If the build is successful the\nPython.Runtime.dll\nwill be located in the pythonnet directory under \\pythonnet\\runtime.\nThe PortfolioManager Application\nHaving built the\nPython.Runtime.dll\n, we need to add it to the Portfolio Manager application. This is a WinUI 3.0 (C#/XAML) application which makes use of the\nWindows Community Toolkit\nfor dependency injection and the MVVM architecture. It also uses an Sqlite database to manage a collection of one or more portfolios.\nAside from the test framework (\nPortfolioManager.Tests.MSTest\n), the solution consists of two main projects: the\nPortfolioManager\nand\nPortfolioManager.Core\n. The\nPortfolioManager\nproject deals with the application logic, user settings, the views and the view models. The reusable logic and data models are located in the\nPortfolioManager.Core\nproject. So we add the\nPython.Runtime.dll\nto the\nDependencies\nhere under the\nAssemblies\nnode.\nThe Python service\nIn the core library, we define a simple\nIPythonService\ninterface that encapsulates the initialisation and the calls to the Python API.\npublic interface IPythonService\n{\n    void Initialize(string pythonDll);\n\n    bool RunPortfolioAnalysis(PortfolioItem portfolio);\n}\nIn the\nPortfolioManager\nproject, in the App.xaml.cs, we add the\nIPythonService\nto the list of services to be activated\n...\nservices.AddSingleton<IPythonService, PythonService>();\nFinally, we pass an instance of the\nIPythonService\ninto the\nPortfolioDetailViewModel\n. This view model manages the graphs output as a result of running the portfolio analysis. When the view is activated after clicking on the ‘Run’ button, the\nPythonService\ncan be initialised and the view model can run the portfolio analysis based on the selected portfolio.\npublic PortfolioDetailViewModel(IPythonService pythonService)\n    {\n        _pythonService = pythonService;\n\n        var settings = App.GetService<SettingsViewModel>();\n\n        var pythonDll = settings.PythonLibrary;\n        _pythonService.Initialize(pythonDll);\n\n\t\t//...\n    }\nInitialisation of the\nPythonService\nconsists of setting the path to the Python dll. This is configured via the application settings page. Additionally, we set up a couple of empty output streams to redirect any console output from the Python.Runtime.\nPortfolio Analysis\nThe main function\nRunPortfolioAnalysis\nis called with the currently selected\nPortfolioItem\n. The\nPortfolioItem\ncontains the user supplied parameters which have been obtained from the UI.\nThe\nRunPortfolioAnalysis\nfunction loads the\nportfolio_analysis.py\nscript and passes it to Python.NET, which creates a Python\nmodule\nobject. The\nmodule\nobject is used to access the script functions and variables. We use C#’s ‘dynamic’ keyword to delay the binding. We can see the available dynamically bound functions and parameters if we expand the\nmodule\nvariable in the Watch window.\nThe portfolio analysis proceeds by calling the Python functions using the user-supplied parameters and any intermediate results. Once these have been appropriately converted they are copied into the portfolio item’s data members.\n...\n\tdynamic portfolioResults = module.portfolio_returns(tickers, startDate, endDate);\n\n\tvar pyTickerWeights = new PyDict(portfolioResults[\"weights\"]);\n\n\tportfolio.TickerWeights = Interop.Converters.ConvertTickerWeights(pyTickerWeights);\n\t...\nIn this snippet, the Python object\npyTickerWeights\nis extracted from the dictionary returned from calling\nmodule.portfolio_returns\n. The Python ‘dict’ is converted into a C#\nList<TickerWeight>\n. The\nConvertTickerWeights\nfunction just iterates over each ticker and obtains the corresponding weight. This is then assigned to the\nTickerWeights\nmember of the portfolio item. The\nTickerWeights\nlist is then used in a Pie Chart that displays the percentage allocation of tickers in the portfolio.\nOnce the analysis is complete, the\nPortfolioDetailViewModel\ninitialises the\nPlotModel\nwith the data from the portfolio item, which then updates the graph view as it is bound to the specific\nPlotModel\n.\nIt is worth highlighting that the performance is quite slow. There seem to be two main aspects to this:\nThe initialisation of the Python engine seems to take some time, and perhaps this could be done once at startup.\nThe\nPortfolioDetailViewModel\nrenders six graphs with different datasets serially. It seems to me that this might be better refactored to use C# asynchronous processing.\nI am currently investigating both these issues.\nThe interop layer\nThis layer provides facilities to convert between C# and Python types. Basic types (strings, ints, doubles etc.) are converted transparently. From C#, we use the\n.ToPython()\nextension method to convert to a Python object. And from Python, we use the\n.AsManagedObject(typeof(T))\nfunction to return a C# object which we can then cast. Converting from a pandas DataFrame or series can be somewhat more involved.\nWrap-up\nThis blog post has described how to call Python functions from a C# desktop application using Python.NET. This arrangement (WinUI 3.0 C# front-end, Python.NET and Python) has the advantage of flexibility. The approach is quite generalisable. I could just as easily have created a TensorFlow model and called it from a C# application, if that had been my interest. On the other hand, the main disadvantage is the slow performance. This is an area that I am still currently investigating.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nAdam’s Software Lab\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "Recently, I've been using Python's __yfinance__ library to perform some simple portfolio analysis. Rather than using a Jupyter notebook to run the Python code and visualise the results, I thought it might be a nice idea to build a .NET desktop application using WinUI 3.0, XAML and C#. The application allows you to define a portfolio and manages the presentation of the results graphically. The underlying analysis is performed using Python. In order to call the Python code from C#, I use [Python.NET](https://github.com/pythonnet/pythonnet). The purpose of this blog post is to describe how to use Python.NET to call Python functions from a C# application. The complete application is available on github: (https://github.com/Adam-Gladstone/PortfolioManager).",
      "meta_keywords": null,
      "og_description": "Recently, I've been using Python's __yfinance__ library to perform some simple portfolio analysis. Rather than using a Jupyter notebook to run the Python code and visualise the results, I thought it might be a nice idea to build a .NET desktop application using WinUI 3.0, XAML and C#. The application allows you to define a portfolio and manages the presentation of the results graphically. The underlying analysis is performed using Python. In order to call the Python code from C#, I use [Python.NET](https://github.com/pythonnet/pythonnet). The purpose of this blog post is to describe how to use Python.NET to call Python functions from a C# application. The complete application is available on github: (https://github.com/Adam-Gladstone/PortfolioManager).",
      "og_image": "https://adam-gladstone.github.io/assets/images/PortfolioAnalysisResults.png",
      "og_title": "Calling Python from C# using Python.NET | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 7.3,
      "sitemap_lastmod": null,
      "twitter_description": "Recently, I've been using Python's __yfinance__ library to perform some simple portfolio analysis. Rather than using a Jupyter notebook to run the Python code and visualise the results, I thought it might be a nice idea to build a .NET desktop application using WinUI 3.0, XAML and C#. The application allows you to define a portfolio and manages the presentation of the results graphically. The underlying analysis is performed using Python. In order to call the Python code from C#, I use [Python.NET](https://github.com/pythonnet/pythonnet). The purpose of this blog post is to describe how to use Python.NET to call Python functions from a C# application. The complete application is available on github: (https://github.com/Adam-Gladstone/PortfolioManager).",
      "twitter_title": "Calling Python from C# using Python.NET | R-bloggers",
      "url": "https://www.r-bloggers.com/2025/02/calling-python-from-c-using-python-net/",
      "word_count": 1461
    }
  }
}