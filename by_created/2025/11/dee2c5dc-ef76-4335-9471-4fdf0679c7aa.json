{
  "uuid": "dee2c5dc-ef76-4335-9471-4fdf0679c7aa",
  "created_at": "2025-11-17 20:39:01",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2023/12/are-birth-dates-still-destiny-for-canadian-nhl-players/",
    "crawled_at": "2025-11-17T09:42:00.077199",
    "external_links": [
      {
        "href": "https://jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/",
        "text": "R | JLaw's R Blog"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://www.amazon.com/Outliers-Story-Success-Malcolm-Gladwell/dp/0316017930",
        "text": "Malcolm Gladwell’s Outliers"
      },
      {
        "href": "https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1310041501",
        "text": "Statistics Canada"
      },
      {
        "href": "https://jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/",
        "text": "R | JLaw's R Blog"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Are Birth Dates Still Destiny for Canadian NHL Players? | R-bloggers",
    "images": [
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/gladwell.PNG?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/canadaBirth.PNG?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/index_files/figure-html/unnamed-chunk-17-1.png?w=450&ssl=1"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/r-jlaws-r-blog/",
        "text": "R | JLaw's R Blog"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-380496 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Are Birth Dates Still Destiny for Canadian NHL Players?</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">December 3, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/r-jlaws-r-blog/\">R | JLaw's R Blog</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/\"> R | JLaw's R Blog</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<p>In the first chapter <a href=\"https://www.amazon.com/Outliers-Story-Success-Malcolm-Gladwell/dp/0316017930\" rel=\"nofollow\" target=\"_blank\">Malcolm Gladwell’s Outliers</a> he discusses how in Canadian Junior Hockey there is a higher likelihood for players to be born in the first quarter of the year. In his words:</p>\n<p><img data-lazy-src=\"https://i2.wp.com/jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/gladwell.PNG?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i2.wp.com/jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/gladwell.PNG?w=578&amp;ssl=1\"/></noscript></p>\n<p>Because these kids are older within their year they make all the important teams at a young age which gets them better resources for skill development and so on.</p>\n<p>While it seems clear that more players are born in the first few months of the year, what isn’t explored is whether or not this would be expected. Maybe more people in Canada <strong>in general</strong> are born earlier in the year.</p>\n<p>I will explore whether Gladwell’s result is expected as well as whether this is still true in today’s NHL for Canadian-born players.</p>\n<p>To answer these questions I will download data on birth rates from Statistics Canada as well as player roster data from the NHL’s API.</p>\n<p>This analysis will leverage the <code>httr</code> package to download the data, <code>tidyverse</code> for data manipulation, and <code>ggtext</code>/<code>ggimage</code>/<code>scales</code> for visualization.</p>\n<pre>library(tidyverse)\nlibrary(httr)\nlibrary(scales)\nlibrary(ggimage)\nlibrary(ggtext)</pre>\n<div class=\"section level2\" id=\"section-1-what-is-the-distribution-of-births-by-month-in-canada\">\n<h2>Section 1: What is the distribution of births by month in Canada?</h2>\n<p>Gladwell’s thesis is that you see more Canadian Junior hockey players born earlier in the year because of the way that cut-offs are set for Youth Hockey. I think that he is correct but what if most people in Canada are born in the beginning of the year. Then this might be representative of the population rather than an outlier effect.</p>\n<p>Information about births by month in Canada can be found at <a href=\"https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1310041501\" rel=\"nofollow\" target=\"_blank\">Statistics Canada</a>.</p>\n<p><img data-lazy-src=\"https://i2.wp.com/jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/canadaBirth.PNG?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i2.wp.com/jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/canadaBirth.PNG?w=578&amp;ssl=1\"/></noscript></p>\n<p>Initially I had tried to web-scrape the table using <code>rvest</code> but could not figure out a way to deal with the “Number” row. Since the data could be downloaded as a CSV file my alternative solution was to use <code>httr</code> to send a call to the download link to grab the file. The URL was found by using the inspect option in Firefox when clicking the download link.</p>\n<pre>canada_raw &lt;- GET('https://www150.statcan.gc.ca/t1/tbl1/en/dtl!downloadDbLoadingData-nonTraduit.action?pid=1310041501&amp;latestN=0&amp;startDate=19910101&amp;endDate=20220101&amp;csvLocale=en&amp;selectedMembers=%5B%5B1%5D%2C%5B%5D%2C%5B1%5D%5D&amp;checkedLevels=1D1%2C1D2') %&gt;%\n  content()</pre>\n<p>The <code>GET()</code> command sends the request to the server and the <code>content()</code> function returns the results. Without the <code>content()</code> function there is a lot of additional information about the call such as headers, request url, etc.</p>\n<p>The raw data contains many columns that are either duplicative or unnecessary for this analysis:</p>\n<table style=\"width:100%;\">\n<colgroup>\n<col width=\"4%\"/>\n<col width=\"18%\"/>\n<col width=\"7%\"/>\n<col width=\"10%\"/>\n<col width=\"10%\"/>\n<col width=\"3%\"/>\n<col width=\"3%\"/>\n<col width=\"6%\"/>\n<col width=\"4%\"/>\n<col width=\"4%\"/>\n<col width=\"5%\"/>\n<col width=\"3%\"/>\n<col width=\"3%\"/>\n<col width=\"3%\"/>\n<col width=\"5%\"/>\n<col width=\"4%\"/>\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th align=\"right\">REF_DATE</th>\n<th align=\"left\">GEO</th>\n<th align=\"left\">DGUID</th>\n<th align=\"left\">Month of birth</th>\n<th align=\"left\">Characteristics</th>\n<th align=\"left\">UOM</th>\n<th align=\"right\">UOM_ID</th>\n<th align=\"left\">SCALAR_FACTOR</th>\n<th align=\"right\">SCALAR_ID</th>\n<th align=\"left\">VECTOR</th>\n<th align=\"left\">COORDINATE</th>\n<th align=\"right\">VALUE</th>\n<th align=\"left\">STATUS</th>\n<th align=\"left\">SYMBOL</th>\n<th align=\"left\">TERMINATED</th>\n<th align=\"right\">DECIMALS</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"right\">1991</td>\n<td align=\"left\">Canada, place of residence of mother</td>\n<td align=\"left\">2016A000011124</td>\n<td align=\"left\">Total, month of birth</td>\n<td align=\"left\">Number of live births</td>\n<td align=\"left\">Number</td>\n<td align=\"right\">223</td>\n<td align=\"left\">units</td>\n<td align=\"right\">0</td>\n<td align=\"left\">v21400536</td>\n<td align=\"left\">1.1.1</td>\n<td align=\"right\">403816</td>\n<td align=\"left\">NA</td>\n<td align=\"left\">NA</td>\n<td align=\"left\">NA</td>\n<td align=\"right\">0</td>\n</tr>\n<tr class=\"even\">\n<td align=\"right\">1992</td>\n<td align=\"left\">Canada, place of residence of mother</td>\n<td align=\"left\">2016A000011124</td>\n<td align=\"left\">Total, month of birth</td>\n<td align=\"left\">Number of live births</td>\n<td align=\"left\">Number</td>\n<td align=\"right\">223</td>\n<td align=\"left\">units</td>\n<td align=\"right\">0</td>\n<td align=\"left\">v21400536</td>\n<td align=\"left\">1.1.1</td>\n<td align=\"right\">399109</td>\n<td align=\"left\">NA</td>\n<td align=\"left\">NA</td>\n<td align=\"left\">NA</td>\n<td align=\"right\">0</td>\n</tr>\n</tbody>\n</table>\n<p>I pulled the data for 1991 through 2022 and each year has a total row as well as a row for each individual month. To clean up this data I filter out the total rows with <code>str_detect()</code>, keep only the <em>REF_DATE</em> for the year, extract the month using <code>str_extract</code> and keep the <em>VALUE</em> which is the actual number of births.</p>\n<pre>canada_births &lt;- canada_raw %&gt;%\n  filter(!str_detect(`Month of birth`, 'Total')) %&gt;%\n  transmute(\n    REF_DATE,\n    MONTH = str_extract(`Month of birth`, 'Month of birth, (\\\\w+)', 1),\n    VALUE\n  ) %&gt;% \n  group_by(MONTH) %&gt;% \n  summarize(country_births = sum(VALUE)) %&gt;% \n  mutate(country_pct = country_births/sum(country_births))</pre>\n<p>Then the distribution can be calculated by <code>dplyr</code> functions. The true distribution of birth month in Canada vs. the expected distribution if every day had an equal chance is shown below:</p>\n<pre>canada_births %&gt;%\n  transmute(\n    `Canada %` = country_pct,\n    `Expected % from Days in Month` = case_when(\n      MONTH %in% c('April', 'June', 'September', 'November') ~ 30/365,\n      MONTH == 'February' ~ 28/365,\n      TRUE ~ 31/365,\n    ),\n    `Difference` = `Canada %` - `Expected % from Days in Month`,\n    month_id = factor(MONTH, levels = c('January', 'February', 'March', 'April',\n                                        'May', 'June', 'July', 'August',\n                                        'September', 'October', 'November', 'December'))\n  ) %&gt;% \n  gather(lbl, value, -month_id) %&gt;% \n  spread(month_id, value) %&gt;%\n  mutate(\n    lbl = factor(lbl, levels = c('Canada %', 'Expected % from Days in Month', 'Difference')),\n    across(January:December, ~percent(.x, accuracy = .1))) %&gt;%\n  arrange(lbl) %&gt;% \n  kable(col.names = c(\"\", names(.)[-1]))</pre>\n<table style=\"width:100%;\">\n<colgroup>\n<col width=\"25%\"/>\n<col width=\"6%\"/>\n<col width=\"7%\"/>\n<col width=\"5%\"/>\n<col width=\"5%\"/>\n<col width=\"4%\"/>\n<col width=\"4%\"/>\n<col width=\"4%\"/>\n<col width=\"5%\"/>\n<col width=\"8%\"/>\n<col width=\"6%\"/>\n<col width=\"7%\"/>\n<col width=\"7%\"/>\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th align=\"left\"></th>\n<th align=\"left\">January</th>\n<th align=\"left\">February</th>\n<th align=\"left\">March</th>\n<th align=\"left\">April</th>\n<th align=\"left\">May</th>\n<th align=\"left\">June</th>\n<th align=\"left\">July</th>\n<th align=\"left\">August</th>\n<th align=\"left\">September</th>\n<th align=\"left\">October</th>\n<th align=\"left\">November</th>\n<th align=\"left\">December</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\">Canada %</td>\n<td align=\"left\">8.0%</td>\n<td align=\"left\">7.5%</td>\n<td align=\"left\">8.5%</td>\n<td align=\"left\">8.4%</td>\n<td align=\"left\">8.8%</td>\n<td align=\"left\">8.5%</td>\n<td align=\"left\">8.9%</td>\n<td align=\"left\">8.7%</td>\n<td align=\"left\">8.7%</td>\n<td align=\"left\">8.4%</td>\n<td align=\"left\">7.8%</td>\n<td align=\"left\">7.8%</td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\">Expected % from Days in Month</td>\n<td align=\"left\">8.5%</td>\n<td align=\"left\">7.7%</td>\n<td align=\"left\">8.5%</td>\n<td align=\"left\">8.2%</td>\n<td align=\"left\">8.5%</td>\n<td align=\"left\">8.2%</td>\n<td align=\"left\">8.5%</td>\n<td align=\"left\">8.5%</td>\n<td align=\"left\">8.2%</td>\n<td align=\"left\">8.5%</td>\n<td align=\"left\">8.2%</td>\n<td align=\"left\">8.5%</td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\">Difference</td>\n<td align=\"left\">-0.5%</td>\n<td align=\"left\">-0.1%</td>\n<td align=\"left\">0.0%</td>\n<td align=\"left\">0.2%</td>\n<td align=\"left\">0.3%</td>\n<td align=\"left\">0.3%</td>\n<td align=\"left\">0.4%</td>\n<td align=\"left\">0.2%</td>\n<td align=\"left\">0.5%</td>\n<td align=\"left\">-0.1%</td>\n<td align=\"left\">-0.4%</td>\n<td align=\"left\">-0.7%</td>\n</tr>\n</tbody>\n</table>\n<p>At first glance, Canadians seem <strong>less</strong> likely to be born in the beginning of the year (particularly January and February) than from random distribution. They’re also less likely to be born in the end of the year.</p>\n<p>Let’s see what the Canadian NHL players look like:</p>\n</div>\n<div class=\"section level2\" id=\"section-2-what-is-the-difstribution-of-births-by-month-for-canadian-nhl-players\">\n<h2>Section 2: What is the difstribution of births by month for Canadian NHL players?</h2>\n<p>To get the information about the NHL players I will use <code>httr</code> to query the NHLs API. My original version of this analysis used the <code>nhlapi</code> package which is on CRAN. But the NHL changed their API at some point in the last few months so that package no longer functioned.</p>\n<p>Getting the 2023-2024 team rosters can be done through the API endpoint <code>https://api-web.nhle.com/v1/roster/{team}/20232024</code> where <code>{team}</code> is a three-character code representing an individual team. To get the rosters for each team I need to first get the codes for each team.</p>\n<p>This is going to involve a bunch of JSON manipulation which is new to me so their is probably a more elegant solution.</p>\n<p>All information on NHL teams can be retrieved from the <code>https://api.nhle.com/stats/rest/en/team</code> endpoint. Using the same <code>GET()</code> / <code>content()</code> set from the prior section I can get all the team information</p>\n<pre>teams &lt;- GET('https://api.nhle.com/stats/rest/en/team') %&gt;% \n  content()</pre>\n<p>This comes back as a list with two items, “data” which contains all the useful information and “total” which contains the number of elements returned in “data”. I just need the “data” piece.</p>\n<pre>teams &lt;- teams %&gt;% \n  .[['data']] </pre>\n<p>Now “teams” is a list with 59 elements with each element containing information (id, franchiseId, fullName, legaugeId, rawTricode, triCode) about a team.</p>\n<pre>teams[1:3] %&gt;% jsonlite::toJSON(auto_unbox = T) %&gt;% jsonlite::prettify()\r\n## [\n##     {\n##         \"id\": 11,\n##         \"franchiseId\": 35,\n##         \"fullName\": \"Atlanta Thrashers\",\n##         \"leagueId\": 133,\n##         \"rawTricode\": \"ATL\",\n##         \"triCode\": \"ATL\"\n##     },\n##     {\n##         \"id\": 34,\n##         \"franchiseId\": 26,\n##         \"fullName\": \"Hartford Whalers\",\n##         \"leagueId\": 133,\n##         \"rawTricode\": \"HFD\",\n##         \"triCode\": \"HFD\"\n##     },\n##     {\n##         \"id\": 31,\n##         \"franchiseId\": 15,\n##         \"fullName\": \"Minnesota North Stars\",\n##         \"leagueId\": 133,\n##         \"rawTricode\": \"MNS\",\n##         \"triCode\": \"MNS\"\n##     }\n## ]\n## </pre>\n<p>Ultimately I want to restructure this set of nested lists into a rectangular format. The way I’ll do this is create a tibble of list columns using <code>tibble()</code> and then <code>tidyr::unnest_wider</code> to turn each element of a list-column into its own column.</p>\n<pre>teams &lt;- teams %&gt;% \n  tibble(data = .) %&gt;% \n  unnest_wider(data)</pre>\n<p>Now everything is in a much more legible format:</p>\n<table>\n<thead>\n<tr class=\"header\">\n<th align=\"right\">id</th>\n<th align=\"right\">franchiseId</th>\n<th align=\"left\">fullName</th>\n<th align=\"right\">leagueId</th>\n<th align=\"left\">rawTricode</th>\n<th align=\"left\">triCode</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"right\">11</td>\n<td align=\"right\">35</td>\n<td align=\"left\">Atlanta Thrashers</td>\n<td align=\"right\">133</td>\n<td align=\"left\">ATL</td>\n<td align=\"left\">ATL</td>\n</tr>\n<tr class=\"even\">\n<td align=\"right\">34</td>\n<td align=\"right\">26</td>\n<td align=\"left\">Hartford Whalers</td>\n<td align=\"right\">133</td>\n<td align=\"left\">HFD</td>\n<td align=\"left\">HFD</td>\n</tr>\n<tr class=\"odd\">\n<td align=\"right\">31</td>\n<td align=\"right\">15</td>\n<td align=\"left\">Minnesota North Stars</td>\n<td align=\"right\">133</td>\n<td align=\"left\">MNS</td>\n<td align=\"left\">MNS</td>\n</tr>\n</tbody>\n</table>\n<p>That was all just to get the 3-character codes needed to actually get the rosters. Since a separate call is made to the Roster endpoint for each team this is a good opportunity to create a function. Then I can use <code>purrr::map_dfr</code> to iterate through the team codes to combine all the rosters together.</p>\n<p>For the function, it’ll take a team code for input and extract the player’s first name, last name, birth date, and birth country.</p>\n<p>The data structure returned from the Roster endpoint is a list with elements for forwards, defensemen, and goalies, Then for each player within the data looks like:</p>\n<pre>GET(glue::glue('https://api-web.nhle.com/v1/roster/NJD/20232024')) %&gt;% \n    content() %&gt;%\n    .[['forwards']] %&gt;%\n    .[[1]] %&gt;%\n    jsonlite::toJSON(auto_unbox = T, pretty = T) %&gt;% \n    jsonlite::prettify()\r\n## {\n##     \"id\": 8479414,\n##     \"headshot\": \"https://assets.nhle.com/mugs/nhl/20232024/NJD/8479414.png\",\n##     \"firstName\": {\n##         \"default\": \"Nathan\"\n##     },\n##     \"lastName\": {\n##         \"default\": \"Bastian\"\n##     },\n##     \"sweaterNumber\": 14,\n##     \"positionCode\": \"R\",\n##     \"shootsCatches\": \"R\",\n##     \"heightInInches\": 76,\n##     \"weightInPounds\": 205,\n##     \"heightInCentimeters\": 193,\n##     \"weightInKilograms\": 93,\n##     \"birthDate\": \"1997-12-06\",\n##     \"birthCity\": {\n##         \"default\": \"Kitchener\"\n##     },\n##     \"birthCountry\": \"CAN\",\n##     \"birthStateProvince\": {\n##         \"default\": \"ON\"\n##     }\n## }\n## </pre>\n<p>To get only the data I want, I’ll (1) pass a team code into the function to call to the API with <code>GET()</code> and <code>content()</code>, (2) use <code>flatten()</code> to remove the level of forwards, defensemen, and goalies to have all the players as one nested list, (3) turn the data into a tibble of list-columns with <code>tibble()</code>, and (4) use the <code>tidyr::hoist()</code> function to pull only the items I want from the structure. Finally, I use <code>transmute</code> to add the 3-character input to the results and to exclude the <em>data</em> list-column.</p>\n<pre>get_roster &lt;- function(team){\n  GET(glue::glue('https://api-web.nhle.com/v1/roster/{team}/20232024')) %&gt;% \n  content() %&gt;%\n  flatten() %&gt;%\n  tibble(data = .) %&gt;%\n  hoist('data',\n    'firstName' = list('firstName', 1L),\n    'lastName' = list('lastName', 1L),\n    'birthDate',\n    'birthCountry'\n  ) %&gt;% \n  transmute(team = team, firstName, lastName, birthDate, birthCountry)\n}</pre>\n<p>Within <code>hoist()</code>, the construction of <code>list('firstName', 1L)</code> is to avoid having to pull the “default” sub-item within firstName. This way simply grabs the value of the first element within the firstName item. Since birthDate and birthCountry have no sub-items there is no need to do that for those fields.</p>\n<p>Finally to get all the players from all the teams I use <code>purrr::map_dfr()</code> to iterate through the team codes and run my function. There is a filter to remove any items with missing firstName fields because the Team endpoint returns information for all historical teams (e.g, Atlanta Thrashers, Hartford Whalers, etc.). Since these teams are not active in 2023-2024 they return information but the fields I want don’t populate.</p>\n<pre>all_roster &lt;- map_dfr(teams$triCode, get_roster) %&gt;%\n  filter(!is.na(firstName))</pre>\n<p>Now we have a dataset of the 774 players in the NHL. This number is slightly larger than the expected number of NHL players (736 = 23 players * 32 teams) so there is likely a nuance to how a roster player is determined but it shouldn’t matter for this analysis.</p>\n<p>Since I only want to look at Canadian players because I have no idea if the same cut-offs that apply in Canada apply in other countries in the world. I’ll also do some data cleanup on birth months and calculate the player distribution.</p>\n<pre>canada_players &lt;- all_roster %&gt;% \n  filter(birthCountry == 'CAN') %&gt;% \n  mutate(\n    mob = month(ymd(birthDate), label = T, abbr = F),\n    mob_id = month(ymd(birthDate))\n  ) %&gt;% \n  count(mob_id, mob, name = \"players\") %&gt;%\n  mutate(player_pct = players/sum(players))</pre>\n<p>Now we have the distribution of birth months for the 314 Canadian NHL players</p>\n</div>\n<div class=\"section level2\" id=\"section-3-putting-it-all-together\">\n<h2>Section 3: Putting it all together</h2>\n<p>The last section is to combine the Canada birth month data from Section 1 with the Canadian NHL player from Section 2 and make a pretty visualization.</p>\n<p>First I combining the data and create a field for the percentage of births you’d expect if every day was equally likely (ex. if January has 31 days then there is a 31/365 chance of being randomly born in January):</p>\n<pre>combined &lt;- canada_players %&gt;%\n  left_join(canada_births, by = c('mob' = 'MONTH')) %&gt;%\n  #Put in random value\n  mutate(\n    random = case_when(\n      mob_id %in% c(4, 6, 9, 11) ~ 30/365,\n      mob_id %in% c(1, 3, 5, 7, 8, 10, 12) ~ 31/365,\n      mob_id == 2 ~ 28/365\n    )\n  )</pre>\n<p>For the visualization I’m going to use the <code>ggimage</code> package to use icons of the Canadian flag and the NHL logo. This package can render a URL so I’ll create variables for those URLs.</p>\n<pre>NHL_ICON &lt;- \"https://pbs.twimg.com/media/F9sTTAYakAAkRv6.png\"\nCANADA_ICON &lt;- \"https://cdn-icons-png.flaticon.com/512/5372/5372678.png\"</pre>\n<p>Finally, a combination of <code>ggplot</code>, <code>ggtext</code>, and <code>ggimage</code> is used to create the visualization.</p>\n<pre>ggplot(combined, aes(x = fct_reorder(mob, -mob_id))) + \n  geom_line(aes(y = random, group = 1), lty = 2, color = 'grey60') + \n  geom_linerange(aes(ymin = country_pct, ymax = player_pct)) + \n  geom_image(aes(image = NHL_ICON, y = player_pct), size = .08) + \n  geom_image(aes(image = CANADA_ICON, y = country_pct), size = .07) + \n  geom_text(aes(label = percent(player_pct, accuracy = .1), \n                y = if_else(player_pct &gt; country_pct, player_pct + .004, player_pct - .004))) + \n  geom_text(aes(label = percent(country_pct, accuracy = .1), \n                y = if_else(country_pct &gt; player_pct, country_pct + .004, country_pct - .004))) +\n  annotate(\n    'curve',\n    xend = 2.3,\n    x = 1.5,\n    yend = .084,\n    y = .10,\n    curvature = .25,\n    arrow = arrow(\n      length = unit(7, \"pt\"),\n      type = \"closed\"\n    )) + \n  annotate(\n    'richtext',\n    x = 1,\n    y = .105,\n    label = \"The grey line is the expected % of births&lt;br /&gt;if birth month was completely random\",\n    size = 4\n  ) + \n  scale_y_continuous(labels = percent) + \n  coord_flip() + \n  labs(x = \"Month of Birth\", y = \"Percentage of Births (%)\",\n       title = \"Are Canadian NHL Players More Likely to be Born Early in the Year?\",\n       subtitle = 'Comparing the distribution of birth months between Canadian NHL players and Canada in general ',\n       caption = glue::glue(\"&lt;img src = {NHL_ICON} width = '15' height=' 15' /&gt; - Canadian NHL Players Birth Month Distribution &lt;br /&gt;\n                            &lt;img src = {CANADA_ICON} width = '15' height=' 15' /&gt; - Canadian Birth Month (1991-2022) Distribution\")\n       ) + \n  theme_light() +\n  theme(\n    text = element_text(family = 'Asap SemiCondensed', size = 14),\n    plot.title.position = 'plot',\n    plot.title = element_markdown(),\n    plot.caption = element_markdown()\n  )</pre>\n<p><img data-lazy-src=\"https://i2.wp.com/jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/index_files/figure-html/unnamed-chunk-17-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i2.wp.com/jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/index_files/figure-html/unnamed-chunk-17-1.png?w=450&amp;ssl=1\"/></noscript></p>\n<p>Visually it looks pretty clear that there are more Canadian NHL players born in January/February than expected and fewer players born in August through the end of the year. May and July are interesting but I don’t have an intuition for why more NHL players might be born in those months.</p>\n<p>For a more stats-y perspective. A chi-sq test can be used to see if the distribution of the Canadian NHL players is different than Canada in general. In the following code, <em>x</em> is the number of Canadian NHL players born in each month and <em>p</em> is the expected proportion based on the distribution of birth months for Canada as a whole.</p>\n<pre>broom::tidy(chisq.test(x = combined$players, p = combined$country_pct))\r\n## # A tibble: 1 × 4\n##   statistic p.value parameter method                                  \n##       &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                                   \n## 1      25.6 0.00752        11 Chi-squared test for given probabilities</pre>\n<p>The p-value of &lt;.01 means that we can reject the null hypothesis that they are the same distribution.</p>\n<p>So it seems that Malcolm Gladwell’s thesis in Outliers still holds true in today’s NHL among Canadian players.</p>\n</div>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/\"> R | JLaw's R Blog</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
    "main_text": "Are Birth Dates Still Destiny for Canadian NHL Players?\nPosted on\nDecember 3, 2023\nby\nR | JLaw's R Blog\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nR | JLaw's R Blog\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nIn the first chapter\nMalcolm Gladwell’s Outliers\nhe discusses how in Canadian Junior Hockey there is a higher likelihood for players to be born in the first quarter of the year. In his words:\nBecause these kids are older within their year they make all the important teams at a young age which gets them better resources for skill development and so on.\nWhile it seems clear that more players are born in the first few months of the year, what isn’t explored is whether or not this would be expected. Maybe more people in Canada\nin general\nare born earlier in the year.\nI will explore whether Gladwell’s result is expected as well as whether this is still true in today’s NHL for Canadian-born players.\nTo answer these questions I will download data on birth rates from Statistics Canada as well as player roster data from the NHL’s API.\nThis analysis will leverage the\nhttr\npackage to download the data,\ntidyverse\nfor data manipulation, and\nggtext\n/\nggimage\n/\nscales\nfor visualization.\nlibrary(tidyverse)\nlibrary(httr)\nlibrary(scales)\nlibrary(ggimage)\nlibrary(ggtext)\nSection 1: What is the distribution of births by month in Canada?\nGladwell’s thesis is that you see more Canadian Junior hockey players born earlier in the year because of the way that cut-offs are set for Youth Hockey. I think that he is correct but what if most people in Canada are born in the beginning of the year. Then this might be representative of the population rather than an outlier effect.\nInformation about births by month in Canada can be found at\nStatistics Canada\n.\nInitially I had tried to web-scrape the table using\nrvest\nbut could not figure out a way to deal with the “Number” row. Since the data could be downloaded as a CSV file my alternative solution was to use\nhttr\nto send a call to the download link to grab the file. The URL was found by using the inspect option in Firefox when clicking the download link.\ncanada_raw <- GET('https://www150.statcan.gc.ca/t1/tbl1/en/dtl!downloadDbLoadingData-nonTraduit.action?pid=1310041501&latestN=0&startDate=19910101&endDate=20220101&csvLocale=en&selectedMembers=%5B%5B1%5D%2C%5B%5D%2C%5B1%5D%5D&checkedLevels=1D1%2C1D2') %>%\n  content()\nThe\nGET()\ncommand sends the request to the server and the\ncontent()\nfunction returns the results. Without the\ncontent()\nfunction there is a lot of additional information about the call such as headers, request url, etc.\nThe raw data contains many columns that are either duplicative or unnecessary for this analysis:\nREF_DATE\nGEO\nDGUID\nMonth of birth\nCharacteristics\nUOM\nUOM_ID\nSCALAR_FACTOR\nSCALAR_ID\nVECTOR\nCOORDINATE\nVALUE\nSTATUS\nSYMBOL\nTERMINATED\nDECIMALS\n1991\nCanada, place of residence of mother\n2016A000011124\nTotal, month of birth\nNumber of live births\nNumber\n223\nunits\n0\nv21400536\n1.1.1\n403816\nNA\nNA\nNA\n0\n1992\nCanada, place of residence of mother\n2016A000011124\nTotal, month of birth\nNumber of live births\nNumber\n223\nunits\n0\nv21400536\n1.1.1\n399109\nNA\nNA\nNA\n0\nI pulled the data for 1991 through 2022 and each year has a total row as well as a row for each individual month. To clean up this data I filter out the total rows with\nstr_detect()\n, keep only the\nREF_DATE\nfor the year, extract the month using\nstr_extract\nand keep the\nVALUE\nwhich is the actual number of births.\ncanada_births <- canada_raw %>%\n  filter(!str_detect(`Month of birth`, 'Total')) %>%\n  transmute(\n    REF_DATE,\n    MONTH = str_extract(`Month of birth`, 'Month of birth, (\\\\w+)', 1),\n    VALUE\n  ) %>% \n  group_by(MONTH) %>% \n  summarize(country_births = sum(VALUE)) %>% \n  mutate(country_pct = country_births/sum(country_births))\nThen the distribution can be calculated by\ndplyr\nfunctions. The true distribution of birth month in Canada vs. the expected distribution if every day had an equal chance is shown below:\ncanada_births %>%\n  transmute(\n    `Canada %` = country_pct,\n    `Expected % from Days in Month` = case_when(\n      MONTH %in% c('April', 'June', 'September', 'November') ~ 30/365,\n      MONTH == 'February' ~ 28/365,\n      TRUE ~ 31/365,\n    ),\n    `Difference` = `Canada %` - `Expected % from Days in Month`,\n    month_id = factor(MONTH, levels = c('January', 'February', 'March', 'April',\n                                        'May', 'June', 'July', 'August',\n                                        'September', 'October', 'November', 'December'))\n  ) %>% \n  gather(lbl, value, -month_id) %>% \n  spread(month_id, value) %>%\n  mutate(\n    lbl = factor(lbl, levels = c('Canada %', 'Expected % from Days in Month', 'Difference')),\n    across(January:December, ~percent(.x, accuracy = .1))) %>%\n  arrange(lbl) %>% \n  kable(col.names = c(\"\", names(.)[-1]))\nJanuary\nFebruary\nMarch\nApril\nMay\nJune\nJuly\nAugust\nSeptember\nOctober\nNovember\nDecember\nCanada %\n8.0%\n7.5%\n8.5%\n8.4%\n8.8%\n8.5%\n8.9%\n8.7%\n8.7%\n8.4%\n7.8%\n7.8%\nExpected % from Days in Month\n8.5%\n7.7%\n8.5%\n8.2%\n8.5%\n8.2%\n8.5%\n8.5%\n8.2%\n8.5%\n8.2%\n8.5%\nDifference\n-0.5%\n-0.1%\n0.0%\n0.2%\n0.3%\n0.3%\n0.4%\n0.2%\n0.5%\n-0.1%\n-0.4%\n-0.7%\nAt first glance, Canadians seem\nless\nlikely to be born in the beginning of the year (particularly January and February) than from random distribution. They’re also less likely to be born in the end of the year.\nLet’s see what the Canadian NHL players look like:\nSection 2: What is the difstribution of births by month for Canadian NHL players?\nTo get the information about the NHL players I will use\nhttr\nto query the NHLs API. My original version of this analysis used the\nnhlapi\npackage which is on CRAN. But the NHL changed their API at some point in the last few months so that package no longer functioned.\nGetting the 2023-2024 team rosters can be done through the API endpoint\nhttps://api-web.nhle.com/v1/roster/{team}/20232024\nwhere\n{team}\nis a three-character code representing an individual team. To get the rosters for each team I need to first get the codes for each team.\nThis is going to involve a bunch of JSON manipulation which is new to me so their is probably a more elegant solution.\nAll information on NHL teams can be retrieved from the\nhttps://api.nhle.com/stats/rest/en/team\nendpoint. Using the same\nGET()\n/\ncontent()\nset from the prior section I can get all the team information\nteams <- GET('https://api.nhle.com/stats/rest/en/team') %>% \n  content()\nThis comes back as a list with two items, “data” which contains all the useful information and “total” which contains the number of elements returned in “data”. I just need the “data” piece.\nteams <- teams %>% \n  .[['data']]\nNow “teams” is a list with 59 elements with each element containing information (id, franchiseId, fullName, legaugeId, rawTricode, triCode) about a team.\nteams[1:3] %>% jsonlite::toJSON(auto_unbox = T) %>% jsonlite::prettify()\n## [\n##     {\n##         \"id\": 11,\n##         \"franchiseId\": 35,\n##         \"fullName\": \"Atlanta Thrashers\",\n##         \"leagueId\": 133,\n##         \"rawTricode\": \"ATL\",\n##         \"triCode\": \"ATL\"\n##     },\n##     {\n##         \"id\": 34,\n##         \"franchiseId\": 26,\n##         \"fullName\": \"Hartford Whalers\",\n##         \"leagueId\": 133,\n##         \"rawTricode\": \"HFD\",\n##         \"triCode\": \"HFD\"\n##     },\n##     {\n##         \"id\": 31,\n##         \"franchiseId\": 15,\n##         \"fullName\": \"Minnesota North Stars\",\n##         \"leagueId\": 133,\n##         \"rawTricode\": \"MNS\",\n##         \"triCode\": \"MNS\"\n##     }\n## ]\n##\nUltimately I want to restructure this set of nested lists into a rectangular format. The way I’ll do this is create a tibble of list columns using\ntibble()\nand then\ntidyr::unnest_wider\nto turn each element of a list-column into its own column.\nteams <- teams %>% \n  tibble(data = .) %>% \n  unnest_wider(data)\nNow everything is in a much more legible format:\nid\nfranchiseId\nfullName\nleagueId\nrawTricode\ntriCode\n11\n35\nAtlanta Thrashers\n133\nATL\nATL\n34\n26\nHartford Whalers\n133\nHFD\nHFD\n31\n15\nMinnesota North Stars\n133\nMNS\nMNS\nThat was all just to get the 3-character codes needed to actually get the rosters. Since a separate call is made to the Roster endpoint for each team this is a good opportunity to create a function. Then I can use\npurrr::map_dfr\nto iterate through the team codes to combine all the rosters together.\nFor the function, it’ll take a team code for input and extract the player’s first name, last name, birth date, and birth country.\nThe data structure returned from the Roster endpoint is a list with elements for forwards, defensemen, and goalies, Then for each player within the data looks like:\nGET(glue::glue('https://api-web.nhle.com/v1/roster/NJD/20232024')) %>% \n    content() %>%\n    .[['forwards']] %>%\n    .[[1]] %>%\n    jsonlite::toJSON(auto_unbox = T, pretty = T) %>% \n    jsonlite::prettify()\n## {\n##     \"id\": 8479414,\n##     \"headshot\": \"https://assets.nhle.com/mugs/nhl/20232024/NJD/8479414.png\",\n##     \"firstName\": {\n##         \"default\": \"Nathan\"\n##     },\n##     \"lastName\": {\n##         \"default\": \"Bastian\"\n##     },\n##     \"sweaterNumber\": 14,\n##     \"positionCode\": \"R\",\n##     \"shootsCatches\": \"R\",\n##     \"heightInInches\": 76,\n##     \"weightInPounds\": 205,\n##     \"heightInCentimeters\": 193,\n##     \"weightInKilograms\": 93,\n##     \"birthDate\": \"1997-12-06\",\n##     \"birthCity\": {\n##         \"default\": \"Kitchener\"\n##     },\n##     \"birthCountry\": \"CAN\",\n##     \"birthStateProvince\": {\n##         \"default\": \"ON\"\n##     }\n## }\n##\nTo get only the data I want, I’ll (1) pass a team code into the function to call to the API with\nGET()\nand\ncontent()\n, (2) use\nflatten()\nto remove the level of forwards, defensemen, and goalies to have all the players as one nested list, (3) turn the data into a tibble of list-columns with\ntibble()\n, and (4) use the\ntidyr::hoist()\nfunction to pull only the items I want from the structure. Finally, I use\ntransmute\nto add the 3-character input to the results and to exclude the\ndata\nlist-column.\nget_roster <- function(team){\n  GET(glue::glue('https://api-web.nhle.com/v1/roster/{team}/20232024')) %>% \n  content() %>%\n  flatten() %>%\n  tibble(data = .) %>%\n  hoist('data',\n    'firstName' = list('firstName', 1L),\n    'lastName' = list('lastName', 1L),\n    'birthDate',\n    'birthCountry'\n  ) %>% \n  transmute(team = team, firstName, lastName, birthDate, birthCountry)\n}\nWithin\nhoist()\n, the construction of\nlist('firstName', 1L)\nis to avoid having to pull the “default” sub-item within firstName. This way simply grabs the value of the first element within the firstName item. Since birthDate and birthCountry have no sub-items there is no need to do that for those fields.\nFinally to get all the players from all the teams I use\npurrr::map_dfr()\nto iterate through the team codes and run my function. There is a filter to remove any items with missing firstName fields because the Team endpoint returns information for all historical teams (e.g, Atlanta Thrashers, Hartford Whalers, etc.). Since these teams are not active in 2023-2024 they return information but the fields I want don’t populate.\nall_roster <- map_dfr(teams$triCode, get_roster) %>%\n  filter(!is.na(firstName))\nNow we have a dataset of the 774 players in the NHL. This number is slightly larger than the expected number of NHL players (736 = 23 players * 32 teams) so there is likely a nuance to how a roster player is determined but it shouldn’t matter for this analysis.\nSince I only want to look at Canadian players because I have no idea if the same cut-offs that apply in Canada apply in other countries in the world. I’ll also do some data cleanup on birth months and calculate the player distribution.\ncanada_players <- all_roster %>% \n  filter(birthCountry == 'CAN') %>% \n  mutate(\n    mob = month(ymd(birthDate), label = T, abbr = F),\n    mob_id = month(ymd(birthDate))\n  ) %>% \n  count(mob_id, mob, name = \"players\") %>%\n  mutate(player_pct = players/sum(players))\nNow we have the distribution of birth months for the 314 Canadian NHL players\nSection 3: Putting it all together\nThe last section is to combine the Canada birth month data from Section 1 with the Canadian NHL player from Section 2 and make a pretty visualization.\nFirst I combining the data and create a field for the percentage of births you’d expect if every day was equally likely (ex. if January has 31 days then there is a 31/365 chance of being randomly born in January):\ncombined <- canada_players %>%\n  left_join(canada_births, by = c('mob' = 'MONTH')) %>%\n  #Put in random value\n  mutate(\n    random = case_when(\n      mob_id %in% c(4, 6, 9, 11) ~ 30/365,\n      mob_id %in% c(1, 3, 5, 7, 8, 10, 12) ~ 31/365,\n      mob_id == 2 ~ 28/365\n    )\n  )\nFor the visualization I’m going to use the\nggimage\npackage to use icons of the Canadian flag and the NHL logo. This package can render a URL so I’ll create variables for those URLs.\nNHL_ICON <- \"https://pbs.twimg.com/media/F9sTTAYakAAkRv6.png\"\nCANADA_ICON <- \"https://cdn-icons-png.flaticon.com/512/5372/5372678.png\"\nFinally, a combination of\nggplot\n,\nggtext\n, and\nggimage\nis used to create the visualization.\nggplot(combined, aes(x = fct_reorder(mob, -mob_id))) + \n  geom_line(aes(y = random, group = 1), lty = 2, color = 'grey60') + \n  geom_linerange(aes(ymin = country_pct, ymax = player_pct)) + \n  geom_image(aes(image = NHL_ICON, y = player_pct), size = .08) + \n  geom_image(aes(image = CANADA_ICON, y = country_pct), size = .07) + \n  geom_text(aes(label = percent(player_pct, accuracy = .1), \n                y = if_else(player_pct > country_pct, player_pct + .004, player_pct - .004))) + \n  geom_text(aes(label = percent(country_pct, accuracy = .1), \n                y = if_else(country_pct > player_pct, country_pct + .004, country_pct - .004))) +\n  annotate(\n    'curve',\n    xend = 2.3,\n    x = 1.5,\n    yend = .084,\n    y = .10,\n    curvature = .25,\n    arrow = arrow(\n      length = unit(7, \"pt\"),\n      type = \"closed\"\n    )) + \n  annotate(\n    'richtext',\n    x = 1,\n    y = .105,\n    label = \"The grey line is the expected % of births<br />if birth month was completely random\",\n    size = 4\n  ) + \n  scale_y_continuous(labels = percent) + \n  coord_flip() + \n  labs(x = \"Month of Birth\", y = \"Percentage of Births (%)\",\n       title = \"Are Canadian NHL Players More Likely to be Born Early in the Year?\",\n       subtitle = 'Comparing the distribution of birth months between Canadian NHL players and Canada in general ',\n       caption = glue::glue(\"<img src = {NHL_ICON} width = '15' height=' 15' /> - Canadian NHL Players Birth Month Distribution <br />\n                            <img src = {CANADA_ICON} width = '15' height=' 15' /> - Canadian Birth Month (1991-2022) Distribution\")\n       ) + \n  theme_light() +\n  theme(\n    text = element_text(family = 'Asap SemiCondensed', size = 14),\n    plot.title.position = 'plot',\n    plot.title = element_markdown(),\n    plot.caption = element_markdown()\n  )\nVisually it looks pretty clear that there are more Canadian NHL players born in January/February than expected and fewer players born in August through the end of the year. May and July are interesting but I don’t have an intuition for why more NHL players might be born in those months.\nFor a more stats-y perspective. A chi-sq test can be used to see if the distribution of the Canadian NHL players is different than Canada in general. In the following code,\nx\nis the number of Canadian NHL players born in each month and\np\nis the expected proportion based on the distribution of birth months for Canada as a whole.\nbroom::tidy(chisq.test(x = combined$players, p = combined$country_pct))\n## # A tibble: 1 × 4\n##   statistic p.value parameter method                                  \n##       <dbl>   <dbl>     <dbl> <chr>                                   \n## 1      25.6 0.00752        11 Chi-squared test for given probabilities\nThe p-value of <.01 means that we can reject the null hypothesis that they are the same distribution.\nSo it seems that Malcolm Gladwell’s thesis in Outliers still holds true in today’s NHL among Canadian players.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nR | JLaw's R Blog\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "In the first chapter Malcolm Gladwell’s Outliers he discusses how in Canadian Junior Hockey there is a higher likelihood for players to be born in the first quarter of the year. In his words: Because these kids are older within their year they make all the important teams at a young age which gets them better resources for skill development and so on. While it seems clear that more players are born in the first few months of the year, what isn’t explored is whether or not this would be expected. Maybe more people in Canada in general are born earlier in the year. I will explore whether Gladwell’s result is expected as well as whether this is still true in today’s NHL for Canadian-born players. To answer these questions I will download data on birth rates from Statistics Canada as well as player roster data from the NHL’s API. This analysis will leverage the httr package to download the data, tidyverse for data manipulation, and ggtext/ggimage/scales for visualization. library(tidyverse) library(httr) library(scales) library(ggimage) library(ggtext) Section 1: What is the distribution of births by month in Canada? Gladwell’s thesis is that you see more Canadian Junior hockey players born earlier in the year because of the way that cut-offs are set for Youth Hockey. I think that he is correct but what if most people in Canada are born in the beginning of the year. Then this might be representative of the population rather than an outlier effect. Information about births by month in Canada can be found at Statistics Canada. Initially I had tried to web-scrape the table using rvest but could not figure out a way to deal with the “Number” row. Since the data could be downloaded as a CSV file my alternative solution was to use httr to send a call to the download link to grab the file. The URL was found by using the inspect option in Firefox when clicking the download link. canada_raw % content() The GET() command sends the request to the server and the content() function returns the results. Without the content() function there is a lot of additional information about the call such as headers, request url, etc. The raw data contains many columns that are either duplicative or unnecessary for this analysis: REF_DATE GEO DGUID Month of birth Characteristics UOM UOM_ID SCALAR_FACTOR SCALAR_ID VECTOR COORDINATE VALUE STATUS SYMBOL TERMINATED DECIMALS 1991 Canada, place of residence of mother 2016A000011124 Total, month of birth Number of live births Number 223 units 0 v21400536 1.1.1 403816 NA NA NA 0 1992 Canada, place of residence of mother 2016A000011124 Total, month of birth Number of live births Number 223 units 0 v21400536 1.1.1 399109 NA NA NA 0 I pulled the data for 1991 through 2022 and each year has a total row as well as a row for each individual month. To clean up this data I filter out the total rows with str_detect(), keep only the REF_DATE for the year, extract the month using str_extract and keep the VALUE which is the actual number of births. canada_births % filter(!str_detect(`Month of birth`, 'Total')) %>% transmute( REF_DATE, MONTH = str_extract(`Month of birth`, 'Month of birth, (\\w+)', 1), VALUE ) %>% group_by(MONTH) %>% summarize(country_births = sum(VALUE)) %>% mutate(country_pct = country_births/sum(country_births)) Then the distribution can be calculated by dplyr functions. The true distribution of birth month in Canada vs. the expected distribution if every day had an equal chance is shown below: canada_births %>% transmute( `Canada %` = country_pct, `Expected % from Days in Month` = case_when( MONTH %in% c('April', 'June', 'September', 'November') ~ 30/365, MONTH == 'February' ~ 28/365, TRUE ~ 31/365, ), `Difference` = `Canada %` - `Expected % from Days in Month`, month_id = factor(MONTH, levels = c('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December')) ) %>% gather(lbl, value, -month_id) %>% spread(month_id, value) %>% mutate( lbl = factor(lbl, levels = c('Canada %', 'Expected % from Days in Month', 'Difference')), across(January:December, ~percent(.x, accuracy = .1))) %>% arrange(lbl) %>% kable(col.names = c(\"\", names(.)[-1])) January February March April May June July August September October November December Canada % 8.0% 7.5% 8.5% 8.4% 8.8% 8.5% 8.9% 8.7% 8.7% 8.4% 7.8% 7.8% Expected % from Days in Month 8.5% 7.7% 8.5% 8.2% 8.5% 8.2% 8.5% 8.5% 8.2% 8.5% 8.2% 8.5% Difference -0.5% -0.1% 0.0% 0.2% 0.3% 0.3% 0.4% 0.2% 0.5% -0.1% -0.4% -0.7% At first glance, Canadians seem less likely to be born in the beginning of the year (particularly January and February) than from random distribution. They’re also less likely to be born in the end of the year. Let’s see what the Canadian NHL players look like: Section 2: What is the difstribution of births by month for Canadian NHL players? To get the information about the NHL players I will use httr to query the NHLs API. My original version of this analysis used the nhlapi package which is on CRAN. But the NHL changed their API at some point in the last few months so that package no longer functioned. Getting the 2023-2024 team rosters can be done through the API endpoint https://api-web.nhle.com/v1/roster/{team}/20232024 where {team} is a three-character code representing an individual team. To get the rosters for each team I need to first get the codes for each team. This is going to involve a bunch of JSON manipulation which is new to me so their is probably a more elegant solution. All information on NHL teams can be retrieved from the https://api.nhle.com/stats/rest/en/team endpoint. Using the same GET() / content() set from the prior section I can get all the team information teams % content() This comes back as a list with two items, “data” which contains all the useful information and “total” which contains the number of elements returned in “data”. I just need the “data” piece. teams % .[['data']] Now “teams” is a list with 59 elements with each element containing information (id, franchiseId, fullName, legaugeId, rawTricode, triCode) about a team. teams[1:3] %>% jsonlite::toJSON(auto_unbox = T) %>% jsonlite::prettify() ## [ ## { ## \"id\": 11, ## \"franchiseId\": 35, ## \"fullName\": \"Atlanta Thrashers\", ## \"leagueId\": 133, ## \"rawTricode\": \"ATL\", ## \"triCode\": \"ATL\" ## }, ## { ## \"id\": 34, ## \"franchiseId\": 26, ## \"fullName\": \"Hartford Whalers\", ## \"leagueId\": 133, ## \"rawTricode\": \"HFD\", ## \"triCode\": \"HFD\" ## }, ## { ## \"id\": 31, ## \"franchiseId\": 15, ## \"fullName\": \"Minnesota North Stars\", ## \"leagueId\": 133, ## \"rawTricode\": \"MNS\", ## \"triCode\": \"MNS\" ## } ## ] ## Ultimately I want to restructure this set of nested lists into a rectangular format. The way I’ll do this is create a tibble of list columns using tibble() and then tidyr::unnest_wider to turn each element of a list-column into its own column. teams % tibble(data = .) %>% unnest_wider(data) Now everything is in a much more legible format: id franchiseId fullName leagueId rawTricode triCode 11 35 Atlanta Thrashers 133 ATL ATL 34 26 Hartford Whalers 133 HFD HFD 31 15 Minnesota North Stars 133 MNS MNS That was all just to get the 3-character codes needed to actually get the rosters. Since a separate call is made to the Roster endpoint for each team this is a good opportunity to create a function. Then I can use purrr::map_dfr to iterate through the team codes to combine all the rosters together. For the function, it’ll take a team code for input and extract the player’s first name, last name, birth date, and birth country. The data structure returned from the Roster endpoint is a list with elements for forwards, defensemen, and goalies, Then for each player within the data looks like: GET(glue::glue('https://api-web.nhle.com/v1/roster/NJD/20232024')) %>% content() %>% .[['forwards']] %>% .[[1]] %>% jsonlite::toJSON(auto_unbox = T, pretty = T) %>% jsonlite::prettify() ## { ## \"id\": 8479414, ## \"headshot\": \"https://assets.nhle.com/mugs/nhl/20232024/NJD/8479414.png\", ## \"firstName\": { ## \"default\": \"Nathan\" ## }, ## \"lastName\": { ## \"default\": \"Bastian\" ## }, ## \"sweaterNumber\": 14, ## \"positionCode\": \"R\", ## \"shootsCatches\": \"R\", ## \"heightInInches\": 76, ## \"weightInPounds\": 205, ## \"heightInCentimeters\": 193, ## \"weightInKilograms\": 93, ## \"birthDate\": \"1997-12-06\", ## \"birthCity\": { ## \"default\": \"Kitchener\" ## }, ## \"birthCountry\": \"CAN\", ## \"birthStateProvince\": { ## \"default\": \"ON\" ## } ## } ## To get only the data I want, I’ll (1) pass a team code into the function to call to the API with GET() and content(), (2) use flatten() to remove the level of forwards, defensemen, and goalies to have all the players as one nested list, (3) turn the data into a tibble of list-columns with tibble(), and (4) use the tidyr::hoist() function to pull only the items I want from the structure. Finally, I use transmute to add the 3-character input to the results and to exclude the data list-column. get_roster % content() %>% flatten() %>% tibble(data = .) %>% hoist('data', 'firstName' = list('firstName', 1L), 'lastName' = list('lastName', 1L), 'birthDate', 'birthCountry' ) %>% transmute(team = team, firstName, lastName, birthDate, birthCountry) } Within hoist(), the construction of list('firstName', 1L) is to avoid having to pull the “default” sub-item within firstName. This way simply grabs the value of the first element within the firstName item. Since birthDate and birthCountry have no sub-items there is no need to do that for those fields. Finally to get all the players from all the teams I use purrr::map_dfr() to iterate through the team codes and run my function. There is a filter to remove any items with missing firstName fields because the Team endpoint returns information for all historical teams (e.g, Atlanta Thrashers, Hartford Whalers, etc.). Since these teams are not active in 2023-2024 they return information but the fields I want don’t populate. all_roster % filter(!is.na(firstName)) Now we have a dataset of the 774 players in the NHL. This number is slightly larger than the expected number of NHL players (736 = 23 players * 32 teams) so there is likely a nuance to how a roster player is determined but it shouldn’t matter for this analysis. Since I only want to look at Canadian players because I have no idea if the same cut-offs that apply in Canada apply in other countries in the world. I’ll also do some data cleanup on birth months and calculate the player distribution. canada_players % filter(birthCountry == 'CAN') %>% mutate( mob = month(ymd(birthDate), label = T, abbr = F), mob_id = month(ymd(birthDate)) ) %>% count(mob_id, mob, name = \"players\") %>% mutate(player_pct = players/sum(players)) Now we have the distribution of birth months for the 314 Canadian NHL players Section 3: Putting it all together The last section is to combine the Canada birth month data from Section 1 with the Canadian NHL player from Section 2 and make a pretty visualization. First I combining the data and create a field for the percentage of births you’d expect if every day was equally likely (ex. if January has 31 days then there is a 31/365 chance of being randomly born in January): combined % left_join(canada_births, by = c('mob' = 'MONTH')) %>% #Put in random value mutate( random = case_when( mob_id %in% c(4, 6, 9, 11) ~ 30/365, mob_id %in% c(1, 3, 5, 7, 8, 10, 12) ~ 31/365, mob_id == 2 ~ 28/365 ) ) For the visualization I’m going to use the ggimage package to use icons of the Canadian flag and the NHL logo. This package can render a URL so I’ll create variables for those URLs. NHL_ICON player_pct, country_pct + .004, country_pct - .004))) + annotate( 'curve', xend = 2.3, x = 1.5, yend = .084, y = .10, curvature = .25, arrow = arrow( length = unit(7, \"pt\"), type = \"closed\" )) + annotate( 'richtext', x = 1, y = .105, label = \"The grey line is the expected % of birthsif birth month was completely random\", size = 4 ) + scale_y_continuous(labels = percent) + coord_flip() + labs(x = \"Month of Birth\", y = \"Percentage of Births (%)\", title = \"Are Canadian NHL Players More Likely to be Born Early in the Year?\", subtitle = 'Comparing the distribution of birth months between Canadian NHL players and Canada in general ', caption = glue::glue(\" - Canadian NHL Players Birth Month Distribution - Canadian Birth Month (1991-2022) Distribution\") ) + theme_light() + theme( text = element_text(family = 'Asap SemiCondensed', size = 14), plot.title.position = 'plot', plot.title = element_markdown(), plot.caption = element_markdown() ) Visually it looks pretty clear that there are more Canadian NHL players born in January/February than expected and fewer players born in August through the end of the year. May and July are interesting but I don’t have an intuition for why more NHL players might be born in those months. For a more stats-y perspective. A chi-sq test can be used to see if the distribution of the Canadian NHL players is different than Canada in general. In the following code, x is the number of Canadian NHL players born in each month and p is the expected proportion based on the distribution of birth months for Canada as a whole. broom::tidy(chisq.test(x = combined$players, p = combined$country_pct)) ## # A tibble: 1 × 4 ## statistic p.value parameter method ## ## 1 25.6 0.00752 11 Chi-squared test for given probabilities The p-value of",
    "meta_keywords": null,
    "og_description": "In the first chapter Malcolm Gladwell’s Outliers he discusses how in Canadian Junior Hockey there is a higher likelihood for players to be born in the first quarter of the year. In his words: Because these kids are older within their year they make all the important teams at a young age which gets them better resources for skill development and so on. While it seems clear that more players are born in the first few months of the year, what isn’t explored is whether or not this would be expected. Maybe more people in Canada in general are born earlier in the year. I will explore whether Gladwell’s result is expected as well as whether this is still true in today’s NHL for Canadian-born players. To answer these questions I will download data on birth rates from Statistics Canada as well as player roster data from the NHL’s API. This analysis will leverage the httr package to download the data, tidyverse for data manipulation, and ggtext/ggimage/scales for visualization. library(tidyverse) library(httr) library(scales) library(ggimage) library(ggtext) Section 1: What is the distribution of births by month in Canada? Gladwell’s thesis is that you see more Canadian Junior hockey players born earlier in the year because of the way that cut-offs are set for Youth Hockey. I think that he is correct but what if most people in Canada are born in the beginning of the year. Then this might be representative of the population rather than an outlier effect. Information about births by month in Canada can be found at Statistics Canada. Initially I had tried to web-scrape the table using rvest but could not figure out a way to deal with the “Number” row. Since the data could be downloaded as a CSV file my alternative solution was to use httr to send a call to the download link to grab the file. The URL was found by using the inspect option in Firefox when clicking the download link. canada_raw % content() The GET() command sends the request to the server and the content() function returns the results. Without the content() function there is a lot of additional information about the call such as headers, request url, etc. The raw data contains many columns that are either duplicative or unnecessary for this analysis: REF_DATE GEO DGUID Month of birth Characteristics UOM UOM_ID SCALAR_FACTOR SCALAR_ID VECTOR COORDINATE VALUE STATUS SYMBOL TERMINATED DECIMALS 1991 Canada, place of residence of mother 2016A000011124 Total, month of birth Number of live births Number 223 units 0 v21400536 1.1.1 403816 NA NA NA 0 1992 Canada, place of residence of mother 2016A000011124 Total, month of birth Number of live births Number 223 units 0 v21400536 1.1.1 399109 NA NA NA 0 I pulled the data for 1991 through 2022 and each year has a total row as well as a row for each individual month. To clean up this data I filter out the total rows with str_detect(), keep only the REF_DATE for the year, extract the month using str_extract and keep the VALUE which is the actual number of births. canada_births % filter(!str_detect(`Month of birth`, 'Total')) %>% transmute( REF_DATE, MONTH = str_extract(`Month of birth`, 'Month of birth, (\\w+)', 1), VALUE ) %>% group_by(MONTH) %>% summarize(country_births = sum(VALUE)) %>% mutate(country_pct = country_births/sum(country_births)) Then the distribution can be calculated by dplyr functions. The true distribution of birth month in Canada vs. the expected distribution if every day had an equal chance is shown below: canada_births %>% transmute( `Canada %` = country_pct, `Expected % from Days in Month` = case_when( MONTH %in% c('April', 'June', 'September', 'November') ~ 30/365, MONTH == 'February' ~ 28/365, TRUE ~ 31/365, ), `Difference` = `Canada %` - `Expected % from Days in Month`, month_id = factor(MONTH, levels = c('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December')) ) %>% gather(lbl, value, -month_id) %>% spread(month_id, value) %>% mutate( lbl = factor(lbl, levels = c('Canada %', 'Expected % from Days in Month', 'Difference')), across(January:December, ~percent(.x, accuracy = .1))) %>% arrange(lbl) %>% kable(col.names = c(\"\", names(.)[-1])) January February March April May June July August September October November December Canada % 8.0% 7.5% 8.5% 8.4% 8.8% 8.5% 8.9% 8.7% 8.7% 8.4% 7.8% 7.8% Expected % from Days in Month 8.5% 7.7% 8.5% 8.2% 8.5% 8.2% 8.5% 8.5% 8.2% 8.5% 8.2% 8.5% Difference -0.5% -0.1% 0.0% 0.2% 0.3% 0.3% 0.4% 0.2% 0.5% -0.1% -0.4% -0.7% At first glance, Canadians seem less likely to be born in the beginning of the year (particularly January and February) than from random distribution. They’re also less likely to be born in the end of the year. Let’s see what the Canadian NHL players look like: Section 2: What is the difstribution of births by month for Canadian NHL players? To get the information about the NHL players I will use httr to query the NHLs API. My original version of this analysis used the nhlapi package which is on CRAN. But the NHL changed their API at some point in the last few months so that package no longer functioned. Getting the 2023-2024 team rosters can be done through the API endpoint https://api-web.nhle.com/v1/roster/{team}/20232024 where {team} is a three-character code representing an individual team. To get the rosters for each team I need to first get the codes for each team. This is going to involve a bunch of JSON manipulation which is new to me so their is probably a more elegant solution. All information on NHL teams can be retrieved from the https://api.nhle.com/stats/rest/en/team endpoint. Using the same GET() / content() set from the prior section I can get all the team information teams % content() This comes back as a list with two items, “data” which contains all the useful information and “total” which contains the number of elements returned in “data”. I just need the “data” piece. teams % .[['data']] Now “teams” is a list with 59 elements with each element containing information (id, franchiseId, fullName, legaugeId, rawTricode, triCode) about a team. teams[1:3] %>% jsonlite::toJSON(auto_unbox = T) %>% jsonlite::prettify() ## [ ## { ## \"id\": 11, ## \"franchiseId\": 35, ## \"fullName\": \"Atlanta Thrashers\", ## \"leagueId\": 133, ## \"rawTricode\": \"ATL\", ## \"triCode\": \"ATL\" ## }, ## { ## \"id\": 34, ## \"franchiseId\": 26, ## \"fullName\": \"Hartford Whalers\", ## \"leagueId\": 133, ## \"rawTricode\": \"HFD\", ## \"triCode\": \"HFD\" ## }, ## { ## \"id\": 31, ## \"franchiseId\": 15, ## \"fullName\": \"Minnesota North Stars\", ## \"leagueId\": 133, ## \"rawTricode\": \"MNS\", ## \"triCode\": \"MNS\" ## } ## ] ## Ultimately I want to restructure this set of nested lists into a rectangular format. The way I’ll do this is create a tibble of list columns using tibble() and then tidyr::unnest_wider to turn each element of a list-column into its own column. teams % tibble(data = .) %>% unnest_wider(data) Now everything is in a much more legible format: id franchiseId fullName leagueId rawTricode triCode 11 35 Atlanta Thrashers 133 ATL ATL 34 26 Hartford Whalers 133 HFD HFD 31 15 Minnesota North Stars 133 MNS MNS That was all just to get the 3-character codes needed to actually get the rosters. Since a separate call is made to the Roster endpoint for each team this is a good opportunity to create a function. Then I can use purrr::map_dfr to iterate through the team codes to combine all the rosters together. For the function, it’ll take a team code for input and extract the player’s first name, last name, birth date, and birth country. The data structure returned from the Roster endpoint is a list with elements for forwards, defensemen, and goalies, Then for each player within the data looks like: GET(glue::glue('https://api-web.nhle.com/v1/roster/NJD/20232024')) %>% content() %>% .[['forwards']] %>% .[[1]] %>% jsonlite::toJSON(auto_unbox = T, pretty = T) %>% jsonlite::prettify() ## { ## \"id\": 8479414, ## \"headshot\": \"https://assets.nhle.com/mugs/nhl/20232024/NJD/8479414.png\", ## \"firstName\": { ## \"default\": \"Nathan\" ## }, ## \"lastName\": { ## \"default\": \"Bastian\" ## }, ## \"sweaterNumber\": 14, ## \"positionCode\": \"R\", ## \"shootsCatches\": \"R\", ## \"heightInInches\": 76, ## \"weightInPounds\": 205, ## \"heightInCentimeters\": 193, ## \"weightInKilograms\": 93, ## \"birthDate\": \"1997-12-06\", ## \"birthCity\": { ## \"default\": \"Kitchener\" ## }, ## \"birthCountry\": \"CAN\", ## \"birthStateProvince\": { ## \"default\": \"ON\" ## } ## } ## To get only the data I want, I’ll (1) pass a team code into the function to call to the API with GET() and content(), (2) use flatten() to remove the level of forwards, defensemen, and goalies to have all the players as one nested list, (3) turn the data into a tibble of list-columns with tibble(), and (4) use the tidyr::hoist() function to pull only the items I want from the structure. Finally, I use transmute to add the 3-character input to the results and to exclude the data list-column. get_roster % content() %>% flatten() %>% tibble(data = .) %>% hoist('data', 'firstName' = list('firstName', 1L), 'lastName' = list('lastName', 1L), 'birthDate', 'birthCountry' ) %>% transmute(team = team, firstName, lastName, birthDate, birthCountry) } Within hoist(), the construction of list('firstName', 1L) is to avoid having to pull the “default” sub-item within firstName. This way simply grabs the value of the first element within the firstName item. Since birthDate and birthCountry have no sub-items there is no need to do that for those fields. Finally to get all the players from all the teams I use purrr::map_dfr() to iterate through the team codes and run my function. There is a filter to remove any items with missing firstName fields because the Team endpoint returns information for all historical teams (e.g, Atlanta Thrashers, Hartford Whalers, etc.). Since these teams are not active in 2023-2024 they return information but the fields I want don’t populate. all_roster % filter(!is.na(firstName)) Now we have a dataset of the 774 players in the NHL. This number is slightly larger than the expected number of NHL players (736 = 23 players * 32 teams) so there is likely a nuance to how a roster player is determined but it shouldn’t matter for this analysis. Since I only want to look at Canadian players because I have no idea if the same cut-offs that apply in Canada apply in other countries in the world. I’ll also do some data cleanup on birth months and calculate the player distribution. canada_players % filter(birthCountry == 'CAN') %>% mutate( mob = month(ymd(birthDate), label = T, abbr = F), mob_id = month(ymd(birthDate)) ) %>% count(mob_id, mob, name = \"players\") %>% mutate(player_pct = players/sum(players)) Now we have the distribution of birth months for the 314 Canadian NHL players Section 3: Putting it all together The last section is to combine the Canada birth month data from Section 1 with the Canadian NHL player from Section 2 and make a pretty visualization. First I combining the data and create a field for the percentage of births you’d expect if every day was equally likely (ex. if January has 31 days then there is a 31/365 chance of being randomly born in January): combined % left_join(canada_births, by = c('mob' = 'MONTH')) %>% #Put in random value mutate( random = case_when( mob_id %in% c(4, 6, 9, 11) ~ 30/365, mob_id %in% c(1, 3, 5, 7, 8, 10, 12) ~ 31/365, mob_id == 2 ~ 28/365 ) ) For the visualization I’m going to use the ggimage package to use icons of the Canadian flag and the NHL logo. This package can render a URL so I’ll create variables for those URLs. NHL_ICON player_pct, country_pct + .004, country_pct - .004))) + annotate( 'curve', xend = 2.3, x = 1.5, yend = .084, y = .10, curvature = .25, arrow = arrow( length = unit(7, \"pt\"), type = \"closed\" )) + annotate( 'richtext', x = 1, y = .105, label = \"The grey line is the expected % of birthsif birth month was completely random\", size = 4 ) + scale_y_continuous(labels = percent) + coord_flip() + labs(x = \"Month of Birth\", y = \"Percentage of Births (%)\", title = \"Are Canadian NHL Players More Likely to be Born Early in the Year?\", subtitle = 'Comparing the distribution of birth months between Canadian NHL players and Canada in general ', caption = glue::glue(\" - Canadian NHL Players Birth Month Distribution - Canadian Birth Month (1991-2022) Distribution\") ) + theme_light() + theme( text = element_text(family = 'Asap SemiCondensed', size = 14), plot.title.position = 'plot', plot.title = element_markdown(), plot.caption = element_markdown() ) Visually it looks pretty clear that there are more Canadian NHL players born in January/February than expected and fewer players born in August through the end of the year. May and July are interesting but I don’t have an intuition for why more NHL players might be born in those months. For a more stats-y perspective. A chi-sq test can be used to see if the distribution of the Canadian NHL players is different than Canada in general. In the following code, x is the number of Canadian NHL players born in each month and p is the expected proportion based on the distribution of birth months for Canada as a whole. broom::tidy(chisq.test(x = combined$players, p = combined$country_pct)) ## # A tibble: 1 × 4 ## statistic p.value parameter method ## ## 1 25.6 0.00752 11 Chi-squared test for given probabilities The p-value of",
    "og_image": "https://jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/gladwell.PNG",
    "og_title": "Are Birth Dates Still Destiny for Canadian NHL Players? | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 12.8,
    "sitemap_lastmod": "2023-12-04T00:00:00+00:00",
    "twitter_description": "In the first chapter Malcolm Gladwell’s Outliers he discusses how in Canadian Junior Hockey there is a higher likelihood for players to be born in the first quarter of the year. In his words: Because these kids are older within their year they make all the important teams at a young age which gets them better resources for skill development and so on. While it seems clear that more players are born in the first few months of the year, what isn’t explored is whether or not this would be expected. Maybe more people in Canada in general are born earlier in the year. I will explore whether Gladwell’s result is expected as well as whether this is still true in today’s NHL for Canadian-born players. To answer these questions I will download data on birth rates from Statistics Canada as well as player roster data from the NHL’s API. This analysis will leverage the httr package to download the data, tidyverse for data manipulation, and ggtext/ggimage/scales for visualization. library(tidyverse) library(httr) library(scales) library(ggimage) library(ggtext) Section 1: What is the distribution of births by month in Canada? Gladwell’s thesis is that you see more Canadian Junior hockey players born earlier in the year because of the way that cut-offs are set for Youth Hockey. I think that he is correct but what if most people in Canada are born in the beginning of the year. Then this might be representative of the population rather than an outlier effect. Information about births by month in Canada can be found at Statistics Canada. Initially I had tried to web-scrape the table using rvest but could not figure out a way to deal with the “Number” row. Since the data could be downloaded as a CSV file my alternative solution was to use httr to send a call to the download link to grab the file. The URL was found by using the inspect option in Firefox when clicking the download link. canada_raw % content() The GET() command sends the request to the server and the content() function returns the results. Without the content() function there is a lot of additional information about the call such as headers, request url, etc. The raw data contains many columns that are either duplicative or unnecessary for this analysis: REF_DATE GEO DGUID Month of birth Characteristics UOM UOM_ID SCALAR_FACTOR SCALAR_ID VECTOR COORDINATE VALUE STATUS SYMBOL TERMINATED DECIMALS 1991 Canada, place of residence of mother 2016A000011124 Total, month of birth Number of live births Number 223 units 0 v21400536 1.1.1 403816 NA NA NA 0 1992 Canada, place of residence of mother 2016A000011124 Total, month of birth Number of live births Number 223 units 0 v21400536 1.1.1 399109 NA NA NA 0 I pulled the data for 1991 through 2022 and each year has a total row as well as a row for each individual month. To clean up this data I filter out the total rows with str_detect(), keep only the REF_DATE for the year, extract the month using str_extract and keep the VALUE which is the actual number of births. canada_births % filter(!str_detect(`Month of birth`, 'Total')) %>% transmute( REF_DATE, MONTH = str_extract(`Month of birth`, 'Month of birth, (\\w+)', 1), VALUE ) %>% group_by(MONTH) %>% summarize(country_births = sum(VALUE)) %>% mutate(country_pct = country_births/sum(country_births)) Then the distribution can be calculated by dplyr functions. The true distribution of birth month in Canada vs. the expected distribution if every day had an equal chance is shown below: canada_births %>% transmute( `Canada %` = country_pct, `Expected % from Days in Month` = case_when( MONTH %in% c('April', 'June', 'September', 'November') ~ 30/365, MONTH == 'February' ~ 28/365, TRUE ~ 31/365, ), `Difference` = `Canada %` - `Expected % from Days in Month`, month_id = factor(MONTH, levels = c('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December')) ) %>% gather(lbl, value, -month_id) %>% spread(month_id, value) %>% mutate( lbl = factor(lbl, levels = c('Canada %', 'Expected % from Days in Month', 'Difference')), across(January:December, ~percent(.x, accuracy = .1))) %>% arrange(lbl) %>% kable(col.names = c(\"\", names(.)[-1])) January February March April May June July August September October November December Canada % 8.0% 7.5% 8.5% 8.4% 8.8% 8.5% 8.9% 8.7% 8.7% 8.4% 7.8% 7.8% Expected % from Days in Month 8.5% 7.7% 8.5% 8.2% 8.5% 8.2% 8.5% 8.5% 8.2% 8.5% 8.2% 8.5% Difference -0.5% -0.1% 0.0% 0.2% 0.3% 0.3% 0.4% 0.2% 0.5% -0.1% -0.4% -0.7% At first glance, Canadians seem less likely to be born in the beginning of the year (particularly January and February) than from random distribution. They’re also less likely to be born in the end of the year. Let’s see what the Canadian NHL players look like: Section 2: What is the difstribution of births by month for Canadian NHL players? To get the information about the NHL players I will use httr to query the NHLs API. My original version of this analysis used the nhlapi package which is on CRAN. But the NHL changed their API at some point in the last few months so that package no longer functioned. Getting the 2023-2024 team rosters can be done through the API endpoint https://api-web.nhle.com/v1/roster/{team}/20232024 where {team} is a three-character code representing an individual team. To get the rosters for each team I need to first get the codes for each team. This is going to involve a bunch of JSON manipulation which is new to me so their is probably a more elegant solution. All information on NHL teams can be retrieved from the https://api.nhle.com/stats/rest/en/team endpoint. Using the same GET() / content() set from the prior section I can get all the team information teams % content() This comes back as a list with two items, “data” which contains all the useful information and “total” which contains the number of elements returned in “data”. I just need the “data” piece. teams % .[['data']] Now “teams” is a list with 59 elements with each element containing information (id, franchiseId, fullName, legaugeId, rawTricode, triCode) about a team. teams[1:3] %>% jsonlite::toJSON(auto_unbox = T) %>% jsonlite::prettify() ## [ ## { ## \"id\": 11, ## \"franchiseId\": 35, ## \"fullName\": \"Atlanta Thrashers\", ## \"leagueId\": 133, ## \"rawTricode\": \"ATL\", ## \"triCode\": \"ATL\" ## }, ## { ## \"id\": 34, ## \"franchiseId\": 26, ## \"fullName\": \"Hartford Whalers\", ## \"leagueId\": 133, ## \"rawTricode\": \"HFD\", ## \"triCode\": \"HFD\" ## }, ## { ## \"id\": 31, ## \"franchiseId\": 15, ## \"fullName\": \"Minnesota North Stars\", ## \"leagueId\": 133, ## \"rawTricode\": \"MNS\", ## \"triCode\": \"MNS\" ## } ## ] ## Ultimately I want to restructure this set of nested lists into a rectangular format. The way I’ll do this is create a tibble of list columns using tibble() and then tidyr::unnest_wider to turn each element of a list-column into its own column. teams % tibble(data = .) %>% unnest_wider(data) Now everything is in a much more legible format: id franchiseId fullName leagueId rawTricode triCode 11 35 Atlanta Thrashers 133 ATL ATL 34 26 Hartford Whalers 133 HFD HFD 31 15 Minnesota North Stars 133 MNS MNS That was all just to get the 3-character codes needed to actually get the rosters. Since a separate call is made to the Roster endpoint for each team this is a good opportunity to create a function. Then I can use purrr::map_dfr to iterate through the team codes to combine all the rosters together. For the function, it’ll take a team code for input and extract the player’s first name, last name, birth date, and birth country. The data structure returned from the Roster endpoint is a list with elements for forwards, defensemen, and goalies, Then for each player within the data looks like: GET(glue::glue('https://api-web.nhle.com/v1/roster/NJD/20232024')) %>% content() %>% .[['forwards']] %>% .[[1]] %>% jsonlite::toJSON(auto_unbox = T, pretty = T) %>% jsonlite::prettify() ## { ## \"id\": 8479414, ## \"headshot\": \"https://assets.nhle.com/mugs/nhl/20232024/NJD/8479414.png\", ## \"firstName\": { ## \"default\": \"Nathan\" ## }, ## \"lastName\": { ## \"default\": \"Bastian\" ## }, ## \"sweaterNumber\": 14, ## \"positionCode\": \"R\", ## \"shootsCatches\": \"R\", ## \"heightInInches\": 76, ## \"weightInPounds\": 205, ## \"heightInCentimeters\": 193, ## \"weightInKilograms\": 93, ## \"birthDate\": \"1997-12-06\", ## \"birthCity\": { ## \"default\": \"Kitchener\" ## }, ## \"birthCountry\": \"CAN\", ## \"birthStateProvince\": { ## \"default\": \"ON\" ## } ## } ## To get only the data I want, I’ll (1) pass a team code into the function to call to the API with GET() and content(), (2) use flatten() to remove the level of forwards, defensemen, and goalies to have all the players as one nested list, (3) turn the data into a tibble of list-columns with tibble(), and (4) use the tidyr::hoist() function to pull only the items I want from the structure. Finally, I use transmute to add the 3-character input to the results and to exclude the data list-column. get_roster % content() %>% flatten() %>% tibble(data = .) %>% hoist('data', 'firstName' = list('firstName', 1L), 'lastName' = list('lastName', 1L), 'birthDate', 'birthCountry' ) %>% transmute(team = team, firstName, lastName, birthDate, birthCountry) } Within hoist(), the construction of list('firstName', 1L) is to avoid having to pull the “default” sub-item within firstName. This way simply grabs the value of the first element within the firstName item. Since birthDate and birthCountry have no sub-items there is no need to do that for those fields. Finally to get all the players from all the teams I use purrr::map_dfr() to iterate through the team codes and run my function. There is a filter to remove any items with missing firstName fields because the Team endpoint returns information for all historical teams (e.g, Atlanta Thrashers, Hartford Whalers, etc.). Since these teams are not active in 2023-2024 they return information but the fields I want don’t populate. all_roster % filter(!is.na(firstName)) Now we have a dataset of the 774 players in the NHL. This number is slightly larger than the expected number of NHL players (736 = 23 players * 32 teams) so there is likely a nuance to how a roster player is determined but it shouldn’t matter for this analysis. Since I only want to look at Canadian players because I have no idea if the same cut-offs that apply in Canada apply in other countries in the world. I’ll also do some data cleanup on birth months and calculate the player distribution. canada_players % filter(birthCountry == 'CAN') %>% mutate( mob = month(ymd(birthDate), label = T, abbr = F), mob_id = month(ymd(birthDate)) ) %>% count(mob_id, mob, name = \"players\") %>% mutate(player_pct = players/sum(players)) Now we have the distribution of birth months for the 314 Canadian NHL players Section 3: Putting it all together The last section is to combine the Canada birth month data from Section 1 with the Canadian NHL player from Section 2 and make a pretty visualization. First I combining the data and create a field for the percentage of births you’d expect if every day was equally likely (ex. if January has 31 days then there is a 31/365 chance of being randomly born in January): combined % left_join(canada_births, by = c('mob' = 'MONTH')) %>% #Put in random value mutate( random = case_when( mob_id %in% c(4, 6, 9, 11) ~ 30/365, mob_id %in% c(1, 3, 5, 7, 8, 10, 12) ~ 31/365, mob_id == 2 ~ 28/365 ) ) For the visualization I’m going to use the ggimage package to use icons of the Canadian flag and the NHL logo. This package can render a URL so I’ll create variables for those URLs. NHL_ICON player_pct, country_pct + .004, country_pct - .004))) + annotate( 'curve', xend = 2.3, x = 1.5, yend = .084, y = .10, curvature = .25, arrow = arrow( length = unit(7, \"pt\"), type = \"closed\" )) + annotate( 'richtext', x = 1, y = .105, label = \"The grey line is the expected % of birthsif birth month was completely random\", size = 4 ) + scale_y_continuous(labels = percent) + coord_flip() + labs(x = \"Month of Birth\", y = \"Percentage of Births (%)\", title = \"Are Canadian NHL Players More Likely to be Born Early in the Year?\", subtitle = 'Comparing the distribution of birth months between Canadian NHL players and Canada in general ', caption = glue::glue(\" - Canadian NHL Players Birth Month Distribution - Canadian Birth Month (1991-2022) Distribution\") ) + theme_light() + theme( text = element_text(family = 'Asap SemiCondensed', size = 14), plot.title.position = 'plot', plot.title = element_markdown(), plot.caption = element_markdown() ) Visually it looks pretty clear that there are more Canadian NHL players born in January/February than expected and fewer players born in August through the end of the year. May and July are interesting but I don’t have an intuition for why more NHL players might be born in those months. For a more stats-y perspective. A chi-sq test can be used to see if the distribution of the Canadian NHL players is different than Canada in general. In the following code, x is the number of Canadian NHL players born in each month and p is the expected proportion based on the distribution of birth months for Canada as a whole. broom::tidy(chisq.test(x = combined$players, p = combined$country_pct)) ## # A tibble: 1 × 4 ## statistic p.value parameter method ## ## 1 25.6 0.00752 11 Chi-squared test for given probabilities The p-value of",
    "twitter_title": "Are Birth Dates Still Destiny for Canadian NHL Players? | R-bloggers",
    "url": "https://www.r-bloggers.com/2023/12/are-birth-dates-still-destiny-for-canadian-nhl-players/",
    "word_count": 2550
  }
}