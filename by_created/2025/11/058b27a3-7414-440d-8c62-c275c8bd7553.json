{
  "uuid": "058b27a3-7414-440d-8c62-c275c8bd7553",
  "created_at": "2025-11-17 20:41:15",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2009/02/correct-datetime-posixct-behaviour-for-r-and-kdb/",
    "crawled_at": "2025-11-17T10:44:57.463335",
    "external_links": [
      {
        "href": "http://dirk.eddelbuettel.com/blog/2009/02/03#kdbplus_datetime_patch",
        "text": "Thinking inside the box"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "http://www.kx.com",
        "text": "kdb+"
      },
      {
        "href": "http://kx.com/Developers/FREE-DOWNLOAD.php",
        "text": "free trials"
      },
      {
        "href": "https://www.r-project.org",
        "text": "R"
      },
      {
        "href": "http://cran.r-project.org",
        "text": "CRAN"
      },
      {
        "href": "http://dirk.eddelbuettel.com/code/rcpp.html",
        "text": "Rcpp package"
      },
      {
        "href": "https://www.r-project.org",
        "text": "R"
      },
      {
        "href": "http://dirk.eddelbuettel.com/blog/2009/02/03#kdbplus_datetime_patch",
        "text": "Thinking inside the box"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Correct Datetime / POSIXct behaviour for R and kdb+ | R-bloggers",
    "images": [],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/thinking-inside-the-box/",
        "text": "Thinking inside the box"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-191 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Correct Datetime / POSIXct behaviour for R and kdb+</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">February 3, 2009</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/thinking-inside-the-box/\">Thinking inside the box</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<p class=\"syndicated-attribution\"><!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"http://dirk.eddelbuettel.com/blog/2009/02/03#kdbplus_datetime_patch\"> Thinking inside the box   </a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div></p>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.0-->\nWe have started to look into <a href=\"http://www.kx.com\" rel=\"nofollow\" target=\"_blank\">kdb+</a> as a possible\nhigh-performance column-store backend. Kx offers\n<a href=\"http://kx.com/Developers/FREE-DOWNLOAD.php\" rel=\"nofollow\" target=\"_blank\">free trials</a>\n— and so I have played with\nthis for a day or two, both the general system, data loads and dumps and in particular with\nthe interface to <a href=\"https://www.r-project.org\" rel=\"nofollow\" target=\"_blank\">R</a>,\nBased on the few files (one C source with interface\ncode, one R file to access the C code, one object file to link against, one header\nfile and a simple Makefile), it took just a couple of minutes to turn this\ninto a proper <a href=\"http://cran.r-project.org\" rel=\"nofollow\" target=\"_blank\">CRAN</a>-style R\npackage.<p>\n\nAnyway, the reason for this post was that the R / kdb+ glue code works well\n… but not for datetimes. I really like to be able to pass date/time objects\n<i>natively</i> between systems as easily as, say, numbers or strings (and see\ne.g. my <a href=\"http://dirk.eddelbuettel.com/code/rcpp.html\" rel=\"nofollow\" target=\"_blank\">Rcpp package</a>\nfor doing this with R and C++) and I was a bit annoyed when the millisecond\ntimestamps didn’t move smoothly.  Turns out that the basic converter function in the\ncode had a number of problems: it converted to integer, only covered a\nsingle scalar rather than vectorised mode, and erroneously reduced a\nreference count.  A better version, in my view, is as follows:\n\n<blockquote>\n<pre>\nstatic SEXP from_datetime_kobject(K x) \n{\n\tSEXP result;\n\tint i, length = x-&gt;n;\n\tif (scalar(x)) {\n\t\tresult = PROTECT(allocVector(REALSXP, 1));\n\t\tREAL(result)[0] = (kF(x)[0] + 10957) * 86400;\n\t} else {\n\t\tresult = PROTECT(allocVector(REALSXP, length));\n\t\tfor(i = 0; i &lt; length; i++) {\n\t\t    \tREAL(result)[i] = (kF(x)[i] + 10957) * 86400;\n\t\t}\n\t}\n\tSEXP datetimeclass = PROTECT(allocVector(STRSXP,2));\n\tSET_STRING_ELT(datetimeclass, 0, mkChar(\"POSIXt\"));\n\tSET_STRING_ELT(datetimeclass, 1, mkChar(\"POSIXct\"));\n\tsetAttrib(result, R_ClassSymbol, datetimeclass);\n\tUNPROTECT(2); \n        return result; \n}\n</pre>\n</blockquote>\n\nThis deals with vectors as well as scalars, converts Kdb's 'fractional days\nsince Jan 1, 2000' to the Unix standard of seconds since the epoch --\nincluding the R extension of fractional seconds -- and as importantly, sets\nthe class attributes to <code>POSIXt POSIXct</code> as needed by R.  With\nthat, a simple <code>select max datetime from table</code> does just that,\nand vectors of timestamped records of trades or quotes or whatever also\ncome with proper <code>POSIXct</code> behaviour into <a href=\"https://www.r-project.org\" rel=\"nofollow\" target=\"_blank\">R</a>. Note that it needs TZ to be set to UTC, though,\nor you get a timezone offset you may not want.\r\n\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.0-->\n<p class=\"syndicated-attribution\"><div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"http://dirk.eddelbuettel.com/blog/2009/02/03#kdbplus_datetime_patch\"> Thinking inside the box   </a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div></p> </p></div>\n</article>",
    "main_text": "Correct Datetime / POSIXct behaviour for R and kdb+\nPosted on\nFebruary 3, 2009\nby\nThinking inside the box\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nThinking inside the box\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nWe have started to look into\nkdb+\nas a possible\nhigh-performance column-store backend. Kx offers\nfree trials\n— and so I have played with\nthis for a day or two, both the general system, data loads and dumps and in particular with\nthe interface to\nR\n,\nBased on the few files (one C source with interface\ncode, one R file to access the C code, one object file to link against, one header\nfile and a simple Makefile), it took just a couple of minutes to turn this\ninto a proper\nCRAN\n-style R\npackage.\nAnyway, the reason for this post was that the R / kdb+ glue code works well\n… but not for datetimes. I really like to be able to pass date/time objects\nnatively\nbetween systems as easily as, say, numbers or strings (and see\ne.g. my\nRcpp package\nfor doing this with R and C++) and I was a bit annoyed when the millisecond\ntimestamps didn’t move smoothly.  Turns out that the basic converter function in the\ncode had a number of problems: it converted to integer, only covered a\nsingle scalar rather than vectorised mode, and erroneously reduced a\nreference count.  A better version, in my view, is as follows:\nstatic SEXP from_datetime_kobject(K x) \n{\n\tSEXP result;\n\tint i, length = x->n;\n\tif (scalar(x)) {\n\t\tresult = PROTECT(allocVector(REALSXP, 1));\n\t\tREAL(result)[0] = (kF(x)[0] + 10957) * 86400;\n\t} else {\n\t\tresult = PROTECT(allocVector(REALSXP, length));\n\t\tfor(i = 0; i < length; i++) {\n\t\t    \tREAL(result)[i] = (kF(x)[i] + 10957) * 86400;\n\t\t}\n\t}\n\tSEXP datetimeclass = PROTECT(allocVector(STRSXP,2));\n\tSET_STRING_ELT(datetimeclass, 0, mkChar(\"POSIXt\"));\n\tSET_STRING_ELT(datetimeclass, 1, mkChar(\"POSIXct\"));\n\tsetAttrib(result, R_ClassSymbol, datetimeclass);\n\tUNPROTECT(2); \n        return result; \n}\nThis deals with vectors as well as scalars, converts Kdb's 'fractional days\nsince Jan 1, 2000' to the Unix standard of seconds since the epoch --\nincluding the R extension of fractional seconds -- and as importantly, sets\nthe class attributes to\nPOSIXt POSIXct\nas needed by R.  With\nthat, a simple\nselect max datetime from table\ndoes just that,\nand vectors of timestamped records of trades or quotes or whatever also\ncome with proper\nPOSIXct\nbehaviour into\nR\n. Note that it needs TZ to be set to UTC, though,\nor you get a timezone offset you may not want.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nThinking inside the box\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "We have started to look into kdb+ as a possible high-performance column-store backend. Kx offers free trials -- and so I have played with this for a day or two, both the general system, data loads and dumps and in particular with the interface to R, Based on the few files (one C source with interface code, one R file to access the C code, one object file to link against, one header file and a simple Makefile), it took just a couple of minutes to turn this into a proper CRAN-style R package. Anyway, the reason for this post was that the R / kdb+ glue code works well ... but not for datetimes. I really like to be able to pass date/time objects natively between systems as easily as, say, numbers or strings (and see e.g. my Rcpp package for doing this with R and C++) and I was a bit annoyed when the millisecond timestamps didn't move smoothly. Turns out that the basic converter function in the code had a number of problems: it converted to integer, only covered a single scalar rather than vectorised mode, and erroneously reduced a reference count. A better version, in my view, is as follows: static SEXP from_datetime_kobject(K x) { SEXP result; int i, length = x->n; if (scalar(x)) { result = PROTECT(allocVector(REALSXP, 1)); REAL(result)[0] = (kF(x)[0] + 10957) * 86400; } else { result = PROTECT(allocVector(REALSXP, length)); for(i = 0; i < length; i++) { REAL(result)[i] = (kF(x)[i] + 10957) * 86400; } } SEXP datetimeclass = PROTECT(allocVector(STRSXP,2)); SET_STRING_ELT(datetimeclass, 0, mkChar(\"POSIXt\")); SET_STRING_ELT(datetimeclass, 1, mkChar(\"POSIXct\")); setAttrib(result, R_ClassSymbol, datetimeclass); UNPROTECT(2); return result; } This deals with vectors as well as scalars, converts Kdb's 'fractional days since Jan 1, 2000' to the Unix standard of seconds since the epoch -- including the R extension of fractional seconds -- and as importantly, sets the class attributes to POSIXt POSIXct as needed by R. With that, a simple select max datetime from table does just that, and vectors of timestamped records of trades or quotes or whatever also come with proper POSIXct behaviour into R. Note that it needs TZ to be set to UTC, though, or you get a timezone offset you may not want.",
    "meta_keywords": null,
    "og_description": "We have started to look into kdb+ as a possible high-performance column-store backend. Kx offers free trials -- and so I have played with this for a day or two, both the general system, data loads and dumps and in particular with the interface to R, Based on the few files (one C source with interface code, one R file to access the C code, one object file to link against, one header file and a simple Makefile), it took just a couple of minutes to turn this into a proper CRAN-style R package. Anyway, the reason for this post was that the R / kdb+ glue code works well ... but not for datetimes. I really like to be able to pass date/time objects natively between systems as easily as, say, numbers or strings (and see e.g. my Rcpp package for doing this with R and C++) and I was a bit annoyed when the millisecond timestamps didn't move smoothly. Turns out that the basic converter function in the code had a number of problems: it converted to integer, only covered a single scalar rather than vectorised mode, and erroneously reduced a reference count. A better version, in my view, is as follows: static SEXP from_datetime_kobject(K x) { SEXP result; int i, length = x->n; if (scalar(x)) { result = PROTECT(allocVector(REALSXP, 1)); REAL(result)[0] = (kF(x)[0] + 10957) * 86400; } else { result = PROTECT(allocVector(REALSXP, length)); for(i = 0; i < length; i++) { REAL(result)[i] = (kF(x)[i] + 10957) * 86400; } } SEXP datetimeclass = PROTECT(allocVector(STRSXP,2)); SET_STRING_ELT(datetimeclass, 0, mkChar(\"POSIXt\")); SET_STRING_ELT(datetimeclass, 1, mkChar(\"POSIXct\")); setAttrib(result, R_ClassSymbol, datetimeclass); UNPROTECT(2); return result; } This deals with vectors as well as scalars, converts Kdb's 'fractional days since Jan 1, 2000' to the Unix standard of seconds since the epoch -- including the R extension of fractional seconds -- and as importantly, sets the class attributes to POSIXt POSIXct as needed by R. With that, a simple select max datetime from table does just that, and vectors of timestamped records of trades or quotes or whatever also come with proper POSIXct behaviour into R. Note that it needs TZ to be set to UTC, though, or you get a timezone offset you may not want.",
    "og_image": "https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png",
    "og_title": "Correct Datetime / POSIXct behaviour for R and kdb+ | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 2.6,
    "sitemap_lastmod": "2009-02-04T02:36:00+00:00",
    "twitter_description": "We have started to look into kdb+ as a possible high-performance column-store backend. Kx offers free trials -- and so I have played with this for a day or two, both the general system, data loads and dumps and in particular with the interface to R, Based on the few files (one C source with interface code, one R file to access the C code, one object file to link against, one header file and a simple Makefile), it took just a couple of minutes to turn this into a proper CRAN-style R package. Anyway, the reason for this post was that the R / kdb+ glue code works well ... but not for datetimes. I really like to be able to pass date/time objects natively between systems as easily as, say, numbers or strings (and see e.g. my Rcpp package for doing this with R and C++) and I was a bit annoyed when the millisecond timestamps didn't move smoothly. Turns out that the basic converter function in the code had a number of problems: it converted to integer, only covered a single scalar rather than vectorised mode, and erroneously reduced a reference count. A better version, in my view, is as follows: static SEXP from_datetime_kobject(K x) { SEXP result; int i, length = x->n; if (scalar(x)) { result = PROTECT(allocVector(REALSXP, 1)); REAL(result)[0] = (kF(x)[0] + 10957) * 86400; } else { result = PROTECT(allocVector(REALSXP, length)); for(i = 0; i < length; i++) { REAL(result)[i] = (kF(x)[i] + 10957) * 86400; } } SEXP datetimeclass = PROTECT(allocVector(STRSXP,2)); SET_STRING_ELT(datetimeclass, 0, mkChar(\"POSIXt\")); SET_STRING_ELT(datetimeclass, 1, mkChar(\"POSIXct\")); setAttrib(result, R_ClassSymbol, datetimeclass); UNPROTECT(2); return result; } This deals with vectors as well as scalars, converts Kdb's 'fractional days since Jan 1, 2000' to the Unix standard of seconds since the epoch -- including the R extension of fractional seconds -- and as importantly, sets the class attributes to POSIXt POSIXct as needed by R. With that, a simple select max datetime from table does just that, and vectors of timestamped records of trades or quotes or whatever also come with proper POSIXct behaviour into R. Note that it needs TZ to be set to UTC, though, or you get a timezone offset you may not want.",
    "twitter_title": "Correct Datetime / POSIXct behaviour for R and kdb+ | R-bloggers",
    "url": "https://www.r-bloggers.com/2009/02/correct-datetime-posixct-behaviour-for-r-and-kdb/",
    "word_count": 526
  }
}