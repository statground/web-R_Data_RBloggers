{
  "id": "92c0976b1d425ef00f70e48b1a115f946805572d",
  "url": "https://www.r-bloggers.com/2023/11/grouped-sequences-in-dplyr/",
  "created_at_utc": "2025-11-17T20:39:23Z",
  "data": null,
  "raw_original": {
    "uuid": "391ae27e-72cb-4e69-9660-ce7c118aae9f",
    "created_at": "2025-11-17 20:39:23",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2023/11/grouped-sequences-in-dplyr/",
      "crawled_at": "2025-11-17T10:00:31.363359",
      "external_links": [
        {
          "href": "https://alan-y.netlify.com/post/2023-11-05-grouped-sequences-in-dplyr/",
          "text": "R on Alan Yeung"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://alan-y.netlify.com/post/2023-11-05-grouped-sequences-in-dplyr/",
          "text": "R on Alan Yeung"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Grouped Sequences in dplyr | R-bloggers",
      "images": [],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/r-on-alan-yeung/",
          "text": "R on Alan Yeung"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-379698 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Grouped Sequences in dplyr</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">November 4, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/r-on-alan-yeung/\">R on Alan Yeung</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://alan-y.netlify.com/post/2023-11-05-grouped-sequences-in-dplyr/\"> R on Alan Yeung</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<p>For a piece of work I had to calculate the number of matches that a team plays away from home in a row, which we will call <code>days_on_the_road</code>. I was not sure how to do this with <code>dplyr</code> but it’s basically a ‘grouped sequence’. For this post, I’ve created some dummy data to illustrate this idea. The <code>num_matches_away</code> variable is what we want to mimic using some data manipulation.</p>\n<pre>library(tidyverse)\n\nsports_df &lt;- tibble::tribble(\n  ~team,    ~date,        ~home_or_away, ~num_matches_away,\n  \"Team A\", \"07/10/2022\", \"H\",           0L,\n  \"Team A\", \"14/10/2022\", \"A\",           1L,\n  \"Team A\", \"21/10/2022\", \"A\",           2L,\n  \"Team A\", \"28/10/2022\", \"H\",           0L,\n  \"Team A\", \"04/11/2022\", \"A\",           1L,\n  \"Team A\", \"11/11/2022\", \"A\",           2L,\n  \"Team A\", \"18/11/2022\", \"A\",           3L,\n  \"Team A\", \"25/11/2022\", \"H\",           0L,\n  \"Team A\", \"02/12/2022\", \"H\",           0L,\n  \"Team A\", \"09/12/2022\", \"H\",           0L,\n  \"Team B\", \"07/10/2022\", \"H\",           0L,\n  \"Team B\", \"14/10/2022\", \"A\",           1L,\n  \"Team B\", \"21/10/2022\", \"A\",           2L,\n  \"Team B\", \"28/10/2022\", \"A\",           3L,\n  \"Team B\", \"04/11/2022\", \"H\",           0L,\n  \"Team B\", \"11/11/2022\", \"A\",           1L,\n  \"Team B\", \"18/11/2022\", \"A\",           2L,\n  \"Team B\", \"25/11/2022\", \"H\",           0L,\n  \"Team B\", \"02/12/2022\", \"H\",           0L,\n  \"Team B\", \"09/12/2022\", \"A\",           1L\n) %&gt;%      \n  mutate(date = as.Date(date, \"%d/%m/%Y\")) %&gt;% \n  arrange(team, date)\n\nsports_df\r\n## # A tibble: 20 × 4\n##    team   date       home_or_away num_matches_away\n##    &lt;chr&gt;  &lt;date&gt;     &lt;chr&gt;                   &lt;int&gt;\n##  1 Team A 2022-10-07 H                           0\n##  2 Team A 2022-10-14 A                           1\n##  3 Team A 2022-10-21 A                           2\n##  4 Team A 2022-10-28 H                           0\n##  5 Team A 2022-11-04 A                           1\n##  6 Team A 2022-11-11 A                           2\n##  7 Team A 2022-11-18 A                           3\n##  8 Team A 2022-11-25 H                           0\n##  9 Team A 2022-12-02 H                           0\n## 10 Team A 2022-12-09 H                           0\n## 11 Team B 2022-10-07 H                           0\n## 12 Team B 2022-10-14 A                           1\n## 13 Team B 2022-10-21 A                           2\n## 14 Team B 2022-10-28 A                           3\n## 15 Team B 2022-11-04 H                           0\n## 16 Team B 2022-11-11 A                           1\n## 17 Team B 2022-11-18 A                           2\n## 18 Team B 2022-11-25 H                           0\n## 19 Team B 2022-12-02 H                           0\n## 20 Team B 2022-12-09 A                           1</pre>\n<p>I firstly came up with a complicated solution for this using a combination of <code>slider::slide()</code> and <code>rle()</code> (run length encoding).</p>\n<pre>sports_df2 &lt;- sports_df %&gt;% \n  group_by(team) %&gt;% \n  mutate(days_on_road = unlist(slider::slide(rle(home_or_away)$length, ~1:.x)),\n         days_on_road = if_else(home_or_away == \"H\", 0L, days_on_road)) %&gt;% \n  ungroup()\n\nidentical(sports_df2$days_on_road, sports_df$num_matches_away)\r\n## [1] TRUE</pre>\n<p>These are some pretty cool functions and it was nice to know <code>rle()</code> existed but I was never really happy with this solution as it seemed overly complex and it’s difficult to understand what the code is doing by simply reading it. So I asked a colleague to try to solve this problem and they came up with a better solution which I’m grateful for! It involves using a combination of <code>group_by()</code> and <code>seq_len()</code> which is a whole lot simpler to understand in my opinion.</p>\n<pre>sports_df3 &lt;- sports_df2 %&gt;%\n  mutate(away = cumsum(home_or_away == \"H\")) %&gt;%\n  group_by(team, home_or_away, away) %&gt;%\n  mutate(days_on_road = seq_len(n())) %&gt;%\n  ungroup() %&gt;%\n  mutate(days_on_road = if_else(home_or_away == \"H\", 0L, days_on_road))\n\nidentical(sports_df3$days_on_road, sports_df$num_matches_away)\r\n## [1] TRUE</pre>\n<p>I hope this is useful for some of you out there coding with R!</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://alan-y.netlify.com/post/2023-11-05-grouped-sequences-in-dplyr/\"> R on Alan Yeung</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
      "main_text": "Grouped Sequences in dplyr\nPosted on\nNovember 4, 2023\nby\nR on Alan Yeung\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nR on Alan Yeung\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nFor a piece of work I had to calculate the number of matches that a team plays away from home in a row, which we will call\ndays_on_the_road\n. I was not sure how to do this with\ndplyr\nbut it’s basically a ‘grouped sequence’. For this post, I’ve created some dummy data to illustrate this idea. The\nnum_matches_away\nvariable is what we want to mimic using some data manipulation.\nlibrary(tidyverse)\n\nsports_df <- tibble::tribble(\n  ~team,    ~date,        ~home_or_away, ~num_matches_away,\n  \"Team A\", \"07/10/2022\", \"H\",           0L,\n  \"Team A\", \"14/10/2022\", \"A\",           1L,\n  \"Team A\", \"21/10/2022\", \"A\",           2L,\n  \"Team A\", \"28/10/2022\", \"H\",           0L,\n  \"Team A\", \"04/11/2022\", \"A\",           1L,\n  \"Team A\", \"11/11/2022\", \"A\",           2L,\n  \"Team A\", \"18/11/2022\", \"A\",           3L,\n  \"Team A\", \"25/11/2022\", \"H\",           0L,\n  \"Team A\", \"02/12/2022\", \"H\",           0L,\n  \"Team A\", \"09/12/2022\", \"H\",           0L,\n  \"Team B\", \"07/10/2022\", \"H\",           0L,\n  \"Team B\", \"14/10/2022\", \"A\",           1L,\n  \"Team B\", \"21/10/2022\", \"A\",           2L,\n  \"Team B\", \"28/10/2022\", \"A\",           3L,\n  \"Team B\", \"04/11/2022\", \"H\",           0L,\n  \"Team B\", \"11/11/2022\", \"A\",           1L,\n  \"Team B\", \"18/11/2022\", \"A\",           2L,\n  \"Team B\", \"25/11/2022\", \"H\",           0L,\n  \"Team B\", \"02/12/2022\", \"H\",           0L,\n  \"Team B\", \"09/12/2022\", \"A\",           1L\n) %>%      \n  mutate(date = as.Date(date, \"%d/%m/%Y\")) %>% \n  arrange(team, date)\n\nsports_df\n## # A tibble: 20 × 4\n##    team   date       home_or_away num_matches_away\n##    <chr>  <date>     <chr>                   <int>\n##  1 Team A 2022-10-07 H                           0\n##  2 Team A 2022-10-14 A                           1\n##  3 Team A 2022-10-21 A                           2\n##  4 Team A 2022-10-28 H                           0\n##  5 Team A 2022-11-04 A                           1\n##  6 Team A 2022-11-11 A                           2\n##  7 Team A 2022-11-18 A                           3\n##  8 Team A 2022-11-25 H                           0\n##  9 Team A 2022-12-02 H                           0\n## 10 Team A 2022-12-09 H                           0\n## 11 Team B 2022-10-07 H                           0\n## 12 Team B 2022-10-14 A                           1\n## 13 Team B 2022-10-21 A                           2\n## 14 Team B 2022-10-28 A                           3\n## 15 Team B 2022-11-04 H                           0\n## 16 Team B 2022-11-11 A                           1\n## 17 Team B 2022-11-18 A                           2\n## 18 Team B 2022-11-25 H                           0\n## 19 Team B 2022-12-02 H                           0\n## 20 Team B 2022-12-09 A                           1\nI firstly came up with a complicated solution for this using a combination of\nslider::slide()\nand\nrle()\n(run length encoding).\nsports_df2 <- sports_df %>% \n  group_by(team) %>% \n  mutate(days_on_road = unlist(slider::slide(rle(home_or_away)$length, ~1:.x)),\n         days_on_road = if_else(home_or_away == \"H\", 0L, days_on_road)) %>% \n  ungroup()\n\nidentical(sports_df2$days_on_road, sports_df$num_matches_away)\n## [1] TRUE\nThese are some pretty cool functions and it was nice to know\nrle()\nexisted but I was never really happy with this solution as it seemed overly complex and it’s difficult to understand what the code is doing by simply reading it. So I asked a colleague to try to solve this problem and they came up with a better solution which I’m grateful for! It involves using a combination of\ngroup_by()\nand\nseq_len()\nwhich is a whole lot simpler to understand in my opinion.\nsports_df3 <- sports_df2 %>%\n  mutate(away = cumsum(home_or_away == \"H\")) %>%\n  group_by(team, home_or_away, away) %>%\n  mutate(days_on_road = seq_len(n())) %>%\n  ungroup() %>%\n  mutate(days_on_road = if_else(home_or_away == \"H\", 0L, days_on_road))\n\nidentical(sports_df3$days_on_road, sports_df$num_matches_away)\n## [1] TRUE\nI hope this is useful for some of you out there coding with R!\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nR on Alan Yeung\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "For a piece of work I had to calculate the number of matches that a team plays away from home in a row, which we will call days_on_the_road. I was not sure how to do this with dplyr but it’s basically a ‘grouped sequence’. For this post, I’ve create...",
      "meta_keywords": null,
      "og_description": "For a piece of work I had to calculate the number of matches that a team plays away from home in a row, which we will call days_on_the_road. I was not sure how to do this with dplyr but it’s basically a ‘grouped sequence’. For this post, I’ve create...",
      "og_image": "https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png",
      "og_title": "Grouped Sequences in dplyr | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 3.6,
      "sitemap_lastmod": "2023-11-05T00:00:00+00:00",
      "twitter_description": "For a piece of work I had to calculate the number of matches that a team plays away from home in a row, which we will call days_on_the_road. I was not sure how to do this with dplyr but it’s basically a ‘grouped sequence’. For this post, I’ve create...",
      "twitter_title": "Grouped Sequences in dplyr | R-bloggers",
      "url": "https://www.r-bloggers.com/2023/11/grouped-sequences-in-dplyr/",
      "word_count": 728
    }
  }
}