{
  "uuid": "c3d00c1f-d396-4256-9938-d52da034baae",
  "created_at": "2025-11-17 20:40:49",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2009/06/open-source-campaign-finance-analysis-with-r-and-mysql/",
    "crawled_at": "2025-11-17T10:35:15.534645",
    "external_links": [
      {
        "href": "http://offensivepolitics.net/blog/?p=52",
        "text": "Offensive Politics » R"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "http://offensivepolitics.net/blog/?p=26",
        "text": "Part 1"
      },
      {
        "href": "http://offensivepolitics.net/fechell",
        "text": "fechell"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "http://www.mplayerhq.hu/design7/news.html",
        "text": "MEncoder"
      },
      {
        "href": "http://dev.mysql.com/downloads/mysql/5.1.html#downloads",
        "text": "download"
      },
      {
        "href": "http://dev.mysql.com/doc/refman/5.1/en/installing.html",
        "text": "MySQL 5.1 Reference Manual"
      },
      {
        "href": "http://dev.mysql.com/doc/refman/5.1/en/user-account-management.html",
        "text": "Section 5.5 (MySQL User Account Management)"
      },
      {
        "href": "http://offensivepolitics.net/blog/?p=52#resources",
        "text": "Resources"
      },
      {
        "href": "http://offensivepolitics.net/blog/?p=52#resources",
        "text": "Resources"
      },
      {
        "href": "http://offensivepolitics.net/blog/?p=52#resources",
        "text": "Resources"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "http://cran.r-project.org/mirrors.html",
        "text": "the R mirrors list"
      },
      {
        "href": "http://cran.r-project.org/faqs.html",
        "text": "R Frequently Asked Questions"
      },
      {
        "href": "http://wiki.r-project.org/rwiki/doku.php",
        "text": "R Wiki"
      },
      {
        "href": "http://wiki.r-project.org/rwiki/doku.php?id=getting-started:installation:packages",
        "text": "How do I install a package?"
      },
      {
        "href": "http://offensivepolitics.net/blog/?p=52#references",
        "text": "References"
      },
      {
        "href": "http://www.mplayerhq.hu/",
        "text": "MPlayer/MEncoder"
      },
      {
        "href": "http://www.mplayerhq.hu/design7/dload.html",
        "text": "MPlayer download page"
      },
      {
        "href": "http://www.jeremychapman.info/cms/mencoder-%3Cbr",
        "text": "avi-to-flv-conversion\">http://jeremychaman.info/"
      },
      {
        "href": "http://www.census.gov/geo/www/cob/z52000.html",
        "text": "ZIP boundaries"
      },
      {
        "href": "https://www.google.com/ig/directory?url=www.google.com/ig/modules/motionchart.xml",
        "text": "Google Motion Chart Gadget"
      },
      {
        "href": "https://www.google.com/ig/directory?url=www.google.com/ig/modules/time-series-line.xml",
        "text": "Animated Timeline"
      },
      {
        "href": "https://en.wikipedia.org/wiki/A_More_Perfect_Union_(speech)",
        "text": "More Perfect Union speech"
      },
      {
        "href": "https://en.wikipedia.org/wiki/Super_Tuesday#Democrats",
        "text": "Super Tuesday"
      },
      {
        "href": "http://www.ruby-lang.org/",
        "text": "Ruby"
      },
      {
        "href": "http://offensivepolitics.net/fechell",
        "text": "fechell"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "http://www.mysql.com",
        "text": "MySQL"
      },
      {
        "href": "http://offensivepolitics.net/assets/create-transactions.sql",
        "text": "Database creation script"
      },
      {
        "href": "http://offensivepolitics.net/assets/create-transactions_summary_weekly.sql",
        "text": "Database population script"
      },
      {
        "href": "http://offensivepolitics.net/assets/draw.R",
        "text": "R script to draw images draw.R"
      },
      {
        "href": "http://offensivepolitics.net/assets/output.flv",
        "text": "FLV file"
      },
      {
        "href": "http://offensivepolitics.net/blog/?p=26",
        "text": "Part 1"
      },
      {
        "href": "http://offensivepolitics.net/blog/?p=52",
        "text": "Offensive Politics » R"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "open-source campaign finance analysis with R and MySQL | R-bloggers",
    "images": [
      {
        "alt": "Obama for America itemized fundraising, 2008-30.",
        "base64": null,
        "src": "https://i0.wp.com/www.r-bloggers.com/wp-content/uploads/2009/06/o4a_2008_30-300x2251.png?resize=300%2C225&ssl=1"
      },
      {
        "alt": "Obama for America itemized fundraising, 2008-30.",
        "base64": null,
        "src": "https://i0.wp.com/www.r-bloggers.com/wp-content/uploads/2009/06/o4a_2008_30-300x2251.png?resize=300%2C225&ssl=1"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/jjh/",
        "text": "jjh"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/wp-content/uploads/2009/06/zips1.zip",
        "text": "Zip codes"
      },
      {
        "href": "https://www.r-bloggers.com/wp-content/uploads/2009/06/obama-F3P-SA-2007-20081.zip",
        "text": "CSV extract"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/tag/campaign-finance/",
        "text": "Campaign Finance"
      },
      {
        "href": "https://www.r-bloggers.com/tag/fec/",
        "text": "FEC"
      },
      {
        "href": "https://www.r-bloggers.com/tag/fechell/",
        "text": "fechell"
      },
      {
        "href": "https://www.r-bloggers.com/tag/open-source/",
        "text": "open source"
      },
      {
        "href": "https://www.r-bloggers.com/tag/r/",
        "text": "R"
      },
      {
        "href": "https://www.r-bloggers.com/tag/uncategorized/",
        "text": "Uncategorized"
      },
      {
        "href": "https://www.r-bloggers.com/tag/visualization/",
        "text": "visualization"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-4736 post type-post status-publish format-standard hentry category-r-bloggers tag-campaign-finance tag-fec tag-fechell tag-open-source tag-r tag-uncategorized tag-visualization\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">open-source campaign finance analysis with R and MySQL</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">June 18, 2009</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/jjh/\">jjh</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<p class=\"syndicated-attribution\"><!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"http://offensivepolitics.net/blog/?p=52\"> Offensive Politics » R</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div></p>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.0--><h2>Introduction</h2>\n<p>In <a href=\"http://offensivepolitics.net/blog/?p=26\" rel=\"nofollow\" target=\"_blank\">Part 1</a> of this tutorial we introduced the <strong><a href=\"http://offensivepolitics.net/fechell\" rel=\"nofollow\" target=\"_blank\">fechell</a></strong> library by extracting all itemized contributions from individuals made to the <em>Obama For America</em> campaign in 2007 and 2008. In Part 2 of the tutorial we will summarize that data set by importing it into a MySQL database and aggregating contributions by week and zip code. Next we’ll visualize the contribution data amounts on a map, week by week. Below is a sample image: </p>\n<p><img alt=\"Obama for America itemized fundraising, 2008-30.\" class=\"aligncenter size-medium wp-image-91 jetpack-lazy-image\" data-lazy-src=\"https://i0.wp.com/www.r-bloggers.com/wp-content/uploads/2009/06/o4a_2008_30-300x2251.png?resize=300%2C225&amp;is-pending-load=1#038;ssl=1\" data-recalc-dims=\"1\" height=\"225\" loading=\"lazy\" src=\"https://i0.wp.com/www.r-bloggers.com/wp-content/uploads/2009/06/o4a_2008_30-300x2251.png?resize=300%2C225&amp;ssl=1\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" title=\"Obama for America itemized fundraising, 2008-30.\" width=\"300\"/><noscript><img alt=\"Obama for America itemized fundraising, 2008-30.\" class=\"aligncenter size-medium wp-image-91\" data-recalc-dims=\"1\" height=\"225\" loading=\"lazy\" src=\"https://i0.wp.com/www.r-bloggers.com/wp-content/uploads/2009/06/o4a_2008_30-300x2251.png?resize=300%2C225&amp;ssl=1\" title=\"Obama for America itemized fundraising, 2008-30.\" width=\"300\"/></noscript></p>\n<p>This visualization contains two separate measures: the top portion is a map of the continental US, marked with a dot at the geographic center of every zip code that had individuals who made contributions to <em>Obama for America</em>. The dot is colored according to how much money in total was raised from that zip code since the 2nd week of 2007, with the colors going from a dark blue to bright red indicating amounts. The second measure is a vertical bar plot showing how much money was raised, per week, from all zip codes combined. The current week is highlighted and annotated with the amount raised for that week. Taken together these measures can show us where the first monetary support for the <em>Obama for America</em> campaign came from and how it progressed geographically and in volume. We will use the free <a href=\"https://www.r-project.org/\" rel=\"nofollow\" target=\"_blank\">R</a> statistics and visualization package to producing the weekly image we shown above. Looking at still images week by week is informative but not very exciting. After all the images are created we’ll use <a href=\"http://www.mplayerhq.hu/design7/news.html\" rel=\"nofollow\" target=\"_blank\">MEncoder</a> to string together the images into a movie to demonstrate the growth of individual financial support pledged to <em>Obama for America</em>.</p>\n<h2>Installing the database</h2>\n<p>To follow along with this exercise you will need to <a href=\"http://dev.mysql.com/downloads/mysql/5.1.html#downloads\" rel=\"nofollow\" target=\"_blank\">download</a> MySQL 5.1 for your platform. English instructions for installation are available in the <a href=\"http://dev.mysql.com/doc/refman/5.1/en/installing.html\" rel=\"nofollow\" target=\"_blank\">MySQL 5.1 Reference Manual</a>. After installation you will also need to create a database user and grant rights to create databases, create indexes and perform <b>LOAD DATA LOCAL</b> functions. All of these administration tasks are covered in the MySQL 5.1 Reference Manual <a href=\"http://dev.mysql.com/doc/refman/5.1/en/user-account-management.html\" rel=\"nofollow\" target=\"_blank\">Section 5.5 (MySQL User Account Management)</a>. Keep the user name and password of the account you created handy as we’ll use it in the next few steps to access the database. </p>\n<h2>Creating the database</h2>\n<p>We will be using two different tables to represent the itemized individual contributions: the <b>transactions</b> table will hold all 2.8 million transaction values, and the <b>transactions_summary_weekly</b> table will hold the sum of all contributions for every combination of year, week, and 5 digit zip code that exists in the data. </p>\n<p>To populate these tables, download and save the transaction table creation script <b>create-transactions.sql</b> available in the <a href=\"http://offensivepolitics.net/blog/?p=52#resources\" rel=\"nofollow\" target=\"_blank\">Resources</a> sub-section below to a directory. Next download the output of the first part of the post into that same directory (<b>obama-data-F3P-2007-2008.csv</b>), available as ZIP archive in <a href=\"http://offensivepolitics.net/blog/?p=52#resources\" rel=\"nofollow\" target=\"_blank\">Resources</a> sub-section below. If this CSV file isn’t in the same directory as the <b>create-transactions.sql</b> script you’ll need to change line #4 to reference the exact location. </p>\n<p><b>create-transactions.sql</b> looks like this:</p>\n<div class=\"wp_syntax\"><table><tr><td class=\"line_numbers\"><pre>1\n2\n3\n4\n5\n</pre></td><td class=\"code\"><pre>CREATE DATABASE fechell;\nUSE fechell;\nCREATE TABLE transactions (contribution_date date,contribution_amount int, zipcode char(5)) engine 'MyISAM';\nLOAD DATA LOCAL INFILE 'obama-data-F3P-2007-2008.csv' INTO TABLE transactions FIELDS terminated BY ',' LINES terminated BY 'rn' IGNORE 1 LINES (contribution_date,contribution_amount,zipcode);\nALTER TABLE transactions ADD INDEX  ix_zipcode (zipcode);</pre></td></tr></table></div>\n<p>We are simply creating a new database (‘fechell’), and creating a new MyISAM table called ‘transactions’ on that database. We chose MyISAM since large data imports are dramatically faster with MyISAM than the default InnoDB, at least in the default setup we’re using.  You can execute this script by running the following command in the directory where you saved <b>create-transactions.sql</b> and <b>obama-data-F3P-2007-2008.csv</b>. Replace YOURDBUSERNAME with the user you created during the MySQL installation.</p>\n<pre>mysql -uYOURDBUSERNAME &lt; create-transactions.sql</pre>\n<p>Since we are loading in 2.8 million records and then adding an index to the zip code field this command might take quite a while to execute depending on your processor speed. After it is finished you should have a large database of all individual itemized transactions in the <b>fechell.transactions</b> table. </p>\n<p>Next we will create and populate the <b>transactions_summary_weekly</b> table, which will contain aggregated itemized individual fund raising totals by zip code by week and year.<br/>\nThe script <b>create-transactions_summary_weekly.sql</b> available in the <a href=\"http://offensivepolitics.net/blog/?p=52#resources\" rel=\"nofollow\" target=\"_blank\">Resources</a> sub-section below looks like this:</p>\n<div class=\"wp_syntax\"><table><tr><td class=\"line_numbers\"><pre>1\n2\n3\n4\n</pre></td><td class=\"code\"><pre>USE fechell;\nCREATE TABLE  transactions_summary_weekly (zipcode char(5) NOT NULL,contribution_year int(10) UNSIGNED NOT NULL,contribution_week int(10) UNSIGNED NOT NULL, total int(10) UNSIGNED NOT NULL) engine 'MyISAM';\nINSERT INTO transactions_summary_weekly(zipcode,contribution_year,contribution_week,total) \n(SELECT zipcode,year(contribution_date),week(contribution_date),sum(contribution_amount) FROM transactions GROUP BY zipcode,year(contribution_date),week(contribution_date));</pre></td></tr></table></div>\n<p>You can run the script with the following command:</p>\n<pre>mysql -uYOURDBUSERNAME &lt; create-transactions_summary_weekly.sql</pre>\n<p>After the script is finished executing you should have two rather large tables populated with the information we’ll need to visualize the data. </p>\n<h2>Installing R</h2>\n<p>Before we can create the visualizations we’ll need to make sure the <a href=\"https://www.r-project.org/\" rel=\"nofollow\" target=\"_blank\">R</a> toolkit and several add-on packages are installed correctly. If it isn’t installed already, you can download an R installer from <a href=\"http://cran.r-project.org/mirrors.html\" rel=\"nofollow\" target=\"_blank\">the R mirrors list</a>. The <a href=\"http://cran.r-project.org/faqs.html\" rel=\"nofollow\" target=\"_blank\">R Frequently Asked Questions</a> page contains instructions for Linux, Unix, Mac, and Windows platforms. </p>\n<h2>Installing R Packages</h2>\n<p> After R is installed you will need to install several add-on packages that may or may not be included with your distribution: <b>sp</b>, <b>maps</b>,<b>maptools</b>, and <b>RMySQL</b>. All are available via CRAN and platform-dependent instructions for installing add-on packages fcan be found on the <a href=\"http://wiki.r-project.org/rwiki/doku.php\" rel=\"nofollow\" target=\"_blank\">R Wiki</a> under <a href=\"http://wiki.r-project.org/rwiki/doku.php?id=getting-started:installation:packages\" rel=\"nofollow\" target=\"_blank\">How do I install a package?</a>. </p>\n<h2>Creating the visualization part 1 – images</h2>\n<p>Before you can create the visualization you will need to download the R script to draw the frames, and a support file containing latitude and longitude pairs for every zip-code in the US. Both are available in the <a href=\"http://offensivepolitics.net/blog/?p=52#references\" rel=\"nofollow\" target=\"_blank\">References</a> sub-section below as <b>draw.R</b> and <b>zips.zip</b>. Unzip the <b>zips.zip</b> file and move the newly created <b>zips.csv</b> file into the same directory as <b>draw.R</b>. You will need to make 1 change to the <b>draw.R</b> script before you can run it: line 37 creates the connection to the database we created and populated earlier. You’ll need to change the host, user name, and password arguments to match your database setup. </p>\n<p>The draw.R file is pretty simple, so we wont walk through the code line by line. Most of the heavy lifting is done by the fantastic <b>sp</b> and <b>RMySQL</b> packages, with a little bit of help from a lat/long database of zip codes. </p>\n<p>Once you’ve edited the <b>draw.R</b> to match your configuration you can can create the images with the following command line, assuming the R bin directory has been correctly added to your PATH:</p>\n<pre>R CMD BATCH draw.R</pre>\n<p>Assuming the packages were installed correctly, the <b>zips.csv</b> file was in the same directory, and the database configuration was modified you should now see 96 PNG files in your directory. The files are named <b>o4a_<i>year</i>_<i>week</i>.png</b>. </p>\n<h2>Creating the visualization part 2 – video</h2>\n<p>To create a FLV movie from the weekly images you will need to install <a href=\"http://www.mplayerhq.hu/\" rel=\"nofollow\" target=\"_blank\">MPlayer/MEncoder</a> if it isn’t installed on your system already. You can find download and install instructions on the <a href=\"http://www.mplayerhq.hu/design7/dload.html\" rel=\"nofollow\" target=\"_blank\">MPlayer download page</a>. Once the installation is complete you can create a FLV movie with the following command line (some options taken from a page on <a href=\"http://www.jeremychapman.info/cms/mencoder-%3Cbr\" rel=\"nofollow\" target=\"_blank\">\navi-to-flv-conversion\"&gt;http://jeremychaman.info/</a></p>\n<pre>mencoder.exe mf://*.png -mf w=1024:h=768:type=png -ovc lavc -lavcopts vcodec=flv:mbd=2:mv0:v4mv:cbp:last_pred=3:trell:keyint=50:vbitrate=300 -o output.flv -fps 2 -ofps 5 -of lavf</pre>\n<p>After the command is complete you will have a FLV file called <b>output.flv</b>. The final file is embedded below, and available in the <a name=\"resources\">Resources</a> section: </p>\n[See post to watch Flash video]\n<h2>Problems with this visualization</h2>\n<p>While this visualization serves our purpose of tracking the geographic spread and growing amount of individual contributions to the <em>Obama for America</em> campaign, it is not perfect. The entire process, from extraction to visualization was created in about half a day, so there is obviously more work that could be done. Also the specific process used in these tutorials was to be a demonstration of several strategies to perform your own analysis, not necessarily to build the best visualization of independent contributions.</p>\n<p>One problem with the current visualization is the representation of an entire zip code by a dot at its geographic center. This is problematic because zip codes represent regions that are vastly different in size, so using single dots will end up in decisions being skewed. Based on our maps alone, we could conclude <em>Obama for America</em> enjoyed very little support in places like Montana and Colorado since they have very few dots within their borders. In truth the campaign received more than $11M  of support from Colorado and just over $1.2M in itemized donations from Montana, but this is very difficult to compare this to Philadelphia or New York City where the map is a smear of dots. A better way to display information by zip code could involve drawing the <a href=\"http://www.census.gov/geo/www/cob/z52000.html\" rel=\"nofollow\" target=\"_blank\">ZIP boundaries</a> and filling with a color, instead of just coloring a single point. This would work fine for places like Montana, Idaho, and Colorado where a zip code might refer to a very large area, but would fail in more populous areas. This is especially true in New York City, where a single zip code could represent an area as small as a single square mile and would be almost impossible to view on a reasonably sized graphic. Merging of zip code areas and averaging their fund raising totals could make this procedure more useful for national analysis or local analysis of heavily populated metro areas. </p>\n<p>Additionally, the output format of the visualization could be improved by making it interactive. Combining our weekly summary data with a tool like the <a href=\"https://www.google.com/ig/directory?url=www.google.com/ig/modules/motionchart.xml\" rel=\"nofollow\" target=\"_blank\">Google Motion Chart Gadget</a> along with an <a href=\"https://www.google.com/ig/directory?url=www.google.com/ig/modules/time-series-line.xml\" rel=\"nofollow\" target=\"_blank\">Animated Timeline</a> would provide a much greater user experience.</p>\n<p>Finally, the national analysis of <em>Obama for America</em> is interesting by itself but would be much more useful if it included data from other candidates. Being able to overlay zip code summaries from primary challengers like <em>Hillary Clinton for President</em>, and general election opponent <em>McCain-Pailn 2008 Inc</em> would allow a much greater depth of analysis to be performed. Including demographic information, primary dates, and election returns on the same visualization would be the best.</p>\n<p>I intend to address these topics -as well as analyzing congressional races-  in a future tutorial. </p>\n<h2>What the visualization tells us</h2>\n<p>Despite the flaws listed above after viewing the final output of our visualization we can draw several conclusions about the fund raising success of the <em>Obama for America</em> campaign. First, the campaign was truly national and had financial support from across the country by the end of the campaign. But the campaign didn’t start out national – during the critical first two months of the campaign <em>Obama for America</em> drew financial support from several metro areas including Chicago, New York City, and DC/Northern Virginia. After several months of heavy development of the grassroots network the campaign started seeing donations coming in from across the US. </p>\n<p>Using the weekly summary data we can try to attribute large spikes in total receipts to campaign events. Looking closely we see the campaign saw a large increase of contributions in the last week of March, which potentially could be attributed to popular support of candidate Obama’s <a href=\"https://en.wikipedia.org/wiki/A_More_Perfect_Union_(speech)\" rel=\"nofollow\" target=\"_blank\">More Perfect Union speech</a> or as a result of the large new donor push at the beginning of that month. We can also look at weeks 2008/4 and 2008/5(beginning of February 2008) and see week to week receipts jump by $5M to around $11M for two full weeks. This spike coincides with the <a href=\"https://en.wikipedia.org/wiki/Super_Tuesday#Democrats\" rel=\"nofollow\" target=\"_blank\">Super Tuesday</a> Democratic primaries where candidate Obama nearly split the day with then-front runner Hillary Clinton. </p>\n<h2>Conclusion</h2>\n<p>Using  free disclosure data and a few open-source tools, like <a href=\"http://www.ruby-lang.org/\" rel=\"nofollow\" target=\"_blank\">Ruby</a>, <a href=\"http://offensivepolitics.net/fechell\" rel=\"nofollow\" target=\"_blank\">fechell</a>, <a href=\"https://www.r-project.org/\" rel=\"nofollow\" target=\"_blank\">R</a>, and <a href=\"http://www.mysql.com\" rel=\"nofollow\" target=\"_blank\">MySQL</a> just about anybody can perform their own professional analysis on federal campaign finance data. </p>\n<h2><a name=\"resources\">Resources</a></h2>\n<p><a href=\"http://offensivepolitics.net/assets/create-transactions.sql\" rel=\"nofollow\" target=\"_blank\">Database creation script</a><br/>\n<a href=\"http://offensivepolitics.net/assets/create-transactions_summary_weekly.sql\" rel=\"nofollow\" target=\"_blank\">Database population script</a><br/>\n<a href=\"http://offensivepolitics.net/assets/draw.R\" rel=\"nofollow\" target=\"_blank\">R script to draw images draw.R</a><br/>\n<a href=\"https://www.r-bloggers.com/wp-content/uploads/2009/06/zips1.zip\" rel=\"nofollow\" target=\"_blank\">Zip codes</a><br/>\n<a href=\"http://offensivepolitics.net/assets/output.flv\" rel=\"nofollow\" target=\"_blank\">FLV file</a><br/>\n<a href=\"https://www.r-bloggers.com/wp-content/uploads/2009/06/obama-F3P-SA-2007-20081.zip\" rel=\"nofollow\" target=\"_blank\">CSV extract</a> from <a href=\"http://offensivepolitics.net/blog/?p=26\" rel=\"nofollow\" target=\"_blank\">Part 1</a></p>\n\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.0-->\n<p class=\"syndicated-attribution\"><div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"http://offensivepolitics.net/blog/?p=52\"> Offensive Politics » R</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div></p> </div>\n<div class=\"post-tags clearfix\"><ul><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/campaign-finance/\" rel=\"tag\">Campaign Finance</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/fec/\" rel=\"tag\">FEC</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/fechell/\" rel=\"tag\">fechell</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/open-source/\" rel=\"tag\">open source</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/r/\" rel=\"tag\">R</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/uncategorized/\" rel=\"tag\">Uncategorized</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/visualization/\" rel=\"tag\">visualization</a></li></ul></div></article>",
    "main_text": "open-source campaign finance analysis with R and MySQL\nPosted on\nJune 18, 2009\nby\njjh\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nOffensive Politics » R\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nIntroduction\nIn\nPart 1\nof this tutorial we introduced the\nfechell\nlibrary by extracting all itemized contributions from individuals made to the\nObama For America\ncampaign in 2007 and 2008. In Part 2 of the tutorial we will summarize that data set by importing it into a MySQL database and aggregating contributions by week and zip code. Next we’ll visualize the contribution data amounts on a map, week by week. Below is a sample image:\nThis visualization contains two separate measures: the top portion is a map of the continental US, marked with a dot at the geographic center of every zip code that had individuals who made contributions to\nObama for America\n. The dot is colored according to how much money in total was raised from that zip code since the 2nd week of 2007, with the colors going from a dark blue to bright red indicating amounts. The second measure is a vertical bar plot showing how much money was raised, per week, from all zip codes combined. The current week is highlighted and annotated with the amount raised for that week. Taken together these measures can show us where the first monetary support for the\nObama for America\ncampaign came from and how it progressed geographically and in volume. We will use the free\nR\nstatistics and visualization package to producing the weekly image we shown above. Looking at still images week by week is informative but not very exciting. After all the images are created we’ll use\nMEncoder\nto string together the images into a movie to demonstrate the growth of individual financial support pledged to\nObama for America\n.\nInstalling the database\nTo follow along with this exercise you will need to\ndownload\nMySQL 5.1 for your platform. English instructions for installation are available in the\nMySQL 5.1 Reference Manual\n. After installation you will also need to create a database user and grant rights to create databases, create indexes and perform\nLOAD DATA LOCAL\nfunctions. All of these administration tasks are covered in the MySQL 5.1 Reference Manual\nSection 5.5 (MySQL User Account Management)\n. Keep the user name and password of the account you created handy as we’ll use it in the next few steps to access the database.\nCreating the database\nWe will be using two different tables to represent the itemized individual contributions: the\ntransactions\ntable will hold all 2.8 million transaction values, and the\ntransactions_summary_weekly\ntable will hold the sum of all contributions for every combination of year, week, and 5 digit zip code that exists in the data.\nTo populate these tables, download and save the transaction table creation script\ncreate-transactions.sql\navailable in the\nResources\nsub-section below to a directory. Next download the output of the first part of the post into that same directory (\nobama-data-F3P-2007-2008.csv\n), available as ZIP archive in\nResources\nsub-section below. If this CSV file isn’t in the same directory as the\ncreate-transactions.sql\nscript you’ll need to change line #4 to reference the exact location.\ncreate-transactions.sql\nlooks like this:\n1\n2\n3\n4\n5\nCREATE DATABASE fechell;\nUSE fechell;\nCREATE TABLE transactions (contribution_date date,contribution_amount int, zipcode char(5)) engine 'MyISAM';\nLOAD DATA LOCAL INFILE 'obama-data-F3P-2007-2008.csv' INTO TABLE transactions FIELDS terminated BY ',' LINES terminated BY 'rn' IGNORE 1 LINES (contribution_date,contribution_amount,zipcode);\nALTER TABLE transactions ADD INDEX  ix_zipcode (zipcode);\nWe are simply creating a new database (‘fechell’), and creating a new MyISAM table called ‘transactions’ on that database. We chose MyISAM since large data imports are dramatically faster with MyISAM than the default InnoDB, at least in the default setup we’re using.  You can execute this script by running the following command in the directory where you saved\ncreate-transactions.sql\nand\nobama-data-F3P-2007-2008.csv\n. Replace YOURDBUSERNAME with the user you created during the MySQL installation.\nmysql -uYOURDBUSERNAME < create-transactions.sql\nSince we are loading in 2.8 million records and then adding an index to the zip code field this command might take quite a while to execute depending on your processor speed. After it is finished you should have a large database of all individual itemized transactions in the\nfechell.transactions\ntable.\nNext we will create and populate the\ntransactions_summary_weekly\ntable, which will contain aggregated itemized individual fund raising totals by zip code by week and year.\nThe script\ncreate-transactions_summary_weekly.sql\navailable in the\nResources\nsub-section below looks like this:\n1\n2\n3\n4\nUSE fechell;\nCREATE TABLE  transactions_summary_weekly (zipcode char(5) NOT NULL,contribution_year int(10) UNSIGNED NOT NULL,contribution_week int(10) UNSIGNED NOT NULL, total int(10) UNSIGNED NOT NULL) engine 'MyISAM';\nINSERT INTO transactions_summary_weekly(zipcode,contribution_year,contribution_week,total) \n(SELECT zipcode,year(contribution_date),week(contribution_date),sum(contribution_amount) FROM transactions GROUP BY zipcode,year(contribution_date),week(contribution_date));\nYou can run the script with the following command:\nmysql -uYOURDBUSERNAME < create-transactions_summary_weekly.sql\nAfter the script is finished executing you should have two rather large tables populated with the information we’ll need to visualize the data.\nInstalling R\nBefore we can create the visualizations we’ll need to make sure the\nR\ntoolkit and several add-on packages are installed correctly. If it isn’t installed already, you can download an R installer from\nthe R mirrors list\n. The\nR Frequently Asked Questions\npage contains instructions for Linux, Unix, Mac, and Windows platforms.\nInstalling R Packages\nAfter R is installed you will need to install several add-on packages that may or may not be included with your distribution:\nsp\n,\nmaps\n,\nmaptools\n, and\nRMySQL\n. All are available via CRAN and platform-dependent instructions for installing add-on packages fcan be found on the\nR Wiki\nunder\nHow do I install a package?\n.\nCreating the visualization part 1 – images\nBefore you can create the visualization you will need to download the R script to draw the frames, and a support file containing latitude and longitude pairs for every zip-code in the US. Both are available in the\nReferences\nsub-section below as\ndraw.R\nand\nzips.zip\n. Unzip the\nzips.zip\nfile and move the newly created\nzips.csv\nfile into the same directory as\ndraw.R\n. You will need to make 1 change to the\ndraw.R\nscript before you can run it: line 37 creates the connection to the database we created and populated earlier. You’ll need to change the host, user name, and password arguments to match your database setup.\nThe draw.R file is pretty simple, so we wont walk through the code line by line. Most of the heavy lifting is done by the fantastic\nsp\nand\nRMySQL\npackages, with a little bit of help from a lat/long database of zip codes.\nOnce you’ve edited the\ndraw.R\nto match your configuration you can can create the images with the following command line, assuming the R bin directory has been correctly added to your PATH:\nR CMD BATCH draw.R\nAssuming the packages were installed correctly, the\nzips.csv\nfile was in the same directory, and the database configuration was modified you should now see 96 PNG files in your directory. The files are named\no4a_\nyear\n_\nweek\n.png\n.\nCreating the visualization part 2 – video\nTo create a FLV movie from the weekly images you will need to install\nMPlayer/MEncoder\nif it isn’t installed on your system already. You can find download and install instructions on the\nMPlayer download page\n. Once the installation is complete you can create a FLV movie with the following command line (some options taken from a page on\navi-to-flv-conversion\">http://jeremychaman.info/\nmencoder.exe mf://*.png -mf w=1024:h=768:type=png -ovc lavc -lavcopts vcodec=flv:mbd=2:mv0:v4mv:cbp:last_pred=3:trell:keyint=50:vbitrate=300 -o output.flv -fps 2 -ofps 5 -of lavf\nAfter the command is complete you will have a FLV file called\noutput.flv\n. The final file is embedded below, and available in the\nResources\nsection:\n[See post to watch Flash video]\nProblems with this visualization\nWhile this visualization serves our purpose of tracking the geographic spread and growing amount of individual contributions to the\nObama for America\ncampaign, it is not perfect. The entire process, from extraction to visualization was created in about half a day, so there is obviously more work that could be done. Also the specific process used in these tutorials was to be a demonstration of several strategies to perform your own analysis, not necessarily to build the best visualization of independent contributions.\nOne problem with the current visualization is the representation of an entire zip code by a dot at its geographic center. This is problematic because zip codes represent regions that are vastly different in size, so using single dots will end up in decisions being skewed. Based on our maps alone, we could conclude\nObama for America\nenjoyed very little support in places like Montana and Colorado since they have very few dots within their borders. In truth the campaign received more than $11M  of support from Colorado and just over $1.2M in itemized donations from Montana, but this is very difficult to compare this to Philadelphia or New York City where the map is a smear of dots. A better way to display information by zip code could involve drawing the\nZIP boundaries\nand filling with a color, instead of just coloring a single point. This would work fine for places like Montana, Idaho, and Colorado where a zip code might refer to a very large area, but would fail in more populous areas. This is especially true in New York City, where a single zip code could represent an area as small as a single square mile and would be almost impossible to view on a reasonably sized graphic. Merging of zip code areas and averaging their fund raising totals could make this procedure more useful for national analysis or local analysis of heavily populated metro areas.\nAdditionally, the output format of the visualization could be improved by making it interactive. Combining our weekly summary data with a tool like the\nGoogle Motion Chart Gadget\nalong with an\nAnimated Timeline\nwould provide a much greater user experience.\nFinally, the national analysis of\nObama for America\nis interesting by itself but would be much more useful if it included data from other candidates. Being able to overlay zip code summaries from primary challengers like\nHillary Clinton for President\n, and general election opponent\nMcCain-Pailn 2008 Inc\nwould allow a much greater depth of analysis to be performed. Including demographic information, primary dates, and election returns on the same visualization would be the best.\nI intend to address these topics -as well as analyzing congressional races-  in a future tutorial.\nWhat the visualization tells us\nDespite the flaws listed above after viewing the final output of our visualization we can draw several conclusions about the fund raising success of the\nObama for America\ncampaign. First, the campaign was truly national and had financial support from across the country by the end of the campaign. But the campaign didn’t start out national – during the critical first two months of the campaign\nObama for America\ndrew financial support from several metro areas including Chicago, New York City, and DC/Northern Virginia. After several months of heavy development of the grassroots network the campaign started seeing donations coming in from across the US.\nUsing the weekly summary data we can try to attribute large spikes in total receipts to campaign events. Looking closely we see the campaign saw a large increase of contributions in the last week of March, which potentially could be attributed to popular support of candidate Obama’s\nMore Perfect Union speech\nor as a result of the large new donor push at the beginning of that month. We can also look at weeks 2008/4 and 2008/5(beginning of February 2008) and see week to week receipts jump by $5M to around $11M for two full weeks. This spike coincides with the\nSuper Tuesday\nDemocratic primaries where candidate Obama nearly split the day with then-front runner Hillary Clinton.\nConclusion\nUsing  free disclosure data and a few open-source tools, like\nRuby\n,\nfechell\n,\nR\n, and\nMySQL\njust about anybody can perform their own professional analysis on federal campaign finance data.\nResources\nDatabase creation script\nDatabase population script\nR script to draw images draw.R\nZip codes\nFLV file\nCSV extract\nfrom\nPart 1\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nOffensive Politics » R\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nCampaign Finance\nFEC\nfechell\nopen source\nR\nUncategorized\nvisualization",
    "meta_description": "Introduction In Part 1 of this tutorial we introduced the fechell library by extracting all itemized contributions from individuals made to the Obama For America campaign in 2007 and 2008. In Part 2 of the tutorial we will summarize that data set by importing it into a MySQL database and aggregating contributions by week and [...]",
    "meta_keywords": "campaign finance,fec,fechell,open source,r,uncategorized,visualization",
    "og_description": "Introduction In Part 1 of this tutorial we introduced the fechell library by extracting all itemized contributions from individuals made to the Obama For America campaign in 2007 and 2008. In Part 2 of the tutorial we will summarize that data set by importing it into a MySQL database and aggregating contributions by week and [...]",
    "og_image": "https://www.r-bloggers.com/wp-content/uploads/2009/06/o4a_2008_30-300x2251.png",
    "og_title": "open-source campaign finance analysis with R and MySQL | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 11.3,
    "sitemap_lastmod": "2011-05-11T21:16:16+00:00",
    "twitter_description": "Introduction In Part 1 of this tutorial we introduced the fechell library by extracting all itemized contributions from individuals made to the Obama For America campaign in 2007 and 2008. In Part 2 of the tutorial we will summarize that data set by importing it into a MySQL database and aggregating contributions by week and [...]",
    "twitter_title": "open-source campaign finance analysis with R and MySQL | R-bloggers",
    "url": "https://www.r-bloggers.com/2009/06/open-source-campaign-finance-analysis-with-r-and-mysql/",
    "word_count": 2253
  }
}