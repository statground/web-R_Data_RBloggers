{
  "uuid": "7028af9e-82a7-4b0e-802b-e5aee6b7569d",
  "created_at": "2025-11-22 19:59:32",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2025/01/bayesian-meta-analysis-with-brms/",
    "crawled_at": "2025-11-22T10:56:09.455461",
    "external_links": [
      {
        "href": "https://rworks.dev/posts/bma-with-brms/",
        "text": "R Works"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://rworks.dev/posts/meta-analysis/",
        "text": "Examining Meta Analysis"
      },
      {
        "href": "https://cran.r-project.org/package=meta",
        "text": "meta"
      },
      {
        "href": "https://mc-stan.org/",
        "text": "stan"
      },
      {
        "href": "https://cran.r-project.org/package=rstan",
        "text": "rstan"
      },
      {
        "href": "https://cran.r-project.org/package=lme4",
        "text": "lme4"
      },
      {
        "href": "https://mc-stan.org/posterior/reference/ess_bulk.html",
        "text": "stan documentation"
      },
      {
        "href": "https://i1.wp.com/rworks.dev/posts/bma-with-brms/index_files/figure-html/unnamed-chunk-6-1.png?ssl=1",
        "text": null
      },
      {
        "href": "https://i1.wp.com/rworks.dev/posts/bma-with-brms/index_files/figure-html/unnamed-chunk-8-1.png?ssl=1",
        "text": null
      },
      {
        "href": "https://cran.r-project.org/web/packages/brms/brms.pdf",
        "text": "package PDF"
      },
      {
        "href": "https://rworks.dev/posts/bma-with-brms/",
        "text": "R Works"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Bayesian Meta-Analysis with brms | R-bloggers",
    "images": [
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAG8AAAAPBAMAAAAYH4wJAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdqvvuzJEid0imWYQVM1Bf7+MAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABT0lEQVQoFY2QMUjDUBCG/2jT5CUNlQriIBIEce3g6ODi5CK4OHZ3cStYKm9U6JDRSbuKS3CwdMvgptDuXQTBTXESBAfvvXtpk9cO3nC5+/67e3cB0NiFZdEgscii1D2q2ngg9m20IHfPbCgkvjTLbAUlcmXLlZUaNz7aCkpk3ZZHmfhPo7Nq77qJUOphPD96A7bNcPOi024BB57EhHiwpUwNuWxfxPRBvlgD4jdKi+SDEqfv8l5a0O4bfqnsEF7fqPxiEFNaT8xBRgKNxy0ltMEnb/CD60ypU1Lf6QDHcGUYK55btYlzjnm+28Q7HopklFB2Ai9NexRMbxSytlcsc+JgHPqZRjyqrhp9PEG8apo7udTikMsqwzvgpkgC9QtEd4PeZGz86ZoJuHG5SykdpYwJOpNMp/6z/sw5U6Z4j2cXiKLBUPl5e5mhe3UWMCN/LcRNB6gw//AAAAAASUVORK5CYII=",
        "src": "https://latex.codecogs.com/png.latex?%5Cdelta_i%20=%20%5Ctheta%20+%20%5Cnu_i%20+%20%5Cepsilon"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAPBAMAAAAizzN6AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdqvvuzJEid0imWYQVM1Bf7+MAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAVUlEQVQIHWNgYBAyYQAC1gA2MFUAIhkYOiGUBJhiFAaLurI3MNxmYFzA+gEoyj+BE0QFM7A2cCswRDCwb9jQw8DBcISB8wEDZ60MkA/WynEaTHHtBABrcA8D5T66ngAAAABJRU5ErkJggg==",
        "src": "https://latex.codecogs.com/png.latex?%5Cdelta_i"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGoAAAAPBAMAAAD+NkdNAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVGaJIrvddhDNq0TvmTJ+KqhmAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABRUlEQVQoFW3RsUvDQBQG8C/NmcTGptDJMSRFwUEKdXEQuti1KoiDS1QQxyIuxcGgq9DOTplEdAmCm0Nx6uif4KSrY8HF985Gkpe+IZf3u/su3AVAYwOijLAjRLd5rrS25ZJQ7UjiPs9d1MUSFeFbELcFPsBQLFnoO/NSeXam6InUMFbzUnm2R1gRqQEqkSBu82ydtO/QIKw9crXo7bS9mTj3wVqinQO6mHETXPSJ6ymOM5+NP7B8bAG8Q66YjQcs+mS90iGUPuku4lRHXvap9ugKmT8Bu0P8CvO9kuj52cMd84emZoyCaz4CPOYubmP/jAL/51KRM4H3NgC0Zxsy//0RYgtPUKNsSo9RNaX9DCWc2I0Ah9ldTWH6hdTzJVD1YQsnVmNgOWPrupDiZukDXyj7Ibw041pTppyrIJyg7Ob5Ot1A8xeWGk5LJWklHgAAAABJRU5ErkJggg==",
        "src": "https://latex.codecogs.com/png.latex?%5Ctheta_i%20=%20%5Ctheta_%7BEi%7D%20-%20%5Ctheta_%7BCi%7D"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAF4AAAATBAMAAADrOqfvAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVGaJIrvddhDNq0TvmTJ+KqhmAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABtklEQVQoFX2RsUsbcRTHP7n8zJ1erwmhSMcDpV0DFqFgIUsdsiSD0KHLUaE4xlHaIbgURDBDB3Exm0KXUxw7HC20LoUshQ4F/QtaKYKCUH3vl1zOI5DH8d73fb/fe7x3B5PiQ150bVt9lmelW7zEO3sNPSjM1Uey1xfo1F6OiBS4P2AG3BjmTCtloSpwmXJGDJGzBJswDSbiIpOF4BU7GTFEf5oVTuy4qbZ3z1+s4F3THPOH0y3asAI7HXPP7/dwuzwZ87cL1+pPYAMnUtns395Km1BaXdizdzD7VfjHKor3ihAieLvwvCcEQf2RlgvKMW8U8fBjowU1hSbmt1/HdOGGUqjUOX0tpzTTBYMOP0FekU8Mf49lQheTXWeVNT5T7Ds9MQXyrGxV1O9C6QC8CD/hhTLg1zQn8vm3O+GaQBnK++9Kqt/9JzXBRN6ppQjsJLmXT3bRATvIsov3X+CunDwTYw4FP6hLkn/tP40phoKzCL7JrL7063D8Tu74InhZdSfUTGnTlrHUGDKFVJnqWBTMp0S+DmVG/nRA3jbqjC4lYU9V8EvThDgaaKnfOZ/gVcnkdWnvAN4UUfQUqs/UAAAAAElFTkSuQmCC",
        "src": "https://latex.codecogs.com/png.latex?%20%5Ctheta_i%20%5Csim%20N(%5Ctheta,%20%5Ctau)"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAKBAMAAACdwMn3AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVM3vqzJ2IhC7ZomZ3UTZb8aUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAATElEQVQIHWNgVGZgcGUAghQG9h+MCxgYZjFwHwDxvzPUNgApVgMGPYYlDAxsDjwCXLwNDJzLjzMwFDEwMG8ESu4CYhC4sQBMMZwqAAATfg3QGzHUDQAAAABJRU5ErkJggg==",
        "src": "https://latex.codecogs.com/png.latex?%5Cnu_i"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAM4AAABCCAMAAAAosxlVAAAAPFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAo1xBWAAAAE3RSTlMAVM3vqzJ2IhC7ZomZ3UTDUGyvHEurjwAAAAlwSFlzAAAOxAAADsQBlSsOGwAABmpJREFUaAXNG9m6taYORxDUnlPe/10LYUZAsuT/Wi+2CkkgZI5rEzLmmukYOr9Q2Y5fsFo4p2jN/um5cx+7wr1006Ny+EXYsnWv3wO43D1QADPxbtB+QH71w75DivkdxkGIsQdpyV4D1Y3KfuGQ4WYLDE2SufP6fF8RwvlD7JDr/MyGJcDk1E+Krf2wGEg+TDyi360Rcg9U8oRdOYrwgpHzjjCzZLtvLyvmUBvEJonxVWtmshMXmNOAfRRxbow/arCDO5bMsVGlIisyo6jgLGOsUqJON2NnU06RZ2ONo4OpCs4h3xB75ieMXyNbQRKiMPa2cgGHD9G2E+Uh+dOnsyszpzdW1HwJh+LUpLLKhUqXzmcdsWI8id1EEWdB7aTMDpMoC3yayb6RJ4vltfxoGedA6YknljzcEqX5jh1+6TJBhYpbxaHOAPiGcw4wHoHyBNR6wfVk9NBcQPXTdyCvOHxAYrBKjKrYYgdc841JXK07b+JsOL1PlMy9XChvb4sdKB4np3iOVPv+jsMk7oBK62n9778MBxRwTHuBrRfnfNX+pFmnxjiECc53nRykKLi9lHbNJMo7GnaMyiwm3JiU7dV8YpwJEr/5UaUvKE0psbNJjMq4YkdLZ7UB9VB3Rt7z7ICzmRPcH0Y7o+xYXADOTnn41afU/FSu+1gkOgVX7Gz7pEKHuVSwECAn3g5gAecyB6EIZCgHzlPvtrKJ1uVJZsEFoS1pFYqdbeE7WDAnnckO8yqVo6yooEG4qTtZpLR7zA7VWuAXi6TiHvNiR43rA54gL6CZX6plcre1VjWfoawy2plbs3rfNgrs35E+iTgp0IExnF2BTkFyK+xAR1SR7YV7jU4pGR9HJsVOhnKi4qhabtYb0mu7K6bAdM5EW9IpsAPhZNMkr1jq6r3GDgHL3TSzGQqc7TRDGCgmqW7XcFdrQjsrZmeNDgRsoNSPdGrzLHbYLlXUEeCzTx5JvcUOETvn4EkyFKMquzZtmqSj07XYSKBlai/Nht59rBSxul6XEGKO/IRDdOVqodhxIIV7VToFWDNkDPnQ+9PRzMfYbaZ0NZoR4hvV4j0XEpsOidkBN3kpYp6OXcVF2kKxYyCKf39lR0cTmnjJU4vkBH6CuoNQNnnHwiFH8I0g35LpzM6cHK3GJwTD2Lmqa571X3ecdZxwFhA1Nm06c+JGjHacB2UudisQYzLXGpsO+Uv+z5GDjyKFLhP3nSvHjsNo3/HS+b/8W21TafupA22IsVYA+7JEezePynbjXcTSUTrFtFEHOgB5M4viip0Yv/GMZwekc3AKSp3H2Gwlq2QsbRLGgVixsyohWzo0xEwbmzKTyug/Xn9kZxE2GcxibEr/XGyq5NyUmY5dwc1NEmPoqOzFUYBopbyNS9PcePv+IzueaBZj/XjrIWbHwTk69pTAHeo5nOnUw6hb53Hf4xQlj7EP6NLAmZoSgLhY7dmxHyuQ7LAQ8UorF8ZEFNPVIWZhuYDwGEopmGlLx3NDbrA3V+w8aAwbEIWzxRFP5ZvgBnaMa3PFTgI09OUMQfBHulNcIFRpQJ1UKHaqCL9NrLjyrbDI3VVcz7qUCY6bTDtnqt+B8nQdOHMaRArbfRuiXc0glenFjo3e4MVRnakeHFyTrMhaVzMIXFtwbBOBMgIyeRI6U80wm+BUOlNdeyly4Qe7mkEqcU2/7ECPzWZ/nZ0pEuGUO1Mj2oZHTzOIqYCQFDvwoxeL2d2Z0lky4FQ6UyOaun1te+Xa4mIHyohpNt0115nKMlcvf/sQ4VQ6U1MSRXP8vve+tv0xJykO155OKY/O6lxn6iUDJgEndFdSHPHZT+uivFBNP05CyISdHfgQULj7zlQzA1Z1jMepdaaGfOvt+oSnPsOmmXhg2HemXOYapipPtc5U104qNP1w15ls8vTlgsc0D74z5TLXbL7wWu5MjfnU2/f9W1YCdtSZQmTAxc5U30YKp5MMsa6s7Ur6XgmBUS9davK+2Oz6Ti3QA1qTLYjPc10+6X0V3hNIRUhx3in+BHF/rg7MsiwpaStbmaKWUAXk4zCkuR9pAPowQp82MyAlMOujftn6acsN5H2crzn+uGE0+LBT437aqhIdVF35vjc8xD1OOCqb/NfFM7vWPP4knhgM8aP9J/aAkdJHsg9kXZL7gcQX1NH/UmEq3y87+oTrvwJ9ohIj/0f+HekfDSY2EF62N1cAAAAASUVORK5CYII=",
        "src": "https://latex.codecogs.com/png.latex?%20%5Cnu_i%20%5Csim%20N%5Cleft(%20%5Ctheta_i,%20%5Csqrt%7B%5Cfrac%7B%5Csigma_%7BEi%7D%5E2%7D%7Bn_%7BEi%7D%7D+%5Cfrac%7B%5Csigma_%7BCi%7D%5E2%7D%7Bn_%7BCi%7D%7D%7D%20%5Cright)"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKBAMAAACQ3rmwAAAAJ1BMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAilU6eAAAADHRSTlMAdolEzVSZq2YQIt0mdGV+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAQElEQVQIHWNgYFQyYAACVwYG1gYGtgIQm4GnSANEzVnAwNAO5C1g4OCewMDWwMCwBCiqETEBLMvAsBMoAgQZCwAnCgnvlAy57QAAAABJRU5ErkJggg==",
        "src": "https://latex.codecogs.com/png.latex?%5Cepsilon_i"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAAATBAMAAAAJ5ryWAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdolEzVSZq2YQIt3vMrv9sR9BAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABj0lEQVQoFXWRMUvDUBSFv9gmbWNruxRcBFEEQYcOiuIgXRzcOnaS4iaIVkHBRTq6CHURcTGbKKL9AYKdRNHBoatYEUHdxEWLRe9L6iON9EJyv3PuCbkvgY61E5ikAtqTIw1iy09QDEx3A9qTxiVEwMgQ6h30JcyST2iMjsIehKFG2NE2ZH2s8f4sxxTk4RmjoG0Y8rHGUriOnOgNmoSq2oYJYWMg43MEU+aXSldJNEh8ubPoxc83xIVnXG2e94NZVpzinRJUCEm6oRzW9x/lngSr6Ora8SZ0KbQzLIYc7KyKygNS0Tpj0uJlkqvDyljAqtOjKAoPk5DIYjeRpaTid8xJ6y5z4ChNAZaO1hQZYq9ArAIfmFVlncC8NNk76SitFjVu5Wxu2viUXoUXDHdPWeNaHElbJen+ki1iTTFmYVr+jr2hYpGcOKdyDefL/rB1I4OCOGn5RulBEldyhnSfimypW4c6bPmmnr9q+g89rVfqtF38H9KOXfBQFvPKaj3+p9v7uCd1ert9HFB2QDvwC054Ssai6zB9AAAAAElFTkSuQmCC",
        "src": "https://latex.codecogs.com/png.latex?%5Cepsilon%20%5Csim%20N(0,%20%5Csigma)"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAUBAMAAAByuXB5AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAELuZInZmVIndzatE7zJ1aH8UAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAiElEQVQIHWNgYBASYIACEwMog5VBDCaGjS5rgYqyNThBWZ4M/FCWKoM8hMX4kcEfwmJdwJAJYXHO6FjNID0tbTcD/wGGaQwcBgwcDP4CLB8YmAoYeRjOggT4BRoZGDwZZAUY3qYuYGDgZNjDwJDNUODAwJN6gIFhGwNDAMSoewx8EJbot7ReAQAouhfaqXMsBQAAAABJRU5ErkJggg==",
        "src": "https://latex.codecogs.com/png.latex?%5Chat%5Ctheta_E"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVBAMAAAC0+9ObAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAELuZInZm3e+rRM0yVImlRAVPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAoElEQVQIHWNgAAHePAMwDSRcGebBmKcZkmBMBoZ3YKaQAAMDYyGYaQLUwnkAxGRlEGNgiGEBiwIJrgWsMKb//38gJlv9/x9QockiqlAWmwLDaiiT4wDDJQYGybK0mQweDAx2DAx8Bgx8INlGBgamC4xcDBwMnBcYGPgFHjIw8MTGAHWdSN0A1cuQyXDBAcqexsAQAGX2MPBAmaLf0l4IAABIhh0wUXq+0gAAAABJRU5ErkJggg==",
        "src": "https://latex.codecogs.com/png.latex?%5Chat%5Csigma%5E2_E"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAVGaJIrvddhDNq0TvmZS+qxkAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAgdY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxutHFvxQAAAABJRU5ErkJggg==",
        "src": "https://latex.codecogs.com/png.latex?%5Ctheta"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,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",
        "src": "https://latex.codecogs.com/png.latex?%20%5Cdelta_i%20%5Csim%20N%5Cleft(%5Ctheta%20+%5Ctheta_i%20%5C;,%5C;%20%5Csqrt%7B%5Cfrac%7B%5Csigma_E%5E2%7D%7Bn_E%7D%20+%20%5Cfrac%7B%5Csigma_C%5E2%7D%7Bn_C%7D%7D%20+%20%5Csigma%5Cright)"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i1.wp.com/rworks.dev/posts/bma-with-brms/index_files/figure-html/unnamed-chunk-6-1.png?w=450&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i1.wp.com/rworks.dev/posts/bma-with-brms/index_files/figure-html/unnamed-chunk-8-1.png?w=450&ssl=1"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/joseph-rickert/",
        "text": "Joseph Rickert"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-389842 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Bayesian Meta-Analysis with brms</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">January 12, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/joseph-rickert/\">Joseph Rickert</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://rworks.dev/posts/bma-with-brms/\"> R Works</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<p>In our previous post, <a href=\"https://rworks.dev/posts/meta-analysis/\" rel=\"nofollow\" target=\"_blank\">Examining Meta Analysis</a>, we contrasted a frequentist version of a meta analysis conducted with R’s <a href=\"https://cran.r-project.org/package=meta\" rel=\"nofollow\" target=\"_blank\">meta</a> package with a Bayesian meta analysis done mostly in <a href=\"https://mc-stan.org/\" rel=\"nofollow\" target=\"_blank\">stan</a> using the <a href=\"https://cran.r-project.org/package=rstan\" rel=\"nofollow\" target=\"_blank\">rstan</a> package as a front end. We did this to hint at the difference between working within the restricted confines of a traditional frequentist framework and the amazing freedom to set up and solve complex probabilistic models using a modern Bayesian engine like <code>stan</code>. However, we fully acknowledge the cognitive burden of learning a completely new language and, at the same time, also learning Bayesian methods.</p>\n<p>In this post, we will ease your anxiety by pointing to a middle way by using the well-established and powerful package <code>brms</code>^1 to formulate <code>stan</code> models.</p>\n<section class=\"level2\" id=\"set-up\">\n<h2 class=\"anchored\" data-anchor-id=\"set-up\">Set Up</h2>\n<p>First, we set up our environment and read in the data on the effect of Amlodipine on angina patients which can be found in the `meta’ package.</p>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Show the code</summary>\n<pre>library(tidyverse)\nlibrary(brms)\nlibrary(tidybayes)\nlibrary(ggdist)</pre>\n</details>\n</div>\n<p><em>nE</em> is the number of subjects in the treatment arm for each Protocol, <em>meanE</em> is the sample treatment mean for each protocol, <em>varE</em> is the observed sample variance for each protocol, and <em>nC</em>, <em>meanC</em>, and <em>varC</em> are the corresponding statistics for the control arm.</p>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Show the code</summary>\n<pre>angina &lt;- read_csv(file = \"Amlodipine.csv\", col_types = c(\"c\",rep(c(\"i\",\"d\",\"d\"),2))) \n\nangina </pre>\n</details>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 8 × 7\n  Protocol    nE meanE   varE    nC   meanC   varC\n  &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;\n1 154         46 0.232 0.225     48 -0.0027 0.0007\n2 156         30 0.281 0.144     26  0.027  0.114 \n3 157         75 0.189 0.198     72  0.0443 0.497 \n4 162         12 0.093 0.139     12  0.228  0.0488\n5 163         32 0.162 0.0961    34  0.0056 0.0955\n6 166         31 0.184 0.125     31  0.0943 0.173 \n7 303         27 0.661 0.706     27 -0.0057 0.989 \n8 306         46 0.137 0.121     47 -0.0057 0.129 </pre>\n</div>\n</div>\n</section>\n<section class=\"level2\" id=\"review-the-model\">\n<h2 class=\"anchored\" data-anchor-id=\"review-the-model\">Review The Model</h2>\n<p>As in the previous post, we will measure the effect of the amlodipine treatment by looking at the difference in the observed means from the two arms of the study. Our model can be expressed as :</p>\n<p><img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Cdelta_i%20=%20%5Ctheta%20+%20%5Cnu_i%20+%20%5Cepsilon\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Cdelta_i%20=%20%5Ctheta%20+%20%5Cnu_i%20+%20%5Cepsilon\"/></noscript></p>\n<p>where for each study, i, <img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Cdelta_i\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Cdelta_i\"/></noscript>, the observed treatment effect, is the mean of the control arm subtracted from the mean of the treatment arm.</p>\n<p><img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Ctheta_i%20=%20%5Ctheta_%7BEi%7D%20-%20%5Ctheta_%7BCi%7D\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Ctheta_i%20=%20%5Ctheta_%7BEi%7D%20-%20%5Ctheta_%7BCi%7D\"/></noscript> We assume the distribution:</p>\n<p><img data-lazy-src=\"https://latex.codecogs.com/png.latex?%20%5Ctheta_i%20%5Csim%20N(%5Ctheta,%20%5Ctau)\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%20%5Ctheta_i%20%5Csim%20N(%5Ctheta,%20%5Ctau)\"/></noscript></p>\n<p><img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Cnu_i\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Cnu_i\"/></noscript> is the group effect from each study</p>\n<p><img data-lazy-src=\"https://latex.codecogs.com/png.latex?%20%5Cnu_i%20%5Csim%20N%5Cleft(%20%5Ctheta_i,%20%5Csqrt%7B%5Cfrac%7B%5Csigma_%7BEi%7D%5E2%7D%7Bn_%7BEi%7D%7D+%5Cfrac%7B%5Csigma_%7BCi%7D%5E2%7D%7Bn_%7BCi%7D%7D%7D%20%5Cright)\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%20%5Cnu_i%20%5Csim%20N%5Cleft(%20%5Ctheta_i,%20%5Csqrt%7B%5Cfrac%7B%5Csigma_%7BEi%7D%5E2%7D%7Bn_%7BEi%7D%7D+%5Cfrac%7B%5Csigma_%7BCi%7D%5E2%7D%7Bn_%7BCi%7D%7D%7D%20%5Cright)\"/></noscript></p>\n<p>and <img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Cepsilon_i\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Cepsilon_i\"/></noscript> is random noise:</p>\n<p><img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Cepsilon%20%5Csim%20N(0,%20%5Csigma)\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Cepsilon%20%5Csim%20N(0,%20%5Csigma)\"/></noscript>.</p>\n<p>The data include <img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Chat%5Ctheta_E\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Chat%5Ctheta_E\"/></noscript> = meanE and <img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Chat%5Csigma%5E2_E\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Chat%5Csigma%5E2_E\"/></noscript> = varE and the corresponding parameters for the control arm.</p>\n<p>With this, we have that <img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Ctheta\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Ctheta\"/></noscript> is distributed as:</p>\n<p><img data-lazy-src=\"https://latex.codecogs.com/png.latex?%20%5Cdelta_i%20%5Csim%20N%5Cleft(%5Ctheta%20+%5Ctheta_i%20%5C;,%5C;%20%5Csqrt%7B%5Cfrac%7B%5Csigma_E%5E2%7D%7Bn_E%7D%20+%20%5Cfrac%7B%5Csigma_C%5E2%7D%7Bn_C%7D%7D%20+%20%5Csigma%5Cright)\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%20%5Cdelta_i%20%5Csim%20N%5Cleft(%5Ctheta%20+%5Ctheta_i%20%5C;,%5C;%20%5Csqrt%7B%5Cfrac%7B%5Csigma_E%5E2%7D%7Bn_E%7D%20+%20%5Cfrac%7B%5Csigma_C%5E2%7D%7Bn_C%7D%7D%20+%20%5Csigma%5Cright)\"/></noscript></p>\n</section>\n<section class=\"level2\" id=\"brms-syntax\">\n<h2 class=\"anchored\" data-anchor-id=\"brms-syntax\">brms Syntax</h2>\n<p>Although it is much simpler than using <code>stan</code> directly, <code>brms</code> is not without its own cognitive load. Using any complex package correctly and with confidence requires time and effort to understand how things work. At a minimum, it is necessary to fully comprehend the function signature and all of the options implicitly coded therein.</p>\n<p>A good bit of the cognitive load associated with <code>brms</code> is associated with the formula interface, which it adopts form the <a href=\"https://cran.r-project.org/package=lme4\" rel=\"nofollow\" target=\"_blank\"><code>lme4</code></a> package for formulating and solving frequentist mixed-effects models. <code>brms</code> builds on this syntax to allow formulating expressions to set up complex, multilevel models.</p>\n<p>The general formula argument^2 is structured as <em>response</em> | <em>aterms</em> ~ <em>pterms</em> + (<em>gterms</em> | <em>group</em>). Everything on the right side of ∼ specifies predictors. <code>+</code> is used to separate different effects from each other. Note: the formula syntax is a very compressed notation, so even though it is in itself concise, explanations of it tend to be long. We very much recommend reading the package documentation.</p>\n<section class=\"level3\" id=\"aterms\">\n<h3 class=\"anchored\" data-anchor-id=\"aterms\">aterms</h3>\n<p>The <em>aterms</em> are optional terms that provide special information about the response variable. Especially helpful for meta-analysis, the term <code>se</code> specifies the standard errors of the response variable when response is a treatment effect. The pdf states:</p>\n<blockquote class=\"blockquote\">\n<p>Suppose that the variable yi contains the effect sizes from the studies and sei the corresponding standard errors. Then, fixed and random effects meta-analyses can be conducted using the formulas yi | se(sei) ~ 1 and yi | se(sei) ~ 1 + (1 | study), respectively, where study is a variable uniquely identifying every study. … By default, the standard errors replace the parameter sigma. To model sigma in addition to the known standard errors, set argument sigma in function se to TRUE, for instance, yi | se(sei, sigma = TRUE) ~ 1.</p>\n</blockquote>\n</section>\n<section class=\"level3\" id=\"pterms\">\n<h3 class=\"anchored\" data-anchor-id=\"pterms\">pterms</h3>\n<p><code>pterms</code> are population-level terms. Everything on the right side of formula that is not recognized as part of a group-level term is treated as a population-level effect.</p>\n</section>\n<section class=\"level3\" id=\"gterms\">\n<h3 class=\"anchored\" data-anchor-id=\"gterms\">gterms</h3>\n<p><code>gterms</code> are group-level terms that are specified as (coefs | group) where coefs contains one or more variables whose effects are assumed to vary with the levels of the grouping factor. For example, if both a group intercept and subject age vary by group, the group effects would be specified by (1 + age | group). Note that it is possible to specify multiple grouping factors, each with multiple group-level coefficients.</p>\n</section>\n</section>\n<section class=\"level2\" id=\"set-up-the-model-using-the-brms-package\">\n<h2 class=\"anchored\" data-anchor-id=\"set-up-the-model-using-the-brms-package\">Set up the model using the brms package</h2>\n<p>First, we read in the data using <code>dplyr</code> , add <code>delta_i</code> the difference in means and its standard error, <code>se_di</code>, rename Protocol to study for convenience, and drop the variables we no longer need. Note: we will refer to Protocol as study from now on.</p>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Show the code</summary>\n<pre>df &lt;- angina %&gt;% mutate(delta_i = (meanE - meanC), se_di = sqrt(varE/nE + varC/nC)) %&gt;%\n                rename(study = Protocol) %&gt;%\n                select(study, delta_i, se_di, nE,nC)\n                        \nhead(df)</pre>\n</details>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 6 × 5\n  study delta_i  se_di    nE    nC\n  &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n1 154    0.234  0.0701    46    48\n2 156    0.254  0.0958    30    26\n3 157    0.145  0.0977    75    72\n4 162   -0.135  0.125     12    12\n5 163    0.157  0.0762    32    34\n6 166    0.0894 0.0980    31    31</pre>\n</div>\n</div>\n</section>\n<section class=\"level2\" id=\"fit-the-model\">\n<h2 class=\"anchored\" data-anchor-id=\"fit-the-model\">Fit the model</h2>\n<p>Note that we are using the <em>aterm</em> <code>se</code> to inform the <code>brm()</code> function about <em>varE</em> and <em>varC</em>. The <code>sigma</code> = TRUE flag indicates that the residual standard deviation parameter sigma should be included in addition to the known measurement error. See the epsilon term in the model equations above. <code>prior</code> is an alias for the <code>set_prior()</code> function^2.</p>\n<p>The last two lines in the call to <code>brm()</code> specify that the model is to be fitted using 4 chains, each with 2000 iterations of which the first 1000 are warm up to calibrate the sampler. This provides a total of 4000 posterior samples.</p>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Show the code</summary>\n<pre>## Random effects meta-analysis\n\nfit_brms &lt;- brm(\n  # specify random standard error effect size by group. See p43 of pdf \n  # sigma = TRUS means estimate epsilon variation in addition to using standard error estimates from data\n  delta_i | se(se_di, sigma = TRUE) ~ 1 + (1 | study),\n  data = df, \n  # set priors in stan language\n  prior = c(prior(normal(0, 1), class = Intercept), \n           prior(normal(0, 1), class = sd, group = study)),\n           iter = 2000, warmup = 1000, cores = 4, chains = 4, seed = 14,\n           control = list(adapt_delta = 0.95))\n\n# Save an object to a file\nsaveRDS(fit_brms, file = \"fit_brms.rds\")</pre>\n</details>\n</div>\n<p>The model fit function shows the great advantage <code>brms</code> achieves by combining <code>lme4</code>s concise formula notation with the exact solutions provided by <code>stan</code>. Working directly in <code>stan</code> does provide great freedom, but freedom comes at the cost of easily specifying models that might not make sense. The <code>brms</code> notation helps guide users in specifying meaningful models.</p>\n<p>Note that in most cases, it is not necessary to specify Normal or t-distribution priors. The software will get it right. We included the prior statement to show how it works. Also note that in order to save processing time when running on the blog site, we read in the model fit object from the RDS file which we wrote above.</p>\n<p>Here are the results of the model fit.</p>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Show the code</summary>\n<pre># Restore the object\nfit_brms &lt;- readRDS(file = \"fit_brms.rds\")\nsummary(fit_brms)</pre>\n</details>\n<div class=\"cell-output cell-output-stdout\">\n<pre> Family: gaussian \n  Links: mu = identity; sigma = identity \nFormula: delta_i | se(se_di, sigma = TRUE) ~ 1 + (1 | study) \n   Data: df (Number of observations: 8) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nMultilevel Hyperparameters:\n~study (Number of levels: 8) \n              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsd(Intercept)     0.10      0.09     0.00     0.33 1.00     1505     2108\n\nRegression Coefficients:\n          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nIntercept     0.16      0.08     0.01     0.34 1.00     2033     1610\n\nFurther Distributional Parameters:\n      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsigma     0.10      0.09     0.00     0.33 1.00     2129     1798\n\nDraws were sampled using sampling(NUTS). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).</pre>\n</div>\n</div>\n<p>The first section of the summary gives some basic information about the model specification. Following this are the statistics for each of the estimated parameters. We see that they are in substantial agreement with the results obtained in our previous post, even though some of the details of the model specification are slightly different than the previous model fits. The payoff is the Intercept, whose value is 0.16.</p>\n<p>For each estimated parameter <em>Estimate</em> and <em>Est.Error</em> provide the mean and the standard deviation of the posterior distribution. <em>l-95% CI</em> and <em>u-95% CI</em> provide the lower and upper bounds on the 95% credible intervals. <em>Rhat</em> = 1 for each parameter indicates that the Markov chains have converged. An <em>Rhat</em> considerably greater than 1 (i.e., &gt; 1.1) would mean that the chains have not yet converged, and it would be necessary to run more iterations or perhaps set stronger priors. (See Gelman and Rubin) <em>Bulk_ESS</em> and <em>Tail_ESS</em> are diagnostics for the sampling efficiency in the bulk and tail of the posterior distribution, respectively. See the <a href=\"https://mc-stan.org/posterior/reference/ess_bulk.html\" rel=\"nofollow\" target=\"_blank\">stan documentation</a> for details and interpretation.</p>\n<p>The <code>brms</code> package also provides a plot method that provides posterior density plots and trace plots of the MCMC draws for the estimated statistics. Note that <em>b_Intercept</em> is the internal <code>stan</code> name for the population intercept.</p>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Show the code</summary>\n<pre>plot(fit_brms)</pre>\n</details>\n<div class=\"cell-output-display\">\n<div>\n<figure class=\"figure\">\n<p><a class=\"lightbox\" data-gallery=\"quarto-lightbox-gallery-1\" href=\"https://i1.wp.com/rworks.dev/posts/bma-with-brms/index_files/figure-html/unnamed-chunk-6-1.png?ssl=1\" rel=\"nofollow\" target=\"_blank\"><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i1.wp.com/rworks.dev/posts/bma-with-brms/index_files/figure-html/unnamed-chunk-6-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/rworks.dev/posts/bma-with-brms/index_files/figure-html/unnamed-chunk-6-1.png?w=450&amp;ssl=1\"/></noscript></a></p>\n</figure>\n</div>\n</div>\n</div>\n</section>\n<section class=\"level2\" id=\"plots-for-analysis\">\n<h2 class=\"anchored\" data-anchor-id=\"plots-for-analysis\">Plots for analysis</h2>\n<p>Now we will prepare a Bayesian version of a <em>forest plot</em> with the help of the <code>spread_draws()</code> function in the <code>tidybayes</code> package that collects information from the <code>fit_brms</code> object and returns it as columns in a data frame. This first code block creates two data frames <code>out_indiv</code> adds the population to the study specific intercept for each draw, while <code>out_theta</code> sets up the data to compute the mean value of population intercept. These data frames are combined into <code>out_all</code>, which is ready for plotting. The <code>mean_qi()</code> function from <code>tidybayes</code> translates draws from distributions in the grouped data frame into point and interval summaries.</p>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Show the code</summary>\n<pre># Prepare data frame for plotting\nout_indiv &lt;- spread_draws(fit_brms, r_study[study,term], b_Intercept) %&gt;%\n             mutate(Intercept = r_study + b_Intercept) %&gt;%\n             mutate(study = as.character(study)) %&gt;%\n             select(study,term,Intercept)\n \nout_theta &lt;- spread_draws(fit_brms, r_study[study,term], b_Intercept) %&gt;%\n           mutate(study = \"theta\") %&gt;%\n           mutate(Intercept = b_Intercept) %&gt;%\n           select(study,term,Intercept)\n\nout_all &lt;- bind_rows(out_indiv, out_theta) %&gt;% mutate(study = factor(study)) %&gt;% \n  ungroup() %&gt;%\n  mutate(study = str_replace_all(study, \"\\\\.\", \" \"))\n\n# Data frame of summary numbers\nout_all_sum &lt;- group_by(out_all, study) %&gt;%  mean_qi(Intercept) </pre>\n</details>\n</div>\n<p>This code stacks and plots the graphs.</p>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Show the code</summary>\n<pre># Draw plot\nout_all %&gt;%   \n  ggplot(aes(Intercept,study)) + \n  # Zero!\n  geom_vline(xintercept = 0, linewidth = .25, lty = 2) +\n  stat_halfeye(.width = c(.8, .95), fill = \"dodgerblue\") +\n  # Add text labels\n  geom_text(\n    data = mutate_if(out_all_sum, is.numeric, round, 2),\n    aes(label = str_glue(\"{Intercept} [{.lower}, {.upper}]\"), x = 0.75),\n    hjust = \"inward\"\n  ) +\n  # Observed as empty points\n  geom_point(\n    data = df %&gt;% mutate(study = str_replace_all(study, \"\\\\.\", \" \")), \n    aes(x=delta_i), position = position_nudge(y = -.2), shape = 1 \n  ) </pre>\n</details>\n<div class=\"cell-output-display\">\n<div>\n<figure class=\"figure\">\n<p><a class=\"lightbox\" data-gallery=\"quarto-lightbox-gallery-2\" href=\"https://i1.wp.com/rworks.dev/posts/bma-with-brms/index_files/figure-html/unnamed-chunk-8-1.png?ssl=1\" rel=\"nofollow\" target=\"_blank\"><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i1.wp.com/rworks.dev/posts/bma-with-brms/index_files/figure-html/unnamed-chunk-8-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/rworks.dev/posts/bma-with-brms/index_files/figure-html/unnamed-chunk-8-1.png?w=450&amp;ssl=1\"/></noscript></a></p>\n</figure>\n</div>\n</div>\n</div>\n</section>\n<section class=\"level2\" id=\"stan-code\">\n<h2 class=\"anchored\" data-anchor-id=\"stan-code\">Stan Code</h2>\n<p>Finally, we extract the stan code from the <code>fit_brms</code> object. This is an extremely useful feature for checking the model, checking that your <code>brms</code> code is doing what you think it is, and maybe for learning <code>stan</code>.</p>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Show the code</summary>\n<pre>stancode(fit_brms)</pre>\n</details>\n</div>\n<details>\n<summary>\n“stan code”\n</summary>\n<div class=\"cell\">\n<details class=\"code-fold\">\n<summary>Show the code</summary>\n<pre>stancode(fit_brms)</pre>\n</details>\n<div class=\"cell-output cell-output-stdout\">\n<pre>// generated with brms 2.21.0\nfunctions {\n}\ndata {\n  int&lt;lower=1&gt; N;  // total number of observations\n  vector[N] Y;  // response variable\n  vector&lt;lower=0&gt;[N] se;  // known sampling error\n  // data for group-level effects of ID 1\n  int&lt;lower=1&gt; N_1;  // number of grouping levels\n  int&lt;lower=1&gt; M_1;  // number of coefficients per level\n  array[N] int&lt;lower=1&gt; J_1;  // grouping indicator per observation\n  // group-level predictor values\n  vector[N] Z_1_1;\n  int prior_only;  // should the likelihood be ignored?\n}\ntransformed data {\n  vector&lt;lower=0&gt;[N] se2 = square(se);\n}\nparameters {\n  real Intercept;  // temporary intercept for centered predictors\n  real&lt;lower=0&gt; sigma;  // dispersion parameter\n  vector&lt;lower=0&gt;[M_1] sd_1;  // group-level standard deviations\n  array[M_1] vector[N_1] z_1;  // standardized group-level effects\n}\ntransformed parameters {\n  vector[N_1] r_1_1;  // actual group-level effects\n  real lprior = 0;  // prior contributions to the log posterior\n  r_1_1 = (sd_1[1] * (z_1[1]));\n  lprior += normal_lpdf(Intercept | 0, 1);\n  lprior += student_t_lpdf(sigma | 3, 0, 2.5)\n    - 1 * student_t_lccdf(0 | 3, 0, 2.5);\n  lprior += normal_lpdf(sd_1 | 0, 1)\n    - 1 * normal_lccdf(0 | 0, 1);\n}\nmodel {\n  // likelihood including constants\n  if (!prior_only) {\n    // initialize linear predictor term\n    vector[N] mu = rep_vector(0.0, N);\n    mu += Intercept;\n    for (n in 1:N) {\n      // add more terms to the linear predictor\n      mu[n] += r_1_1[J_1[n]] * Z_1_1[n];\n    }\n    target += normal_lpdf(Y | mu, sqrt(square(sigma) + se2));\n  }\n  // priors including constants\n  target += lprior;\n  target += std_normal_lpdf(z_1[1]);\n}\ngenerated quantities {\n  // actual population-level intercept\n  real b_Intercept = Intercept;\n}</pre>\n</div>\n</div>\n</details>\n</section>\n<section class=\"level2\" id=\"conclusion-and-observations\">\n<h2 class=\"anchored\" data-anchor-id=\"conclusion-and-observations\">Conclusion and Observations</h2>\n<p>There are two “take aways” from this post that we would like to emphasize.</p>\n<ol type=\"1\">\n<li><p><code>brms</code> makes it easy to specify Bayesian models that produce probability distributions that fully characterize estimated quantities. There is really no reason to settle for the frequentist point estimates that were the best that could be done before the availability of MCMC engines like <code>stan</code>.</p></li>\n<li><p>In Bayesian analysis, we use the structural assumption that unidentified population parameters generate individual outcomes that are used to create summaries of these individuals. This means knowing the individuals (or, in our case, sufficient statistics about the individuals) greatly influences our posterior estimates of plausible population parameters. With <code>brms</code> we are able to quickly infer the difference between treatment and control in a disciplined and documented fashion.</p></li>\n</ol>\n<p>We would also like to point out that our simple example which is a typical meta-analysis project is a multi-level model built without having patient-level data. If we had the patient-level data from the Amplodipine study, then we might have considered a three-level nested model: subjects within treatment arms within studies. We avoided the first level by not having the data and the second level by directly modeling the difference between treatment arms.</p>\n<ol type=\"1\">\n<li><p>See Details under <code>brmsformula</code> in the <code>brms</code> <a href=\"https://cran.r-project.org/web/packages/brms/brms.pdf\" rel=\"nofollow\" target=\"_blank\">package PDF</a>.</p></li>\n<li><p>See Details under <code>set_prior</code> on page 211 of the package PDF.</p></li>\n</ol>\n</section>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://rworks.dev/posts/bma-with-brms/\"> R Works</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
    "main_text": "Bayesian Meta-Analysis with brms\nPosted on\nJanuary 12, 2025\nby\nJoseph Rickert\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nR Works\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nIn our previous post,\nExamining Meta Analysis\n, we contrasted a frequentist version of a meta analysis conducted with R’s\nmeta\npackage with a Bayesian meta analysis done mostly in\nstan\nusing the\nrstan\npackage as a front end. We did this to hint at the difference between working within the restricted confines of a traditional frequentist framework and the amazing freedom to set up and solve complex probabilistic models using a modern Bayesian engine like\nstan\n. However, we fully acknowledge the cognitive burden of learning a completely new language and, at the same time, also learning Bayesian methods.\nIn this post, we will ease your anxiety by pointing to a middle way by using the well-established and powerful package\nbrms\n^1 to formulate\nstan\nmodels.\nSet Up\nFirst, we set up our environment and read in the data on the effect of Amlodipine on angina patients which can be found in the `meta’ package.\nShow the code\nlibrary(tidyverse)\nlibrary(brms)\nlibrary(tidybayes)\nlibrary(ggdist)\nnE\nis the number of subjects in the treatment arm for each Protocol,\nmeanE\nis the sample treatment mean for each protocol,\nvarE\nis the observed sample variance for each protocol, and\nnC\n,\nmeanC\n, and\nvarC\nare the corresponding statistics for the control arm.\nShow the code\nangina <- read_csv(file = \"Amlodipine.csv\", col_types = c(\"c\",rep(c(\"i\",\"d\",\"d\"),2))) \n\nangina\n# A tibble: 8 × 7\n  Protocol    nE meanE   varE    nC   meanC   varC\n  <chr>    <dbl> <dbl>  <dbl> <dbl>   <dbl>  <dbl>\n1 154         46 0.232 0.225     48 -0.0027 0.0007\n2 156         30 0.281 0.144     26  0.027  0.114 \n3 157         75 0.189 0.198     72  0.0443 0.497 \n4 162         12 0.093 0.139     12  0.228  0.0488\n5 163         32 0.162 0.0961    34  0.0056 0.0955\n6 166         31 0.184 0.125     31  0.0943 0.173 \n7 303         27 0.661 0.706     27 -0.0057 0.989 \n8 306         46 0.137 0.121     47 -0.0057 0.129\nReview The Model\nAs in the previous post, we will measure the effect of the amlodipine treatment by looking at the difference in the observed means from the two arms of the study. Our model can be expressed as :\nwhere for each study, i,\n, the observed treatment effect, is the mean of the control arm subtracted from the mean of the treatment arm.\nWe assume the distribution:\nis the group effect from each study\nand\nis random noise:\n.\nThe data include\n= meanE and\n= varE and the corresponding parameters for the control arm.\nWith this, we have that\nis distributed as:\nbrms Syntax\nAlthough it is much simpler than using\nstan\ndirectly,\nbrms\nis not without its own cognitive load. Using any complex package correctly and with confidence requires time and effort to understand how things work. At a minimum, it is necessary to fully comprehend the function signature and all of the options implicitly coded therein.\nA good bit of the cognitive load associated with\nbrms\nis associated with the formula interface, which it adopts form the\nlme4\npackage for formulating and solving frequentist mixed-effects models.\nbrms\nbuilds on this syntax to allow formulating expressions to set up complex, multilevel models.\nThe general formula argument^2 is structured as\nresponse\n|\naterms\n~\npterms\n+ (\ngterms\n|\ngroup\n). Everything on the right side of ∼ specifies predictors.\n+\nis used to separate different effects from each other. Note: the formula syntax is a very compressed notation, so even though it is in itself concise, explanations of it tend to be long. We very much recommend reading the package documentation.\naterms\nThe\naterms\nare optional terms that provide special information about the response variable. Especially helpful for meta-analysis, the term\nse\nspecifies the standard errors of the response variable when response is a treatment effect. The pdf states:\nSuppose that the variable yi contains the effect sizes from the studies and sei the corresponding standard errors. Then, fixed and random effects meta-analyses can be conducted using the formulas yi | se(sei) ~ 1 and yi | se(sei) ~ 1 + (1 | study), respectively, where study is a variable uniquely identifying every study. … By default, the standard errors replace the parameter sigma. To model sigma in addition to the known standard errors, set argument sigma in function se to TRUE, for instance, yi | se(sei, sigma = TRUE) ~ 1.\npterms\npterms\nare population-level terms. Everything on the right side of formula that is not recognized as part of a group-level term is treated as a population-level effect.\ngterms\ngterms\nare group-level terms that are specified as (coefs | group) where coefs contains one or more variables whose effects are assumed to vary with the levels of the grouping factor. For example, if both a group intercept and subject age vary by group, the group effects would be specified by (1 + age | group). Note that it is possible to specify multiple grouping factors, each with multiple group-level coefficients.\nSet up the model using the brms package\nFirst, we read in the data using\ndplyr\n, add\ndelta_i\nthe difference in means and its standard error,\nse_di\n, rename Protocol to study for convenience, and drop the variables we no longer need. Note: we will refer to Protocol as study from now on.\nShow the code\ndf <- angina %>% mutate(delta_i = (meanE - meanC), se_di = sqrt(varE/nE + varC/nC)) %>%\n                rename(study = Protocol) %>%\n                select(study, delta_i, se_di, nE,nC)\n                        \nhead(df)\n# A tibble: 6 × 5\n  study delta_i  se_di    nE    nC\n  <chr>   <dbl>  <dbl> <dbl> <dbl>\n1 154    0.234  0.0701    46    48\n2 156    0.254  0.0958    30    26\n3 157    0.145  0.0977    75    72\n4 162   -0.135  0.125     12    12\n5 163    0.157  0.0762    32    34\n6 166    0.0894 0.0980    31    31\nFit the model\nNote that we are using the\naterm\nse\nto inform the\nbrm()\nfunction about\nvarE\nand\nvarC\n. The\nsigma\n= TRUE flag indicates that the residual standard deviation parameter sigma should be included in addition to the known measurement error. See the epsilon term in the model equations above.\nprior\nis an alias for the\nset_prior()\nfunction^2.\nThe last two lines in the call to\nbrm()\nspecify that the model is to be fitted using 4 chains, each with 2000 iterations of which the first 1000 are warm up to calibrate the sampler. This provides a total of 4000 posterior samples.\nShow the code\n## Random effects meta-analysis\n\nfit_brms <- brm(\n  # specify random standard error effect size by group. See p43 of pdf \n  # sigma = TRUS means estimate epsilon variation in addition to using standard error estimates from data\n  delta_i | se(se_di, sigma = TRUE) ~ 1 + (1 | study),\n  data = df, \n  # set priors in stan language\n  prior = c(prior(normal(0, 1), class = Intercept), \n           prior(normal(0, 1), class = sd, group = study)),\n           iter = 2000, warmup = 1000, cores = 4, chains = 4, seed = 14,\n           control = list(adapt_delta = 0.95))\n\n# Save an object to a file\nsaveRDS(fit_brms, file = \"fit_brms.rds\")\nThe model fit function shows the great advantage\nbrms\nachieves by combining\nlme4\ns concise formula notation with the exact solutions provided by\nstan\n. Working directly in\nstan\ndoes provide great freedom, but freedom comes at the cost of easily specifying models that might not make sense. The\nbrms\nnotation helps guide users in specifying meaningful models.\nNote that in most cases, it is not necessary to specify Normal or t-distribution priors. The software will get it right. We included the prior statement to show how it works. Also note that in order to save processing time when running on the blog site, we read in the model fit object from the RDS file which we wrote above.\nHere are the results of the model fit.\nShow the code\n# Restore the object\nfit_brms <- readRDS(file = \"fit_brms.rds\")\nsummary(fit_brms)\nFamily: gaussian \n  Links: mu = identity; sigma = identity \nFormula: delta_i | se(se_di, sigma = TRUE) ~ 1 + (1 | study) \n   Data: df (Number of observations: 8) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nMultilevel Hyperparameters:\n~study (Number of levels: 8) \n              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsd(Intercept)     0.10      0.09     0.00     0.33 1.00     1505     2108\n\nRegression Coefficients:\n          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nIntercept     0.16      0.08     0.01     0.34 1.00     2033     1610\n\nFurther Distributional Parameters:\n      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsigma     0.10      0.09     0.00     0.33 1.00     2129     1798\n\nDraws were sampled using sampling(NUTS). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\nThe first section of the summary gives some basic information about the model specification. Following this are the statistics for each of the estimated parameters. We see that they are in substantial agreement with the results obtained in our previous post, even though some of the details of the model specification are slightly different than the previous model fits. The payoff is the Intercept, whose value is 0.16.\nFor each estimated parameter\nEstimate\nand\nEst.Error\nprovide the mean and the standard deviation of the posterior distribution.\nl-95% CI\nand\nu-95% CI\nprovide the lower and upper bounds on the 95% credible intervals.\nRhat\n= 1 for each parameter indicates that the Markov chains have converged. An\nRhat\nconsiderably greater than 1 (i.e., > 1.1) would mean that the chains have not yet converged, and it would be necessary to run more iterations or perhaps set stronger priors. (See Gelman and Rubin)\nBulk_ESS\nand\nTail_ESS\nare diagnostics for the sampling efficiency in the bulk and tail of the posterior distribution, respectively. See the\nstan documentation\nfor details and interpretation.\nThe\nbrms\npackage also provides a plot method that provides posterior density plots and trace plots of the MCMC draws for the estimated statistics. Note that\nb_Intercept\nis the internal\nstan\nname for the population intercept.\nShow the code\nplot(fit_brms)\nPlots for analysis\nNow we will prepare a Bayesian version of a\nforest plot\nwith the help of the\nspread_draws()\nfunction in the\ntidybayes\npackage that collects information from the\nfit_brms\nobject and returns it as columns in a data frame. This first code block creates two data frames\nout_indiv\nadds the population to the study specific intercept for each draw, while\nout_theta\nsets up the data to compute the mean value of population intercept. These data frames are combined into\nout_all\n, which is ready for plotting. The\nmean_qi()\nfunction from\ntidybayes\ntranslates draws from distributions in the grouped data frame into point and interval summaries.\nShow the code\n# Prepare data frame for plotting\nout_indiv <- spread_draws(fit_brms, r_study[study,term], b_Intercept) %>%\n             mutate(Intercept = r_study + b_Intercept) %>%\n             mutate(study = as.character(study)) %>%\n             select(study,term,Intercept)\n \nout_theta <- spread_draws(fit_brms, r_study[study,term], b_Intercept) %>%\n           mutate(study = \"theta\") %>%\n           mutate(Intercept = b_Intercept) %>%\n           select(study,term,Intercept)\n\nout_all <- bind_rows(out_indiv, out_theta) %>% mutate(study = factor(study)) %>% \n  ungroup() %>%\n  mutate(study = str_replace_all(study, \"\\\\.\", \" \"))\n\n# Data frame of summary numbers\nout_all_sum <- group_by(out_all, study) %>%  mean_qi(Intercept)\nThis code stacks and plots the graphs.\nShow the code\n# Draw plot\nout_all %>%   \n  ggplot(aes(Intercept,study)) + \n  # Zero!\n  geom_vline(xintercept = 0, linewidth = .25, lty = 2) +\n  stat_halfeye(.width = c(.8, .95), fill = \"dodgerblue\") +\n  # Add text labels\n  geom_text(\n    data = mutate_if(out_all_sum, is.numeric, round, 2),\n    aes(label = str_glue(\"{Intercept} [{.lower}, {.upper}]\"), x = 0.75),\n    hjust = \"inward\"\n  ) +\n  # Observed as empty points\n  geom_point(\n    data = df %>% mutate(study = str_replace_all(study, \"\\\\.\", \" \")), \n    aes(x=delta_i), position = position_nudge(y = -.2), shape = 1 \n  )\nStan Code\nFinally, we extract the stan code from the\nfit_brms\nobject. This is an extremely useful feature for checking the model, checking that your\nbrms\ncode is doing what you think it is, and maybe for learning\nstan\n.\nShow the code\nstancode(fit_brms)\n“stan code”\nShow the code\nstancode(fit_brms)\n// generated with brms 2.21.0\nfunctions {\n}\ndata {\n  int<lower=1> N;  // total number of observations\n  vector[N] Y;  // response variable\n  vector<lower=0>[N] se;  // known sampling error\n  // data for group-level effects of ID 1\n  int<lower=1> N_1;  // number of grouping levels\n  int<lower=1> M_1;  // number of coefficients per level\n  array[N] int<lower=1> J_1;  // grouping indicator per observation\n  // group-level predictor values\n  vector[N] Z_1_1;\n  int prior_only;  // should the likelihood be ignored?\n}\ntransformed data {\n  vector<lower=0>[N] se2 = square(se);\n}\nparameters {\n  real Intercept;  // temporary intercept for centered predictors\n  real<lower=0> sigma;  // dispersion parameter\n  vector<lower=0>[M_1] sd_1;  // group-level standard deviations\n  array[M_1] vector[N_1] z_1;  // standardized group-level effects\n}\ntransformed parameters {\n  vector[N_1] r_1_1;  // actual group-level effects\n  real lprior = 0;  // prior contributions to the log posterior\n  r_1_1 = (sd_1[1] * (z_1[1]));\n  lprior += normal_lpdf(Intercept | 0, 1);\n  lprior += student_t_lpdf(sigma | 3, 0, 2.5)\n    - 1 * student_t_lccdf(0 | 3, 0, 2.5);\n  lprior += normal_lpdf(sd_1 | 0, 1)\n    - 1 * normal_lccdf(0 | 0, 1);\n}\nmodel {\n  // likelihood including constants\n  if (!prior_only) {\n    // initialize linear predictor term\n    vector[N] mu = rep_vector(0.0, N);\n    mu += Intercept;\n    for (n in 1:N) {\n      // add more terms to the linear predictor\n      mu[n] += r_1_1[J_1[n]] * Z_1_1[n];\n    }\n    target += normal_lpdf(Y | mu, sqrt(square(sigma) + se2));\n  }\n  // priors including constants\n  target += lprior;\n  target += std_normal_lpdf(z_1[1]);\n}\ngenerated quantities {\n  // actual population-level intercept\n  real b_Intercept = Intercept;\n}\nConclusion and Observations\nThere are two “take aways” from this post that we would like to emphasize.\nbrms\nmakes it easy to specify Bayesian models that produce probability distributions that fully characterize estimated quantities. There is really no reason to settle for the frequentist point estimates that were the best that could be done before the availability of MCMC engines like\nstan\n.\nIn Bayesian analysis, we use the structural assumption that unidentified population parameters generate individual outcomes that are used to create summaries of these individuals. This means knowing the individuals (or, in our case, sufficient statistics about the individuals) greatly influences our posterior estimates of plausible population parameters. With\nbrms\nwe are able to quickly infer the difference between treatment and control in a disciplined and documented fashion.\nWe would also like to point out that our simple example which is a typical meta-analysis project is a multi-level model built without having patient-level data. If we had the patient-level data from the Amplodipine study, then we might have considered a three-level nested model: subjects within treatment arms within studies. We avoided the first level by not having the data and the second level by directly modeling the difference between treatment arms.\nSee Details under\nbrmsformula\nin the\nbrms\npackage PDF\n.\nSee Details under\nset_prior\non page 211 of the package PDF.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nR Works\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "In our previous post, Examining Meta Analysis, we contrasted a frequentist version of a meta analysis conducted with R’s meta package with a Bayesian meta analysis done mostly in stan using the rstan package as a front end. We did this to hint a...",
    "meta_keywords": null,
    "og_description": "In our previous post, Examining Meta Analysis, we contrasted a frequentist version of a meta analysis conducted with R’s meta package with a Bayesian meta analysis done mostly in stan using the rstan package as a front end. We did this to hint a...",
    "og_image": "https://latex.codecogs.com/png.latex?%5Cdelta_i%20=%20%5Ctheta%20+%20%5Cnu_i%20+%20%5Cepsilon",
    "og_title": "Bayesian Meta-Analysis with brms | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 13,
    "sitemap_lastmod": null,
    "twitter_description": "In our previous post, Examining Meta Analysis, we contrasted a frequentist version of a meta analysis conducted with R’s meta package with a Bayesian meta analysis done mostly in stan using the rstan package as a front end. We did this to hint a...",
    "twitter_title": "Bayesian Meta-Analysis with brms | R-bloggers",
    "url": "https://www.r-bloggers.com/2025/01/bayesian-meta-analysis-with-brms/",
    "word_count": 2594
  }
}