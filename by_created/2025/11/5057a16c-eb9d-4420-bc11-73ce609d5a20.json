{
  "uuid": "5057a16c-eb9d-4420-bc11-73ce609d5a20",
  "created_at": "2025-11-17 20:38:33",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2024/01/powerquery-puzzle-solved-with-r-9/",
    "crawled_at": "2025-11-17T09:17:42.147155",
    "external_links": [
      {
        "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-bbdbfb786b90",
        "text": "Numbers around us - Medium"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://www.linkedin.com/in/excelbi/",
        "text": "ExcelBI"
      },
      {
        "href": "https://github.com/kgryczan/excelbi_puzzles",
        "text": "Github"
      },
      {
        "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-bbdbfb786b90",
        "text": "PowerQuery Puzzle solved with R"
      },
      {
        "href": "https://medium.com/number-around-us",
        "text": "Numbers around us"
      },
      {
        "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-bbdbfb786b90",
        "text": "Numbers around us - Medium"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "PowerQuery Puzzle solved with R | R-bloggers",
    "images": [
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*RTQh0Ax9w7hNJqfKY7T_eQ.jpeg?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/cdn-images-1.medium.com/max/1024/1*fmFYGdyrWOolISAt68iVNw.png?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*QtIh8V0GxrDelcgqjV3TDg.png?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*Bc5DqS4Xdcz_Ix-pbd_Eog.png?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:application/octet-stream;base64,R0lGODlhAQABAO+/vQAA77+977+977+9AAAAIe+/vQQBAAAAACwAAAAAAQABAAACAkQBADs=",
        "src": "https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=bbdbfb786b90"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/numbers-around-us/",
        "text": "Numbers around us"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-381533 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">PowerQuery Puzzle solved with R</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">January 16, 2024</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/numbers-around-us/\">Numbers around us</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-bbdbfb786b90\"> Numbers around us - Medium</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9--><p>#147–148</p><figure><img alt=\"\" data-lazy-src=\"https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*RTQh0Ax9w7hNJqfKY7T_eQ.jpeg?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*RTQh0Ax9w7hNJqfKY7T_eQ.jpeg?w=578&amp;ssl=1\"/></noscript></figure><h3>Puzzles</h3><p>Author: <a href=\"https://www.linkedin.com/in/excelbi/\" rel=\"nofollow\" target=\"_blank\">ExcelBI</a></p><p>All files (xlsx with puzzle and R with solution) for each and every puzzle are available on my <a href=\"https://github.com/kgryczan/excelbi_puzzles\" rel=\"nofollow\" target=\"_blank\">Github</a>. Enjoy.</p><h3>Puzzle #147</h3><figure><img alt=\"\" data-lazy-src=\"https://i2.wp.com/cdn-images-1.medium.com/max/1024/1*fmFYGdyrWOolISAt68iVNw.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/cdn-images-1.medium.com/max/1024/1*fmFYGdyrWOolISAt68iVNw.png?w=578&amp;ssl=1\"/></noscript></figure><p>Picture above showing sudoku-like puzzles looks difficult, but puzzle itself is really hardcore. Probably one of the toughests since I join this puzzle solving. We get table filled with data like unsolved sudoku (that is theme of image). We need to populate it with proper data filling sometimes up, sometimes down. Easier to say than to do. Just look on this spreadsheet. There are even empty rows to fill.</p><figure><img alt=\"\" data-lazy-src=\"https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*QtIh8V0GxrDelcgqjV3TDg.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*QtIh8V0GxrDelcgqjV3TDg.png?w=578&amp;ssl=1\"/></noscript></figure><p>So lets check how I did it. I’ll try to explain my chain of thoughts while solving.</p><h4>Load libraries and data</h4><pre>library(tidyverse)\nlibrary(readxl)\n\ninput = read_excel(\"Power Query/PQ_Challenge_147.xlsx\", range = \"A1:D17\")\ntest  = read_excel(\"Power Query/PQ_Challenge_147.xlsx\", range = \"F1:I17\") %&gt;%\n  janitor::clean_names()</pre><h4>Transformation</h4><pre>reshape &lt;- function(input) {\n  input %&gt;%\n    janitor::clean_names() %&gt;%\n    mutate(nr = row_number()) %&gt;%\n    # for each column enumerate not empty cells\n    mutate(across(c(cust_id, cust_name, amount, type),\n                  ~ ifelse(is.na(.), NA, cumsum(!is.na(.))),\n                  .names = \"index_{.col}\"),\n    # for each row find max index which will be used to find cust_id per row\n           max_index = pmax(index_cust_id, index_cust_name, index_amount, index_type, na.rm = TRUE)) %&gt;%\n    group_by(max_index) %&gt;%\n    mutate(across(c(cust_id, cust_name, amount, type),\n                  ~ max(., na.rm = TRUE)),\n    # for each max_index get first and last row in which it occurs\n           min_row = min(nr, na.rm = TRUE),\n           max_row = max(nr, na.rm = TRUE)) %&gt;%\n    ungroup() %&gt;%\n    # remove originally empty rows\n    filter(!is.na(max_index)) %&gt;%\n    select(-starts_with(\"index_\"), -max_index, -nr) %&gt;%\n    distinct() %&gt;%\n    # using first and last row per index make sequence and unnest it to rows\n    mutate(row_seq = map2(min_row, max_row, seq)) %&gt;%\n    unnest(row_seq) %&gt;%\n    select(-min_row, -max_row, -row_seq) %&gt;%\n    group_by(cust_id) %&gt;%\n    # final touch. add original row number to type\n    mutate(type = paste0(type, row_number())) %&gt;%\n    ungroup()\n}\n\n\nresult = reshape(input)</pre><h4>Validation</h4><pre>identical(result, test)\n# [1] TRUE</pre><h3>Puzzle #148</h3><figure><img alt=\"\" data-lazy-src=\"https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*Bc5DqS4Xdcz_Ix-pbd_Eog.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*Bc5DqS4Xdcz_Ix-pbd_Eog.png?w=578&amp;ssl=1\"/></noscript></figure><p>After one hardcore, comes one pretty nice and easy to solve. And it is about fruits. What we get is column with strings containing names of fruits. We need to split them separately, count them and put in some kind of crosstab. Little bit weird because both rows and columns has the same dimension, name of fruit. Let go into.</p><h4>Load libraries and data</h4><pre>library(tidyverse)\nlibrary(readxl)\n\ninput = read_excel(\"Power Query/PQ_Challenge_148.xlsx\", range = \"A1:A12\")\ntest  = read_excel(\"Power Query/PQ_Challenge_148.xlsx\", range = \"C1:N12\") </pre><h4>Transformation</h4><pre>result = input %&gt;%\n  separate_rows(Fruits, sep = \", \") %&gt;%\n  mutate(Fruits = str_remove_all(Fruits, \" \")) %&gt;%\n  group_by(Fruits) %&gt;%\n  summarise(Count = n()) %&gt;%\n  ungroup() %&gt;%\n  mutate(Fruits2 = Fruits) %&gt;%\n  pivot_wider(names_from = Fruits2, values_from = Count) </pre><h4>Validation</h4><pre>all.equal(result, test)\n#&gt; [1] TRUE\n\n# Today for the first time I used all.equal() instead of identical(). \n# Main reason is because if there are NAs, NA is not identical to NA,\n# it return NA instead of TRUE. But NA is equal to NA, so final df is not\n# identical, but it is equal to given answer.  \n# In our eyes we can say they are the same. </pre><p>Feel free to comment, share and contact me with advices, questions and your ideas how to improve anything. Contact me on Linkedin if you wish as well.</p><img alt=\"\" data-lazy-src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=bbdbfb786b90\" height=\"1\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"1\"/><noscript><img alt=\"\" height=\"1\" loading=\"lazy\" src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=bbdbfb786b90\" width=\"1\"/></noscript><hr/><p><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-bbdbfb786b90\" rel=\"nofollow\" target=\"_blank\">PowerQuery Puzzle solved with R</a> was originally published in <a href=\"https://medium.com/number-around-us\" rel=\"nofollow\" target=\"_blank\">Numbers around us</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-bbdbfb786b90\"> Numbers around us - Medium</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
    "main_text": "PowerQuery Puzzle solved with R\nPosted on\nJanuary 16, 2024\nby\nNumbers around us\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nNumbers around us - Medium\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\n#147–148\nPuzzles\nAuthor:\nExcelBI\nAll files (xlsx with puzzle and R with solution) for each and every puzzle are available on my\nGithub\n. Enjoy.\nPuzzle #147\nPicture above showing sudoku-like puzzles looks difficult, but puzzle itself is really hardcore. Probably one of the toughests since I join this puzzle solving. We get table filled with data like unsolved sudoku (that is theme of image). We need to populate it with proper data filling sometimes up, sometimes down. Easier to say than to do. Just look on this spreadsheet. There are even empty rows to fill.\nSo lets check how I did it. I’ll try to explain my chain of thoughts while solving.\nLoad libraries and data\nlibrary(tidyverse)\nlibrary(readxl)\n\ninput = read_excel(\"Power Query/PQ_Challenge_147.xlsx\", range = \"A1:D17\")\ntest  = read_excel(\"Power Query/PQ_Challenge_147.xlsx\", range = \"F1:I17\") %>%\n  janitor::clean_names()\nTransformation\nreshape <- function(input) {\n  input %>%\n    janitor::clean_names() %>%\n    mutate(nr = row_number()) %>%\n    # for each column enumerate not empty cells\n    mutate(across(c(cust_id, cust_name, amount, type),\n                  ~ ifelse(is.na(.), NA, cumsum(!is.na(.))),\n                  .names = \"index_{.col}\"),\n    # for each row find max index which will be used to find cust_id per row\n           max_index = pmax(index_cust_id, index_cust_name, index_amount, index_type, na.rm = TRUE)) %>%\n    group_by(max_index) %>%\n    mutate(across(c(cust_id, cust_name, amount, type),\n                  ~ max(., na.rm = TRUE)),\n    # for each max_index get first and last row in which it occurs\n           min_row = min(nr, na.rm = TRUE),\n           max_row = max(nr, na.rm = TRUE)) %>%\n    ungroup() %>%\n    # remove originally empty rows\n    filter(!is.na(max_index)) %>%\n    select(-starts_with(\"index_\"), -max_index, -nr) %>%\n    distinct() %>%\n    # using first and last row per index make sequence and unnest it to rows\n    mutate(row_seq = map2(min_row, max_row, seq)) %>%\n    unnest(row_seq) %>%\n    select(-min_row, -max_row, -row_seq) %>%\n    group_by(cust_id) %>%\n    # final touch. add original row number to type\n    mutate(type = paste0(type, row_number())) %>%\n    ungroup()\n}\n\nresult = reshape(input)\nValidation\nidentical(result, test)\n# [1] TRUE\nPuzzle #148\nAfter one hardcore, comes one pretty nice and easy to solve. And it is about fruits. What we get is column with strings containing names of fruits. We need to split them separately, count them and put in some kind of crosstab. Little bit weird because both rows and columns has the same dimension, name of fruit. Let go into.\nLoad libraries and data\nlibrary(tidyverse)\nlibrary(readxl)\n\ninput = read_excel(\"Power Query/PQ_Challenge_148.xlsx\", range = \"A1:A12\")\ntest  = read_excel(\"Power Query/PQ_Challenge_148.xlsx\", range = \"C1:N12\")\nTransformation\nresult = input %>%\n  separate_rows(Fruits, sep = \", \") %>%\n  mutate(Fruits = str_remove_all(Fruits, \" \")) %>%\n  group_by(Fruits) %>%\n  summarise(Count = n()) %>%\n  ungroup() %>%\n  mutate(Fruits2 = Fruits) %>%\n  pivot_wider(names_from = Fruits2, values_from = Count)\nValidation\nall.equal(result, test)\n#> [1] TRUE\n\n# Today for the first time I used all.equal() instead of identical(). \n# Main reason is because if there are NAs, NA is not identical to NA,\n# it return NA instead of TRUE. But NA is equal to NA, so final df is not\n# identical, but it is equal to given answer.  \n# In our eyes we can say they are the same.\nFeel free to comment, share and contact me with advices, questions and your ideas how to improve anything. Contact me on Linkedin if you wish as well.\nPowerQuery Puzzle solved with R\nwas originally published in\nNumbers around us\non Medium, where people are continuing the conversation by highlighting and responding to this story.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nNumbers around us - Medium\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "#147–148PuzzlesAuthor: ExcelBIAll files (xlsx with puzzle and R with solution) for each and every puzzle are available on my Github. Enjoy.Puzzle #147Picture above showing sudoku-like puzzles looks difficult, but puzzle itself is really hardcore. Proba...",
    "meta_keywords": null,
    "og_description": "#147–148PuzzlesAuthor: ExcelBIAll files (xlsx with puzzle and R with solution) for each and every puzzle are available on my Github. Enjoy.Puzzle #147Picture above showing sudoku-like puzzles looks difficult, but puzzle itself is really hardcore. Proba...",
    "og_image": "https://cdn-images-1.medium.com/max/1024/1*RTQh0Ax9w7hNJqfKY7T_eQ.jpeg",
    "og_title": "PowerQuery Puzzle solved with R | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 3.4,
    "sitemap_lastmod": "2024-01-16T12:20:01+00:00",
    "twitter_description": "#147–148PuzzlesAuthor: ExcelBIAll files (xlsx with puzzle and R with solution) for each and every puzzle are available on my Github. Enjoy.Puzzle #147Picture above showing sudoku-like puzzles looks difficult, but puzzle itself is really hardcore. Proba...",
    "twitter_title": "PowerQuery Puzzle solved with R | R-bloggers",
    "url": "https://www.r-bloggers.com/2024/01/powerquery-puzzle-solved-with-r-9/",
    "word_count": 682
  }
}