{
  "id": "e2d98e6c89d02f27e20a8a0fdda304556e7b51c9",
  "url": "https://www.r-bloggers.com/2025/05/cross-checking-osm-ids-between-osm-and-wikidata/",
  "created_at_utc": "2025-11-22T19:58:41Z",
  "data": null,
  "raw_original": {
    "uuid": "da852d73-74bf-4e09-be02-8e8e2d804e4f",
    "created_at": "2025-11-22 19:58:41",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2025/05/cross-checking-osm-ids-between-osm-and-wikidata/",
      "crawled_at": "2025-11-22T10:49:31.310193",
      "external_links": [
        {
          "href": "https://r.iresmi.net/posts/2025/osm_wikidata/",
          "text": "r.iresmi.net"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://www.flickr.com/photos/visavis/33263096951/",
          "text": null
        },
        {
          "href": "https://wiki.openstreetmap.org/wiki/Elements",
          "text": "elements"
        },
        {
          "href": "https://www.wikidata.org/wiki/Wikidata:Data_model",
          "text": "entities"
        },
        {
          "href": "https://www.openstreetmap.org/node/281399025",
          "text": "Mont Blanc"
        },
        {
          "href": "https://www.wikidata.org/wiki/Q583",
          "text": "Mont Blanc"
        },
        {
          "href": "https://www.wikidata.org/wiki/Property:P11693",
          "text": "P11693"
        },
        {
          "href": "https://fr.wikipedia.org/wiki/Termignon",
          "text": "Termignon"
        },
        {
          "href": "https://www.wikidata.org/wiki/Property:P11693",
          "text": "nodes"
        },
        {
          "href": "https://www.wikidata.org/wiki/Property:P10689",
          "text": "ways"
        },
        {
          "href": "https://www.wikidata.org/wiki/Property:P402",
          "text": "relations"
        },
        {
          "href": "https://r.iresmi.net/posts/2025/osm_wikidata/",
          "text": "r.iresmi.net"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Cross checking OSM IDs between OSM and Wikidata | R-bloggers",
      "images": [
        {
          "alt": "Mont Blanc mountain",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Mont Blanc mountain",
          "base64": null,
          "src": "https://i2.wp.com/r.iresmi.net/posts/2025/osm_wikidata/images/33263096951_e118992ac0_c.jpg?w=578&ssl=1"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/michael/",
          "text": "Michael"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-392247 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Cross checking OSM IDs between OSM and Wikidata</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">May 3, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/michael/\">Michael</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://r.iresmi.net/posts/2025/osm_wikidata/\"> r.iresmi.net</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div class=\"cell\">\n<div class=\"cell-output-display\">\n<div class=\"quarto-figure quarto-figure-center\">\n<figure class=\"figure\">\n<p><a href=\"https://www.flickr.com/photos/visavis/33263096951/\" rel=\"nofollow\" target=\"_blank\"><img alt=\"Mont Blanc mountain\" class=\"img-fluid figure-img\" data-lazy-src=\"https://i2.wp.com/r.iresmi.net/posts/2025/osm_wikidata/images/33263096951_e118992ac0_c.jpg?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" style=\"width:100.0%\"/><noscript><img alt=\"Mont Blanc mountain\" class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/r.iresmi.net/posts/2025/osm_wikidata/images/33263096951_e118992ac0_c.jpg?w=578&amp;ssl=1\" style=\"width:100.0%\"/></noscript></a></p>\n<figcaption>Mont Blanc – CC-BY-NC-ND by Viktor Kirilko</figcaption>\n</figure>\n</div>\n</div>\n</div>\n<p>Some OpenStreetMap <a href=\"https://wiki.openstreetmap.org/wiki/Elements\" rel=\"nofollow\" target=\"_blank\">elements</a> have Wikidata <a href=\"https://www.wikidata.org/wiki/Wikidata:Data_model\" rel=\"nofollow\" target=\"_blank\">entities</a> as attributes, like for example the summit of <a href=\"https://www.openstreetmap.org/node/281399025\" rel=\"nofollow\" target=\"_blank\">Mont Blanc</a> has the key/value pair <code>wikidata=Q583</code> directing to <a href=\"https://www.wikidata.org/wiki/Q583\" rel=\"nofollow\" target=\"_blank\">Mont Blanc</a> where we can see it has the correct identifier “OpenStreetMap node ID” (<a href=\"https://www.wikidata.org/wiki/Property:P11693\" rel=\"nofollow\" target=\"_blank\"><code>P11693</code></a>) directing back to the point <code>281399025</code>; and everything is fine…</p>\n<p>However, sometimes Wikidata entities are missing the OSM ID(s). Here is my workflow to find these entities in a defined area to check and complete them.</p>\n<section class=\"level2\" id=\"config\">\n<h2 class=\"anchored\" data-anchor-id=\"config\">Config</h2>\n<div class=\"cell\">\n<pre>library(osmdata)   # get data from OSM\nlibrary(WikidataR) # get data from Wikidata\nlibrary(sf)\nlibrary(dplyr)\nlibrary(purrr)\nlibrary(tidyr)\nlibrary(glue)\nlibrary(janitor)</pre>\n</div>\n</section>\n<section class=\"level1\" id=\"data\">\n<h1>Data</h1>\n<p>First we chose an area of interest, here around <a href=\"https://fr.wikipedia.org/wiki/Termignon\" rel=\"nofollow\" target=\"_blank\">Termignon</a>, and get the OSM data.</p>\n<div class=\"cell\">\n<pre>osm_wd &lt;- getbb(\"Termignon, France\") |&gt; \n  opq() |&gt; \n  add_osm_feature(key = \"wikidata\") |&gt; \n  osmdata_sf()</pre>\n</div>\n<section class=\"level2\" id=\"utilities\">\n<h2 class=\"anchored\" data-anchor-id=\"utilities\">Utilities</h2>\n<p>Then we make two functions that will allow us to query the Wikidata API to get the OSM identifiers associated to a Wikidata entity. There are three properties needed (for <a href=\"https://www.wikidata.org/wiki/Property:P11693\" rel=\"nofollow\" target=\"_blank\">nodes</a>, <a href=\"https://www.wikidata.org/wiki/Property:P10689\" rel=\"nofollow\" target=\"_blank\">ways</a> and <a href=\"https://www.wikidata.org/wiki/Property:P402\" rel=\"nofollow\" target=\"_blank\">relations</a>). An entity can have zero, one, two or three of these properties, and for each property it can have one or several IDs.</p>\n<div class=\"cell\">\n<pre>#' Get the OpenStreetMap IDs of a wikidata item\n#'\n#' @param item (char) wikidata ID (e.g. \"Q19368619\")\n#'\n#' @returns (vec&lt;char&gt;) \n#'   OSM ID (possibly several), prefixed with \n#'    \"n\" for \"node\",\n#'    \"w\" for \"way\" and\n#'    \"r\" for relation\n#'  NULL if no OSM ID or\n#'  NA if not available,\n#' @example get_wd_osm_id(\"Q19368619\")\nget_wd_osm_id &lt;- purrr::possibly(function(item) {\n  \n  # avoid spending time querying if no wikidata item\n  if (is.na(item) | item == \"\" | !stringr::str_detect(item, \"Q[0-9]+\")) { \n    return(NA_character_)\n  } else {\n    i &lt;- WikidataR::get_item(item)\n    \n    # P402 relation\n    relation &lt;- purrr::pluck(i, \n                             1, \"claims\", \"P402\", \"mainsnak\", \"datavalue\", \"value\")\n    relation &lt;- if (!is.null(relation)) { paste0(\"r\", relation) } else { NULL }\n    \n    # P10689 way\n    way &lt;- purrr::pluck(i, \n                        1, \"claims\", \"P10689\", \"mainsnak\", \"datavalue\", \"value\")\n    way &lt;- if (!is.null(way)) { paste0(\"w\", way) } else { NULL }\n    \n    # P11693 node\n    node &lt;- purrr::pluck(i, \n                         1, \"claims\", \"P11693\", \"mainsnak\", \"datavalue\", \"value\")\n    node &lt;- if (!is.null(node)) { paste0(\"n\", node) } else { NULL }\n    \n    return(purrr::compact(c(relation, way, node)))\n  }\n}, otherwise = NA_character_)\n\n#' Add a column with the OpenStreetMap IDs from wikidata\n#' \n#' For all features of an osmdata sf object having a wikidata ID, get the \n#' associated OSM IDs recorded in wikidata\n#'\n#' @param osmdata_features (sf) osmdata sub-object (osm_points, osm_lines,...)\n#'   with a `wikidata` column\n#'\n#' @returns (sf) input object with a new column `wd_osm_id` as a list-column of\n#'   character IDs (or NULL)\n#' @examples add_osmid_from_wikidata(my_osmdata_sf$osm_points)\nadd_osm_id_from_wikidata &lt;- function(osmdata_features) {\n  geom_type &lt;- sf::st_geometry_type(osmdata_features, by_geometry = FALSE)\n  osmdata_features |&gt;\n    tibble::as_tibble(.name_repair = janitor::make_clean_names) |&gt; \n    dplyr::mutate(\n      wd_osm_id = purrr::map(\n        wikidata,\n        slowly(get_wd_osm_id), \n        .progress = glue::glue(\"Getting OSM ID for {geom_type}...\")))\n}\n\n#' Add a prefix to the OSM ID according to the element geometry type\n#' \n#' It will allow us to compare `osm_id` and `wd_osm_id`\n#'\n#' @param x (sf) OSM data sub-object\n#'\n#' @returns x with the `osm_id` field prefixed with \"n\" for \"node\",\n#'    \"w\" for \"way\" and \"r\" for relation\n#' @examples prefix_osm_id(osm_wd$osm_points)\nprefix_osm_id &lt;- function(x, p = c(\"n\", \"w\", \"r\")) {\n  geom_type &lt;- sf::st_geometry_type(osmdata_features, by_geometry = FALSE)\n  p &lt;- case_when(geom_type == \"POINT\" ~ \"n\",\n                 geom_type %in% c(\"LINESTRING\", \"POLYGON\") ~ \"w\",\n                 geom_type %in% c(\"MULTILINESTRING\", \"MULTIPOLYGON\") ~ \"r\",\n                 .default = \"\")\n  \n  x |&gt; \n    mutate(osm_id = glue(\"{p}{osm_id}\"))\n}</pre>\n</div>\n<p>With these functions we can look at our OSM data, keep those having a Wikidata attribute, and for these entities get their OSM IDs, allowing us to check if they are similar or, for those missing, adding the ID manually in Wikidata. Since the OSM data is dispatched in different objects, according the geometry type, we need to do it for each of them.</p>\n<div class=\"cell\">\n<pre>osm_wd_augmented &lt;- list(\n  prefix_osm_id(osm_wd$osm_points, \"n\"),\n  prefix_osm_id(osm_wd$osm_lines, \"w\"),\n  prefix_osm_id(osm_wd$osm_polygons, \"w\"),\n  prefix_osm_id(osm_wd$osm_multilines, \"r\"),\n  prefix_osm_id(osm_wd$osm_multipolygons, \"r\")) |&gt;\n  map(\\(x) {\n    x |&gt; \n      filter(!is.na(wikidata) &amp; wikidata != \"\") |&gt; \n      add_osm_id_from_wikidata() |&gt; \n      select(osm_id, name, wikidata, wd_osm_id) |&gt; \n      unnest(wd_osm_id, keep_empty = TRUE)}) |&gt; \n  list_rbind() |&gt; \n  distinct()</pre>\n</div>\n<p>We get a new variable <code>wd_osm_id</code> whose signification is “<em>it is one of the OSM identifiers in the Wikidata entity which is indicated in the OSM element</em>”</p>\n</section>\n<section class=\"level2\" id=\"use-cases\">\n<h2 class=\"anchored\" data-anchor-id=\"use-cases\">Use cases</h2>\n<p>For example if we want to see the OSM elements having a Wikidata entity not linking back:</p>\n<div class=\"cell\">\n<pre>osm_wd_augmented |&gt; \n  filter(is.na(wd_osm_id)) |&gt; \n  arrange(name)</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 29 × 4\n   osm_id      name                                 wikidata   wd_osm_id\n   &lt;glue&gt;      &lt;chr&gt;                                &lt;chr&gt;      &lt;chr&gt;    \n 1 w194448267  Cenischia                            Q3539637   &lt;NA&gt;     \n 2 n41645050   Champagny-en-Vanoise                 Q34791526  &lt;NA&gt;     \n 3 w108980863  Chapelle Notre-Dame de la Visitation Q13518652  &lt;NA&gt;     \n 4 w131213010  Chapelle Saint-Antoine               Q22975798  &lt;NA&gt;     \n 5 w131213054  Chapelle Saint-Sébastien             Q22968509  &lt;NA&gt;     \n 6 n4573291011 Cinéma Chantelouve                   Q61858809  &lt;NA&gt;     \n 7 r2149907    Communauté de Communes Terra Modana  Q17355571  &lt;NA&gt;     \n 8 w37792978   Dora di Bardonecchia                 Q3714186   &lt;NA&gt;     \n 9 w131215535  Espace Baroque                       Q22968504  &lt;NA&gt;     \n10 r377905     GR 55 La Vanoise                     Q124149580 &lt;NA&gt;     \n# ℹ 19 more rows</pre>\n</div>\n</div>\n<p>Some are maybe legit (?), but some other may need editing…</p>\n<p>Another example, check incoherence between <code>osm_id</code> and <code>wd_osm_id</code>:</p>\n<div class=\"cell\">\n<pre>osm_wd_augmented |&gt; \n  filter(osm_id != wd_osm_id) |&gt; \n  arrange(name)</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 25 × 4\n   osm_id       name                                          wikidata wd_osm_id\n   &lt;glue&gt;       &lt;chr&gt;                                         &lt;chr&gt;    &lt;chr&gt;    \n 1 n26691864    Albertville                                   Q159469  r111528  \n 2 n26691864    Albertville                                   Q159469  r17160712\n 3 n41644953    Aussois                                       Q567783  r89823   \n 4 r2149905     Communauté de Communes de Haute Maurienne-Va… Q2987514 r6876759 \n 5 n11646993705 Dent Parrachée                                Q1189850 n6705389…\n 6 w1257820968  Ferrovia del Moncenisio                       Q950823  r15987785\n 7 w1257820969  Ferrovia del Moncenisio                       Q950823  r15987785\n 8 w1257820970  Ferrovia del Moncenisio                       Q950823  r15987785\n 9 w1257820971  Ferrovia del Moncenisio                       Q950823  r15987785\n10 w993297614   Glacier de Méan-Martin                        Q348352… w42239115\n# ℹ 15 more rows</pre>\n</div>\n</div>\n<p>It could indicate that the OSM elements have been heavily edited or deleted/recreated without updating the corresponding Wikidata entity.</p>\n<p>Corrections require manual back and forth between R, the OSM and Wikidata websites, but these utilities make it quite easy to improve data quality.</p>\n<!-- -->\n</section>\n</section>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://r.iresmi.net/posts/2025/osm_wikidata/\"> r.iresmi.net</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
      "main_text": "Cross checking OSM IDs between OSM and Wikidata\nPosted on\nMay 3, 2025\nby\nMichael\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nr.iresmi.net\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nMont Blanc – CC-BY-NC-ND by Viktor Kirilko\nSome OpenStreetMap\nelements\nhave Wikidata\nentities\nas attributes, like for example the summit of\nMont Blanc\nhas the key/value pair\nwikidata=Q583\ndirecting to\nMont Blanc\nwhere we can see it has the correct identifier “OpenStreetMap node ID” (\nP11693\n) directing back to the point\n281399025\n; and everything is fine…\nHowever, sometimes Wikidata entities are missing the OSM ID(s). Here is my workflow to find these entities in a defined area to check and complete them.\nConfig\nlibrary(osmdata)   # get data from OSM\nlibrary(WikidataR) # get data from Wikidata\nlibrary(sf)\nlibrary(dplyr)\nlibrary(purrr)\nlibrary(tidyr)\nlibrary(glue)\nlibrary(janitor)\nData\nFirst we chose an area of interest, here around\nTermignon\n, and get the OSM data.\nosm_wd <- getbb(\"Termignon, France\") |> \n  opq() |> \n  add_osm_feature(key = \"wikidata\") |> \n  osmdata_sf()\nUtilities\nThen we make two functions that will allow us to query the Wikidata API to get the OSM identifiers associated to a Wikidata entity. There are three properties needed (for\nnodes\n,\nways\nand\nrelations\n). An entity can have zero, one, two or three of these properties, and for each property it can have one or several IDs.\n#' Get the OpenStreetMap IDs of a wikidata item\n#'\n#' @param item (char) wikidata ID (e.g. \"Q19368619\")\n#'\n#' @returns (vec<char>) \n#'   OSM ID (possibly several), prefixed with \n#'    \"n\" for \"node\",\n#'    \"w\" for \"way\" and\n#'    \"r\" for relation\n#'  NULL if no OSM ID or\n#'  NA if not available,\n#' @example get_wd_osm_id(\"Q19368619\")\nget_wd_osm_id <- purrr::possibly(function(item) {\n  \n  # avoid spending time querying if no wikidata item\n  if (is.na(item) | item == \"\" | !stringr::str_detect(item, \"Q[0-9]+\")) { \n    return(NA_character_)\n  } else {\n    i <- WikidataR::get_item(item)\n    \n    # P402 relation\n    relation <- purrr::pluck(i, \n                             1, \"claims\", \"P402\", \"mainsnak\", \"datavalue\", \"value\")\n    relation <- if (!is.null(relation)) { paste0(\"r\", relation) } else { NULL }\n    \n    # P10689 way\n    way <- purrr::pluck(i, \n                        1, \"claims\", \"P10689\", \"mainsnak\", \"datavalue\", \"value\")\n    way <- if (!is.null(way)) { paste0(\"w\", way) } else { NULL }\n    \n    # P11693 node\n    node <- purrr::pluck(i, \n                         1, \"claims\", \"P11693\", \"mainsnak\", \"datavalue\", \"value\")\n    node <- if (!is.null(node)) { paste0(\"n\", node) } else { NULL }\n    \n    return(purrr::compact(c(relation, way, node)))\n  }\n}, otherwise = NA_character_)\n\n#' Add a column with the OpenStreetMap IDs from wikidata\n#' \n#' For all features of an osmdata sf object having a wikidata ID, get the \n#' associated OSM IDs recorded in wikidata\n#'\n#' @param osmdata_features (sf) osmdata sub-object (osm_points, osm_lines,...)\n#'   with a `wikidata` column\n#'\n#' @returns (sf) input object with a new column `wd_osm_id` as a list-column of\n#'   character IDs (or NULL)\n#' @examples add_osmid_from_wikidata(my_osmdata_sf$osm_points)\nadd_osm_id_from_wikidata <- function(osmdata_features) {\n  geom_type <- sf::st_geometry_type(osmdata_features, by_geometry = FALSE)\n  osmdata_features |>\n    tibble::as_tibble(.name_repair = janitor::make_clean_names) |> \n    dplyr::mutate(\n      wd_osm_id = purrr::map(\n        wikidata,\n        slowly(get_wd_osm_id), \n        .progress = glue::glue(\"Getting OSM ID for {geom_type}...\")))\n}\n\n#' Add a prefix to the OSM ID according to the element geometry type\n#' \n#' It will allow us to compare `osm_id` and `wd_osm_id`\n#'\n#' @param x (sf) OSM data sub-object\n#'\n#' @returns x with the `osm_id` field prefixed with \"n\" for \"node\",\n#'    \"w\" for \"way\" and \"r\" for relation\n#' @examples prefix_osm_id(osm_wd$osm_points)\nprefix_osm_id <- function(x, p = c(\"n\", \"w\", \"r\")) {\n  geom_type <- sf::st_geometry_type(osmdata_features, by_geometry = FALSE)\n  p <- case_when(geom_type == \"POINT\" ~ \"n\",\n                 geom_type %in% c(\"LINESTRING\", \"POLYGON\") ~ \"w\",\n                 geom_type %in% c(\"MULTILINESTRING\", \"MULTIPOLYGON\") ~ \"r\",\n                 .default = \"\")\n  \n  x |> \n    mutate(osm_id = glue(\"{p}{osm_id}\"))\n}\nWith these functions we can look at our OSM data, keep those having a Wikidata attribute, and for these entities get their OSM IDs, allowing us to check if they are similar or, for those missing, adding the ID manually in Wikidata. Since the OSM data is dispatched in different objects, according the geometry type, we need to do it for each of them.\nosm_wd_augmented <- list(\n  prefix_osm_id(osm_wd$osm_points, \"n\"),\n  prefix_osm_id(osm_wd$osm_lines, \"w\"),\n  prefix_osm_id(osm_wd$osm_polygons, \"w\"),\n  prefix_osm_id(osm_wd$osm_multilines, \"r\"),\n  prefix_osm_id(osm_wd$osm_multipolygons, \"r\")) |>\n  map(\\(x) {\n    x |> \n      filter(!is.na(wikidata) & wikidata != \"\") |> \n      add_osm_id_from_wikidata() |> \n      select(osm_id, name, wikidata, wd_osm_id) |> \n      unnest(wd_osm_id, keep_empty = TRUE)}) |> \n  list_rbind() |> \n  distinct()\nWe get a new variable\nwd_osm_id\nwhose signification is “\nit is one of the OSM identifiers in the Wikidata entity which is indicated in the OSM element\n”\nUse cases\nFor example if we want to see the OSM elements having a Wikidata entity not linking back:\nosm_wd_augmented |> \n  filter(is.na(wd_osm_id)) |> \n  arrange(name)\n# A tibble: 29 × 4\n   osm_id      name                                 wikidata   wd_osm_id\n   <glue>      <chr>                                <chr>      <chr>    \n 1 w194448267  Cenischia                            Q3539637   <NA>     \n 2 n41645050   Champagny-en-Vanoise                 Q34791526  <NA>     \n 3 w108980863  Chapelle Notre-Dame de la Visitation Q13518652  <NA>     \n 4 w131213010  Chapelle Saint-Antoine               Q22975798  <NA>     \n 5 w131213054  Chapelle Saint-Sébastien             Q22968509  <NA>     \n 6 n4573291011 Cinéma Chantelouve                   Q61858809  <NA>     \n 7 r2149907    Communauté de Communes Terra Modana  Q17355571  <NA>     \n 8 w37792978   Dora di Bardonecchia                 Q3714186   <NA>     \n 9 w131215535  Espace Baroque                       Q22968504  <NA>     \n10 r377905     GR 55 La Vanoise                     Q124149580 <NA>     \n# ℹ 19 more rows\nSome are maybe legit (?), but some other may need editing…\nAnother example, check incoherence between\nosm_id\nand\nwd_osm_id\n:\nosm_wd_augmented |> \n  filter(osm_id != wd_osm_id) |> \n  arrange(name)\n# A tibble: 25 × 4\n   osm_id       name                                          wikidata wd_osm_id\n   <glue>       <chr>                                         <chr>    <chr>    \n 1 n26691864    Albertville                                   Q159469  r111528  \n 2 n26691864    Albertville                                   Q159469  r17160712\n 3 n41644953    Aussois                                       Q567783  r89823   \n 4 r2149905     Communauté de Communes de Haute Maurienne-Va… Q2987514 r6876759 \n 5 n11646993705 Dent Parrachée                                Q1189850 n6705389…\n 6 w1257820968  Ferrovia del Moncenisio                       Q950823  r15987785\n 7 w1257820969  Ferrovia del Moncenisio                       Q950823  r15987785\n 8 w1257820970  Ferrovia del Moncenisio                       Q950823  r15987785\n 9 w1257820971  Ferrovia del Moncenisio                       Q950823  r15987785\n10 w993297614   Glacier de Méan-Martin                        Q348352… w42239115\n# ℹ 15 more rows\nIt could indicate that the OSM elements have been heavily edited or deleted/recreated without updating the corresponding Wikidata entity.\nCorrections require manual back and forth between R, the OSM and Wikidata websites, but these utilities make it quite easy to improve data quality.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nr.iresmi.net\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "Mont Blanc – CC-BY-NC-ND by Viktor Kirilko Some OpenStreetMap elements have Wikidata entities as attributes, like for example the summit of Mont Blanc has the key/value pair wikidata=Q583 directing to Mont Blanc where we can see it has ...",
      "meta_keywords": null,
      "og_description": "Mont Blanc – CC-BY-NC-ND by Viktor Kirilko Some OpenStreetMap elements have Wikidata entities as attributes, like for example the summit of Mont Blanc has the key/value pair wikidata=Q583 directing to Mont Blanc where we can see it has ...",
      "og_image": "https://r.iresmi.net/posts/2025/osm_wikidata/images/33263096951_e118992ac0_c.jpg",
      "og_title": "Cross checking OSM IDs between OSM and Wikidata | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 5.4,
      "sitemap_lastmod": null,
      "twitter_description": "Mont Blanc – CC-BY-NC-ND by Viktor Kirilko Some OpenStreetMap elements have Wikidata entities as attributes, like for example the summit of Mont Blanc has the key/value pair wikidata=Q583 directing to Mont Blanc where we can see it has ...",
      "twitter_title": "Cross checking OSM IDs between OSM and Wikidata | R-bloggers",
      "url": "https://www.r-bloggers.com/2025/05/cross-checking-osm-ids-between-osm-and-wikidata/",
      "word_count": 1073
    }
  }
}