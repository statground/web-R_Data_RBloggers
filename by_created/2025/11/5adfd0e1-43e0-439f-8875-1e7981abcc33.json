{
  "uuid": "5adfd0e1-43e0-439f-8875-1e7981abcc33",
  "created_at": "2025-11-17 20:39:10",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2023/11/using-benchmarking-to-guide-the-adoption-of-dependencies-in-r-packages/",
    "crawled_at": "2025-11-17T09:53:40.615568",
    "external_links": [
      {
        "href": "https://epiverse-trace.github.io/posts/benchmarking_design_decisions/",
        "text": "Epiverse-TRACE developer space"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://cli.r-lib.org/articles/semantic-cli.html",
        "text": "cli"
      },
      {
        "href": "https://cli.r-lib.org/",
        "text": "website"
      },
      {
        "href": "https://cran.r-project.org/web/packages/bench/index.html",
        "text": "bench"
      },
      {
        "href": "https://dplyr.tidyverse.org/",
        "text": "dplyr"
      },
      {
        "href": "https://ggplot2.tidyverse.org/",
        "text": "ggplot2"
      },
      {
        "href": "https://github.com/joshuaulrich/microbenchmark",
        "text": "microbenchmark"
      },
      {
        "href": "https://code.google.com/archive/p/rbenchmark/",
        "text": "rbenchmark"
      },
      {
        "href": "https://github.com/collectivemedia/tictoc",
        "text": "tictok"
      },
      {
        "href": "https://github.com/lorenzwalthert/touchstone/tree/main",
        "text": "touchstone"
      },
      {
        "href": "https://creativecommons.org/licenses/by/4.0/",
        "text": "CC BY 4.0"
      },
      {
        "href": "https://epiverse-trace.github.io//posts/benchmarking_design_decisions",
        "text": "https://epiverse-trace.github.io//posts/benchmarking_design_decisions"
      },
      {
        "href": "https://epiverse-trace.github.io/posts/benchmarking_design_decisions/",
        "text": "Epiverse-TRACE developer space"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Using benchmarking to guide the adoption of dependencies in R packages | R-bloggers",
    "images": [
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/epiverse-trace.github.io/posts/benchmarking_design_decisions/index_files/figure-html/unnamed-chunk-11-1.png?w=450&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i0.wp.com/epiverse-trace.github.io/posts/benchmarking_design_decisions/index_files/figure-html/unnamed-chunk-12-1.png?w=450&ssl=1"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/james-mba-azam/",
        "text": "James Mba Azam"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-380247 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Using benchmarking to guide the adoption of dependencies in R packages</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">November 21, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/james-mba-azam/\">James Mba Azam</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://epiverse-trace.github.io/posts/benchmarking_design_decisions/\"> Epiverse-TRACE developer space</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-2_0a2ec7d38e9ea06380d825f14f6bb229\">\n<pre>library(bench)\nlibrary(cli)\nlibrary(dplyr)\nlibrary(ggplot2)</pre>\n</div>\n<p>R package developers often have to take on dependencies for various reasons. Dependencies are external packages that provide extra functionalities or features to another package <span class=\"citation\" data-cites=\"wickham2023r\">(Wickham and Bryan 2023)</span>. Quite often, the goal of taking on a dependency is to utilize its rich features and reduce duplicated coding effort. For example, the <code>ggplot2</code> package is often adopted, instead of R’s inbuilt plotting functions, to make visualizations using its declarative system and implementation of the Grammar of Graphics, and slick automation across the board.</p>\n<p>Sometimes, introducing a dependency might slow down existing processes. Hence, it is important to consider the speed of a dependency’s functions before adopting it. Code optimisation is often reserved for heavy processes like data processing steps. However, here, we will focus on lesser optimised processes, and in particular, printing of texts in R.</p>\n<p>For this demonstration, we will look at a situation where a package developer is considering options for condition signalling beyond the functionalities provided in base R. Condition signalling refers to the process of communicating to a user that an issue has arisen during code execution <span class=\"citation\" data-cites=\"wickham2019advanced\">(Wickham 2019)</span>.</p>\n<p>Base R ships with functionalities for condition signalling. There is <code>base::stop()</code> for signalling errors. Errors refer to cases where something fatal happens during code execution so that it halts, for example, when a function is run without specifying the required arguments.</p>\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-3_629334328ed1f15628bd14baa045adb7\">\n<pre>rnorm()</pre>\n<div class=\"cell-output cell-output-error\">\n<pre>Error in rnorm(): argument \"n\" is missing, with no default</pre>\n</div>\n</div>\n<p>Base R provides <code>base::warning()</code> for throwing warnings. Warnings are used to handle less fatal issues with code execution that do not need to halt the process. For example, when you compare two vectors of different lengths, R will throw a warning but will still return a result.</p>\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-4_53d77875f26fd1c6f1accb75fa8d8366\">\n<pre>c(1:2) &gt; c(1:3)</pre>\n<div class=\"cell-output cell-output-stderr\">\n<pre>Warning in c(1:2) &gt; c(1:3): longer object length is not a multiple of shorter\nobject length</pre>\n</div>\n<div class=\"cell-output cell-output-stdout\">\n<pre>[1] FALSE FALSE FALSE</pre>\n</div>\n</div>\n<p>Lastly, there is <code>base::message()</code> for throwing messages. Messages are used to provide useful information about processes. For example, sometimes, when you load a package, R will throw a message to indicate that the package has been loaded.</p>\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-5_e0e505ebc837174ee1b8456f534d1af0\">\n<pre>library(dplyr)</pre>\n</div>\n<p>These base R functions are, however, not flexible enough for advanced formatting: colour, progress bar, contextual pluralisation, and so forth. The package developer might want to adopt external dependencies for these flexibilities. The <a href=\"https://cli.r-lib.org/articles/semantic-cli.html\" rel=\"nofollow\" target=\"_blank\">cli</a> package is well designed for this. <code>cli</code> offers many of the advanced formatting features. Here is a quick example (adopted from the help file) using <code>cli::cli_abort()</code>, the equivalent of <code>base::stop()</code>.</p>\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-6_549d605e9fabee5726c9366d82d9f7f0\">\n<pre>n &lt;- \"c(1, 2, 3)\"\ncli_abort(\n    c(\n      \"{.var n} must be a numeric vector\",\n      \"x\" = \"You've supplied a {.cls {class(n)}} vector.\"\n    )\n)</pre>\n<div class=\"cell-output cell-output-error\">\n<pre>Error:\n! `n` must be a numeric vector\n✖ You've supplied a &lt;character&gt; vector.</pre>\n</div>\n</div>\n<p>In this example, we used inline text formatting to print <code>n</code> as a variable and interpolated code to print the class of <code>n</code> in the error message and all in just 6 lines of code.</p>\n<p>If this is enough to excite your interests, check out <code>cli</code>’s <a href=\"https://cli.r-lib.org/\" rel=\"nofollow\" target=\"_blank\">website</a> and help files, which provide in-depth guides on its myriad features.</p>\n<p>Now, considering all these amazing features that <code>cli</code> offers, what should a package developer consider to adopt it? In this article, we will demonstrate how to use (micro)benchmarking<sup>1</sup> to guide the decision through the lense of speed. Benchmarking can be used to check whether adopting <code>cli</code> as a dependency would slow down existing printing processes in undesirable ways.</p>\n<p>Here, we will benchmark <code>cli::cli_warn()</code> against base R’s <code>base::warning()</code> to see if the former has any speed issues. The results of this exercise will provide us with insights on whether its worth taking on <code>cli</code> for its features as a trade-off for slower printing speed.</p>\n<section class=\"level2\" id=\"experiment\">\n<h2 class=\"anchored\" data-anchor-id=\"experiment\">Experiment</h2>\n<p>We will consider different scenarios of number of warnings thrown to tease out the relationship between speed of the function and number of warnings thrown in a function with and without <code>cli::cli_warn()</code>. We will also check how the benchmark scales with the number of warnings in the function.</p>\n<p>Based on this description, we will need the following packages: <code>cli</code> for its warning function, and <a href=\"https://cran.r-project.org/web/packages/bench/index.html\" rel=\"nofollow\" target=\"_blank\">bench</a> for measuring the run times, <a href=\"https://dplyr.tidyverse.org/\" rel=\"nofollow\" target=\"_blank\">dplyr</a> for manipulating the results, and <a href=\"https://ggplot2.tidyverse.org/\" rel=\"nofollow\" target=\"_blank\">ggplot2</a> for plotting.</p>\n<p>Let’s define a function that takes an argument <code>n</code> for the number of warnings to throw and <code>pkg</code> for the type of package to use.</p>\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-7_71188b7abdbc468bfc356ea681b11a3e\">\n<pre>warn_Ntimes &lt;- function(n, pkg) {\n  warning_msg &lt;- \"x must be an integer\"\n  switch(pkg,\n    base = for (i in seq_len(n)) {\n      warning(warning_msg)\n    },\n    cli = for (i in seq_len(n)) {\n      cli_warn(warning_msg)\n    }\n  )\n}</pre>\n</div>\n<p>Let’s test our function to see if it works as expected.</p>\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-8_b2124bb03ff9b8ec22e22516661bd38e\">\n<pre>warn_Ntimes(3, \"base\")</pre>\n<div class=\"cell-output cell-output-stderr\">\n<pre>Warning in warn_Ntimes(3, \"base\"): x must be an integer\n\nWarning in warn_Ntimes(3, \"base\"): x must be an integer\n\nWarning in warn_Ntimes(3, \"base\"): x must be an integer</pre>\n</div>\n<pre>warn_Ntimes(3, \"cli\")</pre>\n<div class=\"cell-output cell-output-stderr\">\n<pre>Warning: x must be an integer</pre>\n</div>\n<div class=\"cell-output cell-output-stderr\">\n<pre>Warning: x must be an integer\nx must be an integer</pre>\n</div>\n</div>\n<p>Now, we’ll consider scenarios where a function throws 1, 5, 10, 15, 20, and 100 warnings using base R and <code>cli</code>.</p>\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-9_202006e941090e6e2fd79826c263afd3\">\n<pre># Number of warnings to throw\nwarnings &lt;- c(1, 5, 10, 15, 20, 100)</pre>\n</div>\n<p>Let’s run benchmarks over the different scenarios and store results in a data.frame.</p>\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-10_c9761cbedeb5ab662f89090949c7f2a2\">\n<pre>bnmark_res &lt;- press(\n  warnings = c(1, 5, 10, 15, 20, 100),\n    mark(\n      cli = warn_Ntimes(warnings, \"cli\"),\n      base = warn_Ntimes(warnings, \"base\")\n    )\n  )</pre>\n</div>\n</section>\n<section class=\"level2\" id=\"results\">\n<h2 class=\"anchored\" data-anchor-id=\"results\">Results</h2>\n<p>It’s time to explore the results of the data generated. Let’s first make a boxplot of the run times for the different scenarios.</p>\n<p>Drum roll please…</p>\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-11_bf5bd5c36fb9bb794aa23a88b4d6ad0b\">\n<pre>autoplot(\n  bnmark_res,\n  type = \"boxplot\"\n  ) +\n  labs(\n    x = \"Package\",\n    caption = \"Functions throwing various numbers of warnings as indicated in the facet label\"\n  )</pre>\n<div class=\"cell-output cell-output-stderr\">\n<pre>Loading required namespace: tidyr</pre>\n</div>\n<div class=\"cell-output-display\">\n<div>\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i2.wp.com/epiverse-trace.github.io/posts/benchmarking_design_decisions/index_files/figure-html/unnamed-chunk-11-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/epiverse-trace.github.io/posts/benchmarking_design_decisions/index_files/figure-html/unnamed-chunk-11-1.png?w=450&amp;ssl=1\"/></noscript></p>\n</figure>\n</div>\n</div>\n</div>\n<p>Now, let’s see how the benchmarks scale with the number of warnings thrown.</p>\n<div class=\"cell\" data-hash=\"index_cache/html/unnamed-chunk-12_9fbeecc1659a3d5548d52aab04da9a01\">\n<pre>bnmark_res$pkg &lt;- attr(bnmark_res$expression, \"description\")\n\nggplot(bnmark_res) +\n  geom_line(\n    aes(\n      x = warnings,\n      y = median,\n      color = pkg\n    ),\n    linewidth = 2\n  ) +\n  labs(\n    x = \"Number of warnigns\",\n    y = \"Median execution time\",\n    color = \"Package\"\n  )</pre>\n<div class=\"cell-output-display\">\n<div>\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i0.wp.com/epiverse-trace.github.io/posts/benchmarking_design_decisions/index_files/figure-html/unnamed-chunk-12-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/epiverse-trace.github.io/posts/benchmarking_design_decisions/index_files/figure-html/unnamed-chunk-12-1.png?w=450&amp;ssl=1\"/></noscript></p>\n</figure>\n</div>\n</div>\n</div>\n<p>As we can see, <code>cli</code> is consistently slower than base R for the same number of warnings thrown. The median times also follow a similar non-linear trajectory. Benchmarking experiments with other <code>cli</code> functions have revealed similar non-linear relationships between its speed and the number of times it invokes those functions <sup>2</sup>. However, those exercises were not compared with equivalent functions in base R. The relative comparison here is useful for decision-making.</p>\n<p>The developers of <code>cli</code> have also conducted benchmarks of the <code>ansi_*()</code> family of functions in <code>cli</code> in comparison to base R and the <code>fansi</code> package. They find that <code>cli</code> is consistently slower than base R, which corroborates the results of our experiment here. These benchmarks are available in the <code>cli</code> documentation <sup>3</sup>.</p>\n<p>So, should we be worried about the speed of <code>cli</code>? Well, it depends on the context. The “R Packages” book by Hadley Wickham and Jenny Bryan suggests approaching such a decision from a holistic, balanced, and quantitative approach<span class=\"citation\" data-cites=\"wickham2023r\">(Wickham and Bryan 2023)</span>. We’ll leave the reader to make their own decision based on their use case.</p>\n<p>Most developers might argue that this is an optimisation overkill<sup>4</sup>. However, it is important to consider speed differences in context. In the case of simple printing, the speed difference is negligible yet disruptive and somewhat painful. However, in the grand scheme of things, this might be nothing compared with much slower processes that need more attention. In those cases, the developer might want to consider other optimisation strategies such as profiling <sup>5</sup>. The essence of this experiment is to demonstrate the utility of benchmarking in making quick design decisions.</p>\n</section>\n<section class=\"level2\" id=\"conclusion\">\n<h2 class=\"anchored\" data-anchor-id=\"conclusion\">Conclusion</h2>\n<p>In designing R package infrastructure with dependencies, it might sometimes be necessary to check if they don’t slow down existing processes. Here, we have demonstrated how benchmarking is one way to achieve this for a process involving condition signalling. We show how a simple decision to use <code>cli::cli_warn()</code> to handle warnings could come at the cost of a tiny loss in speed, which is worth considering in its context.</p>\n<p>The demonstration here can be extended to other dependency adoption decisions for input checking, loops, object manipulations, and so forth. We recommend benchmarking as a way to help developers make quick design decisions. However, we also recommend that developers consider the context of the optimisation in interpreting the results.</p>\n</section>\n<section class=\"level2\" id=\"other-r-packages-for-benchmarking\">\n<h2 class=\"anchored\" data-anchor-id=\"other-r-packages-for-benchmarking\">Other R packages for benchmarking</h2>\n<ul>\n<li><a href=\"https://github.com/joshuaulrich/microbenchmark\" rel=\"nofollow\" target=\"_blank\">microbenchmark</a>: an R package for comparing the execution time of R expressions.</li>\n<li><a href=\"https://code.google.com/archive/p/rbenchmark/\" rel=\"nofollow\" target=\"_blank\">rbenchmark</a>: an R package for benchmarking R code.</li>\n<li><a href=\"https://github.com/collectivemedia/tictoc\" rel=\"nofollow\" target=\"_blank\">tictok</a>: an R package to time R functions</li>\n<li><a href=\"https://github.com/lorenzwalthert/touchstone/tree/main\" rel=\"nofollow\" target=\"_blank\">touchstone</a>: an R package for benchmarking of pull requests with statistical confidence.</li>\n</ul>\n</section>\n<div class=\"default\" id=\"quarto-appendix\"><section class=\"quarto-appendix-contents\"><h2 class=\"anchored quarto-appendix-heading\">References</h2><div class=\"references csl-bib-body hanging-indent\" data-entry-spacing=\"0\" id=\"refs\">\n<div class=\"csl-entry\" id=\"ref-wickham2019advanced\">\nWickham, Hadley. 2019. <em>Advanced r</em>. CRC press.\n</div>\n<div class=\"csl-entry\" id=\"ref-wickham2023r\">\nWickham, Hadley, and Jennifer Bryan. 2023. <em>R Packages</em>. \" O’Reilly Media, Inc.\".\n</div>\n</div></section><section class=\"quarto-appendix-contents\"><h2 class=\"anchored quarto-appendix-heading\">Reuse</h2><div class=\"quarto-appendix-contents\" id=\"quarto-reuse\"><div><a href=\"https://creativecommons.org/licenses/by/4.0/\" rel=\"nofollow\" target=\"_blank\">CC BY 4.0</a></div></div></section><section class=\"quarto-appendix-contents\"><h2 class=\"anchored quarto-appendix-heading\">Citation</h2><div><div class=\"quarto-appendix-secondary-label\">BibTeX citation:</div><pre>@online{mba azam2023,\n  author = {Mba Azam, James},\n  title = {Using Benchmarking to Guide the Adoption of Dependencies in\n    {R} Packages},\n  date = {2023-11-22},\n  url = {https://epiverse-trace.github.io//posts/benchmarking_design_decisions},\n  langid = {en}\n}\n</pre><div class=\"quarto-appendix-secondary-label\">For attribution, please cite this work as:</div><div class=\"csl-entry quarto-appendix-citeas\" id=\"ref-mba azam2023\">\nMba Azam, James. 2023. <span>“Using Benchmarking to Guide the Adoption\nof Dependencies in R Packages.”</span> November 22, 2023. <a href=\"https://epiverse-trace.github.io//posts/benchmarking_design_decisions\" rel=\"nofollow\" target=\"_blank\">https://epiverse-trace.github.io//posts/benchmarking_design_decisions</a>.\n</div></div></section></div>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://epiverse-trace.github.io/posts/benchmarking_design_decisions/\"> Epiverse-TRACE developer space</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
    "main_text": "Using benchmarking to guide the adoption of dependencies in R packages\nPosted on\nNovember 21, 2023\nby\nJames Mba Azam\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nEpiverse-TRACE developer space\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nlibrary(bench)\nlibrary(cli)\nlibrary(dplyr)\nlibrary(ggplot2)\nR package developers often have to take on dependencies for various reasons. Dependencies are external packages that provide extra functionalities or features to another package\n(Wickham and Bryan 2023)\n. Quite often, the goal of taking on a dependency is to utilize its rich features and reduce duplicated coding effort. For example, the\nggplot2\npackage is often adopted, instead of R’s inbuilt plotting functions, to make visualizations using its declarative system and implementation of the Grammar of Graphics, and slick automation across the board.\nSometimes, introducing a dependency might slow down existing processes. Hence, it is important to consider the speed of a dependency’s functions before adopting it. Code optimisation is often reserved for heavy processes like data processing steps. However, here, we will focus on lesser optimised processes, and in particular, printing of texts in R.\nFor this demonstration, we will look at a situation where a package developer is considering options for condition signalling beyond the functionalities provided in base R. Condition signalling refers to the process of communicating to a user that an issue has arisen during code execution\n(Wickham 2019)\n.\nBase R ships with functionalities for condition signalling. There is\nbase::stop()\nfor signalling errors. Errors refer to cases where something fatal happens during code execution so that it halts, for example, when a function is run without specifying the required arguments.\nrnorm()\nError in rnorm(): argument \"n\" is missing, with no default\nBase R provides\nbase::warning()\nfor throwing warnings. Warnings are used to handle less fatal issues with code execution that do not need to halt the process. For example, when you compare two vectors of different lengths, R will throw a warning but will still return a result.\nc(1:2) > c(1:3)\nWarning in c(1:2) > c(1:3): longer object length is not a multiple of shorter\nobject length\n[1] FALSE FALSE FALSE\nLastly, there is\nbase::message()\nfor throwing messages. Messages are used to provide useful information about processes. For example, sometimes, when you load a package, R will throw a message to indicate that the package has been loaded.\nlibrary(dplyr)\nThese base R functions are, however, not flexible enough for advanced formatting: colour, progress bar, contextual pluralisation, and so forth. The package developer might want to adopt external dependencies for these flexibilities. The\ncli\npackage is well designed for this.\ncli\noffers many of the advanced formatting features. Here is a quick example (adopted from the help file) using\ncli::cli_abort()\n, the equivalent of\nbase::stop()\n.\nn <- \"c(1, 2, 3)\"\ncli_abort(\n    c(\n      \"{.var n} must be a numeric vector\",\n      \"x\" = \"You've supplied a {.cls {class(n)}} vector.\"\n    )\n)\nError:\n! `n` must be a numeric vector\n✖ You've supplied a <character> vector.\nIn this example, we used inline text formatting to print\nn\nas a variable and interpolated code to print the class of\nn\nin the error message and all in just 6 lines of code.\nIf this is enough to excite your interests, check out\ncli\n’s\nwebsite\nand help files, which provide in-depth guides on its myriad features.\nNow, considering all these amazing features that\ncli\noffers, what should a package developer consider to adopt it? In this article, we will demonstrate how to use (micro)benchmarking\n1\nto guide the decision through the lense of speed. Benchmarking can be used to check whether adopting\ncli\nas a dependency would slow down existing printing processes in undesirable ways.\nHere, we will benchmark\ncli::cli_warn()\nagainst base R’s\nbase::warning()\nto see if the former has any speed issues. The results of this exercise will provide us with insights on whether its worth taking on\ncli\nfor its features as a trade-off for slower printing speed.\nExperiment\nWe will consider different scenarios of number of warnings thrown to tease out the relationship between speed of the function and number of warnings thrown in a function with and without\ncli::cli_warn()\n. We will also check how the benchmark scales with the number of warnings in the function.\nBased on this description, we will need the following packages:\ncli\nfor its warning function, and\nbench\nfor measuring the run times,\ndplyr\nfor manipulating the results, and\nggplot2\nfor plotting.\nLet’s define a function that takes an argument\nn\nfor the number of warnings to throw and\npkg\nfor the type of package to use.\nwarn_Ntimes <- function(n, pkg) {\n  warning_msg <- \"x must be an integer\"\n  switch(pkg,\n    base = for (i in seq_len(n)) {\n      warning(warning_msg)\n    },\n    cli = for (i in seq_len(n)) {\n      cli_warn(warning_msg)\n    }\n  )\n}\nLet’s test our function to see if it works as expected.\nwarn_Ntimes(3, \"base\")\nWarning in warn_Ntimes(3, \"base\"): x must be an integer\n\nWarning in warn_Ntimes(3, \"base\"): x must be an integer\n\nWarning in warn_Ntimes(3, \"base\"): x must be an integer\nwarn_Ntimes(3, \"cli\")\nWarning: x must be an integer\nWarning: x must be an integer\nx must be an integer\nNow, we’ll consider scenarios where a function throws 1, 5, 10, 15, 20, and 100 warnings using base R and\ncli\n.\n# Number of warnings to throw\nwarnings <- c(1, 5, 10, 15, 20, 100)\nLet’s run benchmarks over the different scenarios and store results in a data.frame.\nbnmark_res <- press(\n  warnings = c(1, 5, 10, 15, 20, 100),\n    mark(\n      cli = warn_Ntimes(warnings, \"cli\"),\n      base = warn_Ntimes(warnings, \"base\")\n    )\n  )\nResults\nIt’s time to explore the results of the data generated. Let’s first make a boxplot of the run times for the different scenarios.\nDrum roll please…\nautoplot(\n  bnmark_res,\n  type = \"boxplot\"\n  ) +\n  labs(\n    x = \"Package\",\n    caption = \"Functions throwing various numbers of warnings as indicated in the facet label\"\n  )\nLoading required namespace: tidyr\nNow, let’s see how the benchmarks scale with the number of warnings thrown.\nbnmark_res$pkg <- attr(bnmark_res$expression, \"description\")\n\nggplot(bnmark_res) +\n  geom_line(\n    aes(\n      x = warnings,\n      y = median,\n      color = pkg\n    ),\n    linewidth = 2\n  ) +\n  labs(\n    x = \"Number of warnigns\",\n    y = \"Median execution time\",\n    color = \"Package\"\n  )\nAs we can see,\ncli\nis consistently slower than base R for the same number of warnings thrown. The median times also follow a similar non-linear trajectory. Benchmarking experiments with other\ncli\nfunctions have revealed similar non-linear relationships between its speed and the number of times it invokes those functions\n2\n. However, those exercises were not compared with equivalent functions in base R. The relative comparison here is useful for decision-making.\nThe developers of\ncli\nhave also conducted benchmarks of the\nansi_*()\nfamily of functions in\ncli\nin comparison to base R and the\nfansi\npackage. They find that\ncli\nis consistently slower than base R, which corroborates the results of our experiment here. These benchmarks are available in the\ncli\ndocumentation\n3\n.\nSo, should we be worried about the speed of\ncli\n? Well, it depends on the context. The “R Packages” book by Hadley Wickham and Jenny Bryan suggests approaching such a decision from a holistic, balanced, and quantitative approach\n(Wickham and Bryan 2023)\n. We’ll leave the reader to make their own decision based on their use case.\nMost developers might argue that this is an optimisation overkill\n4\n. However, it is important to consider speed differences in context. In the case of simple printing, the speed difference is negligible yet disruptive and somewhat painful. However, in the grand scheme of things, this might be nothing compared with much slower processes that need more attention. In those cases, the developer might want to consider other optimisation strategies such as profiling\n5\n. The essence of this experiment is to demonstrate the utility of benchmarking in making quick design decisions.\nConclusion\nIn designing R package infrastructure with dependencies, it might sometimes be necessary to check if they don’t slow down existing processes. Here, we have demonstrated how benchmarking is one way to achieve this for a process involving condition signalling. We show how a simple decision to use\ncli::cli_warn()\nto handle warnings could come at the cost of a tiny loss in speed, which is worth considering in its context.\nThe demonstration here can be extended to other dependency adoption decisions for input checking, loops, object manipulations, and so forth. We recommend benchmarking as a way to help developers make quick design decisions. However, we also recommend that developers consider the context of the optimisation in interpreting the results.\nOther R packages for benchmarking\nmicrobenchmark\n: an R package for comparing the execution time of R expressions.\nrbenchmark\n: an R package for benchmarking R code.\ntictok\n: an R package to time R functions\ntouchstone\n: an R package for benchmarking of pull requests with statistical confidence.\nReferences\nWickham, Hadley. 2019.\nAdvanced r\n. CRC press.\nWickham, Hadley, and Jennifer Bryan. 2023.\nR Packages\n. \" O’Reilly Media, Inc.\".\nReuse\nCC BY 4.0\nCitation\nBibTeX citation:\n@online{mba azam2023,\n  author = {Mba Azam, James},\n  title = {Using Benchmarking to Guide the Adoption of Dependencies in\n    {R} Packages},\n  date = {2023-11-22},\n  url = {https://epiverse-trace.github.io//posts/benchmarking_design_decisions},\n  langid = {en}\n}\nFor attribution, please cite this work as:\nMba Azam, James. 2023.\n“Using Benchmarking to Guide the Adoption\nof Dependencies in R Packages.”\nNovember 22, 2023.\nhttps://epiverse-trace.github.io//posts/benchmarking_design_decisions\n.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nEpiverse-TRACE developer space\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "library(bench) library(cli) library(dplyr) library(ggplot2) R package developers often have to take on dependencies for various reasons. Dependencies are external packages that provide extra functionalities or features to another package (Wick...",
    "meta_keywords": null,
    "og_description": "library(bench) library(cli) library(dplyr) library(ggplot2) R package developers often have to take on dependencies for various reasons. Dependencies are external packages that provide extra functionalities or features to another package (Wick...",
    "og_image": "https://epiverse-trace.github.io/posts/benchmarking_design_decisions/index_files/figure-html/unnamed-chunk-11-1.png",
    "og_title": "Using benchmarking to guide the adoption of dependencies in R packages | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 8.4,
    "sitemap_lastmod": "2023-11-22T00:00:00+00:00",
    "twitter_description": "library(bench) library(cli) library(dplyr) library(ggplot2) R package developers often have to take on dependencies for various reasons. Dependencies are external packages that provide extra functionalities or features to another package (Wick...",
    "twitter_title": "Using benchmarking to guide the adoption of dependencies in R packages | R-bloggers",
    "url": "https://www.r-bloggers.com/2023/11/using-benchmarking-to-guide-the-adoption-of-dependencies-in-r-packages/",
    "word_count": 1681
  }
}