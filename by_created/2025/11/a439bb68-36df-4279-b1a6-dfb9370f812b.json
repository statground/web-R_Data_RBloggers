{
  "uuid": "a439bb68-36df-4279-b1a6-dfb9370f812b",
  "created_at": "2025-11-22 19:57:50",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2025/08/reading-the-background-colour-of-an-xlsx-file-in-a-tidy-way-with-readxl-2/",
    "crawled_at": "2025-11-22T10:44:01.925554",
    "external_links": [
      {
        "href": "https://pacha.dev/blog/2025/08/25/readxl/",
        "text": "pacha.dev/blog"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://buymeacoffee.com/pacha/e/80976",
        "text": "Buy Me a Coffee"
      },
      {
        "href": "https://pacha.dev/blog/2025/08/11/",
        "text": "A Personal Message from an Open Source Contributor"
      },
      {
        "href": "https://www.instagram.com/maplebooster/",
        "text": "here"
      },
      {
        "href": "https://peerj.com/preprints/3183/",
        "text": "Data organization in spreadsheets"
      },
      {
        "href": "https://github.com/jennybc/gapminder",
        "text": "gapminder"
      },
      {
        "href": "https://github.com/tidyverse/readxl/pull/776",
        "text": "changes"
      },
      {
        "href": "https://github.com/tidyverse/readxl",
        "text": "readxl"
      },
      {
        "href": "https://pacha.dev/blog/2025/08/25/readxl/",
        "text": "pacha.dev/blog"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Reading the background colour of an XLSX file in a Tidy way with readxl | R-bloggers",
    "images": [
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i1.wp.com/pacha.dev/blog/2025/08/25/readxl/good.png?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/pacha.dev/blog/2025/08/25/readxl/bad.png?w=578&ssl=1"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/pacha-dev-blog/",
        "text": "pacha.dev/blog"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-395028 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Reading the background colour of an XLSX file in a Tidy way with readxl</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">August 24, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/pacha-dev-blog/\">pacha.dev/blog</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://pacha.dev/blog/2025/08/25/readxl/\"> pacha.dev/blog</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<p><em>Because of delays with my scholarship payment, if this post is useful to you I kindly ask a minimal donation on <a href=\"https://buymeacoffee.com/pacha/e/80976\" rel=\"nofollow\" target=\"_blank\">Buy Me a Coffee</a>. It shall be used to continue my Open Source efforts. The full explanation is here: <a href=\"https://pacha.dev/blog/2025/08/11/\" rel=\"nofollow\" target=\"_blank\">A Personal Message from an Open Source Contributor</a>. If you play the electric guitar, the same scholarship chaos led me to turn my guitar pedals and DIY kits hobby into a business, and you can check those <a href=\"https://www.instagram.com/maplebooster/\" rel=\"nofollow\" target=\"_blank\">here</a>.</em></p>\n<p>I had to read some XLSX (Microsoft Excel) files for a consultancy project I am leading now in Chile, when I found a <em>severe</em> data organization problem. Instead of coding the municipalities in a district as:</p>\n<pre>Distrito    Circunscripción Provincial  Comuna\n14        Talagante                     Talagante\n14        Talagante                     El Monte\n14        Talagante                     Isla de Maipo\n14        Talagante                     Padre Hurtado\n14        Talagante                     Peñaflor\n...</pre>\n<p>Some sheets in the files used multiple background colours to indicate the district that each municipality (“comuna”) belongs to when it comes to define who is the congressperson for that municipality (the map congressperson-municipality is a 1-to-many when the map mayor-municipality is 1-to-1).</p>\n<p>This way of representing information is bad for everybody. It is not clear for the reader and it is more time consumer for whom created the file. A good resource about proper data organization with spreadsheets is <a href=\"https://peerj.com/preprints/3183/\" rel=\"nofollow\" target=\"_blank\">Data organization in spreadsheets</a> by Karl Broman and Kara Woo that I suggest to my students each semester.</p>\n<p>Think about the <a href=\"https://github.com/jennybc/gapminder\" rel=\"nofollow\" target=\"_blank\">gapminder</a> dataset. If instead of this:</p>\n<p><img data-lazy-src=\"https://i1.wp.com/pacha.dev/blog/2025/08/25/readxl/good.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" style=\"display: block; margin: auto; width: 100%;\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i1.wp.com/pacha.dev/blog/2025/08/25/readxl/good.png?w=578&amp;ssl=1\" style=\"display: block; margin: auto; width: 100%;\"/></noscript></p>\n<p>You get this:</p>\n<p><img data-lazy-src=\"https://i2.wp.com/pacha.dev/blog/2025/08/25/readxl/bad.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" style=\"display: block; margin: auto; width: 100%;\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i2.wp.com/pacha.dev/blog/2025/08/25/readxl/bad.png?w=578&amp;ssl=1\" style=\"display: block; margin: auto; width: 100%;\"/></noscript></p>\n<p>Then you need extra information not present in the file to know the continent for each country. This is not so bad but it is for more specific information (e.g., think about the international phone code).</p>\n<p>I searched online and found a few cumbersome solutions from nearly ten years ago using the xlsx package. Not happy with those, I used my C++ knowledge obtained in ECE244 and made some <a href=\"https://github.com/tidyverse/readxl/pull/776\" rel=\"nofollow\" target=\"_blank\">changes</a> to the <a href=\"https://github.com/tidyverse/readxl\" rel=\"nofollow\" target=\"_blank\">readxl</a> package.</p>\n<p>The change adds an extra <code>extract_colors</code> parameter to <code>read_excel()</code>, and allows to do this:</p>\n<pre>file &lt;- readxl_example(\"gapminder-2007.xlsx\")\n\n# extract_colors = FALSE (default)\ngood_data &lt;- read_excel(file, sheet = \"good\")\n\n&gt; good_data                                                                   \n# A tibble: 142 × 6\n   country                  continent  year lifeExp      pop gdpPercap\n   &lt;chr&gt;                    &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;\n 1 Algeria                  Africa     2007    72.3 33333216     6223.\n 2 Angola                   Africa     2007    42.7 12420476     4797.\n 3 Benin                    Africa     2007    56.7  8078314     1441.\n 4 Botswana                 Africa     2007    50.7  1639131    12570.\n 5 Burkina Faso             Africa     2007    52.3 14326203     1217.\n 6 Burundi                  Africa     2007    49.6  8390505      430.\n 7 Cameroon                 Africa     2007    50.4 17696293     2042.\n 8 Central African Republic Africa     2007    44.7  4369038      706.\n 9 Chad                     Africa     2007    50.7 10238807     1704.\n10 Comoros                  Africa     2007    65.2   710960      986.\n# ℹ 132 more rows\n# ℹ Use `print(n = ...)` to see more rows\n# using the new functionality\nbad_data &lt;- read_excel(file, sheet = \"bad\", extract_colors = TRUE)\n\n&gt; bad_data                                                                    \n# A tibble: 142 × 6\n   country                   year lifeExp      pop gdpPercap country_bg\n   &lt;chr&gt;                    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     \n 1 Algeria                   2007    72.3 33333216     6223. #FF6600   \n 2 Angola                    2007    42.7 12420476     4797. #FF6600   \n 3 Benin                     2007    56.7  8078314     1441. #FF6600   \n 4 Botswana                  2007    50.7  1639131    12570. #FF6600   \n 5 Burkina Faso              2007    52.3 14326203     1217. #FF6600   \n 6 Burundi                   2007    49.6  8390505      430. #FF6600   \n 7 Cameroon                  2007    50.4 17696293     2042. #FF6600   \n 8 Central African Republic  2007    44.7  4369038      706. #FF6600   \n 9 Chad                      2007    50.7 10238807     1704. #FF6600   \n10 Comoros                   2007    65.2   710960      986. #FF6600</pre>\n<p>In this way, we can group countries somehow, and one of many possibilities is to convert <code>country_bg</code> to a factor with five categories (e.g., one colour per continent) with:</p>\n<pre>library(dplyr)\n\nbad_data %&gt;%\n  mutate(country_bg = as.factor(country_bg))</pre>\n<p>or matching HEX codes to a string:</p>\n<pre>bad_data %&gt;%\n  inner_join(\n    bad_data %&gt;%\n      distinct(country_bg) %&gt;%\n      mutate(\n        continent = case_when(\n          country_bg == \"#FF6600\" ~ \"Asia\",\n          country_bg == \"#99CCFF\" ~ \"Europe\",\n          country_bg == \"#FFFFCC\" ~ \"Africa\",\n          country_bg == \"#993366\" ~ \"Americas\",\n          country_bg == \"#666699\" ~ \"Oceania\",\n          TRUE ~ NA_character_\n        )\n      )\n  )</pre>\n<p>I hope this is useful!</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://pacha.dev/blog/2025/08/25/readxl/\"> pacha.dev/blog</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
    "main_text": "Reading the background colour of an XLSX file in a Tidy way with readxl\nPosted on\nAugust 24, 2025\nby\npacha.dev/blog\nin\nR bloggers\n| 0 Comments\n[This article was first published on\npacha.dev/blog\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nBecause of delays with my scholarship payment, if this post is useful to you I kindly ask a minimal donation on\nBuy Me a Coffee\n. It shall be used to continue my Open Source efforts. The full explanation is here:\nA Personal Message from an Open Source Contributor\n. If you play the electric guitar, the same scholarship chaos led me to turn my guitar pedals and DIY kits hobby into a business, and you can check those\nhere\n.\nI had to read some XLSX (Microsoft Excel) files for a consultancy project I am leading now in Chile, when I found a\nsevere\ndata organization problem. Instead of coding the municipalities in a district as:\nDistrito    Circunscripción Provincial  Comuna\n14        Talagante                     Talagante\n14        Talagante                     El Monte\n14        Talagante                     Isla de Maipo\n14        Talagante                     Padre Hurtado\n14        Talagante                     Peñaflor\n...\nSome sheets in the files used multiple background colours to indicate the district that each municipality (“comuna”) belongs to when it comes to define who is the congressperson for that municipality (the map congressperson-municipality is a 1-to-many when the map mayor-municipality is 1-to-1).\nThis way of representing information is bad for everybody. It is not clear for the reader and it is more time consumer for whom created the file. A good resource about proper data organization with spreadsheets is\nData organization in spreadsheets\nby Karl Broman and Kara Woo that I suggest to my students each semester.\nThink about the\ngapminder\ndataset. If instead of this:\nYou get this:\nThen you need extra information not present in the file to know the continent for each country. This is not so bad but it is for more specific information (e.g., think about the international phone code).\nI searched online and found a few cumbersome solutions from nearly ten years ago using the xlsx package. Not happy with those, I used my C++ knowledge obtained in ECE244 and made some\nchanges\nto the\nreadxl\npackage.\nThe change adds an extra\nextract_colors\nparameter to\nread_excel()\n, and allows to do this:\nfile <- readxl_example(\"gapminder-2007.xlsx\")\n\n# extract_colors = FALSE (default)\ngood_data <- read_excel(file, sheet = \"good\")\n\n> good_data                                                                   \n# A tibble: 142 × 6\n   country                  continent  year lifeExp      pop gdpPercap\n   <chr>                    <chr>     <dbl>   <dbl>    <dbl>     <dbl>\n 1 Algeria                  Africa     2007    72.3 33333216     6223.\n 2 Angola                   Africa     2007    42.7 12420476     4797.\n 3 Benin                    Africa     2007    56.7  8078314     1441.\n 4 Botswana                 Africa     2007    50.7  1639131    12570.\n 5 Burkina Faso             Africa     2007    52.3 14326203     1217.\n 6 Burundi                  Africa     2007    49.6  8390505      430.\n 7 Cameroon                 Africa     2007    50.4 17696293     2042.\n 8 Central African Republic Africa     2007    44.7  4369038      706.\n 9 Chad                     Africa     2007    50.7 10238807     1704.\n10 Comoros                  Africa     2007    65.2   710960      986.\n# ℹ 132 more rows\n# ℹ Use `print(n = ...)` to see more rows\n# using the new functionality\nbad_data <- read_excel(file, sheet = \"bad\", extract_colors = TRUE)\n\n> bad_data                                                                    \n# A tibble: 142 × 6\n   country                   year lifeExp      pop gdpPercap country_bg\n   <chr>                    <dbl>   <dbl>    <dbl>     <dbl> <chr>     \n 1 Algeria                   2007    72.3 33333216     6223. #FF6600   \n 2 Angola                    2007    42.7 12420476     4797. #FF6600   \n 3 Benin                     2007    56.7  8078314     1441. #FF6600   \n 4 Botswana                  2007    50.7  1639131    12570. #FF6600   \n 5 Burkina Faso              2007    52.3 14326203     1217. #FF6600   \n 6 Burundi                   2007    49.6  8390505      430. #FF6600   \n 7 Cameroon                  2007    50.4 17696293     2042. #FF6600   \n 8 Central African Republic  2007    44.7  4369038      706. #FF6600   \n 9 Chad                      2007    50.7 10238807     1704. #FF6600   \n10 Comoros                   2007    65.2   710960      986. #FF6600\nIn this way, we can group countries somehow, and one of many possibilities is to convert\ncountry_bg\nto a factor with five categories (e.g., one colour per continent) with:\nlibrary(dplyr)\n\nbad_data %>%\n  mutate(country_bg = as.factor(country_bg))\nor matching HEX codes to a string:\nbad_data %>%\n  inner_join(\n    bad_data %>%\n      distinct(country_bg) %>%\n      mutate(\n        continent = case_when(\n          country_bg == \"#FF6600\" ~ \"Asia\",\n          country_bg == \"#99CCFF\" ~ \"Europe\",\n          country_bg == \"#FFFFCC\" ~ \"Africa\",\n          country_bg == \"#993366\" ~ \"Americas\",\n          country_bg == \"#666699\" ~ \"Oceania\",\n          TRUE ~ NA_character_\n        )\n      )\n  )\nI hope this is useful!\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\npacha.dev/blog\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "Because of delays with my scholarship payment, if this post is useful to you I kindly ask a minimal donation on Buy Me a Coffee. It shall be used to continue my Open Source efforts. The full explanation is here: A Personal Message from an Open So...",
    "meta_keywords": null,
    "og_description": "Because of delays with my scholarship payment, if this post is useful to you I kindly ask a minimal donation on Buy Me a Coffee. It shall be used to continue my Open Source efforts. The full explanation is here: A Personal Message from an Open So...",
    "og_image": "https://pacha.dev/blog/2025/08/25/readxl/good.png",
    "og_title": "Reading the background colour of an XLSX file in a Tidy way with readxl | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 4,
    "sitemap_lastmod": null,
    "twitter_description": "Because of delays with my scholarship payment, if this post is useful to you I kindly ask a minimal donation on Buy Me a Coffee. It shall be used to continue my Open Source efforts. The full explanation is here: A Personal Message from an Open So...",
    "twitter_title": "Reading the background colour of an XLSX file in a Tidy way with readxl | R-bloggers",
    "url": "https://www.r-bloggers.com/2025/08/reading-the-background-colour-of-an-xlsx-file-in-a-tidy-way-with-readxl-2/",
    "word_count": 804
  }
}