{
  "uuid": "38f21019-b9c3-42b0-b338-a2d88bd226d3",
  "created_at": "2025-11-22 19:58:39",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2025/05/advanced-resampling-with-custom-measure-solution/",
    "crawled_at": "2025-11-22T10:49:16.903780",
    "external_links": [
      {
        "href": "https://mlr-org.com/gallery/appliedml/2025-04-28-tuning-adv-resampling-custom-msr-sol/",
        "text": "mlr-org"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://github.com/mlr-org/mlr3website/",
        "text": "GitHub"
      },
      {
        "href": "https://mlr-org.com/gallery/appliedml/2025-04-28-tuning-adv-resampling-custom-msr-sol/",
        "text": "mlr-org"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Advanced Resampling with Custom Measure Solution | R-bloggers",
    "images": [
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAPUAAAAyBAMAAAB2coBaAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdmZU3TIiRM0Qibvvq5mze/DLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEU0lEQVRYCe2WTYgcRRTH30zvdG/Px86qiKAovTF62LBmlT1EhBAEkdzam6i4IwgrRMNAPHjRDB4Ec3Gy8bTKuhgvLgoTEgTxMggxCMKuxggGokMOYiLqgl/4Rft/r6r6Y9INTm8ze9AHU/XqX/V/v+mq6e4hGj3cm49cGd1VjKPc9E8WUylHlUfpQg5XMZbrqF9MoRxVLjhftHPY8lue80Nvz/0szMeRPLEYscfBSzCa/7MT+zGOwX97zzf++oRjIwiCMd7ias/3/qnO154LeuM4acVQ7FrgaeTqr0Wx3elkpaEhJpuyx+5GiNxvHMdpyqQp/SBFg6QBpduJGvEVr3VpNT7mfOXrYz73R3/mlqPaJevM5y8SbVJNKUMtyiB6Q6oeasDMAtFN8RXfDMjy4kIsrwaD2Kgx1aVSO4ONMogMtgY8sETU4WU6SrScFMyE9K/8FBs2sNuTlM6WMplsRbS3KOUyM/+ZvB60Ijiz78lg61XhddvdyIdMAFYH5lZCx+D5YcGMraBjUvxMwH7v37ErXyXZDHDfOtamOlFlP1kDrqoSKBnx4x/RBLP7zA7d4ZxR9HVbpxR6dxDAgBBAzSOaIDpR92vTLKqkyen3lxAXOYvFROyJxuwDzA7d4UKjKPbx02qiceWQQHDPslD3iZ4iai9KZpJ6N6wylNjBx6ECtt1htrgTN4dRhH3Y/LncQw7WcwjgDSQP4/MuLbKmk4kkG8/vINhS83v/Vj1asCsdOW/jdj7g8DCnFWY759BInCVLvgy2mgHP4vMqPg/SLTKtkuzzpkZ0l4HtHhB26FY1onqCMtdt92lqTa0QwK3Ikbi/0ylRVSJTqedNk9qN1XzefWaLaU78ujGKusyV8yJjw7HXc3SjIIk+hTqJDdiyfyH7Sww4oUO6REp3KdKY/bJcN0zl5DlpRbGprC6sT+cJ617SgLMoVZonmp3dosqHGHBCuyLAUFbqhIJ15tvTdIOw2YRfbCy0otnkXOxi8qG7ff5l9xXABYjsTTSlAR5w6CV5n5PUWOAasXhG2Gx6M6YiVUrPiNFzbbYCHADOCcYim2zXW8KWRL6McSX6ykeJIcBdnLeYDnqxKaOE7GjuZHVarrb5gs/iYbxFL6Of59cpEryfMuLp9tCEPQBbTJdbsSmj9GKaTh9f8AVQVgfrzJdnwGW2JHdc69DK/WamapIjYCu3Ubg3SgqbH6NxQCvuIxoaknX98pzPS2pr3HLcpTr8WKhi0pReXAnd7s1cC0isSA6WHvPUA+k7o6/+ZrKR+13TI1nmd1NpEw59g7lLe/TraKQqORdfpQZ/26PyYJdmLWel0W3nqNmC67YfwuiOXiSfA3+s9jn5rNt2lTt0tbztKvkKlDx65N581gJd+FuKcO8rsOSIpax9IxqKXJ58XxZZObtWmZ8wiJ1gewdX1tfX394Rtt2Ry94RdtXbOfbEstrzJ9VXGGs7dafgnHdUvx32P/z+GXEfLJl4AAAAAElFTkSuQmCC",
        "src": "https://latex.codecogs.com/png.latex?f(y,%20%5Chat%7By%7D)%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20%5Cmathbb%7BI%7D(%7Cy_i%20-%20%5Chat%7By%7D_i%7C%20%3C%20%5Csigma_y)"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAANBAMAAAC9V5gpAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZt3vq5kQIrt2RM0yVInEBf8hAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAYElEQVQIHWNgYNT//5kBDFzTOyEMxgaG1RAW8wGGGxBWMQNDHAOjA+cBkJQZg4AadwEDMwPLBQb2DcwMDDxz5zAwMD44AlHLwHfhJZTFE6sDZTEwKEBZFYwToCxGSQYGADkgEaaJcHgeAAAAAElFTkSuQmCC",
        "src": "https://latex.codecogs.com/png.latex?%5Csigma_y"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAANBAMAAACX52mGAAAAHlBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACGjDitAAAACXRSTlMAVLvdq81mmRBcZHzPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAGklEQVQIHWMQMjFNYGBwqGAAEgUkEkLmQQIALXsJH3rxVPcAAAAASUVORK5CYII=",
        "src": "https://latex.codecogs.com/png.latex?%5Cmathbb%7BI%7D"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAATQAAAAyBAMAAAAggToFAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdmZU3TIiRM0Qibvvq5mze/DLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFKklEQVRYCe1WXWgcVRT+9m82k9lsgrX4IIZJij9NSBO1b0IMgkjeFnwp+NPtUwWNWdS+KLX7IqIvbhNfxJosqUUoFFMfBM3LEqxFKCQ+iCgUlgpKEWxEk6o1jOfcn5k7k52VDTQ7Dz2wc8/5znfP+ebeO7MDdG6nP5msdT5rT2a4m70Te9Ko8ya55b5S57P2ZEZqoLAnfXbRpK908vgupt22Kfm3/NIOPnL9oPuOtX+z+yLiFNyRFrcy7fA7q9ZudeJyiV+1tX+vsK15nleJu4n2eGak2Z7QeVau2vgtOdMa85Y7r8EzjuHH3U2MnyWlOZ6rKAtb8dx2mSMYbZfemTsdhlLhkKObArLXfEWTOzmAPQBEapk0ygLnBVI08YhfhBKQOgCsG0n7C9hNI2bXvvDXOQGd+lNnemvaM8Y+8s1aQepDpi/Qz54WoBOkDI96kzlawNBhpCpGuvgy8IgRh9xerxmKI8E9CNcK0j/zvIwLqC+q1tK4N0tTAp48jh4GtA3YbhjQCTG+90cojARVxExNYY6plN9vscPtWxj3FjmhyNrQGg1q/HfsGa9s8CIur0rsgjP3LPIVeY5aS5P1KCcEZKrA5xIKrvnWB4YIGY/4ceaUW9QyyScx6/0jgP+RxgLsj9+toAE83YR85qRDSIzdkKU5+8zWgZ/mxipID9Uxesv6qs6fvw2jFpOE6erB97GD3CQyTZVXg6Kx7Ab9HBeYgj1xCRcp0g7tMopX2eqMGpYN/gfs3/Gsm29gH+4FvsQPyBLPqOXP8qv3+5CD+ULJGfBjdjSNpbGAQglWFfncBi5xWjnfsN/SLC/I3cRixf4bF3AUOPNKDS8gqGWeOVmUkEJN13RQOUq9+XT6pmksjZssArkqnbt1EscmHfnyEQBd+uk/0/NUNL6tYWyhv0zSYI3TPV0GjkRqvbFC9hnRdfWsIU3eESXzzFpxAxpLYwGv0UJOAdlKapki7TSE3/LSF7w+SFqNpM2cmyV5K8D7kVr+fF3dPGt4is9ByBSNpTXod58cF2tq46XDmdZnDT11yklT0lYxm0OqZwDqMeAS6XVN4lEjpjS6p4sYM1mapqV9S8l3aM8wW8IMrbdwLLmCoXk6uKod0IYu0obam3h8Dk37Mnpovqrlho4EF2XkRTGX21D7DWszHewwZxSNckIAH/59QHrpU9Dzppw0OTGWqvqJ57dP3Pj+ue3SoQeP/XL3Zu7K9dSEX4seLcO4OiPDAuM21H5kZIMfHMMUjXIswN6g1AynB+lHpYXj0H3F2OH4FKx1v1avG54/CEbEv7doQ+2RamIpzCIRRKMcCcjPUzV23sbX5ExAOkJrZJYMc0yLNWqtamXnTBJXJ4Sls1EbBz2VQhnTrgDURdFIGgnof7NEsNXEepFIGfKFc11xdw4vVXZiAUIfDqpW8YEAlUUJKdYEyG0c9OEacK3cgkbSSEBa7v6rGKbzJqSxk2a9re0JDfdqxxzzE4CqZcKyOnC/BKW09BCRwyZEsGxDgBWmRELg4YPD3wmKU9fMQ9oJjWVathAQCiirLaedFmOuXY0I3zqxiscE9qvOLMgvch12bcykp8SrGerNYR8f9RpdUxNuXKyDX804Jf5MxaUeZnQtKlTozU82+Jtv8mHrmiK/8Swy1YofJcp5CMW6myhFvpi7kDublB30RUWcjCuA+eUInpzw0WpytESUWAmUpr5KEygtnf3gPFktgdL0V2kSpS3JQ5dEadMH5YZORZ6LBITqq/T11fLtFvMfPi1hnaxB+44AAAAASUVORK5CYII=",
        "src": "https://latex.codecogs.com/png.latex?f(y,%20%5Chat%7By%7D)%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20%5Cmax((y_i%20-%20%5Chat%7By%7D_i)%5E2,%7Cy_i%20-%20%5Chat%7By%7D_i%7C)"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/giuseppe-casalicchio/",
        "text": "Giuseppe Casalicchio"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-392909 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Advanced Resampling with Custom Measure Solution</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">May 6, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/giuseppe-casalicchio/\">Giuseppe Casalicchio</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://mlr-org.com/gallery/appliedml/2025-04-28-tuning-adv-resampling-custom-msr-sol/\"> mlr-org</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n\n<noscript>\n<div style=\"border: 1px solid #ccc; padding: 1em; margin-top: 1em; background: #f9f9f9;\">\n<strong>JavaScript is required to unlock solutions.</strong><br/>\n    Please enable JavaScript and reload the page,<br/>\n    or download the source files from\n    <a href=\"https://github.com/mlr-org/mlr3website/\" rel=\"nofollow\" target=\"_blank\">GitHub</a>\n    and run the code locally.\n  </div>\n</noscript>\n<section class=\"level1\" id=\"goal\">\n<h1>Goal</h1>\n<p>After this exercise, you should be able to control the resampling process when using <code>mlr3</code> in order to account for data specificities, such as class imbalances in classification settings or grouping phenomena. Further, you will have learned how to construct and utilize custom measures for performance evaluation within <code>mlr3</code>.</p>\n</section>\n<section class=\"level1\" id=\"prerequisites\">\n<h1>Prerequisites</h1>\n<p>We load the most important packages and use a fixed seed for reproducibility.</p>\n<div class=\"cell\" data-layout-align=\"center\">\n<pre>library(mlr3verse)\nlibrary(mlbench)\nlibrary(data.table)\nset.seed(7832)</pre>\n</div>\n</section>\n<section class=\"level1\" id=\"stratified-resampling\">\n<h1>1 Stratified Resampling</h1>\n<p>In classification tasks, the ratio of the target class distribution should be similar in each train/test split, which is achieved by stratification. This is particularly useful in the case of imbalanced classes and small data sets.</p>\n<p>Stratification can also be performed with respect to explanatory categorical variables to ensure that all subgroups are represented in all training and test sets.</p>\n<p>In <code>mlr3</code>, each <code>task</code> has a slot <code>$col_roles</code>. This slot shows general roles certain features will have throughout different stages of the machine learning process. At least, the <code>$col_roles</code> slot shows which variables will be used as <code>feature</code> and as <code>target</code>. However, the <code>$col_roles</code> slot can be more diverse and some variables might even serve multiple roles. For example, <code>task$col_roles$stratum</code> specify the variable used for stratification. In this exercise, we will illustrate this using the <code>german_credit</code> data:</p>\n<div class=\"cell\" data-layout-align=\"center\">\n<pre>task_gc = tsk(\"german_credit\")\ntask_gc$col_roles</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre>$feature\n [1] \"age\"                     \"amount\"                  \"credit_history\"          \"duration\"               \n [5] \"employment_duration\"     \"foreign_worker\"          \"housing\"                 \"installment_rate\"       \n [9] \"job\"                     \"number_credits\"          \"other_debtors\"           \"other_installment_plans\"\n[13] \"people_liable\"           \"personal_status_sex\"     \"present_residence\"       \"property\"               \n[17] \"purpose\"                 \"savings\"                 \"status\"                  \"telephone\"              \n\n$target\n[1] \"credit_risk\"\n\n$name\ncharacter(0)\n\n$order\ncharacter(0)\n\n$stratum\ncharacter(0)\n\n$group\ncharacter(0)\n\n$weight\ncharacter(0)\n\n$offset\ncharacter(0)\n\n$always_included\ncharacter(0)</pre>\n</div>\n</div>\n<section class=\"level2\" id=\"set-stratification-variable\">\n<h2 class=\"anchored\" data-anchor-id=\"set-stratification-variable\">1.1 Set stratification variable</h2>\n<p>Modify the <code>task_gc</code> object such that the target variable <code>credit_risk</code> is used to for stratification.</p>\n<details>\n<summary>\n<strong>Hint 1</strong>\n</summary>\n<div class=\"cell\" data-layout-align=\"center\">\n<pre>task_gc$col_roles$... = \"credit_risk\"</pre>\n</div>\n</details>\n<div class=\"callout callout-style-default callout-note callout-titled\">\n<div aria-controls=\"callout-1\" aria-expanded=\"false\" aria-label=\"Toggle callout\" class=\"callout-header d-flex align-content-center\" data-bs-=\"\" data-bs-toggle=\"collapse\">\n<div class=\"callout-icon-container\">\n<i class=\"callout-icon\"></i>\n</div>\n<div class=\"callout-title-container flex-fill\">\nSolution\n</div>\n<div class=\"callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end\"><i class=\"callout-toggle\"></i></div>\n</div>\n<div class=\"callout-1-contents callout-collapse collapse\" id=\"callout-1\">\n<div class=\"callout-body-container callout-body\">\n<div>\n<div class=\"b64-wrapper\"><button class=\"unlock-btn\" data-cf-modified-4b2c3746ee8a4e91dc3a8866-=\"\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; unlockOne(this)\">Unlock solution</button><div class=\"hidden-solution\" data-encoded=\"PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+dGFza19nYzxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj5jb2xfcm9sZXM8c3BhbiBjbGFzcz0ic2MiPiQ8L3NwYW4+c3RyYXR1bSA8c3BhbiBjbGFzcz0ib3QiPj08L3NwYW4+IDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7Y3JlZGl0X3Jpc2smcXVvdDs8L3NwYW4+PC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPC9kaXY+CjxwPkFmdGVyIHRoZSBzcGVjaWZpY2F0aW9uIG9mIDxjb2RlPnRhc2skY29sX3JvbGVzJHN0cmF0dW08L2NvZGU+LCB0aGUKYWN0aXZlIGJpbmRpbmcgPGNvZGU+dGFzayRzdHJhdGE8L2NvZGU+IHdpbGwgc2hvdyB0aGUgbnVtYmVyIG9mCm9ic2VydmF0aW9ucyBpbiBlYWNoIGdyb3VwIGFuZCB0aGUgY29ycmVzcG9uZGluZyByb3cgaWRzOjwvcD4KPGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjIiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjItMSI+PGEgaHJlZj0iI2NiMi0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+dGFza19nYzxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj5zdHJhdGE8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8ZGl2IGNsYXNzPSJjZWxsLW91dHB1dCBjZWxsLW91dHB1dC1zdGRvdXQiPgo8cHJlPjxjb2RlPiAgICAgICBOICAgICAgICAgICAgICAgIHJvd19pZAogICAmbHQ7aW50Jmd0OyAgICAgICAgICAgICAgICAmbHQ7bGlzdCZndDsKMTogICA3MDAgICAgICAgMSwzLDQsNiw3LDgsLi4uCjI6ICAgMzAwICAyLCA1LDEwLDExLDEyLDE0LC4uLjwvY29kZT48L3ByZT4KPC9kaXY+CjwvZGl2Pg==\" style=\"display:none\"></div></div>\n</div>\n</div>\n</div>\n</div>\n</section>\n<section class=\"level2\" id=\"create-resampling-procedure\">\n<h2 class=\"anchored\" data-anchor-id=\"create-resampling-procedure\">1.2 Create resampling procedure</h2>\n<p>Next, specify a 3-fold cross validation and instantiate the resampling on the task.</p>\n<div class=\"callout callout-style-default callout-note callout-titled\">\n<div aria-controls=\"callout-2\" aria-expanded=\"false\" aria-label=\"Toggle callout\" class=\"callout-header d-flex align-content-center\" data-bs-=\"\" data-bs-toggle=\"collapse\">\n<div class=\"callout-icon-container\">\n<i class=\"callout-icon\"></i>\n</div>\n<div class=\"callout-title-container flex-fill\">\nSolution\n</div>\n<div class=\"callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end\"><i class=\"callout-toggle\"></i></div>\n</div>\n<div class=\"callout-2-contents callout-collapse collapse\" id=\"callout-2\">\n<div class=\"callout-body-container callout-body\">\n<div>\n<div class=\"b64-wrapper\"><button class=\"unlock-btn\" data-cf-modified-4b2c3746ee8a4e91dc3a8866-=\"\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; unlockOne(this)\">Unlock solution</button><div class=\"hidden-solution\" data-encoded=\"PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+Y3YzIDxzcGFuIGNsYXNzPSJvdCI+PTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5yc21wPC9zcGFuPig8c3BhbiBjbGFzcz0ic3QiPiZxdW90O2N2JnF1b3Q7PC9zcGFuPiwgPHNwYW4gY2xhc3M9ImF0Ij5mb2xkcyA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZHYiPjM8L3NwYW4+KTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yIj48YSBocmVmPSIjY2IxLTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5jdjM8c3BhbiBjbGFzcz0ic2MiPiQ8L3NwYW4+PHNwYW4gY2xhc3M9ImZ1Ij5pbnN0YW50aWF0ZTwvc3Bhbj4odGFza19nYyk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMyI+PGEgaHJlZj0iI2NiMS0zIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+Y3YzPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPmluc3RhbmNlPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPGRpdiBjbGFzcz0iY2VsbC1vdXRwdXQgY2VsbC1vdXRwdXQtc3Rkb3V0Ij4KPHByZT48Y29kZT4gICAgICByb3dfaWQgIGZvbGQKICAgICAgICZsdDtpbnQmZ3Q7ICZsdDtpbnQmZ3Q7CiAgIDE6ICAgICAgNyAgICAgMQogICAyOiAgICAgIDggICAgIDEKICAgMzogICAgICA5ICAgICAxCiAgIDQ6ICAgICAxNyAgICAgMQogICA1OiAgICAgMjIgICAgIDEKICAtLS0gICAgICAgICAgICAgCiA5OTY6ICAgIDk1OSAgICAgMwogOTk3OiAgICA5NjcgICAgIDMKIDk5ODogICAgOTgwICAgICAzCiA5OTk6ICAgIDk4NCAgICAgMwoxMDAwOiAgICA5OTkgICAgIDM8L2NvZGU+PC9wcmU+CjwvZGl2Pgo8L2Rpdj4=\" style=\"display:none\"></div></div>\n</div>\n</div>\n</div>\n</div>\n</section>\n<section class=\"level2\" id=\"sanity-check\">\n<h2 class=\"anchored\" data-anchor-id=\"sanity-check\">1.3 Sanity check</h2>\n<p>As a sanity check, the target class distribution should be similar within each CV fold. Compute and check the target class distribution in form of a ratio within each fold.</p>\n<details>\n<summary>\n<strong>Hint 1</strong>\n</summary>\nFirst, merge the data with the corresponding cv fold. Second, aggregate for each fold.\n</details>\n<details>\n<summary>\n<strong>Hint 2</strong>\n</summary>\n<div class=\"cell\" data-layout-align=\"center\">\n<pre>dt &lt;- merge(cv3$..., transform(..., row_id = seq_len(...)), by = ...)\naggregate(..., data = ..., FUN = function(x) ...)</pre>\n</div>\n</details>\n<div class=\"callout callout-style-default callout-note callout-titled\">\n<div aria-controls=\"callout-3\" aria-expanded=\"false\" aria-label=\"Toggle callout\" class=\"callout-header d-flex align-content-center\" data-bs-=\"\" data-bs-toggle=\"collapse\">\n<div class=\"callout-icon-container\">\n<i class=\"callout-icon\"></i>\n</div>\n<div class=\"callout-title-container flex-fill\">\nSolution\n</div>\n<div class=\"callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end\"><i class=\"callout-toggle\"></i></div>\n</div>\n<div class=\"callout-3-contents callout-collapse collapse\" id=\"callout-3\">\n<div class=\"callout-body-container callout-body\">\n<div>\n<div class=\"b64-wrapper\"><button class=\"unlock-btn\" data-cf-modified-4b2c3746ee8a4e91dc3a8866-=\"\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; unlockOne(this)\">Unlock solution</button><div class=\"hidden-solution\" data-encoded=\"PHA+V2l0aCA8Y29kZT5iYXNlIFI8L2NvZGU+OjwvcD4KPGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ZHQgPHNwYW4gY2xhc3M9Im90Ij4mbHQ7LTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5tZXJnZTwvc3Bhbj4oY3YzPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPmluc3RhbmNlLCA8c3BhbiBjbGFzcz0iZnUiPnRyYW5zZm9ybTwvc3Bhbj4odGFza19nYzxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj48c3BhbiBjbGFzcz0iZnUiPmRhdGE8L3NwYW4+KCksIDxzcGFuIGNsYXNzPSJhdCI+cm93X2lkID08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+c2VxX2xlbjwvc3Bhbj4oPHNwYW4gY2xhc3M9ImZ1Ij5ucm93PC9zcGFuPih0YXNrX2djPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPjxzcGFuIGNsYXNzPSJmdSI+ZGF0YTwvc3Bhbj4oKSkpKSwgPHNwYW4gY2xhc3M9ImF0Ij5ieSA9PC9zcGFuPiA8c3BhbiBjbGFzcz0ic3QiPiZxdW90O3Jvd19pZCZxdW90Ozwvc3Bhbj4pPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTIiPjxhIGhyZWY9IiNjYjEtMiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJmdSI+YWdncmVnYXRlPC9zcGFuPihjcmVkaXRfcmlzayA8c3BhbiBjbGFzcz0ic2MiPn48L3NwYW4+IGZvbGQsIDxzcGFuIGNsYXNzPSJhdCI+ZGF0YSA9PC9zcGFuPiBkdCwgPHNwYW4gY2xhc3M9ImF0Ij5GVU4gPTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImNmIj5mdW5jdGlvbjwvc3Bhbj4oeCkgPHNwYW4gY2xhc3M9ImZ1Ij5zdW08L3NwYW4+KHggPHNwYW4gY2xhc3M9InNjIj49PTwvc3Bhbj4gPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtiYWQmcXVvdDs8L3NwYW4+KSA8c3BhbiBjbGFzcz0ic2MiPi88L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+c3VtPC9zcGFuPih4IDxzcGFuIGNsYXNzPSJzYyI+PT08L3NwYW4+IDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7Z29vZCZxdW90Ozwvc3Bhbj4pKTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+ICBmb2xkIGNyZWRpdF9yaXNrCjEgICAgMSAgIDAuNDI3MzUwNAoyICAgIDIgICAwLjQyOTE4NDUKMyAgICAzICAgMC40MjkxODQ1PC9jb2RlPjwvcHJlPgo8L2Rpdj4KPGRpdiBjbGFzcz0ic291cmNlQ29kZSIgaWQ9ImNiMyI+PHByZQpjbGFzcz0ic291cmNlQ29kZSByIGNlbGwtY29kZSI+PGNvZGUgY2xhc3M9InNvdXJjZUNvZGUgciI+PHNwYW4gaWQ9ImNiMy0xIj48YSBocmVmPSIjY2IzLTEiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT48c3BhbiBjbGFzcz0iZnUiPndpdGg8L3NwYW4+KGR0LCA8c3BhbiBjbGFzcz0iZnUiPnN1bTwvc3Bhbj4oY3JlZGl0X3Jpc2sgPHNwYW4gY2xhc3M9InNjIj49PTwvc3Bhbj4gPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtiYWQmcXVvdDs8L3NwYW4+KSA8c3BhbiBjbGFzcz0ic2MiPi88L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+c3VtPC9zcGFuPihjcmVkaXRfcmlzayA8c3BhbiBjbGFzcz0ic2MiPj09PC9zcGFuPiA8c3BhbiBjbGFzcz0ic3QiPiZxdW90O2dvb2QmcXVvdDs8L3NwYW4+KSk8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8ZGl2IGNsYXNzPSJjZWxsLW91dHB1dCBjZWxsLW91dHB1dC1zdGRvdXQiPgo8cHJlPjxjb2RlPlsxXSAwLjQyODU3MTQ8L2NvZGU+PC9wcmU+CjwvZGl2Pgo8L2Rpdj4KPHA+V2l0aCA8Y29kZT5kYXRhLnRhYmxlPC9jb2RlPjo8L3A+CjxkaXYgY2xhc3M9ImNlbGwiIGRhdGEtbGF5b3V0LWFsaWduPSJjZW50ZXIiPgo8ZGl2IGNsYXNzPSJzb3VyY2VDb2RlIiBpZD0iY2I1Ij48cHJlCmNsYXNzPSJzb3VyY2VDb2RlIHIgY2VsbC1jb2RlIj48Y29kZSBjbGFzcz0ic291cmNlQ29kZSByIj48c3BhbiBpZD0iY2I1LTEiPjxhIGhyZWY9IiNjYjUtMSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPmR0IDxzcGFuIGNsYXNzPSJvdCI+PTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5tZXJnZTwvc3Bhbj4oY3YzPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPmluc3RhbmNlLCB0YXNrX2djPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPjxzcGFuIGNsYXNzPSJmdSI+ZGF0YTwvc3Bhbj4oKVssIDxzcGFuIGNsYXNzPSJhdCI+cm93X2lkIDo9PC9zcGFuPiAuSV0sIDxzcGFuIGNsYXNzPSJhdCI+YnkgPTwvc3Bhbj4gPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtyb3dfaWQmcXVvdDs8L3NwYW4+KTwvc3Bhbj4KPHNwYW4gaWQ9ImNiNS0yIj48YSBocmVmPSIjY2I1LTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5kdFssIC4oPHNwYW4gY2xhc3M9ImF0Ij5jbGFzc19yYXRpbyA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPnN1bTwvc3Bhbj4oY3JlZGl0X3Jpc2sgPHNwYW4gY2xhc3M9InNjIj49PTwvc3Bhbj4gPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtiYWQmcXVvdDs8L3NwYW4+KSA8c3BhbiBjbGFzcz0ic2MiPi88L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2I1LTMiPjxhIGhyZWY9IiNjYjUtMyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgPHNwYW4gY2xhc3M9ImZ1Ij5zdW08L3NwYW4+KGNyZWRpdF9yaXNrIDxzcGFuIGNsYXNzPSJzYyI+PT08L3NwYW4+IDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7Z29vZCZxdW90Ozwvc3Bhbj4pKSwgYnkgPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiBmb2xkXTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+ICAgIGZvbGQgY2xhc3NfcmF0aW8KICAgJmx0O2ludCZndDsgICAgICAgJmx0O251bSZndDsKMTogICAgIDIgICAwLjQyOTE4NDUKMjogICAgIDMgICAwLjQyOTE4NDUKMzogICAgIDEgICAwLjQyNzM1MDQ8L2NvZGU+PC9wcmU+CjwvZGl2Pgo8L2Rpdj4KPHA+SW5kZWVkLCB3ZSBjYW4gc2VlIHRoYXQgdGhlIHRhcmdldCBjbGFzcyBpcyBkaXN0cmlidXRlZCBzaW1pbGFybHkKd2l0aGluIGVhY2ggQ1YgZm9sZCwgbWF0Y2hpbmcgdGhlIG92ZXJhbGwgY2xhc3MgZGlzdHJpYnV0aW9uOjwvcD4KPGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjciPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjctMSI+PGEgaHJlZj0iI2NiNy0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ZHRbLCAuKDxzcGFuIGNsYXNzPSJhdCI+Y2xhc3NfcmF0aW8gPTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5zdW08L3NwYW4+KGNyZWRpdF9yaXNrIDxzcGFuIGNsYXNzPSJzYyI+PT08L3NwYW4+IDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7YmFkJnF1b3Q7PC9zcGFuPikgPHNwYW4gY2xhc3M9InNjIj4vPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPnN1bTwvc3Bhbj4oY3JlZGl0X3Jpc2sgPHNwYW4gY2xhc3M9InNjIj49PTwvc3Bhbj4gPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtnb29kJnF1b3Q7PC9zcGFuPikpXTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+ICAgY2xhc3NfcmF0aW8KICAgICAgICAgJmx0O251bSZndDsKMTogICAwLjQyODU3MTQ8L2NvZGU+PC9wcmU+CjwvZGl2Pgo8L2Rpdj4=\" style=\"display:none\"></div></div>\n</div>\n</div>\n</div>\n</div>\n</section>\n</section>\n<section class=\"level1\" id=\"block-resampling\">\n<h1>2 Block Resampling</h1>\n<p>An additional concern when specifying resampling is respecting the natural grouping of the data. Blocking refers to the situation where subsets of observations belong together and must not be separated during resampling. Hence, for one train/test set pair the entire block is either in the training set or in the test set.</p>\n<p>In the following example, wel will consider the <code>BreastCancer</code> data set from the <code>mlbench</code> package:</p>\n<div class=\"cell\" data-layout-align=\"center\">\n<pre>data(BreastCancer, package = \"mlbench\")\ntask_bc = as_task_classif(BreastCancer, target = \"Class\", positive = \"malignant\")</pre>\n</div>\n<p>In this data set, several observations have the same <code>Id</code> (sample code number), which implies these are samples taken from the same patient at different times.</p>\n<section class=\"level2\" id=\"count-groups\">\n<h2 class=\"anchored\" data-anchor-id=\"count-groups\">2.1 Count groups</h2>\n<p>Let’s count how many observation actually have the same <code>Id</code> more than once.</p>\n<div class=\"callout callout-style-default callout-note callout-titled\">\n<div aria-controls=\"callout-4\" aria-expanded=\"false\" aria-label=\"Toggle callout\" class=\"callout-header d-flex align-content-center\" data-bs-=\"\" data-bs-toggle=\"collapse\">\n<div class=\"callout-icon-container\">\n<i class=\"callout-icon\"></i>\n</div>\n<div class=\"callout-title-container flex-fill\">\nSolution\n</div>\n<div class=\"callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end\"><i class=\"callout-toggle\"></i></div>\n</div>\n<div class=\"callout-4-contents callout-collapse collapse\" id=\"callout-4\">\n<div class=\"callout-body-container callout-body\">\n<div>\n<div class=\"b64-wrapper\"><button class=\"unlock-btn\" data-cf-modified-4b2c3746ee8a4e91dc3a8866-=\"\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; unlockOne(this)\">Unlock solution</button><div class=\"hidden-solution\" data-encoded=\"PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5zdW08L3NwYW4+KDxzcGFuIGNsYXNzPSJmdSI+dGFibGU8L3NwYW4+KEJyZWFzdENhbmNlcjxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj5JZCkgPHNwYW4gY2xhc3M9InNjIj4mZ3Q7PC9zcGFuPiA8c3BhbiBjbGFzcz0iZHYiPjE8L3NwYW4+KTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+WzFdIDQ2PC9jb2RlPjwvcHJlPgo8L2Rpdj4KPC9kaXY+CjxwPlRoZXJlIGFyZSA0NiA8Y29kZT5JZDwvY29kZT5zIHdpdGggbW9yZSB0aGFuIG9uZSBvYnNlcnZhdGlvbgoocm93KS48L3A+\" style=\"display:none\"></div></div>\n</div>\n</div>\n</div>\n</div>\n<p>The model trained on this data set will be used to predict cancer status of new patients. Hence, we have to make sure that each Id occurs exactly in one fold, so that all observations with the same Id should be either used for training or for evaluating the model. This way, we get less biased performance estimates via k-fold cross validation. This can be achieved by block cross validation.</p>\n</section>\n<section class=\"level2\" id=\"set-up-block-resampling\">\n<h2 class=\"anchored\" data-anchor-id=\"set-up-block-resampling\">2.2 Set up block resampling</h2>\n<p>Similarly to stratified resampling, block resampling uses <code>task$col_roles$group</code> to specify the name of a grouping variable included in the feature set. Now, set the column <code>Id</code> as grouping variable in the <code>task</code> object.</p>\n<div class=\"callout callout-style-default callout-note callout-titled\">\n<div aria-controls=\"callout-5\" aria-expanded=\"false\" aria-label=\"Toggle callout\" class=\"callout-header d-flex align-content-center\" data-bs-=\"\" data-bs-toggle=\"collapse\">\n<div class=\"callout-icon-container\">\n<i class=\"callout-icon\"></i>\n</div>\n<div class=\"callout-title-container flex-fill\">\nSolution\n</div>\n<div class=\"callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end\"><i class=\"callout-toggle\"></i></div>\n</div>\n<div class=\"callout-5-contents callout-collapse collapse\" id=\"callout-5\">\n<div class=\"callout-body-container callout-body\">\n<div>\n<div class=\"b64-wrapper\"><button class=\"unlock-btn\" data-cf-modified-4b2c3746ee8a4e91dc3a8866-=\"\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; unlockOne(this)\">Unlock solution</button><div class=\"hidden-solution\" data-encoded=\"PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+dGFza19iYzxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj5jb2xfcm9sZXM8c3BhbiBjbGFzcz0ic2MiPiQ8L3NwYW4+Z3JvdXAgPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiA8c3BhbiBjbGFzcz0ic3QiPiZxdW90O0lkJnF1b3Q7PC9zcGFuPjwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjwvZGl2Pg==\" style=\"display:none\"></div></div>\n</div>\n</div>\n</div>\n</div>\n</section>\n<section class=\"level2\" id=\"instantiate-resampling\">\n<h2 class=\"anchored\" data-anchor-id=\"instantiate-resampling\">2.3 Instantiate resampling</h2>\n<p>Next, set up a 5-fold CV and instantiate it on the task.</p>\n<div class=\"callout callout-style-default callout-note callout-titled\">\n<div aria-controls=\"callout-6\" aria-expanded=\"false\" aria-label=\"Toggle callout\" class=\"callout-header d-flex align-content-center\" data-bs-=\"\" data-bs-toggle=\"collapse\">\n<div class=\"callout-icon-container\">\n<i class=\"callout-icon\"></i>\n</div>\n<div class=\"callout-title-container flex-fill\">\nSolution\n</div>\n<div class=\"callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end\"><i class=\"callout-toggle\"></i></div>\n</div>\n<div class=\"callout-6-contents callout-collapse collapse\" id=\"callout-6\">\n<div class=\"callout-body-container callout-body\">\n<div>\n<div class=\"b64-wrapper\"><button class=\"unlock-btn\" data-cf-modified-4b2c3746ee8a4e91dc3a8866-=\"\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; unlockOne(this)\">Unlock solution</button><div class=\"hidden-solution\" data-encoded=\"PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+Y3Y1IDxzcGFuIGNsYXNzPSJvdCI+PTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5yc21wPC9zcGFuPig8c3BhbiBjbGFzcz0ic3QiPiZxdW90O2N2JnF1b3Q7PC9zcGFuPiwgPHNwYW4gY2xhc3M9ImF0Ij5mb2xkcyA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZHYiPjU8L3NwYW4+KTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yIj48YSBocmVmPSIjY2IxLTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5jdjU8c3BhbiBjbGFzcz0ic2MiPiQ8L3NwYW4+PHNwYW4gY2xhc3M9ImZ1Ij5pbnN0YW50aWF0ZTwvc3Bhbj4odGFza19iYyk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMyI+PGEgaHJlZj0iI2NiMS0zIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+Y3Y1PHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPmluc3RhbmNlPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPGRpdiBjbGFzcz0iY2VsbC1vdXRwdXQgY2VsbC1vdXRwdXQtc3Rkb3V0Ij4KPHByZT48Y29kZT5LZXk6ICZsdDtmb2xkJmd0OwogICAgICByb3dfaWQgIGZvbGQKICAgICAgJmx0O2NoYXImZ3Q7ICZsdDtpbnQmZ3Q7CiAgMTogMTAxNTQyNSAgICAgMQogIDI6IDEwNDE4MDEgICAgIDEKICAzOiAxMDQ5ODE1ICAgICAxCiAgNDogMTA1OTU1MiAgICAgMQogIDU6IDEwODQ1ODQgICAgIDEKIC0tLSAgICAgICAgICAgICAgCjY0MTogMTM3MTkyMCAgICAgNQo2NDI6ICA1MzY3MDggICAgIDUKNjQzOiAgNTY2MzQ2ICAgICA1CjY0NDogIDYwMzE0OCAgICAgNQo2NDU6ICA4ODg4MjAgICAgIDU8L2NvZGU+PC9wcmU+CjwvZGl2Pgo8L2Rpdj4=\" style=\"display:none\"></div></div>\n</div>\n</div>\n</div>\n</div>\n</section>\n<section class=\"level2\" id=\"sanity-check-1\">\n<h2 class=\"anchored\" data-anchor-id=\"sanity-check-1\">2.4 Sanity check</h2>\n<p>If the specified blocking groups are respected, each <code>Id</code> appears only in exactly one fold. To inspect if blocking was successful when generating the folds, count how often each <code>Id</code> appears in a specific fold and print the <code>Id</code>s that appear in more than one fold.</p>\n<div class=\"callout callout-style-default callout-note callout-titled\">\n<div aria-controls=\"callout-7\" aria-expanded=\"false\" aria-label=\"Toggle callout\" class=\"callout-header d-flex align-content-center\" data-bs-=\"\" data-bs-toggle=\"collapse\">\n<div class=\"callout-icon-container\">\n<i class=\"callout-icon\"></i>\n</div>\n<div class=\"callout-title-container flex-fill\">\nSolution\n</div>\n<div class=\"callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end\"><i class=\"callout-toggle\"></i></div>\n</div>\n<div class=\"callout-7-contents callout-collapse collapse\" id=\"callout-7\">\n<div class=\"callout-body-container callout-body\">\n<div>\n<div class=\"b64-wrapper\"><button class=\"unlock-btn\" data-cf-modified-4b2c3746ee8a4e91dc3a8866-=\"\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; unlockOne(this)\">Unlock solution</button><div class=\"hidden-solution\" data-encoded=\"PHA+V2l0aCA8Y29kZT5iYXNlIFI8L2NvZGU+OjwvcD4KPGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ZHQgPHNwYW4gY2xhc3M9Im90Ij4mbHQ7LTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5hZ2dyZWdhdGU8L3NwYW4+KGZvbGQgPHNwYW4gY2xhc3M9InNjIj5+PC9zcGFuPiBJZCw8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMiI+PGEgaHJlZj0iI2NiMS0yIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYXQiPmRhdGEgPTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5tZXJnZTwvc3Bhbj4odGFza19iYzxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj48c3BhbiBjbGFzcz0iZnUiPmRhdGE8L3NwYW4+KCksPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTMiPjxhIGhyZWY9IiNjYjEtMyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN2NTxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj5pbnN0YW5jZSw8L3NwYW4+CjxzcGFuIGlkPSJjYjEtNCI+PGEgaHJlZj0iI2NiMS00IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImF0Ij5ieS54ID08L3NwYW4+IDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7SWQmcXVvdDs8L3NwYW4+LDwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS01Ij48YSBocmVmPSIjY2IxLTUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYXQiPmJ5LnkgPTwvc3Bhbj4gPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtyb3dfaWQmcXVvdDs8L3NwYW4+KSw8L3NwYW4+CjxzcGFuIGlkPSJjYjEtNiI+PGEgaHJlZj0iI2NiMS02IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYXQiPkZVTiA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iY2YiPmZ1bmN0aW9uPC9zcGFuPih4KSA8c3BhbiBjbGFzcz0iZnUiPmxlbmd0aDwvc3Bhbj4oPHNwYW4gY2xhc3M9ImZ1Ij51bmlxdWU8L3NwYW4+KHgpKSk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtNyI+PGEgaHJlZj0iI2NiMS03IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ZHRbZHQ8c3BhbiBjbGFzcz0ic2MiPiQ8L3NwYW4+Zm9sZCA8c3BhbiBjbGFzcz0ic2MiPiZndDs8L3NwYW4+IDxzcGFuIGNsYXNzPSJkdiI+MTwvc3Bhbj4sXTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+WzFdIElkICAgZm9sZAombHQ7MCByb3dzJmd0OyAob3IgMC1sZW5ndGggcm93Lm5hbWVzKTwvY29kZT48L3ByZT4KPC9kaXY+CjwvZGl2Pgo8cD5XaXRoIDxjb2RlPmRhdGEudGFibGU8L2NvZGU+OjwvcD4KPGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjMiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjMtMSI+PGEgaHJlZj0iI2NiMy0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ZHQgPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPm1lcmdlPC9zcGFuPih0YXNrX2JjPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPjxzcGFuIGNsYXNzPSJmdSI+ZGF0YTwvc3Bhbj4oKSwgY3Y1PHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPmluc3RhbmNlLCA8c3BhbiBjbGFzcz0iYXQiPmJ5LnggPTwvc3Bhbj4gPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtJZCZxdW90Ozwvc3Bhbj4sIDxzcGFuIGNsYXNzPSJhdCI+YnkueSA9PC9zcGFuPiA8c3BhbiBjbGFzcz0ic3QiPiZxdW90O3Jvd19pZCZxdW90Ozwvc3Bhbj4pPC9zcGFuPgo8c3BhbiBpZD0iY2IzLTIiPjxhIGhyZWY9IiNjYjMtMiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPmR0IDxzcGFuIGNsYXNzPSJvdCI+PTwvc3Bhbj4gZHRbLCAuKDxzcGFuIGNsYXNzPSJhdCI+dW5pcXVlX2ZvbGRzID08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+bGVuZ3RoPC9zcGFuPig8c3BhbiBjbGFzcz0iZnUiPnVuaXF1ZTwvc3Bhbj4oZm9sZCkpKSwgYnkgPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiBJZF08L3NwYW4+CjxzcGFuIGlkPSJjYjMtMyI+PGEgaHJlZj0iI2NiMy0zIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ZHRbdW5pcXVlX2ZvbGRzIDxzcGFuIGNsYXNzPSJzYyI+Jmd0Ozwvc3Bhbj4gPHNwYW4gY2xhc3M9ImR2Ij4xPC9zcGFuPiwgXTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+S2V5OiAmbHQ7SWQmZ3Q7CkVtcHR5IGRhdGEudGFibGUgKDAgcm93cyBhbmQgMiBjb2xzKTogSWQsdW5pcXVlX2ZvbGRzPC9jb2RlPjwvcHJlPgo8L2Rpdj4KPC9kaXY+\" style=\"display:none\"></div></div>\n</div>\n</div>\n</div>\n</div>\n<p>As expected, the table is empty as there are no Id’s present in more than one fold.</p>\n</section>\n</section>\n<section class=\"level1\" id=\"custom-performance-measures\">\n<h1>3 Custom Performance Measures</h1>\n<p>Many domain applications require custom measures for performance evaluations not supported in <code>mlr3</code>. You can inspect all available measures by calling <code>as.data.table(mlr_measures)</code>. Luckily, you can design your own measures for evaluating model performance. To do so, we simply create a new <code>R6</code> class that inherits either from <code>MeasureRegr</code> (for a regression measure) or <code>MeasureClassif</code> (for a classification measure). Let’s see how this works in practice. Let us consider a regression measure that scores a prediction as 1 if the difference between the true and predicted values is less than one standard deviation of the truth, or scores the prediction as 0 otherwise. In maths this would be defined as <img data-lazy-src=\"https://latex.codecogs.com/png.latex?f(y,%20%5Chat%7By%7D)%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20%5Cmathbb%7BI%7D(%7Cy_i%20-%20%5Chat%7By%7D_i%7C%20%3C%20%5Csigma_y)\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?f(y,%20%5Chat%7By%7D)%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20%5Cmathbb%7BI%7D(%7Cy_i%20-%20%5Chat%7By%7D_i%7C%20%3C%20%5Csigma_y)\"/></noscript>, where <img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Csigma_y\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Csigma_y\"/></noscript> is the standard deviation of the truth and <img data-lazy-src=\"https://latex.codecogs.com/png.latex?%5Cmathbb%7BI%7D\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?%5Cmathbb%7BI%7D\"/></noscript> is the indicator function. In this case, we need the following code to construct a corresponding measure class:</p>\n<div class=\"cell\" data-layout-align=\"center\">\n<pre>MeasureRegrThresholdAcc = R6::R6Class(\"MeasureRegrThresholdAcc\",\n  inherit = mlr3::MeasureRegr, # regression measure\n  public = list(\n    initialize = function() { # initialize class\n      super$initialize(\n        id = \"thresh_acc\", # unique ID\n        packages = character(), # no package dependencies\n        properties = character(), # no special properties\n        predict_type = \"response\", # measures response prediction\n        range = c(0, 1), # results in values between (0, 1)\n        minimize = FALSE # larger values are better\n      )\n    }\n  ),\n\n  private = list(\n    # define score as private method\n    .score = function(prediction, ...) {\n      # define loss\n      threshold_acc = function(truth, response) {\n        mean(ifelse(abs(truth - response) &lt; sd(truth), 1, 0))\n      }\n      # call loss function\n      threshold_acc(prediction$truth, prediction$response)\n    }\n  )\n)</pre>\n</div>\n<ol type=\"1\">\n<li>In the first two lines we name the class, here <code>MeasureRegrThresholdAcc</code>, and then state this is a regression measure that inherits from <code>MeasureRegr</code>.</li>\n<li>We initialize the class by stating its unique ID is <code>\"thresh_acc\"</code>, that it does not require any external packages (<code>packages = character()</code>) and that it has no special properties (<code>properties = character()</code>).</li>\n<li>We then pass specific details of the loss function which are: it measures the quality of a <code>\"response\"</code> type prediction, its values range between <code>(0, 1)</code>, and that the loss is optimized as its maximum (<code>minimize = FALSE</code>).</li>\n<li>Finally, we define the score itself as a private method called <code>.score</code> where we pass the predictions to the function we defined just above. The private method is a function assigned to the R6 class <code>MeasureRegrThresholdAcc</code>, such that one can (internally) call <code>object$.score(prediction,...)</code> for an object of class <code>MeasureRegrThresholdAcc</code>. The method is “private” as it is not intended to be visible for the end user.</li>\n</ol>\n<p>Once you have defined your custom measure, you can add it to the <code>mlr3measures</code> dictionary like this:</p>\n<div class=\"cell\" data-layout-align=\"center\">\n<pre>mlr3::mlr_measures$add(\"regr.thresh_acc\", MeasureRegrThresholdAcc)</pre>\n</div>\n<section class=\"level2\" id=\"mse-mae\">\n<h2 class=\"anchored\" data-anchor-id=\"mse-mae\">3.1 MSE-MAE</h2>\n<p>Define you own risk measure for regression, the maximum of MSE and MAE: <img data-lazy-src=\"https://latex.codecogs.com/png.latex?f(y,%20%5Chat%7By%7D)%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20%5Cmax((y_i%20-%20%5Chat%7By%7D_i)%5E2,%7Cy_i%20-%20%5Chat%7By%7D_i%7C)\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img src=\"https://latex.codecogs.com/png.latex?f(y,%20%5Chat%7By%7D)%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20%5Cmax((y_i%20-%20%5Chat%7By%7D_i)%5E2,%7Cy_i%20-%20%5Chat%7By%7D_i%7C)\"/></noscript>, using the code skeleton supplied above.</p>\n<details>\n<summary>\n<strong>Hint 1:</strong>\n</summary>\n<p>You need to change the code chunk containing the <code>MeasureRegrThresholdAcc</code> class definition in at least 7 lines.</p>\n</details>\n<div class=\"callout callout-style-default callout-note callout-titled\">\n<div aria-controls=\"callout-8\" aria-expanded=\"false\" aria-label=\"Toggle callout\" class=\"callout-header d-flex align-content-center\" data-bs-=\"\" data-bs-toggle=\"collapse\">\n<div class=\"callout-icon-container\">\n<i class=\"callout-icon\"></i>\n</div>\n<div class=\"callout-title-container flex-fill\">\nSolution\n</div>\n<div class=\"callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end\"><i class=\"callout-toggle\"></i></div>\n</div>\n<div class=\"callout-8-contents callout-collapse collapse\" id=\"callout-8\">\n<div class=\"callout-body-container callout-body\">\n<div>\n<div class=\"b64-wrapper\"><button class=\"unlock-btn\" data-cf-modified-4b2c3746ee8a4e91dc3a8866-=\"\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; unlockOne(this)\">Unlock solution</button><div class=\"hidden-solution\" data-encoded=\"PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+TWVhc3VyZVJlZ3JNYXhNc2VNYWUgPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiBSNjxzcGFuIGNsYXNzPSJzYyI+Ojo8L3NwYW4+PHNwYW4gY2xhc3M9ImZ1Ij5SNkNsYXNzPC9zcGFuPig8c3BhbiBjbGFzcz0ic3QiPiZxdW90O01lYXN1cmVSZWdyTWF4TXNlTWFlJnF1b3Q7PC9zcGFuPiw8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMiI+PGEgaHJlZj0iI2NiMS0yIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICA8c3BhbiBjbGFzcz0iYXQiPmluaGVyaXQgPTwvc3Bhbj4gbWxyMzxzcGFuIGNsYXNzPSJzYyI+Ojo8L3NwYW4+TWVhc3VyZVJlZ3IsIDxzcGFuIGNsYXNzPSJjbyI+IyByZWdyZXNzaW9uIG1lYXN1cmU8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTMiPjxhIGhyZWY9IiNjYjEtMyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgPHNwYW4gY2xhc3M9ImF0Ij5wdWJsaWMgPTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5saXN0PC9zcGFuPig8L3NwYW4+CjxzcGFuIGlkPSJjYjEtNCI+PGEgaHJlZj0iI2NiMS00IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgIDxzcGFuIGNsYXNzPSJhdCI+aW5pdGlhbGl6ZSA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iY2YiPmZ1bmN0aW9uPC9zcGFuPigpIHsgPHNwYW4gY2xhc3M9ImNvIj4jIGluaXRpYWxpemUgY2xhc3M8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTUiPjxhIGhyZWY9IiNjYjEtNSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgICAgIHN1cGVyPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPjxzcGFuIGNsYXNzPSJmdSI+aW5pdGlhbGl6ZTwvc3Bhbj4oPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTYiPjxhIGhyZWY9IiNjYjEtNiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgICAgICAgPHNwYW4gY2xhc3M9ImF0Ij5pZCA9PC9zcGFuPiA8c3BhbiBjbGFzcz0ic3QiPiZxdW90O21heF9tc2VfbWFlJnF1b3Q7PC9zcGFuPiwgPHNwYW4gY2xhc3M9ImNvIj4jIHVuaXF1ZSBJRDwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtNyI+PGEgaHJlZj0iI2NiMS03IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgICAgICA8c3BhbiBjbGFzcz0iYXQiPnBhY2thZ2VzID08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Y2hhcmFjdGVyPC9zcGFuPigpLCA8c3BhbiBjbGFzcz0iY28iPiMgbm8gcGFja2FnZSBkZXBlbmRlbmNpZXM8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTgiPjxhIGhyZWY9IiNjYjEtOCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgICAgICAgPHNwYW4gY2xhc3M9ImF0Ij5wcm9wZXJ0aWVzID08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Y2hhcmFjdGVyPC9zcGFuPigpLCA8c3BhbiBjbGFzcz0iY28iPiMgbm8gc3BlY2lhbCBwcm9wZXJ0aWVzPC9zcGFuPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS05Ij48YSBocmVmPSIjY2IxLTkiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gICAgICAgIDxzcGFuIGNsYXNzPSJhdCI+cHJlZGljdF90eXBlID08L3NwYW4+IDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7cmVzcG9uc2UmcXVvdDs8L3NwYW4+LCA8c3BhbiBjbGFzcz0iY28iPiMgbWVhc3VyZXMgcmVzcG9uc2UgcHJlZGljdGlvbjwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtMTAiPjxhIGhyZWY9IiNjYjEtMTAiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gICAgICAgIDxzcGFuIGNsYXNzPSJhdCI+cmFuZ2UgPTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5jPC9zcGFuPig8c3BhbiBjbGFzcz0iZHYiPjA8L3NwYW4+LCA8c3BhbiBjbGFzcz0iY24iPkluZjwvc3Bhbj4pLCA8c3BhbiBjbGFzcz0iY28iPiMgcmVzdWx0cyBpbiB2YWx1ZXMgYmV0d2VlbiAoMCwgMSk8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTExIj48YSBocmVmPSIjY2IxLTExIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgICAgICA8c3BhbiBjbGFzcz0iYXQiPm1pbmltaXplID08L3NwYW4+IDxzcGFuIGNsYXNzPSJjbiI+VFJVRTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImNvIj4jIHNtYWxsZXIgdmFsdWVzIGFyZSBiZXR0ZXI8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTEyIj48YSBocmVmPSIjY2IxLTEyIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgICAgKTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xMyI+PGEgaHJlZj0iI2NiMS0xMyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgICB9PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTE0Ij48YSBocmVmPSIjY2IxLTE0IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICApLDwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xNSI+PGEgaHJlZj0iI2NiMS0xNSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xNiI+PGEgaHJlZj0iI2NiMS0xNiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgPHNwYW4gY2xhc3M9ImF0Ij5wcml2YXRlID08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+bGlzdDwvc3Bhbj4oPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTE3Ij48YSBocmVmPSIjY2IxLTE3IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgIDxzcGFuIGNsYXNzPSJjbyI+IyBkZWZpbmUgc2NvcmUgYXMgcHJpdmF0ZSBtZXRob2Q8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTE4Ij48YSBocmVmPSIjY2IxLTE4IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgIDxzcGFuIGNsYXNzPSJhdCI+LnNjb3JlID08L3NwYW4+IDxzcGFuIGNsYXNzPSJjZiI+ZnVuY3Rpb248L3NwYW4+KHByZWRpY3Rpb24sIC4uLikgezwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xOSI+PGEgaHJlZj0iI2NiMS0xOSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgICAgIDxzcGFuIGNsYXNzPSJjbyI+IyBkZWZpbmUgbG9zczwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtMjAiPjxhIGhyZWY9IiNjYjEtMjAiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gICAgICBtYXhfbXNlX21hZSA8c3BhbiBjbGFzcz0ib3QiPj08L3NwYW4+IDxzcGFuIGNsYXNzPSJjZiI+ZnVuY3Rpb248L3NwYW4+KHRydXRoLCByZXNwb25zZSkgezwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yMSI+PGEgaHJlZj0iI2NiMS0yMSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgICAgICAgPHNwYW4gY2xhc3M9ImZ1Ij5tZWFuPC9zcGFuPig8c3BhbiBjbGFzcz0iZnUiPm1heDwvc3Bhbj4oKHRydXRoIDxzcGFuIGNsYXNzPSJzYyI+LTwvc3Bhbj4gcmVzcG9uc2UpPHNwYW4gY2xhc3M9InNjIj5ePC9zcGFuPjxzcGFuIGNsYXNzPSJkdiI+Mjwvc3Bhbj4sIDxzcGFuIGNsYXNzPSJmdSI+YWJzPC9zcGFuPih0cnV0aCA8c3BhbiBjbGFzcz0ic2MiPi08L3NwYW4+IHJlc3BvbnNlKSkpPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTIyIj48YSBocmVmPSIjY2IxLTIyIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgICAgfTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yMyI+PGEgaHJlZj0iI2NiMS0yMyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgICAgIDxzcGFuIGNsYXNzPSJjbyI+IyBjYWxsIGxvc3MgZnVuY3Rpb248L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTI0Ij48YSBocmVmPSIjY2IxLTI0IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgICAgPHNwYW4gY2xhc3M9ImZ1Ij5tYXhfbXNlX21hZTwvc3Bhbj4ocHJlZGljdGlvbjxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj50cnV0aCwgcHJlZGljdGlvbjxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj5yZXNwb25zZSk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMjUiPjxhIGhyZWY9IiNjYjEtMjUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gICAgfTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yNiI+PGEgaHJlZj0iI2NiMS0yNiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgKTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yNyI+PGEgaHJlZj0iI2NiMS0yNyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPik8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8L2Rpdj4=\" style=\"display:none\"></div></div>\n</div>\n</div>\n</div>\n</div>\n</section>\n<section class=\"level2\" id=\"evaluate-a-custom-measure\">\n<h2 class=\"anchored\" data-anchor-id=\"evaluate-a-custom-measure\">3.2 Evaluate a custom measure</h2>\n<p>Add your custom measure to the <code>mlr3measures</code> dictionary and use it to evaluate the following model prediction:</p>\n<div class=\"cell\" data-layout-align=\"center\">\n<pre>tsk_mtcars = tsk(\"mtcars\")\nsplit = partition(tsk_mtcars)\nlrn_ranger = lrn(\"regr.ranger\")$train(tsk_mtcars, split$train)\nprediction = lrn_ranger$predict(tsk_mtcars, split$test)</pre>\n</div>\n<div class=\"callout callout-style-default callout-note callout-titled\">\n<div aria-controls=\"callout-9\" aria-expanded=\"false\" aria-label=\"Toggle callout\" class=\"callout-header d-flex align-content-center\" data-bs-=\"\" data-bs-toggle=\"collapse\">\n<div class=\"callout-icon-container\">\n<i class=\"callout-icon\"></i>\n</div>\n<div class=\"callout-title-container flex-fill\">\nSolution\n</div>\n<div class=\"callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end\"><i class=\"callout-toggle\"></i></div>\n</div>\n<div class=\"callout-9-contents callout-collapse collapse\" id=\"callout-9\">\n<div class=\"callout-body-container callout-body\">\n<div>\n<div class=\"b64-wrapper\"><button class=\"unlock-btn\" data-cf-modified-4b2c3746ee8a4e91dc3a8866-=\"\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; unlockOne(this)\">Unlock solution</button><div class=\"hidden-solution\" data-encoded=\"PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+bWxyMzxzcGFuIGNsYXNzPSJzYyI+Ojo8L3NwYW4+bWxyX21lYXN1cmVzPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPjxzcGFuIGNsYXNzPSJmdSI+YWRkPC9zcGFuPig8c3BhbiBjbGFzcz0ic3QiPiZxdW90O3JlZ3IubWF4X21zZV9tYWUmcXVvdDs8L3NwYW4+LCBNZWFzdXJlUmVnck1heE1zZU1hZSk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMiI+PGEgaHJlZj0iI2NiMS0yIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+cHJlZGljdGlvbjxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj48c3BhbiBjbGFzcz0iZnUiPnNjb3JlPC9zcGFuPig8c3BhbiBjbGFzcz0iZnUiPm1zcjwvc3Bhbj4oPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtyZWdyLm1heF9tc2VfbWFlJnF1b3Q7PC9zcGFuPikpPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPGRpdiBjbGFzcz0iY2VsbC1vdXRwdXQgY2VsbC1vdXRwdXQtc3Rkb3V0Ij4KPHByZT48Y29kZT5tYXhfbXNlX21hZSAKICAgIDI2LjI1OTMgPC9jb2RlPjwvcHJlPgo8L2Rpdj4KPC9kaXY+\" style=\"display:none\"></div></div>\n</div>\n</div>\n</div>\n</div>\n</section>\n</section>\n<section class=\"level1\" id=\"summary\">\n<h1>Summary</h1>\n<ul>\n<li>Stratified resampling helps with balancing classes and features within CV folds, to ensure each fold represents the data well enough.</li>\n<li>Block resampling reduces bias in generalization error estimates by ensuring that observations from the same group end up in the same fold.</li>\n<li>Custom domain applications require custom performance measures. In <code>mlr3</code>, you can define custom measures by creating a new <code>R6</code> class.</li>\n</ul>\n</section>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://mlr-org.com/gallery/appliedml/2025-04-28-tuning-adv-resampling-custom-msr-sol/\"> mlr-org</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
    "main_text": "Advanced Resampling with Custom Measure Solution\nPosted on\nMay 6, 2025\nby\nGiuseppe Casalicchio\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nmlr-org\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nJavaScript is required to unlock solutions.\nPlease enable JavaScript and reload the page,\nor download the source files from\nGitHub\nand run the code locally.\nGoal\nAfter this exercise, you should be able to control the resampling process when using\nmlr3\nin order to account for data specificities, such as class imbalances in classification settings or grouping phenomena. Further, you will have learned how to construct and utilize custom measures for performance evaluation within\nmlr3\n.\nPrerequisites\nWe load the most important packages and use a fixed seed for reproducibility.\nlibrary(mlr3verse)\nlibrary(mlbench)\nlibrary(data.table)\nset.seed(7832)\n1 Stratified Resampling\nIn classification tasks, the ratio of the target class distribution should be similar in each train/test split, which is achieved by stratification. This is particularly useful in the case of imbalanced classes and small data sets.\nStratification can also be performed with respect to explanatory categorical variables to ensure that all subgroups are represented in all training and test sets.\nIn\nmlr3\n, each\ntask\nhas a slot\n$col_roles\n. This slot shows general roles certain features will have throughout different stages of the machine learning process. At least, the\n$col_roles\nslot shows which variables will be used as\nfeature\nand as\ntarget\n. However, the\n$col_roles\nslot can be more diverse and some variables might even serve multiple roles. For example,\ntask$col_roles$stratum\nspecify the variable used for stratification. In this exercise, we will illustrate this using the\ngerman_credit\ndata:\ntask_gc = tsk(\"german_credit\")\ntask_gc$col_roles\n$feature\n [1] \"age\"                     \"amount\"                  \"credit_history\"          \"duration\"               \n [5] \"employment_duration\"     \"foreign_worker\"          \"housing\"                 \"installment_rate\"       \n [9] \"job\"                     \"number_credits\"          \"other_debtors\"           \"other_installment_plans\"\n[13] \"people_liable\"           \"personal_status_sex\"     \"present_residence\"       \"property\"               \n[17] \"purpose\"                 \"savings\"                 \"status\"                  \"telephone\"              \n\n$target\n[1] \"credit_risk\"\n\n$name\ncharacter(0)\n\n$order\ncharacter(0)\n\n$stratum\ncharacter(0)\n\n$group\ncharacter(0)\n\n$weight\ncharacter(0)\n\n$offset\ncharacter(0)\n\n$always_included\ncharacter(0)\n1.1 Set stratification variable\nModify the\ntask_gc\nobject such that the target variable\ncredit_risk\nis used to for stratification.\nHint 1\ntask_gc$col_roles$... = \"credit_risk\"\nSolution\nUnlock solution\n1.2 Create resampling procedure\nNext, specify a 3-fold cross validation and instantiate the resampling on the task.\nSolution\nUnlock solution\n1.3 Sanity check\nAs a sanity check, the target class distribution should be similar within each CV fold. Compute and check the target class distribution in form of a ratio within each fold.\nHint 1\nFirst, merge the data with the corresponding cv fold. Second, aggregate for each fold.\nHint 2\ndt <- merge(cv3$..., transform(..., row_id = seq_len(...)), by = ...)\naggregate(..., data = ..., FUN = function(x) ...)\nSolution\nUnlock solution\n2 Block Resampling\nAn additional concern when specifying resampling is respecting the natural grouping of the data. Blocking refers to the situation where subsets of observations belong together and must not be separated during resampling. Hence, for one train/test set pair the entire block is either in the training set or in the test set.\nIn the following example, wel will consider the\nBreastCancer\ndata set from the\nmlbench\npackage:\ndata(BreastCancer, package = \"mlbench\")\ntask_bc = as_task_classif(BreastCancer, target = \"Class\", positive = \"malignant\")\nIn this data set, several observations have the same\nId\n(sample code number), which implies these are samples taken from the same patient at different times.\n2.1 Count groups\nLet’s count how many observation actually have the same\nId\nmore than once.\nSolution\nUnlock solution\nThe model trained on this data set will be used to predict cancer status of new patients. Hence, we have to make sure that each Id occurs exactly in one fold, so that all observations with the same Id should be either used for training or for evaluating the model. This way, we get less biased performance estimates via k-fold cross validation. This can be achieved by block cross validation.\n2.2 Set up block resampling\nSimilarly to stratified resampling, block resampling uses\ntask$col_roles$group\nto specify the name of a grouping variable included in the feature set. Now, set the column\nId\nas grouping variable in the\ntask\nobject.\nSolution\nUnlock solution\n2.3 Instantiate resampling\nNext, set up a 5-fold CV and instantiate it on the task.\nSolution\nUnlock solution\n2.4 Sanity check\nIf the specified blocking groups are respected, each\nId\nappears only in exactly one fold. To inspect if blocking was successful when generating the folds, count how often each\nId\nappears in a specific fold and print the\nId\ns that appear in more than one fold.\nSolution\nUnlock solution\nAs expected, the table is empty as there are no Id’s present in more than one fold.\n3 Custom Performance Measures\nMany domain applications require custom measures for performance evaluations not supported in\nmlr3\n. You can inspect all available measures by calling\nas.data.table(mlr_measures)\n. Luckily, you can design your own measures for evaluating model performance. To do so, we simply create a new\nR6\nclass that inherits either from\nMeasureRegr\n(for a regression measure) or\nMeasureClassif\n(for a classification measure). Let’s see how this works in practice. Let us consider a regression measure that scores a prediction as 1 if the difference between the true and predicted values is less than one standard deviation of the truth, or scores the prediction as 0 otherwise. In maths this would be defined as\n, where\nis the standard deviation of the truth and\nis the indicator function. In this case, we need the following code to construct a corresponding measure class:\nMeasureRegrThresholdAcc = R6::R6Class(\"MeasureRegrThresholdAcc\",\n  inherit = mlr3::MeasureRegr, # regression measure\n  public = list(\n    initialize = function() { # initialize class\n      super$initialize(\n        id = \"thresh_acc\", # unique ID\n        packages = character(), # no package dependencies\n        properties = character(), # no special properties\n        predict_type = \"response\", # measures response prediction\n        range = c(0, 1), # results in values between (0, 1)\n        minimize = FALSE # larger values are better\n      )\n    }\n  ),\n\n  private = list(\n    # define score as private method\n    .score = function(prediction, ...) {\n      # define loss\n      threshold_acc = function(truth, response) {\n        mean(ifelse(abs(truth - response) < sd(truth), 1, 0))\n      }\n      # call loss function\n      threshold_acc(prediction$truth, prediction$response)\n    }\n  )\n)\nIn the first two lines we name the class, here\nMeasureRegrThresholdAcc\n, and then state this is a regression measure that inherits from\nMeasureRegr\n.\nWe initialize the class by stating its unique ID is\n\"thresh_acc\"\n, that it does not require any external packages (\npackages = character()\n) and that it has no special properties (\nproperties = character()\n).\nWe then pass specific details of the loss function which are: it measures the quality of a\n\"response\"\ntype prediction, its values range between\n(0, 1)\n, and that the loss is optimized as its maximum (\nminimize = FALSE\n).\nFinally, we define the score itself as a private method called\n.score\nwhere we pass the predictions to the function we defined just above. The private method is a function assigned to the R6 class\nMeasureRegrThresholdAcc\n, such that one can (internally) call\nobject$.score(prediction,...)\nfor an object of class\nMeasureRegrThresholdAcc\n. The method is “private” as it is not intended to be visible for the end user.\nOnce you have defined your custom measure, you can add it to the\nmlr3measures\ndictionary like this:\nmlr3::mlr_measures$add(\"regr.thresh_acc\", MeasureRegrThresholdAcc)\n3.1 MSE-MAE\nDefine you own risk measure for regression, the maximum of MSE and MAE:\n, using the code skeleton supplied above.\nHint 1:\nYou need to change the code chunk containing the\nMeasureRegrThresholdAcc\nclass definition in at least 7 lines.\nSolution\nUnlock solution\n3.2 Evaluate a custom measure\nAdd your custom measure to the\nmlr3measures\ndictionary and use it to evaluate the following model prediction:\ntsk_mtcars = tsk(\"mtcars\")\nsplit = partition(tsk_mtcars)\nlrn_ranger = lrn(\"regr.ranger\")$train(tsk_mtcars, split$train)\nprediction = lrn_ranger$predict(tsk_mtcars, split$test)\nSolution\nUnlock solution\nSummary\nStratified resampling helps with balancing classes and features within CV folds, to ensure each fold represents the data well enough.\nBlock resampling reduces bias in generalization error estimates by ensuring that observations from the same group end up in the same fold.\nCustom domain applications require custom performance measures. In\nmlr3\n, you can define custom measures by creating a new\nR6\nclass.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nmlr-org\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "JavaScript is required to unlock solutions. Please enable JavaScript and reload the page, or download the source files from GitHub and run the code locally. Goal After this exercise, you should be able to control the resampling process when using mlr3 in order to account for data specificities, such as class imbalances in classification settings or grouping phenomena. Further, you will have learned how to construct and utilize custom measures for performance evaluation within mlr3. Prerequisites We load the most important packages and use a fixed seed for reproducibility. library(mlr3verse) library(mlbench) library(data.table) set.seed(7832) 1 Stratified Resampling In classification tasks, the ratio of the target class distribution should be similar in each train/test split, which is achieved by stratification. This is particularly useful in the case of imbalanced classes and small data sets. Stratification can also be performed with respect to explanatory categorical variables to ensure that all subgroups are represented in all training and test sets. In mlr3, each task has a slot $col_roles. This slot shows general roles certain features will have throughout different stages of the machine learning process. At least, the $col_roles slot shows which variables will be used as feature and as target. However, the $col_roles slot can be more diverse and some variables might even serve multiple roles. For example, task$col_roles$stratum specify the variable used for stratification. In this exercise, we will illustrate this using the german_credit data: task_gc = tsk(\"german_credit\") task_gc$col_roles $feature [1] \"age\" \"amount\" \"credit_history\" \"duration\" [5] \"employment_duration\" \"foreign_worker\" \"housing\" \"installment_rate\" [9] \"job\" \"number_credits\" \"other_debtors\" \"other_installment_plans\" [13] \"people_liable\" \"personal_status_sex\" \"present_residence\" \"property\" [17] \"purpose\" \"savings\" \"status\" \"telephone\" $target [1] \"credit_risk\" $name character(0) $order character(0) $stratum character(0) $group character(0) $weight character(0) $offset character(0) $always_included character(0) 1.1 Set stratification variable Modify the task_gc object such that the target variable credit_risk is used to for stratification. Hint 1 task_gc$col_roles$... = \"credit_risk\" Solution Unlock solution 1.2 Create resampling procedure Next, specify a 3-fold cross validation and instantiate the resampling on the task. Solution Unlock solution 1.3 Sanity check As a sanity check, the target class distribution should be similar within each CV fold. Compute and check the target class distribution in form of a ratio within each fold. Hint 1 First, merge the data with the corresponding cv fold. Second, aggregate for each fold. Hint 2 dt",
    "meta_keywords": null,
    "og_description": "JavaScript is required to unlock solutions. Please enable JavaScript and reload the page, or download the source files from GitHub and run the code locally. Goal After this exercise, you should be able to control the resampling process when using mlr3 in order to account for data specificities, such as class imbalances in classification settings or grouping phenomena. Further, you will have learned how to construct and utilize custom measures for performance evaluation within mlr3. Prerequisites We load the most important packages and use a fixed seed for reproducibility. library(mlr3verse) library(mlbench) library(data.table) set.seed(7832) 1 Stratified Resampling In classification tasks, the ratio of the target class distribution should be similar in each train/test split, which is achieved by stratification. This is particularly useful in the case of imbalanced classes and small data sets. Stratification can also be performed with respect to explanatory categorical variables to ensure that all subgroups are represented in all training and test sets. In mlr3, each task has a slot $col_roles. This slot shows general roles certain features will have throughout different stages of the machine learning process. At least, the $col_roles slot shows which variables will be used as feature and as target. However, the $col_roles slot can be more diverse and some variables might even serve multiple roles. For example, task$col_roles$stratum specify the variable used for stratification. In this exercise, we will illustrate this using the german_credit data: task_gc = tsk(\"german_credit\") task_gc$col_roles $feature [1] \"age\" \"amount\" \"credit_history\" \"duration\" [5] \"employment_duration\" \"foreign_worker\" \"housing\" \"installment_rate\" [9] \"job\" \"number_credits\" \"other_debtors\" \"other_installment_plans\" [13] \"people_liable\" \"personal_status_sex\" \"present_residence\" \"property\" [17] \"purpose\" \"savings\" \"status\" \"telephone\" $target [1] \"credit_risk\" $name character(0) $order character(0) $stratum character(0) $group character(0) $weight character(0) $offset character(0) $always_included character(0) 1.1 Set stratification variable Modify the task_gc object such that the target variable credit_risk is used to for stratification. Hint 1 task_gc$col_roles$... = \"credit_risk\" Solution Unlock solution 1.2 Create resampling procedure Next, specify a 3-fold cross validation and instantiate the resampling on the task. Solution Unlock solution 1.3 Sanity check As a sanity check, the target class distribution should be similar within each CV fold. Compute and check the target class distribution in form of a ratio within each fold. Hint 1 First, merge the data with the corresponding cv fold. Second, aggregate for each fold. Hint 2 dt",
    "og_image": "https://latex.codecogs.com/png.latex?f(y,%20%5Chat%7By%7D)%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20%5Cmathbb%7BI%7D(%7Cy_i%20-%20%5Chat%7By%7D_i%7C%20%3C%20%5Csigma_y)",
    "og_title": "Advanced Resampling with Custom Measure Solution | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 7.3,
    "sitemap_lastmod": null,
    "twitter_description": "JavaScript is required to unlock solutions. Please enable JavaScript and reload the page, or download the source files from GitHub and run the code locally. Goal After this exercise, you should be able to control the resampling process when using mlr3 in order to account for data specificities, such as class imbalances in classification settings or grouping phenomena. Further, you will have learned how to construct and utilize custom measures for performance evaluation within mlr3. Prerequisites We load the most important packages and use a fixed seed for reproducibility. library(mlr3verse) library(mlbench) library(data.table) set.seed(7832) 1 Stratified Resampling In classification tasks, the ratio of the target class distribution should be similar in each train/test split, which is achieved by stratification. This is particularly useful in the case of imbalanced classes and small data sets. Stratification can also be performed with respect to explanatory categorical variables to ensure that all subgroups are represented in all training and test sets. In mlr3, each task has a slot $col_roles. This slot shows general roles certain features will have throughout different stages of the machine learning process. At least, the $col_roles slot shows which variables will be used as feature and as target. However, the $col_roles slot can be more diverse and some variables might even serve multiple roles. For example, task$col_roles$stratum specify the variable used for stratification. In this exercise, we will illustrate this using the german_credit data: task_gc = tsk(\"german_credit\") task_gc$col_roles $feature [1] \"age\" \"amount\" \"credit_history\" \"duration\" [5] \"employment_duration\" \"foreign_worker\" \"housing\" \"installment_rate\" [9] \"job\" \"number_credits\" \"other_debtors\" \"other_installment_plans\" [13] \"people_liable\" \"personal_status_sex\" \"present_residence\" \"property\" [17] \"purpose\" \"savings\" \"status\" \"telephone\" $target [1] \"credit_risk\" $name character(0) $order character(0) $stratum character(0) $group character(0) $weight character(0) $offset character(0) $always_included character(0) 1.1 Set stratification variable Modify the task_gc object such that the target variable credit_risk is used to for stratification. Hint 1 task_gc$col_roles$... = \"credit_risk\" Solution Unlock solution 1.2 Create resampling procedure Next, specify a 3-fold cross validation and instantiate the resampling on the task. Solution Unlock solution 1.3 Sanity check As a sanity check, the target class distribution should be similar within each CV fold. Compute and check the target class distribution in form of a ratio within each fold. Hint 1 First, merge the data with the corresponding cv fold. Second, aggregate for each fold. Hint 2 dt",
    "twitter_title": "Advanced Resampling with Custom Measure Solution | R-bloggers",
    "url": "https://www.r-bloggers.com/2025/05/advanced-resampling-with-custom-measure-solution/",
    "word_count": 1453
  }
}