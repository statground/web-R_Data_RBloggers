{
  "id": "ca39d76e04a3e849d1090a9c88799588de7332ae",
  "url": "https://www.r-bloggers.com/2023/11/print-debugging-now-with-icecream/",
  "created_at_utc": "2025-11-17T20:39:21Z",
  "data": null,
  "raw_original": {
    "uuid": "3990ebf1-fba4-4ddb-a8fb-31bf9cd59067",
    "created_at": "2025-11-17 20:39:21",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2023/11/print-debugging-now-with-icecream/",
      "crawled_at": "2025-11-17T09:59:48.622869",
      "external_links": [
        {
          "href": "https://jcarroll.com.au/2023/11/07/print-debugging-now-with-icecream/",
          "text": "rstats on Irregularly Scheduled Programming"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://dev-doc.rust-lang.org/beta/std/macro.dbg.html",
          "text": "dbg!"
        },
        {
          "href": "https://docs.rs/log/latest/log/",
          "text": "log"
        },
        {
          "href": "https://turtletopia.github.io/2022/07/28/ice-cream-for-r-programmers/",
          "text": "a blog\npost"
        },
        {
          "href": "https://github.com/lewinfox/icecream",
          "text": "{icecream}"
        },
        {
          "href": "https://fosstodon.org/@jonocarroll",
          "text": "Mastodon"
        },
        {
          "href": "https://jcarroll.com.au/2023/11/07/print-debugging-now-with-icecream/",
          "text": "rstats on Irregularly Scheduled Programming"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Print Debugging (Now with Icecream!) | R-bloggers",
      "images": [],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/jonathan-carroll/",
          "text": "Jonathan Carroll"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-379735 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Print Debugging (Now with Icecream!)</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">November 6, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/jonathan-carroll/\">Jonathan Carroll</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://jcarroll.com.au/2023/11/07/print-debugging-now-with-icecream/\"> rstats on Irregularly Scheduled Programming</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9--><p>Print debugging has its place. Sure, it’s not always the <em>best</em> way to debug something,\nbut it can often be the fastest. In this post I describe a useful way to do this in Rust\nand how we can get similar behaviour in R.</p>\n<p>I love the Rust <a href=\"https://dev-doc.rust-lang.org/beta/std/macro.dbg.html\" rel=\"nofollow\" target=\"_blank\"><code>dbg!</code></a>\nmacro – it wraps a value or expression and prints the result to help debug\nwhat’s happening in the middle of some function. If we had some complicated\nfunction that combined some values, e.g.</p>\n<pre>fn f(val1: i32, val2: i32) -&gt; i32 {\n    // do some things\n    let otherval: i32 = 10;\n    // final result\n    val1 + val2 + otherval\n}\n\nfn main() {\n    println!(\"final result = {}\", f(5, 6))\n}</pre>\n<p>Running this gives just the final result, as expected</p>\n<pre>final result = 21</pre>\n<p>We might want to check on what the intermediate combinations of <code>otherval</code> and <code>val1</code>\nor <code>val2</code> (terrible names, I know). One option is to just print them</p>\n<pre>fn f(val1: i32, val2: i32) -&gt; i32 {\n    // do some things\n    let otherval: i32 = 10;\n    println!(\"{}\", otherval + val1);\n    println!(\"{}\", otherval + val2);\n    // final result\n    val1 + val2 + otherval\n}\n\nfn main() {\n    println!(\"final result = {}\", f(5, 6))\n}</pre>\n<p>Running this shows the values we printed, but with no context</p>\n<pre>15\n16\nfinal result = 21</pre>\n<p>We could add some context manually</p>\n<pre>fn f(val1: i32, val2: i32) -&gt; i32 {\n    // do some things\n    let otherval: i32 = 10;\n    println!(\"first temp val = {}\", otherval + val1);\n    println!(\"second temp val = {}\", otherval + val2);\n    // final result\n    val1 + val2 + otherval\n}\n\nfn main() {\n    println!(\"final result = {}\", f(5, 6))\n}</pre>\n<p>producing</p>\n<pre>first temp val = 15\nsecond temp val = 16\nfinal result = 21</pre>\n<p>but across an entire codebase, this is going to get messy, fast.</p>\n<p>A better option is the <code>dbg!</code> macro, which takes an <em>expression</em> (a value, or\nsomething that produces a value) and prints both the expression itself and the resulting\nvalue</p>\n<pre>fn f(val1: i32, val2: i32) -&gt; i32 {\n    // do some things\n    let otherval: i32 = 10;\n    dbg!(otherval + val1);\n    dbg!(otherval + val2);\n    // final result\n    val1 + val2 + otherval\n}\n\nfn main() {\n    println!(\"final result = {}\", f(5, 6))\n}</pre>\n<p>Running this produces</p>\n<pre>[src/main.rs:15] otherval + val1 = 15\n[src/main.rs:16] otherval + val2 = 16\nfinal result = 21</pre>\n<p>and we see we get the file/linenumber context, the expression we wrapped, and the value.</p>\n<p>This is extremely useful, and helps me to figure out what’s going on in the middle of\nsome implementation.</p>\n<p>One of the downsides is that even if I make a release build, these statements remain,\nso I need to go through and remove them all once I’m finished debugging.</p>\n<p>A “better” solution is to use a full logging solution like the\n<a href=\"https://docs.rs/log/latest/log/\" rel=\"nofollow\" target=\"_blank\"><code>log</code></a> crate which enables using different log\nlevels, turning off logging outside of some threshold, etc… but that seems\nmore suited to intentional logging, not debugging something that <em>isn’t</em>\nworking.</p>\n<p>Having played with this in Rust, of course I wanted the same thing in R. I built a\nminimal viable proof-of-concept which leverages {rlang} to capture the expression</p>\n<pre>dbg &lt;- function(x) {\n  ex &lt;- rlang::f_text(rlang::enquos(x)[[1]])\n  ret &lt;- rlang::eval_bare(x)\n  message(glue::glue(\"DEBUG: {ex} = {ret}\"))\n  ret\n}</pre>\n<p>This works rather well - it postpones evaluation of the expression and prints the result\nwithout affecting any variables</p>\n<pre>a &lt;- 1\nb &lt;- 3\nx &lt;- dbg(a + b)\r\n## DEBUG: a + b = 4\r\ny &lt;- dbg(2*x + 3)\r\n## DEBUG: 2 * x + 3 = 11\r\nz &lt;- 10 + dbg(y*2)\r\n## DEBUG: y * 2 = 22\r\nz\r\n## [1] 32</pre>\n<p>It lacks one beautiful part of the Rust solution, though - if I include this in some\nfunctions sourced from a file, I won’t be able to tell which file the statement came from. Plus,\nit doesn’t deal so well with large structures</p>\n<pre>x &lt;- dbg(head(mtcars))\r\n## DEBUG: head(mtcars) = c(21, 21, 22.8, 21.4, 18.7, 18.1)DEBUG: head(mtcars) = c(6, 6, 4, 6, 8, 6)DEBUG: head(mtcars) = c(160, 160, 108, 258, 360, 225)DEBUG: head(mtcars) = c(110, 110, 93, 110, 175, 105)DEBUG: head(mtcars) = c(3.9, 3.9, 3.85, 3.08, 3.15, 2.76)DEBUG: head(mtcars) = c(2.62, 2.875, 2.32, 3.215, 3.44, 3.46)DEBUG: head(mtcars) = c(16.46, 17.02, 18.61, 19.44, 17.02, 20.22)DEBUG: head(mtcars) = c(0, 0, 1, 1, 0, 1)DEBUG: head(mtcars) = c(1, 1, 1, 0, 0, 0)DEBUG: head(mtcars) = c(4, 4, 4, 3, 3, 3)DEBUG: head(mtcars) = c(4, 4, 1, 1, 2, 1)</pre>\n<p>At some point I saw <a href=\"https://turtletopia.github.io/2022/07/28/ice-cream-for-r-programmers/\" rel=\"nofollow\" target=\"_blank\">a blog\npost</a>\nabout a debug logging package <a href=\"https://github.com/lewinfox/icecream\" rel=\"nofollow\" target=\"_blank\">{icecream}</a>\nwhich had this ability of tracing the <code>srcref</code> of a file containing the debug\nstatement, so I wanted to see if I could extract that to suit my needs. Running\nthe <code>ic()</code> statement as a print debugger works nicely</p>\n<pre>f &lt;- function(val1, val2) {\n  otherval &lt;- 10\n  icecream::ic(otherval + val1)\n  icecream::ic(otherval + val2)\n  val1 + val2 + otherval\n}\nf(5, 6)\r\n## ℹ ic| `otherval + val1`: num 15\r\n## ℹ ic| `otherval + val2`: num 16\r\n## [1] 21</pre>\n<p>it indeed wraps the expression and shows the result. After poking around at the\ninternals, I realised it actually does everything that I wanted, I just needed to change\nsome of the defaults</p>\n<pre>options(icecream.peeking.function = utils::head,\n        icecream.max.lines = 5,\n        icecream.prefix = \"dbg:\",\n        icecream.always.include.context = TRUE)</pre>\n<p>Now it prints like the <code>dbg!</code> macro</p>\n<pre>f &lt;- function(val1, val2) {\n  otherval &lt;- 10\n  icecream::ic(otherval + val1)\n  icecream::ic(otherval + val2)\n  val1 + val2 + otherval\n}\nf(5, 6)\r\n## ℹ dbg: `f()` in &lt;env: global&gt; | `otherval + val1`: [1] 15\r\n## ℹ dbg: `f()` in &lt;env: global&gt; | `otherval + val2`: [1] 16\r\n## [1] 21</pre>\n<p>To make it even more like the Rust macro, I made a similar binding of <code>.dbg</code> (so\nthat it doesn’t appear in my workspace by default) and added the following to my\n.Rprofile</p>\n<pre># install.packages(\"icecream\")\nif (requireNamespace(\"icecream\", quietly = TRUE)) {\n  .dbg &lt;- icecream::ic\n  options(icecream.peeking.function = utils::head,\n          icecream.max.lines = 5,\n          icecream.prefix = \"dbg:\",\n          icecream.always.include.context = TRUE)\n}</pre>\n<p>so now I can add debug statements</p>\n<pre>f &lt;- function(val1, val2) {\n  otherval &lt;- 10\n  .dbg(otherval + val1)\n  .dbg(otherval + val2)\n  val1 + val2 + otherval\n}\nf(5, 6)\r\n## ℹ dbg: `f()` in &lt;env: global&gt; | `otherval + val1`: [1] 15\r\n## ℹ dbg: `f()` in &lt;env: global&gt; | `otherval + val2`: [1] 16\r\n## [1] 21</pre>\n<p>Better yet, I can turn them off if I don’t need them</p>\n<pre>icecream::ic_disable()\nf(5, 6)\r\n## [1] 21</pre>\n<p>This works as I had hoped; I can even debug partway through an expression</p>\n<pre>icecream::ic_enable()\n3 + .dbg(4 + 6)\r\n## ℹ dbg: &lt;env: global&gt; | `4 + 6`: [1] 10\r\n## [1] 13</pre>\n<p>and if I source a file, I get the context</p>\n<pre>## test_dbg.R:\nf &lt;- function() {\n  x &lt;- 7\n  .dbg(x + 3)\n  7\n}\r\nsource(\"test_dbg.R\")\nf()\r\nℹ dbg: `f()` in test_dbg.R:3:2 | `x + 3`: [1] 10\r\n[1] 7</pre>\n<p>It even deals with printing larger objects, given the “peeking_function” and “max lines”\noptions above</p>\n<pre>.dbg(mtcars)\r\n## ℹ dbg: &lt;env: global&gt; | `mtcars`: \n## mpg cyl disp  hp drat    wt  qsec vs am gear carb\n## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4\n## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4\n## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1\n## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</pre>\n<p>That seems to be feature-equivalent to the Rust <code>dbg!</code> macro, plus the ability to\nturn off the messages, so I’m very happy with this result.</p>\n<p>Do you have a better solution? I can be found on\n<a href=\"https://fosstodon.org/@jonocarroll\" rel=\"nofollow\" target=\"_blank\">Mastodon</a> or use the comments below.</p>\n<br/>\n<details>\n<summary>\n<tt>devtools::session_info()</tt>\n</summary>\n<pre>## ─ Session info ───────────────────────────────────────────────────────────────\n##  setting  value\n##  version  R version 4.1.2 (2021-11-01)\n##  os       Pop!_OS 22.04 LTS\n##  system   x86_64, linux-gnu\n##  ui       X11\n##  language (EN)\n##  collate  en_AU.UTF-8\n##  ctype    en_AU.UTF-8\n##  tz       Australia/Adelaide\n##  date     2023-11-07\n##  pandoc   3.1.8 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/x86_64/ (via rmarkdown)\n## \n## ─ Packages ───────────────────────────────────────────────────────────────────\n##  package     * version date (UTC) lib source\n##  blogdown      1.17    2023-05-16 [1] CRAN (R 4.1.2)\n##  bookdown      0.29    2022-09-12 [1] CRAN (R 4.1.2)\n##  bslib         0.5.1   2023-08-11 [3] CRAN (R 4.3.1)\n##  cachem        1.0.8   2023-05-01 [3] CRAN (R 4.3.0)\n##  callr         3.7.3   2022-11-02 [3] CRAN (R 4.2.2)\n##  cli           3.6.1   2023-03-23 [3] CRAN (R 4.2.3)\n##  crayon        1.5.2   2022-09-29 [3] CRAN (R 4.2.1)\n##  devtools      2.4.5   2022-10-11 [1] CRAN (R 4.1.2)\n##  digest        0.6.33  2023-07-07 [3] CRAN (R 4.3.1)\n##  ellipsis      0.3.2   2021-04-29 [3] CRAN (R 4.1.1)\n##  evaluate      0.21    2023-05-05 [3] CRAN (R 4.3.0)\n##  fansi         1.0.4   2023-01-22 [3] CRAN (R 4.2.2)\n##  fastmap       1.1.1   2023-02-24 [3] CRAN (R 4.2.2)\n##  fs            1.6.3   2023-07-20 [3] CRAN (R 4.3.1)\n##  glue          1.6.2   2022-02-24 [3] CRAN (R 4.2.0)\n##  htmltools     0.5.6   2023-08-10 [3] CRAN (R 4.3.1)\n##  htmlwidgets   1.5.4   2021-09-08 [1] CRAN (R 4.1.2)\n##  httpuv        1.6.6   2022-09-08 [1] CRAN (R 4.1.2)\n##  icecream      0.2.1   2023-09-27 [1] CRAN (R 4.1.2)\n##  jquerylib     0.1.4   2021-04-26 [3] CRAN (R 4.1.2)\n##  jsonlite      1.8.7   2023-06-29 [3] CRAN (R 4.3.1)\n##  knitr         1.43    2023-05-25 [3] CRAN (R 4.3.0)\n##  later         1.3.0   2021-08-18 [1] CRAN (R 4.1.2)\n##  lifecycle     1.0.3   2022-10-07 [3] CRAN (R 4.2.1)\n##  magrittr      2.0.3   2022-03-30 [3] CRAN (R 4.2.0)\n##  memoise       2.0.1   2021-11-26 [3] CRAN (R 4.2.0)\n##  mime          0.12    2021-09-28 [3] CRAN (R 4.2.0)\n##  miniUI        0.1.1.1 2018-05-18 [1] CRAN (R 4.1.2)\n##  pillar        1.9.0   2023-03-22 [3] CRAN (R 4.2.3)\n##  pkgbuild      1.4.0   2022-11-27 [1] CRAN (R 4.1.2)\n##  pkgload       1.3.0   2022-06-27 [1] CRAN (R 4.1.2)\n##  prettyunits   1.1.1   2020-01-24 [3] CRAN (R 4.0.1)\n##  processx      3.8.2   2023-06-30 [3] CRAN (R 4.3.1)\n##  profvis       0.3.7   2020-11-02 [1] CRAN (R 4.1.2)\n##  promises      1.2.0.1 2021-02-11 [1] CRAN (R 4.1.2)\n##  ps            1.7.5   2023-04-18 [3] CRAN (R 4.3.0)\n##  purrr         1.0.1   2023-01-10 [1] CRAN (R 4.1.2)\n##  R6            2.5.1   2021-08-19 [3] CRAN (R 4.2.0)\n##  Rcpp          1.0.9   2022-07-08 [1] CRAN (R 4.1.2)\n##  remotes       2.4.2   2021-11-30 [1] CRAN (R 4.1.2)\n##  rlang         1.1.1   2023-04-28 [1] CRAN (R 4.1.2)\n##  rmarkdown     2.24    2023-08-14 [3] CRAN (R 4.3.1)\n##  rstudioapi    0.15.0  2023-07-07 [3] CRAN (R 4.3.1)\n##  sass          0.4.7   2023-07-15 [3] CRAN (R 4.3.1)\n##  sessioninfo   1.2.2   2021-12-06 [1] CRAN (R 4.1.2)\n##  shiny         1.7.2   2022-07-19 [1] CRAN (R 4.1.2)\n##  stringi       1.7.12  2023-01-11 [3] CRAN (R 4.2.2)\n##  stringr       1.5.0   2022-12-02 [1] CRAN (R 4.1.2)\n##  urlchecker    1.0.1   2021-11-30 [1] CRAN (R 4.1.2)\n##  usethis       2.1.6   2022-05-25 [1] CRAN (R 4.1.2)\n##  utf8          1.2.3   2023-01-31 [3] CRAN (R 4.2.2)\n##  vctrs         0.6.3   2023-06-14 [1] CRAN (R 4.1.2)\n##  xfun          0.40    2023-08-09 [3] CRAN (R 4.3.1)\n##  xtable        1.8-4   2019-04-21 [1] CRAN (R 4.1.2)\n##  yaml          2.3.7   2023-01-23 [3] CRAN (R 4.2.2)\n## \n##  [1] /home/jono/R/x86_64-pc-linux-gnu-library/4.1\n##  [2] /usr/local/lib/R/site-library\n##  [3] /usr/lib/R/site-library\n##  [4] /usr/lib/R/library\n## \n## ──────────────────────────────────────────────────────────────────────────────</pre>\n</details>\n<p><br/></p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://jcarroll.com.au/2023/11/07/print-debugging-now-with-icecream/\"> rstats on Irregularly Scheduled Programming</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
      "main_text": "Print Debugging (Now with Icecream!)\nPosted on\nNovember 6, 2023\nby\nJonathan Carroll\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nrstats on Irregularly Scheduled Programming\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nPrint debugging has its place. Sure, it’s not always the\nbest\nway to debug something,\nbut it can often be the fastest. In this post I describe a useful way to do this in Rust\nand how we can get similar behaviour in R.\nI love the Rust\ndbg!\nmacro – it wraps a value or expression and prints the result to help debug\nwhat’s happening in the middle of some function. If we had some complicated\nfunction that combined some values, e.g.\nfn f(val1: i32, val2: i32) -> i32 {\n    // do some things\n    let otherval: i32 = 10;\n    // final result\n    val1 + val2 + otherval\n}\n\nfn main() {\n    println!(\"final result = {}\", f(5, 6))\n}\nRunning this gives just the final result, as expected\nfinal result = 21\nWe might want to check on what the intermediate combinations of\notherval\nand\nval1\nor\nval2\n(terrible names, I know). One option is to just print them\nfn f(val1: i32, val2: i32) -> i32 {\n    // do some things\n    let otherval: i32 = 10;\n    println!(\"{}\", otherval + val1);\n    println!(\"{}\", otherval + val2);\n    // final result\n    val1 + val2 + otherval\n}\n\nfn main() {\n    println!(\"final result = {}\", f(5, 6))\n}\nRunning this shows the values we printed, but with no context\n15\n16\nfinal result = 21\nWe could add some context manually\nfn f(val1: i32, val2: i32) -> i32 {\n    // do some things\n    let otherval: i32 = 10;\n    println!(\"first temp val = {}\", otherval + val1);\n    println!(\"second temp val = {}\", otherval + val2);\n    // final result\n    val1 + val2 + otherval\n}\n\nfn main() {\n    println!(\"final result = {}\", f(5, 6))\n}\nproducing\nfirst temp val = 15\nsecond temp val = 16\nfinal result = 21\nbut across an entire codebase, this is going to get messy, fast.\nA better option is the\ndbg!\nmacro, which takes an\nexpression\n(a value, or\nsomething that produces a value) and prints both the expression itself and the resulting\nvalue\nfn f(val1: i32, val2: i32) -> i32 {\n    // do some things\n    let otherval: i32 = 10;\n    dbg!(otherval + val1);\n    dbg!(otherval + val2);\n    // final result\n    val1 + val2 + otherval\n}\n\nfn main() {\n    println!(\"final result = {}\", f(5, 6))\n}\nRunning this produces\n[src/main.rs:15] otherval + val1 = 15\n[src/main.rs:16] otherval + val2 = 16\nfinal result = 21\nand we see we get the file/linenumber context, the expression we wrapped, and the value.\nThis is extremely useful, and helps me to figure out what’s going on in the middle of\nsome implementation.\nOne of the downsides is that even if I make a release build, these statements remain,\nso I need to go through and remove them all once I’m finished debugging.\nA “better” solution is to use a full logging solution like the\nlog\ncrate which enables using different log\nlevels, turning off logging outside of some threshold, etc… but that seems\nmore suited to intentional logging, not debugging something that\nisn’t\nworking.\nHaving played with this in Rust, of course I wanted the same thing in R. I built a\nminimal viable proof-of-concept which leverages {rlang} to capture the expression\ndbg <- function(x) {\n  ex <- rlang::f_text(rlang::enquos(x)[[1]])\n  ret <- rlang::eval_bare(x)\n  message(glue::glue(\"DEBUG: {ex} = {ret}\"))\n  ret\n}\nThis works rather well - it postpones evaluation of the expression and prints the result\nwithout affecting any variables\na <- 1\nb <- 3\nx <- dbg(a + b)\n## DEBUG: a + b = 4\ny <- dbg(2*x + 3)\n## DEBUG: 2 * x + 3 = 11\nz <- 10 + dbg(y*2)\n## DEBUG: y * 2 = 22\nz\n## [1] 32\nIt lacks one beautiful part of the Rust solution, though - if I include this in some\nfunctions sourced from a file, I won’t be able to tell which file the statement came from. Plus,\nit doesn’t deal so well with large structures\nx <- dbg(head(mtcars))\n## DEBUG: head(mtcars) = c(21, 21, 22.8, 21.4, 18.7, 18.1)DEBUG: head(mtcars) = c(6, 6, 4, 6, 8, 6)DEBUG: head(mtcars) = c(160, 160, 108, 258, 360, 225)DEBUG: head(mtcars) = c(110, 110, 93, 110, 175, 105)DEBUG: head(mtcars) = c(3.9, 3.9, 3.85, 3.08, 3.15, 2.76)DEBUG: head(mtcars) = c(2.62, 2.875, 2.32, 3.215, 3.44, 3.46)DEBUG: head(mtcars) = c(16.46, 17.02, 18.61, 19.44, 17.02, 20.22)DEBUG: head(mtcars) = c(0, 0, 1, 1, 0, 1)DEBUG: head(mtcars) = c(1, 1, 1, 0, 0, 0)DEBUG: head(mtcars) = c(4, 4, 4, 3, 3, 3)DEBUG: head(mtcars) = c(4, 4, 1, 1, 2, 1)\nAt some point I saw\na blog\npost\nabout a debug logging package\n{icecream}\nwhich had this ability of tracing the\nsrcref\nof a file containing the debug\nstatement, so I wanted to see if I could extract that to suit my needs. Running\nthe\nic()\nstatement as a print debugger works nicely\nf <- function(val1, val2) {\n  otherval <- 10\n  icecream::ic(otherval + val1)\n  icecream::ic(otherval + val2)\n  val1 + val2 + otherval\n}\nf(5, 6)\n## ℹ ic| `otherval + val1`: num 15\n## ℹ ic| `otherval + val2`: num 16\n## [1] 21\nit indeed wraps the expression and shows the result. After poking around at the\ninternals, I realised it actually does everything that I wanted, I just needed to change\nsome of the defaults\noptions(icecream.peeking.function = utils::head,\n        icecream.max.lines = 5,\n        icecream.prefix = \"dbg:\",\n        icecream.always.include.context = TRUE)\nNow it prints like the\ndbg!\nmacro\nf <- function(val1, val2) {\n  otherval <- 10\n  icecream::ic(otherval + val1)\n  icecream::ic(otherval + val2)\n  val1 + val2 + otherval\n}\nf(5, 6)\n## ℹ dbg: `f()` in <env: global> | `otherval + val1`: [1] 15\n## ℹ dbg: `f()` in <env: global> | `otherval + val2`: [1] 16\n## [1] 21\nTo make it even more like the Rust macro, I made a similar binding of\n.dbg\n(so\nthat it doesn’t appear in my workspace by default) and added the following to my\n.Rprofile\n# install.packages(\"icecream\")\nif (requireNamespace(\"icecream\", quietly = TRUE)) {\n  .dbg <- icecream::ic\n  options(icecream.peeking.function = utils::head,\n          icecream.max.lines = 5,\n          icecream.prefix = \"dbg:\",\n          icecream.always.include.context = TRUE)\n}\nso now I can add debug statements\nf <- function(val1, val2) {\n  otherval <- 10\n  .dbg(otherval + val1)\n  .dbg(otherval + val2)\n  val1 + val2 + otherval\n}\nf(5, 6)\n## ℹ dbg: `f()` in <env: global> | `otherval + val1`: [1] 15\n## ℹ dbg: `f()` in <env: global> | `otherval + val2`: [1] 16\n## [1] 21\nBetter yet, I can turn them off if I don’t need them\nicecream::ic_disable()\nf(5, 6)\n## [1] 21\nThis works as I had hoped; I can even debug partway through an expression\nicecream::ic_enable()\n3 + .dbg(4 + 6)\n## ℹ dbg: <env: global> | `4 + 6`: [1] 10\n## [1] 13\nand if I source a file, I get the context\n## test_dbg.R:\nf <- function() {\n  x <- 7\n  .dbg(x + 3)\n  7\n}\nsource(\"test_dbg.R\")\nf()\nℹ dbg: `f()` in test_dbg.R:3:2 | `x + 3`: [1] 10\n[1] 7\nIt even deals with printing larger objects, given the “peeking_function” and “max lines”\noptions above\n.dbg(mtcars)\n## ℹ dbg: <env: global> | `mtcars`: \n## mpg cyl disp  hp drat    wt  qsec vs am gear carb\n## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4\n## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4\n## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1\n## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1\nThat seems to be feature-equivalent to the Rust\ndbg!\nmacro, plus the ability to\nturn off the messages, so I’m very happy with this result.\nDo you have a better solution? I can be found on\nMastodon\nor use the comments below.\ndevtools::session_info()\n## ─ Session info ───────────────────────────────────────────────────────────────\n##  setting  value\n##  version  R version 4.1.2 (2021-11-01)\n##  os       Pop!_OS 22.04 LTS\n##  system   x86_64, linux-gnu\n##  ui       X11\n##  language (EN)\n##  collate  en_AU.UTF-8\n##  ctype    en_AU.UTF-8\n##  tz       Australia/Adelaide\n##  date     2023-11-07\n##  pandoc   3.1.8 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/x86_64/ (via rmarkdown)\n## \n## ─ Packages ───────────────────────────────────────────────────────────────────\n##  package     * version date (UTC) lib source\n##  blogdown      1.17    2023-05-16 [1] CRAN (R 4.1.2)\n##  bookdown      0.29    2022-09-12 [1] CRAN (R 4.1.2)\n##  bslib         0.5.1   2023-08-11 [3] CRAN (R 4.3.1)\n##  cachem        1.0.8   2023-05-01 [3] CRAN (R 4.3.0)\n##  callr         3.7.3   2022-11-02 [3] CRAN (R 4.2.2)\n##  cli           3.6.1   2023-03-23 [3] CRAN (R 4.2.3)\n##  crayon        1.5.2   2022-09-29 [3] CRAN (R 4.2.1)\n##  devtools      2.4.5   2022-10-11 [1] CRAN (R 4.1.2)\n##  digest        0.6.33  2023-07-07 [3] CRAN (R 4.3.1)\n##  ellipsis      0.3.2   2021-04-29 [3] CRAN (R 4.1.1)\n##  evaluate      0.21    2023-05-05 [3] CRAN (R 4.3.0)\n##  fansi         1.0.4   2023-01-22 [3] CRAN (R 4.2.2)\n##  fastmap       1.1.1   2023-02-24 [3] CRAN (R 4.2.2)\n##  fs            1.6.3   2023-07-20 [3] CRAN (R 4.3.1)\n##  glue          1.6.2   2022-02-24 [3] CRAN (R 4.2.0)\n##  htmltools     0.5.6   2023-08-10 [3] CRAN (R 4.3.1)\n##  htmlwidgets   1.5.4   2021-09-08 [1] CRAN (R 4.1.2)\n##  httpuv        1.6.6   2022-09-08 [1] CRAN (R 4.1.2)\n##  icecream      0.2.1   2023-09-27 [1] CRAN (R 4.1.2)\n##  jquerylib     0.1.4   2021-04-26 [3] CRAN (R 4.1.2)\n##  jsonlite      1.8.7   2023-06-29 [3] CRAN (R 4.3.1)\n##  knitr         1.43    2023-05-25 [3] CRAN (R 4.3.0)\n##  later         1.3.0   2021-08-18 [1] CRAN (R 4.1.2)\n##  lifecycle     1.0.3   2022-10-07 [3] CRAN (R 4.2.1)\n##  magrittr      2.0.3   2022-03-30 [3] CRAN (R 4.2.0)\n##  memoise       2.0.1   2021-11-26 [3] CRAN (R 4.2.0)\n##  mime          0.12    2021-09-28 [3] CRAN (R 4.2.0)\n##  miniUI        0.1.1.1 2018-05-18 [1] CRAN (R 4.1.2)\n##  pillar        1.9.0   2023-03-22 [3] CRAN (R 4.2.3)\n##  pkgbuild      1.4.0   2022-11-27 [1] CRAN (R 4.1.2)\n##  pkgload       1.3.0   2022-06-27 [1] CRAN (R 4.1.2)\n##  prettyunits   1.1.1   2020-01-24 [3] CRAN (R 4.0.1)\n##  processx      3.8.2   2023-06-30 [3] CRAN (R 4.3.1)\n##  profvis       0.3.7   2020-11-02 [1] CRAN (R 4.1.2)\n##  promises      1.2.0.1 2021-02-11 [1] CRAN (R 4.1.2)\n##  ps            1.7.5   2023-04-18 [3] CRAN (R 4.3.0)\n##  purrr         1.0.1   2023-01-10 [1] CRAN (R 4.1.2)\n##  R6            2.5.1   2021-08-19 [3] CRAN (R 4.2.0)\n##  Rcpp          1.0.9   2022-07-08 [1] CRAN (R 4.1.2)\n##  remotes       2.4.2   2021-11-30 [1] CRAN (R 4.1.2)\n##  rlang         1.1.1   2023-04-28 [1] CRAN (R 4.1.2)\n##  rmarkdown     2.24    2023-08-14 [3] CRAN (R 4.3.1)\n##  rstudioapi    0.15.0  2023-07-07 [3] CRAN (R 4.3.1)\n##  sass          0.4.7   2023-07-15 [3] CRAN (R 4.3.1)\n##  sessioninfo   1.2.2   2021-12-06 [1] CRAN (R 4.1.2)\n##  shiny         1.7.2   2022-07-19 [1] CRAN (R 4.1.2)\n##  stringi       1.7.12  2023-01-11 [3] CRAN (R 4.2.2)\n##  stringr       1.5.0   2022-12-02 [1] CRAN (R 4.1.2)\n##  urlchecker    1.0.1   2021-11-30 [1] CRAN (R 4.1.2)\n##  usethis       2.1.6   2022-05-25 [1] CRAN (R 4.1.2)\n##  utf8          1.2.3   2023-01-31 [3] CRAN (R 4.2.2)\n##  vctrs         0.6.3   2023-06-14 [1] CRAN (R 4.1.2)\n##  xfun          0.40    2023-08-09 [3] CRAN (R 4.3.1)\n##  xtable        1.8-4   2019-04-21 [1] CRAN (R 4.1.2)\n##  yaml          2.3.7   2023-01-23 [3] CRAN (R 4.2.2)\n## \n##  [1] /home/jono/R/x86_64-pc-linux-gnu-library/4.1\n##  [2] /usr/local/lib/R/site-library\n##  [3] /usr/lib/R/site-library\n##  [4] /usr/lib/R/library\n## \n## ──────────────────────────────────────────────────────────────────────────────\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nrstats on Irregularly Scheduled Programming\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "Print debugging has its place. Sure, it’s not always the best way to debug something, but it can often be the fastest. In this post I describe a useful way to do this in Rust and how we can get similar behaviour in R. I love the Rust dbg! macro - it wr...",
      "meta_keywords": null,
      "og_description": "Print debugging has its place. Sure, it’s not always the best way to debug something, but it can often be the fastest. In this post I describe a useful way to do this in Rust and how we can get similar behaviour in R. I love the Rust dbg! macro - it wr...",
      "og_image": "https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png",
      "og_title": "Print Debugging (Now with Icecream!) | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 11.1,
      "sitemap_lastmod": "2023-11-07T00:00:00+00:00",
      "twitter_description": "Print debugging has its place. Sure, it’s not always the best way to debug something, but it can often be the fastest. In this post I describe a useful way to do this in Rust and how we can get similar behaviour in R. I love the Rust dbg! macro - it wr...",
      "twitter_title": "Print Debugging (Now with Icecream!) | R-bloggers",
      "url": "https://www.r-bloggers.com/2023/11/print-debugging-now-with-icecream/",
      "word_count": 2227
    }
  }
}