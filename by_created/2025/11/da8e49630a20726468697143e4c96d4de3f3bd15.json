{
  "id": "da8e49630a20726468697143e4c96d4de3f3bd15",
  "url": "https://www.r-bloggers.com/2025/04/getting-my-feet-wet-with-plumber-and-javascript/",
  "created_at_utc": "2025-11-22T19:58:51Z",
  "data": null,
  "raw_original": {
    "uuid": "a8ac64eb-4589-4223-9542-96e8c1012a91",
    "created_at": "2025-11-22 19:58:51",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2025/04/getting-my-feet-wet-with-plumber-and-javascript/",
      "crawled_at": "2025-11-22T10:50:33.563773",
      "external_links": [
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/",
          "text": "r on Everyday Is A School Day"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#motivation",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/pressure/",
          "text": "barometric pressure monitoring"
        },
        {
          "href": "https://alecsalces.com/",
          "text": "Alec Wong"
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#objectives",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#bigpicture",
          "text": "Big Picture"
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#plumber",
          "text": "plumber.R"
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#serve",
          "text": "How to run it?"
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#hack",
          "text": "One Click on iOS"
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#opportunity",
          "text": "Opportunities for Improvement"
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#lessons",
          "text": "Lessons Learnt"
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#bigpicture",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#plumber",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#load-libraries-load-data-metadata",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#lets-write-out-html--javascript",
          "text": null
        },
        {
          "href": "https://www.rplumber.io/articles/rendering-output.html#serializers-1",
          "text": "Serializer"
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#more-plumber-api-functions",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#ok-lets-check-it-out-click-that-run-api-button-for-a-test-run",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#serve",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#paste-this-in-the-migraine-loggerservice",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#enable-start-check-status",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#hack",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#opportunity",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/#lessons",
          "text": null
        },
        {
          "href": "https://www.kenkoonwong.com/blog/",
          "text": "comment or visit my other blogs"
        },
        {
          "href": "https://bsky.app/profile/kenkoonwong.bsky.social",
          "text": "BlueSky"
        },
        {
          "href": "https://twitter.com/kenkoonwong/",
          "text": "twitter"
        },
        {
          "href": "https://github.com/kenkoonwong/",
          "text": "GitHub"
        },
        {
          "href": "https://med-mastodon.com/@kenkoonwong",
          "text": "Mastodon"
        },
        {
          "href": "https://www.kenkoonwong.com/contact/",
          "text": "contact me"
        },
        {
          "href": "https://www.kenkoonwong.com/blog/plumber/",
          "text": "r on Everyday Is A School Day"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Getting My Feet Wet With `Plumber` and JavaScript | R-bloggers",
      "images": [
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/www.kenkoonwong.com/blog/plumber/big_pic.png?w=578&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/www.kenkoonwong.com/blog/plumber/swagger.png?w=578&ssl=1"
        },
        {
          "alt": "image",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "image",
          "base64": null,
          "src": "https://i2.wp.com/www.kenkoonwong.com/blog/plumber/api.jpeg?w=50%25&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/www.kenkoonwong.com/blog/plumber/systemctl.png?w=578&ssl=1"
        },
        {
          "alt": "image",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "image",
          "base64": null,
          "src": "https://i2.wp.com/www.kenkoonwong.com/blog/plumber/link.jpeg?w=50%25&ssl=1"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/r-on-everyday-is-a-school-day/",
          "text": "r on Everyday Is A School Day"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-391891 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Getting My Feet Wet With `Plumber` and JavaScript</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">April 13, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/r-on-everyday-is-a-school-day/\">r on Everyday Is A School Day</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://www.kenkoonwong.com/blog/plumber/\"> r on Everyday Is A School Day</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47--><blockquote>\n<p>Tried out plumber and a bit of JavaScript to build a simple local API for logging migraine events üß†üíª. Just a quick tap on my phone now records the time to a CSV‚Äîpretty handy! üì±‚úÖ</p>\n</blockquote>\n<h2 id=\"motivation\">Motivation\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#motivation\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>After our previous blog on \n<a href=\"https://www.kenkoonwong.com/blog/pressure/\" rel=\"nofollow\" target=\"_blank\">barometric pressure monitoring</a>, my friend \n<a href=\"https://alecsalces.com/\" rel=\"nofollow\" target=\"_blank\">Alec Wong</a> said ‚ÄòWon‚Äôt it be great if we can just hit a button and it will record an event?‚Äù.</p>\n<p>In this case the reason for recording barometric pressure is to see if there is a link between migraine event and barometric pressure values/change etc. And yes, it would be great if we can create an app of something sort to make recording much easier!</p>\n<p>There are many ways to do this. The way where we can maximize learning within R environment is to use <code>plumber</code> to create an API for us to interact and record event! Our use case is actually quite straight forward. We just need something that record a current timestamp when a button is clicked. Simple!</p>\n<p>But since I‚Äôve never used <code>plumber</code> before, this is a great opportunity to explore it! And also a bit of JavaScript too. Again, this blog is more for my benefit where it serves as a note for myself. Here we go!</p>\n<h2 id=\"objectives\">Objectives:\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#objectives\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/plumber/#bigpicture\" rel=\"nofollow\" target=\"_blank\">Big Picture</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/plumber/#plumber\" rel=\"nofollow\" target=\"_blank\">plumber.R</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/plumber/#serve\" rel=\"nofollow\" target=\"_blank\">How to run it?</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/plumber/#hack\" rel=\"nofollow\" target=\"_blank\">One Click on iOS</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/plumber/#opportunity\" rel=\"nofollow\" target=\"_blank\">Opportunities for Improvement</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/plumber/#lessons\" rel=\"nofollow\" target=\"_blank\">Lessons Learnt</a></li>\n</ul>\n<h2 id=\"bigpicture\">Big Picture\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#bigpicture\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p><img alt=\"\" data-lazy-src=\"https://i0.wp.com/www.kenkoonwong.com/blog/plumber/big_pic.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.kenkoonwong.com/blog/plumber/big_pic.png?w=578&amp;ssl=1\"/></noscript>\nAs the image above shows, we want an app on our phone that once clicked will somehow change a csv dataframe. All these can be done by <code>plumber</code> setting an API to the <code>csv</code>. Since I just want to be able to do this on a local network of a different device (e.g. raspberrypi), we don‚Äôt need to deploy this to digital ocean or a server per se. We can run it in the background and set <code>systemctl</code> in case rpi restarts, point it to <code>0.0.0.0</code> and we can GET/POST via the device‚Äôs IP.</p>\n<p>Yes, unfortunately this will not work if we‚Äôre no longer on local network, which at least from my utility, it will be just fine. No need to expose port forwarding. The safer way would be to use digital ocean droplet to do this, so you‚Äôre not exposing your own IP and open port to the public. That also means, you may have to pay some üí∞ (e.g. ~$5/month). May someday when it can incorporate the barometric pressure and/or other metrics then</p>\n<h2 id=\"plumber\">plumber.R\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#plumber\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<pre>library(plumber)\nlibrary(readr)\n\nfile &lt;- \"migraine.csv\"\n\nif (file.exists(file)) {\n  df &lt;- read_csv(file)\n} else {\ndf &lt;- tibble(date=as.POSIXct(character()))\n}\n\n#* @apiTitle Migraine logger\n#* @apiDescription A simple API to log migraine events\n\n#* Return HTML content\n#* @get /\n#* @serializer html\nfunction() {\n  \n  # Return HTML code with the log button\n  html_content &lt;- '\n     &lt;!DOCTYPE html&gt;\n     &lt;html&gt;\n     &lt;head&gt;\n       &lt;title&gt;Migraine Logger&lt;/title&gt;\n     &lt;/head&gt;\n     &lt;body&gt;\n       &lt;h1&gt;Migraine Logger&lt;/h1&gt;\n       &lt;button id=\"submit\"&gt;Oh No, Migraine Today!&lt;/button&gt;\n       &lt;div id=\"result\" style=\"display: none;\"&gt;&lt;/div&gt;\n       \n      &lt;script&gt;\n       document.getElementById(\"submit\").onclick = function() {\n          fetch(\"/log\", {\n            method : \"post\"\n          })\n          .then(response =&gt; response.json())\n          .then(data =&gt; {\n            const resultDiv = document.getElementById(\"result\");\n            resultDiv.textContent = data[0];\n            resultDiv.style.display = \"block\";\n          })\n          .catch(error =&gt; {\n            const resultDiv = document.getElementById(\"result\");\n            resultDiv.textContent = error.message\n          })\n       };\n      &lt;/script&gt;\n      \n     &lt;/body&gt;\n     &lt;/html&gt;\n     '\n  return(html_content)\n}\n\n#* logging \n#* @post /log\nfunction(){\n  date_now &lt;- tibble(date=Sys.time())\n  df &lt;&lt;- rbind(df,date_now)\n  write_csv(df, \"migraine.csv\")\n  list(paste0(\"you have logged \", date_now$date[1], \" to migraine.csv\"))\n}\n\n#* download data\n#* @get /download\n#* @serializer csv\nfunction(){\n  df\n}\n</pre><p>Alright, let‚Äôs explore the code one by one. Again, as a note for my benefit.</p>\n<h4 id=\"load-libraries-load-data-metadata\">Load libraries, load data, metadata\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#load-libraries-load-data-metadata\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>library(plumber)\nlibrary(readr)\n\nfile &lt;- \"migraine.csv\"\n\nif (file.exists(file)) {\n  df &lt;- read_csv(file)\n} else {\ndf &lt;- tibble(date=as.POSIXct(character()))\n}\n\n#* @apiTitle Migraine logger\n#* @apiDescription A simple API to log migraine events\n</pre><p>The above is quite self-explainatory. Point to a file, if it exists, read it, if not create an empty dataframe. The title and description of this API is described as such.</p>\n<h4 id=\"lets-write-out-html--javascript\">Let‚Äôs Write Out HTML &amp; Javascript\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#lets-write-out-html--javascript\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>#* Return HTML content\n#* @get /\n#* @serializer html\nfunction() {\n  \n  # Return HTML code with the log button\n  html_content &lt;- '\n     &lt;!DOCTYPE html&gt;\n     &lt;html&gt;\n     &lt;head&gt;\n       &lt;title&gt;Migraine Logger&lt;/title&gt;\n     &lt;/head&gt;\n     &lt;body&gt;\n       &lt;h1&gt;Migraine Logger&lt;/h1&gt;\n       &lt;button id=\"submit\"&gt;Oh No, Migraine Today!&lt;/button&gt;\n       &lt;div id=\"result\" style=\"display: none;\"&gt;&lt;/div&gt;\n       \n      &lt;script&gt;\n       document.getElementById(\"submit\").onclick = function() {\n          fetch(\"/log\", {\n            method : \"post\"\n          })\n          .then(response =&gt; response.json())\n          .then(data =&gt; {\n            const resultDiv = document.getElementById(\"result\");\n            resultDiv.textContent = data[0];\n            resultDiv.style.display = \"block\";\n          })\n          .catch(error =&gt; {\n            const resultDiv = document.getElementById(\"result\");\n            resultDiv.textContent = error.message\n          })\n       };\n      &lt;/script&gt;\n      \n     &lt;/body&gt;\n     &lt;/html&gt;\n     '\n  return(html_content)\n}\n</pre><ol>\n<li>The skeleton #*, first is comment, 2nd is <code>GET /</code> (HTTP method), 3rd is <code>Turn this function into HTML output</code>\n<a href=\"https://www.rplumber.io/articles/rendering-output.html#serializers-1\" rel=\"nofollow\" target=\"_blank\">Serializer</a>. Basically means if we go to <code>http://localhost:8000/</code>, it will return this HTML. Now if we set <code>GET /hello</code>, then html will also show if you go to <code>http://localhost:8000/hello</code></li>\n<li>Next is the HTML (without the Javascript, which is between ). Basically, write a heading, create a button, and a div to return result.</li>\n<li>The Javascript:</li>\n</ol>\n<ul>\n<li><code>document.getElementById(\"submit\").onclick</code>: when the <code>submit</code> button has been clicked, run the function</li>\n<li><code>fetch(\"/log\", { method : \"post\" })</code>: this is the part where it will call the <code>POST /log</code> function (see below) and run it.</li>\n<li><code>.then(response =&gt; response.json())</code>: This is a Promise chain. After the fetch request completes, this takes the response from the server and calls the .json() method on it, which parses the JSON response body into a JavaScript object. This method also returns a Promise that resolves to the parsed JSON data.</li>\n<li><code>.then(data =&gt; { const resultDiv = document.getElementById(\"result\"); resultDiv.textContent = data[0]; resultDiv.style.display = \"block\";})</code>: This is the next step in the Promise chain. Once the JSON is parsed, It finds the HTML element with the ID ‚Äúresult‚Äù. Sets its text content to be the first item in the data array (data[0]). Makes the element visible by setting its CSS display property to ‚Äúblock‚Äù</li>\n<li><code>.catch(error =&gt; { const resultDiv = document.getElementById(\"result\"); resultDiv.textContent = error.message })};</code>This catches any errors that might occur during the fetch operation or when processing the response. If an error happens, it finds the HTML element with ID ‚Äúresult‚Äù. Sets its text content to the error message.</li>\n</ul>\n<p>The interesting thing I‚Äôve not come across is the arrow function. <code>response =&gt; response.json()</code> means <code>function(response) { return response.json() }</code>.</p>\n<h4 id=\"more-plumber-api-functions\">More Plumber API functions:\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#more-plumber-api-functions\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>#* logging \n#* @post /log\nfunction(){\n  date_now &lt;- tibble(date=Sys.time())\n  df &lt;&lt;- rbind(df,date_now)\n  write_csv(df, \"migraine.csv\")\n  list(paste0(\"you have logged \", date_now$date[1], \" to migraine.csv\"))\n}\n\n#* download data\n#* @get /download\n#* @serializer csv\nfunction(){\n  df\n}\n</pre><ol>\n<li>\n<p>The <code>POST /log</code> function is where the magic happens. When the button is clicked, it will run this function. It will create a new row with the current timestamp and append it to the dataframe. Then write it out to <code>migraine.csv</code>. The <code>&lt;&lt;-</code> operator is used to assign a value to a variable in the parent environment (in this case, the global environment). This allows us to modify the <code>df</code> variable defined outside of the function.  The <code>list(paste0(\"you have logged \", date_now$date[1], \" to migraine.csv\"))</code> will return a message to the user that the event has been logged. This is what will be displayed in the div with ID ‚Äúresult‚Äù in the HTML.</p>\n</li>\n<li>\n<p>The <code>GET /download</code> function is to download the data. It will return the dataframe as a CSV file when you go to <code>http://localhost:8000/download</code>. The <code>@serializer csv</code> line tells plumber to serialize the output as a CSV file.</p>\n</li>\n</ol>\n<h4 id=\"ok-lets-check-it-out-click-that-run-api-button-for-a-test-run\">OK, Let‚Äôs Check It Out! Click that <code>Run API</code> button for A Test Run!\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#ok-lets-check-it-out-click-that-run-api-button-for-a-test-run\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<p><img alt=\"\" data-lazy-src=\"https://i0.wp.com/www.kenkoonwong.com/blog/plumber/swagger.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.kenkoonwong.com/blog/plumber/swagger.png?w=578&amp;ssl=1\"/></noscript>\nWe should see something like this. You can test it via Swagger UI or you can go to the address without <code>__doc__</code> to get to the html directly.</p>\n<p>Hurray! It works, locally‚Ä¶ now let‚Äôs see if it works if it‚Äôs on a different device.</p>\n<h2 id=\"serve\">How To Run It?\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#serve\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ol>\n<li>Transfer <code>plumber.R</code> or whatever file you saved to, to your device of choice.</li>\n<li>Install packages, of course</li>\n<li>Then run the following code</li>\n</ol>\n<pre>Rscript -e \"pr &lt;- plumber::plumb('plumber.R'); pr |&gt; pr_run(port=8000,host='0.0.0.0')\"\n</pre><p>What it does it it‚Äôll run the plumber API. And use a different device in the same network, then go to <code>http://your-local-device-ip:8000/</code> and you should see something like the following</p>\n<p align=\"center\">\n<img alt=\"image\" data-lazy-src=\"https://i2.wp.com/www.kenkoonwong.com/blog/plumber/api.jpeg?w=50%25&amp;ssl=1\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"image\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://i2.wp.com/www.kenkoonwong.com/blog/plumber/api.jpeg?w=50%25&amp;ssl=1\"/></noscript>\n</p>\n<p>Hurray! It works! Now, let‚Äôs make sure we run it in the background and if rpi restarts, it will re-run the script by using <code>systemctl</code>. All of the code below are to be run in <code>bash</code></p>\n<pre>sudo nano /etc/systemd/system/migraine-logger.service\n</pre>\n<h4 id=\"paste-this-in-the-migraine-loggerservice\">Paste this in the migraine-logger.service\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#paste-this-in-the-migraine-loggerservice\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>[Unit]\nDescription=Migraine Logger Plumber API\nAfter=network.target\n\n[Service]\nType=simple\nUser=pi\nWorkingDirectory=/path/to/your/app\nExecStart=/usr/bin/Rscript -e \"pr &lt;- plumber::plumb('plumber.R'); pr |&gt; pr_run(port=8000, host='0.0.0.0')\"\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\n</pre><ul>\n<li>Change <code>/path/to/your/app</code> to the directory where your <code>plumber.R</code> file is located.</li>\n</ul>\n<h4 id=\"enable-start-check-status\">Enable, Start, Check Status\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#enable-start-check-status\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>sudo systemctl enable migraine-logger.service\nsudo systemctl start migraine-logger.service\nsudo systemctl status migraine-logger.service\n</pre><p><img alt=\"\" data-lazy-src=\"https://i0.wp.com/www.kenkoonwong.com/blog/plumber/systemctl.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.kenkoonwong.com/blog/plumber/systemctl.png?w=578&amp;ssl=1\"/></noscript>\nHurray !!!</p>\n<h2 id=\"hack\">One Click On iOS?\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#hack\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>Use your browser on iOS to go to your device‚Äôs IP and port e.g. <code>http://192.168.1.11:8000</code> , then click on share and create shortcut homescreen, like so</p>\n<p align=\"center\">\n<img alt=\"image\" data-lazy-src=\"https://i2.wp.com/www.kenkoonwong.com/blog/plumber/link.jpeg?w=50%25&amp;ssl=1\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"image\" data-recalc-dims=\"1\" height=\"auto\" loading=\"lazy\" src=\"https://i2.wp.com/www.kenkoonwong.com/blog/plumber/link.jpeg?w=50%25&amp;ssl=1\"/></noscript>\n</p>\n<p>Then you can have a shortcut on your iOS device that will open the app and click the button for you!</p>\n<h2 id=\"opportunity\">Opportunities For Improvement\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#opportunity\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>This only works if you‚Äôre on the local network, could potentially expand this to digital ocean droplet, especially if we add more features (e.g., post old log if we had forgotten to record one, show 10 latest data, show barometric data etc.)</li>\n<li>need to learn more node.js/javascript, really enjoyed using Positron and <code>Code Runner</code> to be able to quickly call <code>node</code> and run the entire script on console</li>\n<li>need to learn more about <code>plumber</code>, e.g. how to deploy it to digital ocean</li>\n<li>a python part we could translate to is FastAPI, need to learn that as well, but implementation &amp; code structure should be quite similar</li>\n</ul>\n<h2 id=\"lessons\">Lessons Learnt\n  <a href=\"https://www.kenkoonwong.com/blog/plumber/#lessons\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>Learnt some simple GET/POST plumber API</li>\n<li>Learnt some simple JavaScript, found this has major potential for future projects.</li>\n<li>Learnt <code>systemctl</code></li>\n</ul>\n<p>If you like this article:</p>\n<ul>\n<li>please feel free to send me a \n<a href=\"https://www.kenkoonwong.com/blog/\" rel=\"nofollow\" target=\"_blank\">comment or visit my other blogs</a></li>\n<li>please feel free to follow me on \n<a href=\"https://bsky.app/profile/kenkoonwong.bsky.social\" rel=\"nofollow\" target=\"_blank\">BlueSky</a>, \n<a href=\"https://twitter.com/kenkoonwong/\" rel=\"nofollow\" target=\"_blank\">twitter</a>, \n<a href=\"https://github.com/kenkoonwong/\" rel=\"nofollow\" target=\"_blank\">GitHub</a> or \n<a href=\"https://med-mastodon.com/@kenkoonwong\" rel=\"nofollow\" target=\"_blank\">Mastodon</a></li>\n<li>if you would like collaborate please feel free to \n<a href=\"https://www.kenkoonwong.com/contact/\" rel=\"nofollow\" target=\"_blank\">contact me</a></li>\n</ul>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://www.kenkoonwong.com/blog/plumber/\"> r on Everyday Is A School Day</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
      "main_text": "Getting My Feet Wet With `Plumber` and JavaScript\nPosted on\nApril 13, 2025\nby\nr on Everyday Is A School Day\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nr on Everyday Is A School Day\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nTried out plumber and a bit of JavaScript to build a simple local API for logging migraine events üß†üíª. Just a quick tap on my phone now records the time to a CSV‚Äîpretty handy! üì±‚úÖ\nMotivation\nAfter our previous blog on\nbarometric pressure monitoring\n, my friend\nAlec Wong\nsaid ‚ÄòWon‚Äôt it be great if we can just hit a button and it will record an event?‚Äù.\nIn this case the reason for recording barometric pressure is to see if there is a link between migraine event and barometric pressure values/change etc. And yes, it would be great if we can create an app of something sort to make recording much easier!\nThere are many ways to do this. The way where we can maximize learning within R environment is to use\nplumber\nto create an API for us to interact and record event! Our use case is actually quite straight forward. We just need something that record a current timestamp when a button is clicked. Simple!\nBut since I‚Äôve never used\nplumber\nbefore, this is a great opportunity to explore it! And also a bit of JavaScript too. Again, this blog is more for my benefit where it serves as a note for myself. Here we go!\nObjectives:\nBig Picture\nplumber.R\nHow to run it?\nOne Click on iOS\nOpportunities for Improvement\nLessons Learnt\nBig Picture\nAs the image above shows, we want an app on our phone that once clicked will somehow change a csv dataframe. All these can be done by\nplumber\nsetting an API to the\ncsv\n. Since I just want to be able to do this on a local network of a different device (e.g. raspberrypi), we don‚Äôt need to deploy this to digital ocean or a server per se. We can run it in the background and set\nsystemctl\nin case rpi restarts, point it to\n0.0.0.0\nand we can GET/POST via the device‚Äôs IP.\nYes, unfortunately this will not work if we‚Äôre no longer on local network, which at least from my utility, it will be just fine. No need to expose port forwarding. The safer way would be to use digital ocean droplet to do this, so you‚Äôre not exposing your own IP and open port to the public. That also means, you may have to pay some üí∞ (e.g. ~$5/month). May someday when it can incorporate the barometric pressure and/or other metrics then\nplumber.R\nlibrary(plumber)\nlibrary(readr)\n\nfile <- \"migraine.csv\"\n\nif (file.exists(file)) {\n  df <- read_csv(file)\n} else {\ndf <- tibble(date=as.POSIXct(character()))\n}\n\n#* @apiTitle Migraine logger\n#* @apiDescription A simple API to log migraine events\n\n#* Return HTML content\n#* @get /\n#* @serializer html\nfunction() {\n  \n  # Return HTML code with the log button\n  html_content <- '\n     <!DOCTYPE html>\n     <html>\n     <head>\n       <title>Migraine Logger</title>\n     </head>\n     <body>\n       <h1>Migraine Logger</h1>\n       <button id=\"submit\">Oh No, Migraine Today!</button>\n       <div id=\"result\" style=\"display: none;\"></div>\n       \n      <script>\n       document.getElementById(\"submit\").onclick = function() {\n          fetch(\"/log\", {\n            method : \"post\"\n          })\n          .then(response => response.json())\n          .then(data => {\n            const resultDiv = document.getElementById(\"result\");\n            resultDiv.textContent = data[0];\n            resultDiv.style.display = \"block\";\n          })\n          .catch(error => {\n            const resultDiv = document.getElementById(\"result\");\n            resultDiv.textContent = error.message\n          })\n       };\n      </script>\n      \n     </body>\n     </html>\n     '\n  return(html_content)\n}\n\n#* logging \n#* @post /log\nfunction(){\n  date_now <- tibble(date=Sys.time())\n  df <<- rbind(df,date_now)\n  write_csv(df, \"migraine.csv\")\n  list(paste0(\"you have logged \", date_now$date[1], \" to migraine.csv\"))\n}\n\n#* download data\n#* @get /download\n#* @serializer csv\nfunction(){\n  df\n}\nAlright, let‚Äôs explore the code one by one. Again, as a note for my benefit.\nLoad libraries, load data, metadata\nlibrary(plumber)\nlibrary(readr)\n\nfile <- \"migraine.csv\"\n\nif (file.exists(file)) {\n  df <- read_csv(file)\n} else {\ndf <- tibble(date=as.POSIXct(character()))\n}\n\n#* @apiTitle Migraine logger\n#* @apiDescription A simple API to log migraine events\nThe above is quite self-explainatory. Point to a file, if it exists, read it, if not create an empty dataframe. The title and description of this API is described as such.\nLet‚Äôs Write Out HTML & Javascript\n#* Return HTML content\n#* @get /\n#* @serializer html\nfunction() {\n  \n  # Return HTML code with the log button\n  html_content <- '\n     <!DOCTYPE html>\n     <html>\n     <head>\n       <title>Migraine Logger</title>\n     </head>\n     <body>\n       <h1>Migraine Logger</h1>\n       <button id=\"submit\">Oh No, Migraine Today!</button>\n       <div id=\"result\" style=\"display: none;\"></div>\n       \n      <script>\n       document.getElementById(\"submit\").onclick = function() {\n          fetch(\"/log\", {\n            method : \"post\"\n          })\n          .then(response => response.json())\n          .then(data => {\n            const resultDiv = document.getElementById(\"result\");\n            resultDiv.textContent = data[0];\n            resultDiv.style.display = \"block\";\n          })\n          .catch(error => {\n            const resultDiv = document.getElementById(\"result\");\n            resultDiv.textContent = error.message\n          })\n       };\n      </script>\n      \n     </body>\n     </html>\n     '\n  return(html_content)\n}\nThe skeleton #*, first is comment, 2nd is\nGET /\n(HTTP method), 3rd is\nTurn this function into HTML output\nSerializer\n. Basically means if we go to\nhttp://localhost:8000/\n, it will return this HTML. Now if we set\nGET /hello\n, then html will also show if you go to\nhttp://localhost:8000/hello\nNext is the HTML (without the Javascript, which is between\n). Basically, write a heading, create a button, and a div to return result.\nThe Javascript:\ndocument.getElementById(\"submit\").onclick\n: when the\nsubmit\nbutton has been clicked, run the function\nfetch(\"/log\", { method : \"post\" })\n: this is the part where it will call the\nPOST /log\nfunction (see below) and run it.\n.then(response => response.json())\n: This is a Promise chain. After the fetch request completes, this takes the response from the server and calls the .json() method on it, which parses the JSON response body into a JavaScript object. This method also returns a Promise that resolves to the parsed JSON data.\n.then(data => { const resultDiv = document.getElementById(\"result\"); resultDiv.textContent = data[0]; resultDiv.style.display = \"block\";})\n: This is the next step in the Promise chain. Once the JSON is parsed, It finds the HTML element with the ID ‚Äúresult‚Äù. Sets its text content to be the first item in the data array (data[0]). Makes the element visible by setting its CSS display property to ‚Äúblock‚Äù\n.catch(error => { const resultDiv = document.getElementById(\"result\"); resultDiv.textContent = error.message })};\nThis catches any errors that might occur during the fetch operation or when processing the response. If an error happens, it finds the HTML element with ID ‚Äúresult‚Äù. Sets its text content to the error message.\nThe interesting thing I‚Äôve not come across is the arrow function.\nresponse => response.json()\nmeans\nfunction(response) { return response.json() }\n.\nMore Plumber API functions:\n#* logging \n#* @post /log\nfunction(){\n  date_now <- tibble(date=Sys.time())\n  df <<- rbind(df,date_now)\n  write_csv(df, \"migraine.csv\")\n  list(paste0(\"you have logged \", date_now$date[1], \" to migraine.csv\"))\n}\n\n#* download data\n#* @get /download\n#* @serializer csv\nfunction(){\n  df\n}\nThe\nPOST /log\nfunction is where the magic happens. When the button is clicked, it will run this function. It will create a new row with the current timestamp and append it to the dataframe. Then write it out to\nmigraine.csv\n. The\n<<-\noperator is used to assign a value to a variable in the parent environment (in this case, the global environment). This allows us to modify the\ndf\nvariable defined outside of the function.  The\nlist(paste0(\"you have logged \", date_now$date[1], \" to migraine.csv\"))\nwill return a message to the user that the event has been logged. This is what will be displayed in the div with ID ‚Äúresult‚Äù in the HTML.\nThe\nGET /download\nfunction is to download the data. It will return the dataframe as a CSV file when you go to\nhttp://localhost:8000/download\n. The\n@serializer csv\nline tells plumber to serialize the output as a CSV file.\nOK, Let‚Äôs Check It Out! Click that\nRun API\nbutton for A Test Run!\nWe should see something like this. You can test it via Swagger UI or you can go to the address without\n__doc__\nto get to the html directly.\nHurray! It works, locally‚Ä¶ now let‚Äôs see if it works if it‚Äôs on a different device.\nHow To Run It?\nTransfer\nplumber.R\nor whatever file you saved to, to your device of choice.\nInstall packages, of course\nThen run the following code\nRscript -e \"pr <- plumber::plumb('plumber.R'); pr |> pr_run(port=8000,host='0.0.0.0')\"\nWhat it does it it‚Äôll run the plumber API. And use a different device in the same network, then go to\nhttp://your-local-device-ip:8000/\nand you should see something like the following\nHurray! It works! Now, let‚Äôs make sure we run it in the background and if rpi restarts, it will re-run the script by using\nsystemctl\n. All of the code below are to be run in\nbash\nsudo nano /etc/systemd/system/migraine-logger.service\nPaste this in the migraine-logger.service\n[Unit]\nDescription=Migraine Logger Plumber API\nAfter=network.target\n\n[Service]\nType=simple\nUser=pi\nWorkingDirectory=/path/to/your/app\nExecStart=/usr/bin/Rscript -e \"pr <- plumber::plumb('plumber.R'); pr |> pr_run(port=8000, host='0.0.0.0')\"\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\nChange\n/path/to/your/app\nto the directory where your\nplumber.R\nfile is located.\nEnable, Start, Check Status\nsudo systemctl enable migraine-logger.service\nsudo systemctl start migraine-logger.service\nsudo systemctl status migraine-logger.service\nHurray !!!\nOne Click On iOS?\nUse your browser on iOS to go to your device‚Äôs IP and port e.g.\nhttp://192.168.1.11:8000\n, then click on share and create shortcut homescreen, like so\nThen you can have a shortcut on your iOS device that will open the app and click the button for you!\nOpportunities For Improvement\nThis only works if you‚Äôre on the local network, could potentially expand this to digital ocean droplet, especially if we add more features (e.g., post old log if we had forgotten to record one, show 10 latest data, show barometric data etc.)\nneed to learn more node.js/javascript, really enjoyed using Positron and\nCode Runner\nto be able to quickly call\nnode\nand run the entire script on console\nneed to learn more about\nplumber\n, e.g. how to deploy it to digital ocean\na python part we could translate to is FastAPI, need to learn that as well, but implementation & code structure should be quite similar\nLessons Learnt\nLearnt some simple GET/POST plumber API\nLearnt some simple JavaScript, found this has major potential for future projects.\nLearnt\nsystemctl\nIf you like this article:\nplease feel free to send me a\ncomment or visit my other blogs\nplease feel free to follow me on\nBlueSky\n,\ntwitter\n,\nGitHub\nor\nMastodon\nif you would like collaborate please feel free to\ncontact me\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nr on Everyday Is A School Day\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "Tried out plumber and a bit of JavaScript to build a simple local API for logging migraine events üß†üíª. Just a quick tap on my phone now records the time to a CSV‚Äîpretty handy! üì±‚úÖ Motivation After our previous blog on barometric pressure monitoring, my friend Alec Wong said ‚ÄòWon‚Äôt it be great if we can just hit a button and it will record an event?\". In this case the reason for recording barometric pressure is to see if there is a link between migraine event and barometric pressure values/change etc. And yes, it would be great if we can create an app of something sort to make recording much easier! There are many ways to do this. The way where we can maximize learning within R environment is to use plumber to create an API for us to interact and record event! Our use case is actually quite straight forward. We just need something that record a current timestamp when a button is clicked. Simple! But since I‚Äôve never used plumber before, this is a great opportunity to explore it! And also a bit of JavaScript too. Again, this blog is more for my benefit where it serves as a note for myself. Here we go! Objectives: Big Picture plumber.R How to run it? One Click on iOS Opportunities for Improvement Lessons Learnt Big Picture As the image above shows, we want an app on our phone that once clicked will somehow change a csv dataframe. All these can be done by plumber setting an API to the csv. Since I just want to be able to do this on a local network of a different device (e.g. raspberrypi), we don‚Äôt need to deploy this to digital ocean or a server per se. We can run it in the background and set systemctl in case rpi restarts, point it to 0.0.0.0 and we can GET/POST via the device‚Äôs IP. Yes, unfortunately this will not work if we‚Äôre no longer on local network, which at least from my utility, it will be just fine. No need to expose port forwarding. The safer way would be to use digital ocean droplet to do this, so you‚Äôre not exposing your own IP and open port to the public. That also means, you may have to pay some üí∞ (e.g. ~$5/month). May someday when it can incorporate the barometric pressure and/or other metrics then plumber.R library(plumber) library(readr) file response.json()): This is a Promise chain. After the fetch request completes, this takes the response from the server and calls the .json() method on it, which parses the JSON response body into a JavaScript object. This method also returns a Promise that resolves to the parsed JSON data. .then(data => { const resultDiv = document.getElementById(\"result\"); resultDiv.textContent = data[0]; resultDiv.style.display = \"block\";}): This is the next step in the Promise chain. Once the JSON is parsed, It finds the HTML element with the ID ‚Äúresult‚Äù. Sets its text content to be the first item in the data array (data[0]). Makes the element visible by setting its CSS display property to ‚Äúblock‚Äù .catch(error => { const resultDiv = document.getElementById(\"result\"); resultDiv.textContent = error.message })};This catches any errors that might occur during the fetch operation or when processing the response. If an error happens, it finds the HTML element with ID ‚Äúresult‚Äù. Sets its text content to the error message. The interesting thing I‚Äôve not come across is the arrow function. response => response.json() means function(response) { return response.json() }. More Plumber API functions: #* logging #* @post /log function(){ date_now",
      "meta_keywords": null,
      "og_description": "Tried out plumber and a bit of JavaScript to build a simple local API for logging migraine events üß†üíª. Just a quick tap on my phone now records the time to a CSV‚Äîpretty handy! üì±‚úÖ Motivation After our previous blog on barometric pressure monitoring, my friend Alec Wong said ‚ÄòWon‚Äôt it be great if we can just hit a button and it will record an event?\". In this case the reason for recording barometric pressure is to see if there is a link between migraine event and barometric pressure values/change etc. And yes, it would be great if we can create an app of something sort to make recording much easier! There are many ways to do this. The way where we can maximize learning within R environment is to use plumber to create an API for us to interact and record event! Our use case is actually quite straight forward. We just need something that record a current timestamp when a button is clicked. Simple! But since I‚Äôve never used plumber before, this is a great opportunity to explore it! And also a bit of JavaScript too. Again, this blog is more for my benefit where it serves as a note for myself. Here we go! Objectives: Big Picture plumber.R How to run it? One Click on iOS Opportunities for Improvement Lessons Learnt Big Picture As the image above shows, we want an app on our phone that once clicked will somehow change a csv dataframe. All these can be done by plumber setting an API to the csv. Since I just want to be able to do this on a local network of a different device (e.g. raspberrypi), we don‚Äôt need to deploy this to digital ocean or a server per se. We can run it in the background and set systemctl in case rpi restarts, point it to 0.0.0.0 and we can GET/POST via the device‚Äôs IP. Yes, unfortunately this will not work if we‚Äôre no longer on local network, which at least from my utility, it will be just fine. No need to expose port forwarding. The safer way would be to use digital ocean droplet to do this, so you‚Äôre not exposing your own IP and open port to the public. That also means, you may have to pay some üí∞ (e.g. ~$5/month). May someday when it can incorporate the barometric pressure and/or other metrics then plumber.R library(plumber) library(readr) file response.json()): This is a Promise chain. After the fetch request completes, this takes the response from the server and calls the .json() method on it, which parses the JSON response body into a JavaScript object. This method also returns a Promise that resolves to the parsed JSON data. .then(data => { const resultDiv = document.getElementById(\"result\"); resultDiv.textContent = data[0]; resultDiv.style.display = \"block\";}): This is the next step in the Promise chain. Once the JSON is parsed, It finds the HTML element with the ID ‚Äúresult‚Äù. Sets its text content to be the first item in the data array (data[0]). Makes the element visible by setting its CSS display property to ‚Äúblock‚Äù .catch(error => { const resultDiv = document.getElementById(\"result\"); resultDiv.textContent = error.message })};This catches any errors that might occur during the fetch operation or when processing the response. If an error happens, it finds the HTML element with ID ‚Äúresult‚Äù. Sets its text content to the error message. The interesting thing I‚Äôve not come across is the arrow function. response => response.json() means function(response) { return response.json() }. More Plumber API functions: #* logging #* @post /log function(){ date_now",
      "og_image": "https://www.kenkoonwong.com/blog/plumber/big_pic.png",
      "og_title": "Getting My Feet Wet With `Plumber` and JavaScript | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 9.6,
      "sitemap_lastmod": null,
      "twitter_description": "Tried out plumber and a bit of JavaScript to build a simple local API for logging migraine events üß†üíª. Just a quick tap on my phone now records the time to a CSV‚Äîpretty handy! üì±‚úÖ Motivation After our previous blog on barometric pressure monitoring, my friend Alec Wong said ‚ÄòWon‚Äôt it be great if we can just hit a button and it will record an event?\". In this case the reason for recording barometric pressure is to see if there is a link between migraine event and barometric pressure values/change etc. And yes, it would be great if we can create an app of something sort to make recording much easier! There are many ways to do this. The way where we can maximize learning within R environment is to use plumber to create an API for us to interact and record event! Our use case is actually quite straight forward. We just need something that record a current timestamp when a button is clicked. Simple! But since I‚Äôve never used plumber before, this is a great opportunity to explore it! And also a bit of JavaScript too. Again, this blog is more for my benefit where it serves as a note for myself. Here we go! Objectives: Big Picture plumber.R How to run it? One Click on iOS Opportunities for Improvement Lessons Learnt Big Picture As the image above shows, we want an app on our phone that once clicked will somehow change a csv dataframe. All these can be done by plumber setting an API to the csv. Since I just want to be able to do this on a local network of a different device (e.g. raspberrypi), we don‚Äôt need to deploy this to digital ocean or a server per se. We can run it in the background and set systemctl in case rpi restarts, point it to 0.0.0.0 and we can GET/POST via the device‚Äôs IP. Yes, unfortunately this will not work if we‚Äôre no longer on local network, which at least from my utility, it will be just fine. No need to expose port forwarding. The safer way would be to use digital ocean droplet to do this, so you‚Äôre not exposing your own IP and open port to the public. That also means, you may have to pay some üí∞ (e.g. ~$5/month). May someday when it can incorporate the barometric pressure and/or other metrics then plumber.R library(plumber) library(readr) file response.json()): This is a Promise chain. After the fetch request completes, this takes the response from the server and calls the .json() method on it, which parses the JSON response body into a JavaScript object. This method also returns a Promise that resolves to the parsed JSON data. .then(data => { const resultDiv = document.getElementById(\"result\"); resultDiv.textContent = data[0]; resultDiv.style.display = \"block\";}): This is the next step in the Promise chain. Once the JSON is parsed, It finds the HTML element with the ID ‚Äúresult‚Äù. Sets its text content to be the first item in the data array (data[0]). Makes the element visible by setting its CSS display property to ‚Äúblock‚Äù .catch(error => { const resultDiv = document.getElementById(\"result\"); resultDiv.textContent = error.message })};This catches any errors that might occur during the fetch operation or when processing the response. If an error happens, it finds the HTML element with ID ‚Äúresult‚Äù. Sets its text content to the error message. The interesting thing I‚Äôve not come across is the arrow function. response => response.json() means function(response) { return response.json() }. More Plumber API functions: #* logging #* @post /log function(){ date_now",
      "twitter_title": "Getting My Feet Wet With `Plumber` and JavaScript | R-bloggers",
      "url": "https://www.r-bloggers.com/2025/04/getting-my-feet-wet-with-plumber-and-javascript/",
      "word_count": 1916
    }
  }
}