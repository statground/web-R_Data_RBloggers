{
  "uuid": "3492a6bf-641d-489a-bd83-f0b4f49d983b",
  "created_at": "2025-11-17 20:38:47",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2023/12/non-equi-joins-in-data-table-2/",
    "crawled_at": "2025-11-17T09:26:44.019819",
    "external_links": [
      {
        "href": "https://johnmackintosh.net/blog/2023-12-22-non-equi-joins/",
        "text": "Data By John"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://adventofcode.com/",
        "text": "advent of code"
      },
      {
        "href": "https://johnmackintosh.net/blog/2023-12-22-non-equi-joins/",
        "text": "Data By John"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "non-equi joins in data.table | R-bloggers",
    "images": [],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/john-mackintosh/",
        "text": "John MacKintosh"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-381073 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">non-equi joins in data.table</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">December 21, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/john-mackintosh/\">John MacKintosh</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://johnmackintosh.net/blog/2023-12-22-non-equi-joins/\"> Data By John</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9--><p>I have been toying with some of the <a href=\"https://adventofcode.com/\" rel=\"nofollow\" target=\"_blank\">advent of code</a> challenges (I am way behind though!).</p>\n<p>For day 5,  I had to create a function, and I’m writing this up, because it’s an example of a non-equi join between two tables.<br/>\nIn this particular sitation, there are are no common columns between the two tables, so my usual <code>data.table</code> hack of copying the columns of interest, renaming them<code>join_col</code>, and then keying them both does not work.</p>\n<p>Here’s the function:</p>\n<pre>find_matches &lt;- function(input_dt, lookup_dt) {\n res &lt;-  lookup_dt[input_dt,\n            .(V1 = i.V1,\n              dest_start = x.dest_start,\n              source_start = x.source_start,\n              source_end = x.source_end),\n            on = .(source_start &lt;= V1,\n                   source_end &gt;= V1)\n  ][, dest := fcase(is.na(source_start), V1,\n                    !is.na(source_start),V1 - source_start + dest_start)\n  ][,.(V1 = dest)]\n return(res)\n\n}\n\n</pre>\n<p>I want to join the main table, <code>input_dt</code> with the <code>lookup_dt</code>. \nBecause data.table uses right joins, and removes the joining column from the main table (unless you tell it otherwise), I am being very specific.</p>\n<p>This bit is where I specify the column names I want to return, and which table they come from.</p>\n<p><code>i.col_name</code> is the main / large/ right hand side table</p>\n<p><code>x.col_name</code> is the smaller/ left hand side table</p>\n<p>Here I’m saying to keep <code>V1</code> from the main table, and <code>dest_start</code>, <code>source_start</code> and <code>source_end</code>   from the smaller table:</p>\n<pre>            .(V1 = i.V1,\n              dest_start = x.dest_start,\n              source_start = x.source_start,\n              source_end = x.source_end),\n           \n</pre>\n<p>Here is the non-equi join bit.</p>\n<pre>on = .(source_start &lt;= V1,\n                   source_end &gt;= V1)\n</pre>\n<p>The tables should join when V1 is between the source start and source end.</p>\n<p>There will be rows where these conditions are not met, these will return <code>NA</code>.\nThis section of code deals with those – any NA’s are replaced with the original value and no further calculation is required.</p>\n<pre>[, dest := fcase(is.na(source_start), V1,\n                    !is.na(source_start),V1 - source_start + dest_start)\n  ]\n</pre>\n<p>The rest of the code returns the vector of interest.</p>\n<p>The main takeway from this is to understand:</p>\n<ul>\n<li>data.table uses right joins by default</li>\n<li>the join column in the main table will be removed from the resulting joined table, unless you tell it otherwise</li>\n<li>Use <code>i.col_name</code> to specify columns from the main table</li>\n<li>Use <code>x.col_name</code> to specify columns from the smaller / lookup table</li>\n<li>you can use conditions in your <code>on</code> syntax to create equi or non equi joins</li>\n</ul>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://johnmackintosh.net/blog/2023-12-22-non-equi-joins/\"> Data By John</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
    "main_text": "non-equi joins in data.table\nPosted on\nDecember 21, 2023\nby\nJohn MacKintosh\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nData By John\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nI have been toying with some of the\nadvent of code\nchallenges (I am way behind though!).\nFor day 5,  I had to create a function, and I’m writing this up, because it’s an example of a non-equi join between two tables.\nIn this particular sitation, there are are no common columns between the two tables, so my usual\ndata.table\nhack of copying the columns of interest, renaming them\njoin_col\n, and then keying them both does not work.\nHere’s the function:\nfind_matches <- function(input_dt, lookup_dt) {\n res <-  lookup_dt[input_dt,\n            .(V1 = i.V1,\n              dest_start = x.dest_start,\n              source_start = x.source_start,\n              source_end = x.source_end),\n            on = .(source_start <= V1,\n                   source_end >= V1)\n  ][, dest := fcase(is.na(source_start), V1,\n                    !is.na(source_start),V1 - source_start + dest_start)\n  ][,.(V1 = dest)]\n return(res)\n\n}\nI want to join the main table,\ninput_dt\nwith the\nlookup_dt\n. \nBecause data.table uses right joins, and removes the joining column from the main table (unless you tell it otherwise), I am being very specific.\nThis bit is where I specify the column names I want to return, and which table they come from.\ni.col_name\nis the main / large/ right hand side table\nx.col_name\nis the smaller/ left hand side table\nHere I’m saying to keep\nV1\nfrom the main table, and\ndest_start\n,\nsource_start\nand\nsource_end\nfrom the smaller table:\n.(V1 = i.V1,\n              dest_start = x.dest_start,\n              source_start = x.source_start,\n              source_end = x.source_end),\nHere is the non-equi join bit.\non = .(source_start <= V1,\n                   source_end >= V1)\nThe tables should join when V1 is between the source start and source end.\nThere will be rows where these conditions are not met, these will return\nNA\n.\nThis section of code deals with those – any NA’s are replaced with the original value and no further calculation is required.\n[, dest := fcase(is.na(source_start), V1,\n                    !is.na(source_start),V1 - source_start + dest_start)\n  ]\nThe rest of the code returns the vector of interest.\nThe main takeway from this is to understand:\ndata.table uses right joins by default\nthe join column in the main table will be removed from the resulting joined table, unless you tell it otherwise\nUse\ni.col_name\nto specify columns from the main table\nUse\nx.col_name\nto specify columns from the smaller / lookup table\nyou can use conditions in your\non\nsyntax to create equi or non equi joins\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nData By John\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "A quick note to understand (non-equi) joins in data.table",
    "meta_keywords": null,
    "og_description": "A quick note to understand (non-equi) joins in data.table",
    "og_image": "https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png",
    "og_title": "non-equi joins in data.table | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 2.6,
    "sitemap_lastmod": "2023-12-22T20:11:04+00:00",
    "twitter_description": "A quick note to understand (non-equi) joins in data.table",
    "twitter_title": "non-equi joins in data.table | R-bloggers",
    "url": "https://www.r-bloggers.com/2023/12/non-equi-joins-in-data-table-2/",
    "word_count": 529
  }
}