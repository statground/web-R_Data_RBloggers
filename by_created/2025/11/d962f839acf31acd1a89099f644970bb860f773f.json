{
  "id": "d962f839acf31acd1a89099f644970bb860f773f",
  "url": "https://www.r-bloggers.com/2023/12/fastai-in-r-how-to-train-deep-learning-models-with-fastai/",
  "created_at_utc": "2025-11-17T20:38:55Z",
  "data": null,
  "raw_original": {
    "uuid": "bd6e0032-e7a5-4847-b05a-8cea07b32f43",
    "created_at": "2025-11-17 20:38:55",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2023/12/fastai-in-r-how-to-train-deep-learning-models-with-fastai/",
      "crawled_at": "2025-11-17T09:37:16.572415",
      "external_links": [
        {
          "href": "https://appsilon.com/fastai-in-r/",
          "text": "Tag: r - Appsilon | Enterprise R Shiny Dashboards"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://github.com/fastai/fastai",
          "text": "FastAI"
        },
        {
          "href": "https://pypi.org/project/fastai/",
          "text": "Python"
        },
        {
          "href": "https://github.com/EagerAI/fastai",
          "text": "R"
        },
        {
          "href": "https://github.com/Appsilon/fastai-in-r/",
          "text": "This repository"
        },
        {
          "href": "https://appsilon.com/fast-ai-in-r/",
          "text": "Fast AI in R blogpost"
        },
        {
          "href": "https://appsilon.com/transfer-learning-introduction/",
          "text": "Look no further than Transfer Learning"
        },
        {
          "href": "https://appsilon.com/fastai-in-r/#what-is-fastai",
          "text": "What is FastAI and Why Should You Care?"
        },
        {
          "href": "https://appsilon.com/fastai-in-r/#install",
          "text": "FastAI in R – How to Install FastAI"
        },
        {
          "href": "https://appsilon.com/fastai-in-r/#model",
          "text": "How to Train an Image Classification Model with FastAI in R"
        },
        {
          "href": "https://appsilon.com/fastai-in-r/#summary",
          "text": "Summing up FastAI in R"
        },
        {
          "href": "https://www.fast.ai/",
          "text": "FastAI homepage with recent blog posts"
        },
        {
          "href": "https://course.fast.ai/",
          "text": "Practical Deep Learning for Coders course"
        },
        {
          "href": "https://www.amazon.com/Deep-Learning-Coders-fastai-PyTorch/dp/1492045527",
          "text": "Deep Learning for Coders with FastAI and PyTorch book"
        },
        {
          "href": "https://appsilon.com/use-r-and-python-together/",
          "text": "We have just the article for you"
        },
        {
          "href": "https://github.com/EagerAI/fastai",
          "text": "GitHub repo"
        },
        {
          "href": "https://www.robots.ox.ac.uk/~vgg/data/pets/",
          "text": "Oxford-IIT Pet Dataset"
        },
        {
          "href": "https://s3.amazonaws.com/fast-ai-imageclas/oxford-iiit-pet%20113",
          "text": "download link"
        },
        {
          "href": "https://appsilon.com/tag/timm/",
          "text": "timm"
        },
        {
          "href": "https://twitter.com/appsilon?lang=en",
          "text": "@appsilon"
        },
        {
          "href": "https://appsilon.com/using-ai-to-detect-solar-panels-part-1/",
          "text": "We did the research, you do the reading"
        },
        {
          "href": "https://appsilon.com/fastai-in-r/",
          "text": "Tag: r - Appsilon | Enterprise R Shiny Dashboards"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "FastAI in R: How to Train Deep Learning Models with FastAI | R-bloggers",
      "images": [
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Fast_AI_R.webp"
        },
        {
          "alt": "Image 1 - Installing Miniconda with Reticulate",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 1 - Installing Miniconda with Reticulate",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-1-Installing-Miniconda-with-Reticulate.webp"
        },
        {
          "alt": "Image 2 - Creating a virtual environment with Reticulate",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 2 - Creating a virtual environment with Reticulate",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-2-Creating-a-virtual-environment-with-Reticulate.webp"
        },
        {
          "alt": "Image 3 - Installing the R package from GitHub with devtools",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 3 - Installing the R package from GitHub with devtools",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-3-Installing-the-R-package-from-GitHub-with-devtools.webp"
        },
        {
          "alt": "Image 4 - Installing FastAI Python dependencies",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 4 - Installing FastAI Python dependencies",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-4-Installing-FastAI-Python-dependencies.webp"
        },
        {
          "alt": "Image 5 - Path to a single image",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 5 - Path to a single image",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-5-Path-to-a-single-image.webp"
        },
        {
          "alt": "Image 6 - A random batch of images",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 6 - A random batch of images",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-6-A-random-batch-of-images.webp"
        },
        {
          "alt": "Image 7 - ResNet-18 architecture (Credits- www.researchgate.net)",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 7 - ResNet-18 architecture (Credits- www.researchgate.net)",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-7-ResNet-18-architecture-Credits-www.researchgate.net_.webp"
        },
        {
          "alt": "Image 8 - Downloading a ResNet-18 model",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 8 - Downloading a ResNet-18 model",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-8-Downloading-a-ResNet-18-model.webp"
        },
        {
          "alt": "Image 9 - FastAI in R training progress",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 9 - FastAI in R training progress",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-9-FastAI-in-R-training-progress.webp"
        },
        {
          "alt": "Image 10 - Training and validation metrics during training",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 10 - Training and validation metrics during training",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-10-Training-and-validation-metrics-during-training.webp"
        },
        {
          "alt": "Image 11 - Confusion matrix",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 11 - Confusion matrix",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-11-Confusion-matrix.webp"
        },
        {
          "alt": "Image 12 - Top losses of our classification model",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Image 12 - Top losses of our classification model",
          "base64": null,
          "src": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-12-Top-losses-of-our-classification-model.webp"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/dario-radecic/",
          "text": "Dario Radečić"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-380786 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">FastAI in R: How to Train Deep Learning Models with FastAI</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">December 12, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/dario-radecic/\">Dario Radečić</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://appsilon.com/fastai-in-r/\"> Tag: r - Appsilon | Enterprise R Shiny Dashboards</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9--><div><img alt=\"\" class=\"attachment-medium size-medium wp-post-image\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Fast_AI_R.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" style=\"margin-bottom: 15px;\" width=\"450\"/><noscript><img alt=\"\" class=\"attachment-medium size-medium wp-post-image\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Fast_AI_R.webp\" style=\"margin-bottom: 15px;\" width=\"450\"/></noscript></div><p>It seems like it’s getting easier and easier to get into deep learning, at least as a practitioner. Packages like <a href=\"https://github.com/fastai/fastai\" rel=\"nofollow\" target=\"_blank\">FastAI</a> are available to masses for both <a href=\"https://pypi.org/project/fastai/\" rel=\"nofollow\" target=\"_blank\">Python</a> and <a href=\"https://github.com/EagerAI/fastai\" rel=\"nofollow\" target=\"_blank\">R</a>, and in some simple scenarios they seem to provide a no-brainer solution for training deep learning models with as few lines of code as possible.</p>\n<p>Today we’ll dive into FastAI in R, and you’ll learn how to train an image classification model from scratch. Well, not from scratch, but with a pretrained network available in FastAI, which yields high accuracy with only a few training epochs. But first, we’ll go over FastAI in general, so you can know what it can and what it can’t do.</p>\n<p><a href=\"https://github.com/Appsilon/fastai-in-r/\" rel=\"nofollow\" target=\"_blank\"><span style=\"font-weight: 400;\">This repository</span></a><span style=\"font-weight: 400;\"> we </span><span style=\"font-weight: 400;\">prepared contains</span><span style=\"font-weight: 400;\"> three examples of how FastAI can be leveraged from the perspective of an R user, with various degrees of involvement of Python code. You can find a brief presentation of the methods in </span><span style=\"font-weight: 400;\">our</span> <a href=\"https://appsilon.com/fast-ai-in-r/\" rel=\"nofollow\" target=\"_blank\"><span style=\"font-weight: 400;\">Fast AI in R blogpost</span></a><span style=\"font-weight: 400;\">. Here we </span><span style=\"font-weight: 400;\">will explain</span><span style=\"font-weight: 400;\"> the steps in some more </span><span style=\"font-weight: 400;\">detail</span><span style=\"font-weight: 400;\">.</span></p>\n<blockquote><p>Looking to build a custom Deep Learning Model on top of an existing architecture? <a href=\"https://appsilon.com/transfer-learning-introduction/\" rel=\"nofollow\" target=\"_blank\">Look no further than Transfer Learning</a>.</p></blockquote>\n<h3>Table of contents:</h3>\n<ul>\n<li><strong><a href=\"https://appsilon.com/fastai-in-r/#what-is-fastai\" rel=\"nofollow\" target=\"_blank\">What is FastAI and Why Should You Care?</a></strong></li>\n<li><strong><a href=\"https://appsilon.com/fastai-in-r/#install\" rel=\"nofollow\" target=\"_blank\">FastAI in R – How to Install FastAI</a></strong></li>\n<li><strong><a href=\"https://appsilon.com/fastai-in-r/#model\" rel=\"nofollow\" target=\"_blank\">How to Train an Image Classification Model with FastAI in R</a></strong></li>\n<li><strong><a href=\"https://appsilon.com/fastai-in-r/#summary\" rel=\"nofollow\" target=\"_blank\">Summing up FastAI in R</a></strong></li>\n</ul>\n<hr>\n<h2 id=\"what-is-fastai\">What is FastAI and Why Should You Care?</h2>\n<p>FastAI is an open-source library for deep learning that makes it easy to train highly-accurate neural network models. Needless to say, it moves the barrier of entry for practitioners even lower, which is a good thing. The library is built on top of PyTorch and provides a suite of high-level API functions for building and evaluating models in no time.</p>\n<p>Since FastAI is built on top of PyTorch, it has native Python support. <b>But what about R?</b> Well, there’s a wrapper package we’ll go over shortly, and it can do anything the Python version can since it mainly executes Python code below the surface.</p>\n<p>So, what can you do with FastAI? The library has a range of tools that make it easy to work with images, text, tabular data, time series, audio, GANs, and much more. There are also convenient functions built in for downloading various datasets, so you don’t have to search the web and preprocess the data manually. Neat!</p>\n<h3>Who’s Behind FastAI?</h3>\n<p>The founder of FastAI, <b>Jeremy Howard</b>, needs no introduction. He’s made significant contributions to the field of deep learning, was CEO of Kaggle for a time, and is currently a faculty member at the University of San Francisco and the University of the Witwatersrand in South Africa.</p>\n<p>Howard co-founded FastAI with <b>Rachel Thomas</b>, who is also a founding director of the Center for Applied Data Ethics at the University of San Francisco. She was selected by Forbes magazine as one of the 20 most incredible women in artificial intelligence.</p>\n<p>In short, this means FastAI has more than solid foundations, and you can expect the library to be built and documented well.</p>\n<p>Want to learn more about FastAI? Here are some useful links:</p>\n<ul>\n<li><a href=\"https://www.fast.ai/\" rel=\"nofollow\" target=\"_blank\">FastAI homepage with recent blog posts</a></li>\n<li><a href=\"https://course.fast.ai/\" rel=\"nofollow\" target=\"_blank\">Practical Deep Learning for Coders course</a></li>\n<li><a href=\"https://www.amazon.com/Deep-Learning-Coders-fastai-PyTorch/dp/1492045527\" rel=\"nofollow\" target=\"_blank\">Deep Learning for Coders with FastAI and PyTorch book</a></li>\n</ul>\n<h2 id=\"install\">FastAI in R – How to Install FastAI</h2>\n<p><i><b>Note: </b>As of April 2023, we had trouble installing the R version of FastAI on Apple Silicon Macbooks. The procedure you’re about to see works on any Intel Mac or Windows/Linux PC but isn’t guaranteed to work on M1/M2 devices.</i></p>\n<p>Installing the R version of FastAI is a bit more manual and tedious than the Python version. In Python, one pip-install command is enough, but for R, it’s a different story. You first have to install Miniconda, then the <code>reticulate</code> package, create a virtual environment, and then install FastAI from GitHub.</p>\n<p>You don’t need to worry since we’ll guide you through every step.</p>\n<h3>Install Miniconda and Create a Virtual Environment</h3>\n<p>Miniconda is a lightweight version of Anaconda Python distribution, which is a popular package and environment manager for Python. As it turns out, you need to install Miniconda first if you want to use a FastAI wrapper in R.</p>\n<p>But even before Miniconda, you have to install R’s <code>reticulate</code> package. It provides an interface between R and Python, allowing you to integrate code written in both languages on the same project. If you’re a data scientist using both R and Python, <code>reticulate</code> is the package you should consider learning.</p>\n<p>The following code snippet uses the R console to install <code>reticulate</code>, and then uses the package to install Miniconda on your system:</p>\n<pre>install.pakcages(\"reticulate\")\r\n\r\nreticulate::install_miniconda()</pre>\n<p>Here’s the output you should see:</p>\n<div class=\"wp-caption alignnone\" id=\"attachment_22363\" style=\"width: 1436px\"><img alt=\"Image 1 - Installing Miniconda with Reticulate\" aria-describedby=\"caption-attachment-22363\" class=\"size-full wp-image-22363\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-1-Installing-Miniconda-with-Reticulate.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 1 - Installing Miniconda with Reticulate\" aria-describedby=\"caption-attachment-22363\" class=\"size-full wp-image-22363\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-1-Installing-Miniconda-with-Reticulate.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22363\">Image 1 – Installing Miniconda with Reticulate</p></div>\n<p>Once installed, you can create a new <b>virtual environment</b>. We’ve named ours <code>r-reticulate</code>, but feel free to be a bit more creative:</p>\n<pre>reticulate::conda_create(\"r-reticulate\")</pre>\n<div class=\"wp-caption alignnone\" id=\"attachment_22365\" style=\"width: 1776px\"><img alt=\"Image 2 - Creating a virtual environment with Reticulate\" aria-describedby=\"caption-attachment-22365\" class=\"size-full wp-image-22365\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-2-Creating-a-virtual-environment-with-Reticulate.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 2 - Creating a virtual environment with Reticulate\" aria-describedby=\"caption-attachment-22365\" class=\"size-full wp-image-22365\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-2-Creating-a-virtual-environment-with-Reticulate.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22365\">Image 2 – Creating a virtual environment with Reticulate</p></div>\n<blockquote><p>Want to learn more about R and Python integration with Reticulate? <a href=\"https://appsilon.com/use-r-and-python-together/\" rel=\"nofollow\" target=\"_blank\">We have just the article for you</a>.</p></blockquote>\n<p>You now have both <code>reticulate</code> and a virtual environment configured, so the next step is to install FastAI.</p>\n<h3>Install and Configure FastAI in R</h3>\n<p>The recommended way to install FastAI in R is by getting it straight from the <a href=\"https://github.com/EagerAI/fastai\" rel=\"nofollow\" target=\"_blank\">GitHub repo</a>. Doing so requires an additional R package – <code>devtools</code>. Here’s the R shell command to install that package first, and then to install FastAI from a repo:</p>\n<pre>install.packages(\"devtools\")\r\n\r\ndevtools::install_github(\"eagerai/fastai\")</pre>\n<p>You should see something similar to this in the console output:</p>\n<div class=\"wp-caption alignnone\" id=\"attachment_22367\" style=\"width: 745px\"><img alt=\"Image 3 - Installing the R package from GitHub with devtools\" aria-describedby=\"caption-attachment-22367\" class=\"size-full wp-image-22367\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-3-Installing-the-R-package-from-GitHub-with-devtools.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 3 - Installing the R package from GitHub with devtools\" aria-describedby=\"caption-attachment-22367\" class=\"size-full wp-image-22367\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-3-Installing-the-R-package-from-GitHub-with-devtools.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22367\">Image 3 – Installing the R package from GitHub with devtools</p></div>\n<p>You’d think that’s all, but you’d be wrong. The R wrapper package might be installed, but that doesn’t mean the underlying Python library and its dependencies are installed and configured correctly.</p>\n<p>Run these two commands to activate the previously configured <code>r-reticulate</code> virtual environment and to install Python dependencies for FastAI:</p>\n<pre>reticulate::use_condaenv(\"r-reticulate\", required = TRUE)\r\nfastai::install_fastai(gpu = FALSE, cuda_version = \"11.6\", overwrite = FALSE)</pre>\n<p>The last command will pull a good amount of Python libraries, as shown in the following image:</p>\n<div class=\"wp-caption alignnone\" id=\"attachment_22369\" style=\"width: 1830px\"><img alt=\"Image 4 - Installing FastAI Python dependencies\" aria-describedby=\"caption-attachment-22369\" class=\"size-full wp-image-22369\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-4-Installing-FastAI-Python-dependencies.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 4 - Installing FastAI Python dependencies\" aria-describedby=\"caption-attachment-22369\" class=\"size-full wp-image-22369\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-4-Installing-FastAI-Python-dependencies.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22369\">Image 4 – Installing FastAI Python dependencies</p></div>\n<p>Sit back because this will take a couple of minutes. Done? Great, join us in the following section.</p>\n<h2 id=\"model\">How to Train an Image Classification Model with FastAI in R</h2>\n<p>The difficult part of this article was installing FastAI in R. That’s over, which means you can now fully enjoy the high-level API functions FastAI has to offer.</p>\n<p>We’ll start by downloading and exploring a dataset for image classification.</p>\n<h3>Data Gathering and Exploration</h3>\n<p>The process of data gathering typically boils down to searching the web for adequate pre-made datasets at best or creating the dataset from scratch at worst. Depending on the problem you’re trying to solve, this step can typically take from minutes to months or even years in some domain-specific problems.</p>\n<p>Luckily for us, that’s not the case with FastAI. There are dozens of built-in convenience functions that will download the data for you, and even automatically set the appropriate directory structure.</p>\n<p>But first, the library imports. Stick these two at the top of your R script:</p>\n<pre>library(magrittr)\r\nlibrary(fastai)</pre>\n<p>We’ll use the <a href=\"https://www.robots.ox.ac.uk/~vgg/data/pets/\" rel=\"nofollow\" target=\"_blank\">Oxford-IIT Pet Dataset</a> which has 37 categories of pet images with roughly 200 images for each class. <span style=\"font-weight: 400;\">It may seem this is not enough for deep learning, and indeed, a model trained from scratch on this data will likely </span><span style=\"font-weight: 400;\">generalize</span><span style=\"font-weight: 400;\"> poorly</span>.</p>\n<p><b>The good news is</b> – FastAI allows us to leverage transfer learning without breaking a sweat.</p>\n<p>But first, let’s download the dataset. The following code snippet downloads the Oxford-IIT Pet dataset:</p>\n<pre># Download data\r\nURLs_PETS()</pre>\n<p>If the function call doesn’t work for you, download and extract the .tgz file from this <a href=\"https://s3.amazonaws.com/fast-ai-imageclas/oxford-iiit-pet%20113\" rel=\"nofollow\" target=\"_blank\">download link</a>. Either way, you’re ready to move on to the next step.</p>\n<p>Now you have to define paths to the dataset, image, and annotation folders. The built-in <code>get_image_files()</code> function automatically scans the image directory and ensures they are formatted correctly. If there are no errors, the function returns all of the images in an array.</p>\n<p>The following code snippet defines paths to all folders, loads the images, and prints the contents of the first one:</p>\n<pre># Folder paths\r\npath &lt;- \"/Users/dradecic/Desktop/oxford-iiit-pet\"\r\npath_anno &lt;- \"/Users/dradecic/Desktop/oxford-iiit-pet/annotations\"\r\npath_img &lt;- \"/Users/dradecic/Desktop/oxford-iiit-pet/images\"\r\nfnames &lt;- get_image_files(path_img)\r\n\r\n# One example\r\nfnames[1]</pre>\n<p>Here’s what you should see in the R console:</p>\n<div class=\"wp-caption alignnone\" id=\"attachment_22371\" style=\"width: 1442px\"><img alt=\"Image 5 - Path to a single image\" aria-describedby=\"caption-attachment-22371\" class=\"size-full wp-image-22371\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-5-Path-to-a-single-image.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 5 - Path to a single image\" aria-describedby=\"caption-attachment-22371\" class=\"size-full wp-image-22371\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-5-Path-to-a-single-image.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22371\">Image 5 – Path to a single image</p></div>\n<p>We’re on the right track, and the next step is to load these images with the <code>DataLoader</code> class. This one will load all of the JPG files in batches of 10, and resize them to a square size of 460×460 pixels. It also uses the ImageNet normalization values for red, green, and blue image channels.</p>\n<p>Finally, the code snippet plots one batch of images with their respective class names so we can see what we’re dealing with:</p>\n<pre># DataLoader\r\ndls = ImageDataLoaders_from_name_re(\r\n  path = path,\r\n  fnames = fnames,\r\n  pat = \"(.+)_\\\\d+.jpg$\",\r\n  item_tfms = Resize(size = 460),\r\n  bs = 10,\r\n  batch_tfms = list(Normalize_from_stats(imagenet_stats()))\r\n)\r\n\r\ndls %&gt;%\r\n  show_batch()</pre>\n<p>The images in the batch are random, but expect to see something similar to this:</p>\n<div class=\"wp-caption alignnone\" id=\"attachment_22373\" style=\"width: 1208px\"><img alt=\"Image 6 - A random batch of images\" aria-describedby=\"caption-attachment-22373\" class=\"size-full wp-image-22373\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-6-A-random-batch-of-images.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 6 - A random batch of images\" aria-describedby=\"caption-attachment-22373\" class=\"size-full wp-image-22373\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-6-A-random-batch-of-images.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22373\">Image 6 – A random batch of images</p></div>\n<p>The dataset is now loaded correctly, which means we can proceed to model training.</p>\n<h3>A Custom Pretrained Neural Network Architecture</h3>\n<p>A big part of why FastAI in R works so great on a small dataset is transfer learning. Put simply, this technique leverages <span style=\"font-weight: 400;\">models</span><span style=\"font-weight: 400;\"> trained on large, generic datasets, where especially the initial layers of the model learn to recognise patterns common in almost all image data (such as edges, corners, gradients of color etc.). This </span><span style=\"font-weight: 400;\">valuable knowledge serves as a foundation to learning specifics of a new (so called “downstream”) task.</span><span style=\"font-weight: 400;\"> Apparently, for many cases which fall close to the standard problems solved by computer vision, even small datasets are enough to finetune the model to a given task.</span>.</p>\n<p>There are numerous pre-built architectures you can use, <span style=\"font-weight: 400;\">many implemented directly in FastAI, and even more available when using packages like </span><a href=\"https://appsilon.com/tag/timm/\" rel=\"nofollow\" target=\"_blank\"><span style=\"font-weight: 400;\">timm</span></a>.</p>\n<p>If you’re into graphs, the following one describes the structure of one of the simplest choices the ResNet-18 architecture:</p>\n<div class=\"wp-caption alignnone\" id=\"attachment_22375\" style=\"width: 860px\"><img alt=\"Image 7 - ResNet-18 architecture (Credits- www.researchgate.net)\" aria-describedby=\"caption-attachment-22375\" class=\"size-full wp-image-22375\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-7-ResNet-18-architecture-Credits-www.researchgate.net_.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 7 - ResNet-18 architecture (Credits- www.researchgate.net)\" aria-describedby=\"caption-attachment-22375\" class=\"size-full wp-image-22375\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-7-ResNet-18-architecture-Credits-www.researchgate.net_.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22375\">Image 7 – ResNet-18 architecture (Credits- www.researchgate.net)</p></div>\n<p>The following code snippet instantiates a <code>cnn_learner</code>, which takes in a DataLoader, model architecture, and a list of metrics you want to keep track of while training:</p>\n<pre># Model architecture\r\nlearn = cnn_learner(dls = dls, arch = resnet18(), metrics = list(accuracy, error_rate()))</pre>\n<p>Once you run the above code snippet, you should see the download progress bar in the R console. This just means R is downloading the ResNet-18 network:</p>\n<div class=\"wp-caption alignnone\" id=\"attachment_22377\" style=\"width: 1656px\"><img alt=\"Image 8 - Downloading a ResNet-18 model\" aria-describedby=\"caption-attachment-22377\" class=\"size-full wp-image-22377\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-8-Downloading-a-ResNet-18-model.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 8 - Downloading a ResNet-18 model\" aria-describedby=\"caption-attachment-22377\" class=\"size-full wp-image-22377\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-8-Downloading-a-ResNet-18-model.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22377\">Image 8 – Downloading a ResNet-18 model</p></div>\n<p>Once done, you can proceed with model training. Let’s do that next.</p>\n<h3>Training a Model with FastAI in R</h3>\n<p>We don’t need to train the model for long since it leverages a pretrained architecture. A couple of epochs should be enough. The following code snippet trains the model on our custom dataset for 5 epochs:</p>\n<pre># Fit\r\nlearn %&gt;%\r\n  fit_one_cycle(n_epoch = 5)</pre>\n<p>Depending on your hardware, this might take a while, from seconds per epoch to minutes. You’ll see the R console output updated with each epoch, and it will look similar to this after the training finishes:</p>\n<div class=\"wp-caption aligncenter\" id=\"attachment_22379\" style=\"width: 710px\"><img alt=\"Image 9 - FastAI in R training progress\" aria-describedby=\"caption-attachment-22379\" class=\"size-full wp-image-22379\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-9-FastAI-in-R-training-progress.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 9 - FastAI in R training progress\" aria-describedby=\"caption-attachment-22379\" class=\"size-full wp-image-22379\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-9-FastAI-in-R-training-progress.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22379\">Image 9 – FastAI in R training progress</p></div>\n<p>In addition, you’ll see your metrics on training and validation sets plotted automatically in the Charts panel of RStudio. Here’s what it looks like on our end:</p>\n<div class=\"wp-caption alignnone\" id=\"attachment_22381\" style=\"width: 1006px\"><img alt=\"Image 10 - Training and validation metrics during training\" aria-describedby=\"caption-attachment-22381\" class=\"size-full wp-image-22381\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-10-Training-and-validation-metrics-during-training.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 10 - Training and validation metrics during training\" aria-describedby=\"caption-attachment-22381\" class=\"size-full wp-image-22381\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-10-Training-and-validation-metrics-during-training.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22381\">Image 10 – Training and validation metrics during training</p></div>\n<p>You can see why we say the metrics are hit and miss. Both training and validation loss are decreasing, but accuracy and error rates seem static over time. The accuracy is reported to be only around 3%, which is far from the truth, as you’ll see in the following section.</p>\n<h3>Evaluating Model Predictions</h3>\n<p>The easiest and also visually most appealing way to evaluate a classification algorithm is through a confusion matrix. It’s an NxN matrix that shows correct classification on the top-left to bottom-right diagonal, false positives in the upper triangle, and false negatives on the bottom triangle.</p>\n<p>The following code snippet calculates the confusion matrix and plots it using the <code>highcharter</code> R package. Install it if you don’t have it already (<code>install.packages(\"highcharter\")</code>):</p>\n<pre># Confusion matrix\r\nlibrary(highcharter)\r\n\r\ncm &lt;- learn %&gt;%\r\n  get_confusion_matrix()\r\n\r\nhchart(cm, label = TRUE) %&gt;%\r\n  hc_yAxis(title = list(text = \"Actual\")) %&gt;%\r\n  hc_xAxis(title = list(text = \"Predicted\"), labels = list(rotation = - 90))</pre>\n<p>This is the resulting visualization:</p>\n<div class=\"wp-caption alignnone\" id=\"attachment_22383\" style=\"width: 1727px\"><img alt=\"Image 11 - Confusion matrix\" aria-describedby=\"caption-attachment-22383\" class=\"size-full wp-image-22383\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-11-Confusion-matrix.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 11 - Confusion matrix\" aria-describedby=\"caption-attachment-22383\" class=\"size-full wp-image-22383\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-11-Confusion-matrix.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22383\">Image 11 – Confusion matrix</p></div>\n<p>This one is a bit difficult to look at due to 37 classes, but the main diagonal looks great. There are some misclassifications, but overall nothing we should worry about. After all, we’ve trained the model on one of the simplest architectures for only 5 epochs!</p>\n<p>FastAI in R also has a convenient function that allows you to visualize <i>top losses</i>, or instances your model had the hardest time predicting. Here’s how to use it:</p>\n<pre># Top losses\r\ninterp = ClassificationInterpretation_from_learner(learn = learn)\r\ninterp %&gt;%\r\n  plot_top_losses(k = 9, figsize = c(15, 11))</pre>\n<p>And this is what it outputs in our case:</p>\n<div class=\"wp-caption alignnone\" id=\"attachment_22385\" style=\"width: 959px\"><img alt=\"Image 12 - Top losses of our classification model\" aria-describedby=\"caption-attachment-22385\" class=\"size-full wp-image-22385\" data-lazy-src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-12-Top-losses-of-our-classification-model.webp\" decoding=\"async\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"450\"/><noscript><img alt=\"Image 12 - Top losses of our classification model\" aria-describedby=\"caption-attachment-22385\" class=\"size-full wp-image-22385\" decoding=\"async\" loading=\"lazy\" src=\"https://wordpress.appsilon.com/wp-content/uploads/2023/12/Image-12-Top-losses-of-our-classification-model.webp\" width=\"450\"/></noscript><p class=\"wp-caption-text\" id=\"caption-attachment-22385\">Image 12 – Top losses of our classification model</p></div>\n<p>In the example of the first image, the model predicted the class of <code>newfoundland</code> while the actual class was <code>american_pit_bull_terrier</code>.</p>\n<p>And that’s how easy it is to use FastAI in R to train highly-accurate image classification models. Let’s make a short recap next.</p>\n<hr/>\n<h2 id=\"summary\">Summing up FastAI in R</h2>\n<p>If you’re working on a deep learning problem that has to do with tabular data, time series, image classification, NLP, and even GANs, here is some good news for you – You don’t have to start from scratch. Libraries like FastAI do all the heavy lifting for you and provide a plethora of convenience functions for training and evaluating deep learning models. The best thing – FastAI is available for both Python and R, so you won’t have to change tech stacks in order to use it.</p>\n<p>Today you’ve learned how to train an image classification model with FastAI and transfer learning, and it took us maybe 15 lines of code to train a highly-accurate model on a stupidly small dataset. That’s the power of libraries such as FastAI, so make sure to leverage it in your next machine learning project.</p>\n<p><i>Would you like to see another example of FastAI in R?</i> Please let us know in the comment section below, or reach out on Twitter – <a href=\"https://twitter.com/appsilon?lang=en\" rel=\"nofollow\" target=\"_blank\">@appsilon</a>. We’d love to hear from you.</p>\n<blockquote><p>FastAI for detecting Solar Panels from Orthophotos? <a href=\"https://appsilon.com/using-ai-to-detect-solar-panels-part-1/\" rel=\"nofollow\" target=\"_blank\">We did the research, you do the reading</a>.</p></blockquote>\n<p>The post appeared first on appsilon.com/blog/.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://appsilon.com/fastai-in-r/\"> Tag: r - Appsilon | Enterprise R Shiny Dashboards</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div> </hr></div>\n</article>",
      "main_text": "FastAI in R: How to Train Deep Learning Models with FastAI\nPosted on\nDecember 12, 2023\nby\nDario Radečić\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nTag: r - Appsilon | Enterprise R Shiny Dashboards\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nIt seems like it’s getting easier and easier to get into deep learning, at least as a practitioner. Packages like\nFastAI\nare available to masses for both\nPython\nand\nR\n, and in some simple scenarios they seem to provide a no-brainer solution for training deep learning models with as few lines of code as possible.\nToday we’ll dive into FastAI in R, and you’ll learn how to train an image classification model from scratch. Well, not from scratch, but with a pretrained network available in FastAI, which yields high accuracy with only a few training epochs. But first, we’ll go over FastAI in general, so you can know what it can and what it can’t do.\nThis repository\nwe\nprepared contains\nthree examples of how FastAI can be leveraged from the perspective of an R user, with various degrees of involvement of Python code. You can find a brief presentation of the methods in\nour\nFast AI in R blogpost\n. Here we\nwill explain\nthe steps in some more\ndetail\n.\nLooking to build a custom Deep Learning Model on top of an existing architecture?\nLook no further than Transfer Learning\n.\nTable of contents:\nWhat is FastAI and Why Should You Care?\nFastAI in R – How to Install FastAI\nHow to Train an Image Classification Model with FastAI in R\nSumming up FastAI in R\nWhat is FastAI and Why Should You Care?\nFastAI is an open-source library for deep learning that makes it easy to train highly-accurate neural network models. Needless to say, it moves the barrier of entry for practitioners even lower, which is a good thing. The library is built on top of PyTorch and provides a suite of high-level API functions for building and evaluating models in no time.\nSince FastAI is built on top of PyTorch, it has native Python support.\nBut what about R?\nWell, there’s a wrapper package we’ll go over shortly, and it can do anything the Python version can since it mainly executes Python code below the surface.\nSo, what can you do with FastAI? The library has a range of tools that make it easy to work with images, text, tabular data, time series, audio, GANs, and much more. There are also convenient functions built in for downloading various datasets, so you don’t have to search the web and preprocess the data manually. Neat!\nWho’s Behind FastAI?\nThe founder of FastAI,\nJeremy Howard\n, needs no introduction. He’s made significant contributions to the field of deep learning, was CEO of Kaggle for a time, and is currently a faculty member at the University of San Francisco and the University of the Witwatersrand in South Africa.\nHoward co-founded FastAI with\nRachel Thomas\n, who is also a founding director of the Center for Applied Data Ethics at the University of San Francisco. She was selected by Forbes magazine as one of the 20 most incredible women in artificial intelligence.\nIn short, this means FastAI has more than solid foundations, and you can expect the library to be built and documented well.\nWant to learn more about FastAI? Here are some useful links:\nFastAI homepage with recent blog posts\nPractical Deep Learning for Coders course\nDeep Learning for Coders with FastAI and PyTorch book\nFastAI in R – How to Install FastAI\nNote:\nAs of April 2023, we had trouble installing the R version of FastAI on Apple Silicon Macbooks. The procedure you’re about to see works on any Intel Mac or Windows/Linux PC but isn’t guaranteed to work on M1/M2 devices.\nInstalling the R version of FastAI is a bit more manual and tedious than the Python version. In Python, one pip-install command is enough, but for R, it’s a different story. You first have to install Miniconda, then the\nreticulate\npackage, create a virtual environment, and then install FastAI from GitHub.\nYou don’t need to worry since we’ll guide you through every step.\nInstall Miniconda and Create a Virtual Environment\nMiniconda is a lightweight version of Anaconda Python distribution, which is a popular package and environment manager for Python. As it turns out, you need to install Miniconda first if you want to use a FastAI wrapper in R.\nBut even before Miniconda, you have to install R’s\nreticulate\npackage. It provides an interface between R and Python, allowing you to integrate code written in both languages on the same project. If you’re a data scientist using both R and Python,\nreticulate\nis the package you should consider learning.\nThe following code snippet uses the R console to install\nreticulate\n, and then uses the package to install Miniconda on your system:\ninstall.pakcages(\"reticulate\")\n\nreticulate::install_miniconda()\nHere’s the output you should see:\nImage 1 – Installing Miniconda with Reticulate\nOnce installed, you can create a new\nvirtual environment\n. We’ve named ours\nr-reticulate\n, but feel free to be a bit more creative:\nreticulate::conda_create(\"r-reticulate\")\nImage 2 – Creating a virtual environment with Reticulate\nWant to learn more about R and Python integration with Reticulate?\nWe have just the article for you\n.\nYou now have both\nreticulate\nand a virtual environment configured, so the next step is to install FastAI.\nInstall and Configure FastAI in R\nThe recommended way to install FastAI in R is by getting it straight from the\nGitHub repo\n. Doing so requires an additional R package –\ndevtools\n. Here’s the R shell command to install that package first, and then to install FastAI from a repo:\ninstall.packages(\"devtools\")\n\ndevtools::install_github(\"eagerai/fastai\")\nYou should see something similar to this in the console output:\nImage 3 – Installing the R package from GitHub with devtools\nYou’d think that’s all, but you’d be wrong. The R wrapper package might be installed, but that doesn’t mean the underlying Python library and its dependencies are installed and configured correctly.\nRun these two commands to activate the previously configured\nr-reticulate\nvirtual environment and to install Python dependencies for FastAI:\nreticulate::use_condaenv(\"r-reticulate\", required = TRUE)\nfastai::install_fastai(gpu = FALSE, cuda_version = \"11.6\", overwrite = FALSE)\nThe last command will pull a good amount of Python libraries, as shown in the following image:\nImage 4 – Installing FastAI Python dependencies\nSit back because this will take a couple of minutes. Done? Great, join us in the following section.\nHow to Train an Image Classification Model with FastAI in R\nThe difficult part of this article was installing FastAI in R. That’s over, which means you can now fully enjoy the high-level API functions FastAI has to offer.\nWe’ll start by downloading and exploring a dataset for image classification.\nData Gathering and Exploration\nThe process of data gathering typically boils down to searching the web for adequate pre-made datasets at best or creating the dataset from scratch at worst. Depending on the problem you’re trying to solve, this step can typically take from minutes to months or even years in some domain-specific problems.\nLuckily for us, that’s not the case with FastAI. There are dozens of built-in convenience functions that will download the data for you, and even automatically set the appropriate directory structure.\nBut first, the library imports. Stick these two at the top of your R script:\nlibrary(magrittr)\nlibrary(fastai)\nWe’ll use the\nOxford-IIT Pet Dataset\nwhich has 37 categories of pet images with roughly 200 images for each class.\nIt may seem this is not enough for deep learning, and indeed, a model trained from scratch on this data will likely\ngeneralize\npoorly\n.\nThe good news is\n– FastAI allows us to leverage transfer learning without breaking a sweat.\nBut first, let’s download the dataset. The following code snippet downloads the Oxford-IIT Pet dataset:\n# Download data\nURLs_PETS()\nIf the function call doesn’t work for you, download and extract the .tgz file from this\ndownload link\n. Either way, you’re ready to move on to the next step.\nNow you have to define paths to the dataset, image, and annotation folders. The built-in\nget_image_files()\nfunction automatically scans the image directory and ensures they are formatted correctly. If there are no errors, the function returns all of the images in an array.\nThe following code snippet defines paths to all folders, loads the images, and prints the contents of the first one:\n# Folder paths\npath <- \"/Users/dradecic/Desktop/oxford-iiit-pet\"\npath_anno <- \"/Users/dradecic/Desktop/oxford-iiit-pet/annotations\"\npath_img <- \"/Users/dradecic/Desktop/oxford-iiit-pet/images\"\nfnames <- get_image_files(path_img)\n\n# One example\nfnames[1]\nHere’s what you should see in the R console:\nImage 5 – Path to a single image\nWe’re on the right track, and the next step is to load these images with the\nDataLoader\nclass. This one will load all of the JPG files in batches of 10, and resize them to a square size of 460×460 pixels. It also uses the ImageNet normalization values for red, green, and blue image channels.\nFinally, the code snippet plots one batch of images with their respective class names so we can see what we’re dealing with:\n# DataLoader\ndls = ImageDataLoaders_from_name_re(\n  path = path,\n  fnames = fnames,\n  pat = \"(.+)_\\\\d+.jpg$\",\n  item_tfms = Resize(size = 460),\n  bs = 10,\n  batch_tfms = list(Normalize_from_stats(imagenet_stats()))\n)\n\ndls %>%\n  show_batch()\nThe images in the batch are random, but expect to see something similar to this:\nImage 6 – A random batch of images\nThe dataset is now loaded correctly, which means we can proceed to model training.\nA Custom Pretrained Neural Network Architecture\nA big part of why FastAI in R works so great on a small dataset is transfer learning. Put simply, this technique leverages\nmodels\ntrained on large, generic datasets, where especially the initial layers of the model learn to recognise patterns common in almost all image data (such as edges, corners, gradients of color etc.). This\nvaluable knowledge serves as a foundation to learning specifics of a new (so called “downstream”) task.\nApparently, for many cases which fall close to the standard problems solved by computer vision, even small datasets are enough to finetune the model to a given task.\n.\nThere are numerous pre-built architectures you can use,\nmany implemented directly in FastAI, and even more available when using packages like\ntimm\n.\nIf you’re into graphs, the following one describes the structure of one of the simplest choices the ResNet-18 architecture:\nImage 7 – ResNet-18 architecture (Credits- www.researchgate.net)\nThe following code snippet instantiates a\ncnn_learner\n, which takes in a DataLoader, model architecture, and a list of metrics you want to keep track of while training:\n# Model architecture\nlearn = cnn_learner(dls = dls, arch = resnet18(), metrics = list(accuracy, error_rate()))\nOnce you run the above code snippet, you should see the download progress bar in the R console. This just means R is downloading the ResNet-18 network:\nImage 8 – Downloading a ResNet-18 model\nOnce done, you can proceed with model training. Let’s do that next.\nTraining a Model with FastAI in R\nWe don’t need to train the model for long since it leverages a pretrained architecture. A couple of epochs should be enough. The following code snippet trains the model on our custom dataset for 5 epochs:\n# Fit\nlearn %>%\n  fit_one_cycle(n_epoch = 5)\nDepending on your hardware, this might take a while, from seconds per epoch to minutes. You’ll see the R console output updated with each epoch, and it will look similar to this after the training finishes:\nImage 9 – FastAI in R training progress\nIn addition, you’ll see your metrics on training and validation sets plotted automatically in the Charts panel of RStudio. Here’s what it looks like on our end:\nImage 10 – Training and validation metrics during training\nYou can see why we say the metrics are hit and miss. Both training and validation loss are decreasing, but accuracy and error rates seem static over time. The accuracy is reported to be only around 3%, which is far from the truth, as you’ll see in the following section.\nEvaluating Model Predictions\nThe easiest and also visually most appealing way to evaluate a classification algorithm is through a confusion matrix. It’s an NxN matrix that shows correct classification on the top-left to bottom-right diagonal, false positives in the upper triangle, and false negatives on the bottom triangle.\nThe following code snippet calculates the confusion matrix and plots it using the\nhighcharter\nR package. Install it if you don’t have it already (\ninstall.packages(\"highcharter\")\n):\n# Confusion matrix\nlibrary(highcharter)\n\ncm <- learn %>%\n  get_confusion_matrix()\n\nhchart(cm, label = TRUE) %>%\n  hc_yAxis(title = list(text = \"Actual\")) %>%\n  hc_xAxis(title = list(text = \"Predicted\"), labels = list(rotation = - 90))\nThis is the resulting visualization:\nImage 11 – Confusion matrix\nThis one is a bit difficult to look at due to 37 classes, but the main diagonal looks great. There are some misclassifications, but overall nothing we should worry about. After all, we’ve trained the model on one of the simplest architectures for only 5 epochs!\nFastAI in R also has a convenient function that allows you to visualize\ntop losses\n, or instances your model had the hardest time predicting. Here’s how to use it:\n# Top losses\ninterp = ClassificationInterpretation_from_learner(learn = learn)\ninterp %>%\n  plot_top_losses(k = 9, figsize = c(15, 11))\nAnd this is what it outputs in our case:\nImage 12 – Top losses of our classification model\nIn the example of the first image, the model predicted the class of\nnewfoundland\nwhile the actual class was\namerican_pit_bull_terrier\n.\nAnd that’s how easy it is to use FastAI in R to train highly-accurate image classification models. Let’s make a short recap next.\nSumming up FastAI in R\nIf you’re working on a deep learning problem that has to do with tabular data, time series, image classification, NLP, and even GANs, here is some good news for you – You don’t have to start from scratch. Libraries like FastAI do all the heavy lifting for you and provide a plethora of convenience functions for training and evaluating deep learning models. The best thing – FastAI is available for both Python and R, so you won’t have to change tech stacks in order to use it.\nToday you’ve learned how to train an image classification model with FastAI and transfer learning, and it took us maybe 15 lines of code to train a highly-accurate model on a stupidly small dataset. That’s the power of libraries such as FastAI, so make sure to leverage it in your next machine learning project.\nWould you like to see another example of FastAI in R?\nPlease let us know in the comment section below, or reach out on Twitter –\n@appsilon\n. We’d love to hear from you.\nFastAI for detecting Solar Panels from Orthophotos?\nWe did the research, you do the reading\n.\nThe post appeared first on appsilon.com/blog/.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nTag: r - Appsilon | Enterprise R Shiny Dashboards\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "It seems like it’s getting easier and easier to get into deep learning, at least as a practitioner. Packages like FastAI are available to masses for both Python and R, and in some simple scenarios they seem to provide a no-brainer solution for training deep learning models with as few lines of code as possible. […] The post appeared first on appsilon.com/blog/.",
      "meta_keywords": null,
      "og_description": "It seems like it’s getting easier and easier to get into deep learning, at least as a practitioner. Packages like FastAI are available to masses for both Python and R, and in some simple scenarios they seem to provide a no-brainer solution for training deep learning models with as few lines of code as possible. […] The post appeared first on appsilon.com/blog/.",
      "og_image": "https://wordpress.appsilon.com/wp-content/uploads/2023/12/Fast_AI_R.webp",
      "og_title": "FastAI in R: How to Train Deep Learning Models with FastAI | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 13.3,
      "sitemap_lastmod": "2023-12-12T13:41:05+00:00",
      "twitter_description": "It seems like it’s getting easier and easier to get into deep learning, at least as a practitioner. Packages like FastAI are available to masses for both Python and R, and in some simple scenarios they seem to provide a no-brainer solution for training deep learning models with as few lines of code as possible. […] The post appeared first on appsilon.com/blog/.",
      "twitter_title": "FastAI in R: How to Train Deep Learning Models with FastAI | R-bloggers",
      "url": "https://www.r-bloggers.com/2023/12/fastai-in-r-how-to-train-deep-learning-models-with-fastai/",
      "word_count": 2652
    }
  }
}