{
  "id": "7575086130e23a38c3135c77244f23fd5fe49de1",
  "url": "https://www.r-bloggers.com/2024/12/tidyverse-%f0%9f%aa%90to-polars-%f0%9f%90%bb%e2%80%8d%e2%9d%84%ef%b8%8f-my-notes",
  "created_at_utc": "2025-11-22T19:59:36Z",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2024/12/tidyverse-%f0%9f%aa%90to-polars-%f0%9f%90%bb%e2%80%8d%e2%9d%84%ef%b8%8f-my-notes/",
    "crawled_at": "2025-11-22T10:56:43.415699",
    "external_links": [
      {
        "href": "https://www.kenkoonwong.com/blog/polars/",
        "text": "r on Everyday Is A School Day"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#motivation",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#objectives",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#data",
        "text": "Create A Dataframe"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#basic",
        "text": "Filter, Select, Summarize, Across"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#basic2",
        "text": "Mutate, Paste"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#basic3",
        "text": "Extract"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#basic4",
        "text": "Case_when"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#join",
        "text": "Join / Merge"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#pivot",
        "text": "To Dummies/Pivot/Unpivot"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#resource",
        "text": "Helpful Resources"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#lessons",
        "text": "Lessons Learnt"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#create-a-dataframe",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#filter-select-summarize-across",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse-1",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars-1",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#mutate-paste",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse-2",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars-2",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse-3",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars-3",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#extract",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse-4",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars-4",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#case_when",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse-5",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars-5",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse-6",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars-6",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#group_by-shift-forward_fill",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse-7",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars-7",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#is-there-an-easier-way-to-unnest-without-typing-all-of-the-columns-in-polars",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#merge--join",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse-8",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars-8",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse-9",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars-9",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#to-dummies-pivot_longer--pivot_wider",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#tidyverse-10",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars---to_dummies",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#polars---pivot",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#helpful-resources",
        "text": null
      },
      {
        "href": "https://docs.pola.rs/api/python/stable/reference/index.html",
        "text": "Polars Python API documentation"
      },
      {
        "href": "https://franzdiebold.github.io/polars-cheat-sheet/Polars_cheat_sheet.pdf",
        "text": "Cheat sheet"
      },
      {
        "href": "https://ddotta.github.io/cookbook-rpolars/",
        "text": "cookbook Polars for R"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/#lessons-learnt",
        "text": null
      },
      {
        "href": "https://www.kenkoonwong.com/blog/",
        "text": "comment or visit my other blogs"
      },
      {
        "href": "https://bsky.app/profile/kenkoonwong.bsky.social",
        "text": "BlueSky"
      },
      {
        "href": "https://twitter.com/kenkoonwong/",
        "text": "twitter"
      },
      {
        "href": "https://github.com/kenkoonwong/",
        "text": "GitHub"
      },
      {
        "href": "https://med-mastodon.com/@kenkoonwong",
        "text": "Mastodon"
      },
      {
        "href": "https://www.kenkoonwong.com/contact/",
        "text": "contact me"
      },
      {
        "href": "https://www.kenkoonwong.com/blog/polars/",
        "text": "r on Everyday Is A School Day"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Tidyverse ü™êto Polars üêª‚Äç‚ùÑÔ∏è: My Notes | R-bloggers",
    "images": [
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/www.kenkoonwong.com/blog/polars/polars.png?w=578&ssl=1"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/r-on-everyday-is-a-school-day/",
        "text": "r on Everyday Is A School Day"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/cdn-cgi/l/email-protection",
        "text": "[email¬†protected]"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-389508 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Tidyverse ü™êto Polars üêª‚Äç‚ùÑÔ∏è: My Notes</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">December 20, 2024</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/r-on-everyday-is-a-school-day/\">r on Everyday Is A School Day</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://www.kenkoonwong.com/blog/polars/\"> r on Everyday Is A School Day</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47--><blockquote>\n<p>I found <code>Polars</code> syntax is quite similar to <code>dplyr</code>. And the way that we can chain the functions makes it even more familiar! It was fun learning the nuances, now it‚Äôs time to put them into practice! Wish me luck! üçÄ</p>\n</blockquote>\n<h2 id=\"motivation\">Motivation\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#motivation\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>In preparation for using more Python in 2025 and also to speak more of the same language with our datathon team, I‚Äôve decided to practice <code>Polars</code> in Python thinking in R first. Below is my notes to myself, hopefully I‚Äôll be able to refer back and improve this more as I use more of this for the next month. Wish me luck!</p>\n<p><img alt=\"\" data-lazy-src=\"https://i2.wp.com/www.kenkoonwong.com/blog/polars/polars.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/www.kenkoonwong.com/blog/polars/polars.png?w=578&amp;ssl=1\"/></noscript></p>\n<h2 id=\"objectives\">Objectives\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#objectives\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#data\" rel=\"nofollow\" target=\"_blank\">Create A Dataframe</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#basic\" rel=\"nofollow\" target=\"_blank\">Filter, Select, Summarize, Across</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#basic2\" rel=\"nofollow\" target=\"_blank\">Mutate, Paste</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#basic3\" rel=\"nofollow\" target=\"_blank\">Extract</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#basic4\" rel=\"nofollow\" target=\"_blank\">Case_when</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#join\" rel=\"nofollow\" target=\"_blank\">Join / Merge</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#pivot\" rel=\"nofollow\" target=\"_blank\">To Dummies/Pivot/Unpivot</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#resource\" rel=\"nofollow\" target=\"_blank\">Helpful Resources</a></li>\n<li>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#lessons\" rel=\"nofollow\" target=\"_blank\">Lessons Learnt</a></li>\n</ul>\n<h2 id=\"create-a-dataframe\">Create A Dataframe\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#create-a-dataframe\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<h4 id=\"tidyverse\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>library(tidyverse)\nlibrary(reticulate)\nuse_virtualenv('path/to/your/environment')\n\ndf &lt;- tibble(\n  name = c(\"Alice\", \"Bob\", \"Charlie\", \"Ken\", \"Steven\", \"Carlos\"),\n  age = c(30, 25, 35, 50, 60, 58),\n  city = c(\"New York\", \"San Francisco\", \"Tokyo\", \"Toronto\", \"Lima\", \"Cleveland\"),\n  address = c(\"123 Main St, Ontario, OH\", \"123 Main St, Calgary, AB\", \"456-7890, Tokyo, NY\",\n              \"49494 Exchange St, Toronto, ON\", \"1010 Gb st, Lima, OH\", \"666 Heaven dr, Cleveland, OH\"),\n  phone_number = c(\"123-456-7890\", \"987-654-3210\", \"098-765-4332\", \"111-232-4141\", \n                  \"505-402-6060\", \"909-435-1000\"),\n  email = c(\"<a class=\"__cf_email__\" data-cfemail=\"e88984818b8da88d90898598848dc68b8785\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\", \"<a class=\"__cf_email__\" data-cfemail=\"aac8c5c8eacfd2cbc7dac6cf84c9c5c7\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\", \"<a class=\"__cf_email__\" data-cfemail=\"44272c2536282d2104213c25293428216a272b29\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\", \n            \"<a class=\"__cf_email__\" data-cfemail=\"97fcf2f9d7e4e3f6e3e4b9f8e5f0\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\", \"<a class=\"__cf_email__\" data-cfemail=\"cfbcbbaabfa7aaa1acbabdbdb68fa1adaee1aca0a2\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\", \"<a class=\"__cf_email__\" data-cfemail=\"fa999b88969589ba9d9f94938f89d49f9e8f\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\"),\n  salary = c(50000, 45000, 60000, 20000, 40000, 30000),\n  department = c(\"Engineering\", \"Marketing\", \"Finance\", \"Marketing\", \"Marketing\", \"Finance\"),\n  hire_date = c(\"2010-01-01\", \"2012-05-15\", \"2015-10-01\", \"2010-04-01\", \n                \"2009-10-30\", \"2005-11-12\"),\n  status = c(\"Active\", \"Inactive\", \"Active\", \"Inactive\", \"Active\", \"Active\"),\n  salary_increase_percentage = c(10, 5, 15, 10, 10, 5),\n  years_of_service = c(5, 3, 7, 10, 10, 12),\n  bonus_amount = c(2000, 1500, 3000, 5000, 3000, 2000),\n  performance_rating = c(4, 3, 5, 5, 4, 4),\n  performance_reviews_count = c(2, 1, 3, 3, 4, 5),\n  performance_reviews_last_updated = c(\"2022-05-01\", \"2021-07-15\", \"2022-08-31\",\n                                     \"2024-10-30\", \"2023-01-02\", \"2024-12-12\")\n)\n</pre>\n<h4 id=\"polars\">Polars\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#polars\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>import polars as pl\n\ndf = pl.DataFrame({\n    \"name\": [\"Alice\", \"Bob\", \"Charlie\",\"Ken\",\"Steven\",\"Carlos\"],\n    \"age\": [30, 25, 35, 50, 60, 58],\n    \"city\": [\"New York\", \"San Francisco\", \"Tokyo\",\"Toronto\",\"Lima\",\"Cleveland\"],\n    \"address\" : [\"123 Main St, Ontario, OH\",\"123 Main St, Calgary, AB\", \"456-7890, Tokyo, NY\",\"49494 Exchange St, Toronto, ON\",\"1010 Gb st, Lima, OH\",\"666 Heaven dr, Cleveland, OH\"],\n    \"phone_number\" : [\"123-456-7890\", \"987-654-3210\", \"098-765-4332\",\"111-232-4141\",\"505-402-6060\",\"909-435-1000\"],\n    \"email\" : [\"<a class=\"__cf_email__\" data-cfemail=\"20414c494345604558414d504c450e434f4d\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\", \"<a class=\"__cf_email__\" data-cfemail=\"73111c1133160b121e031f165d101c1e\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\", \"<a class=\"__cf_email__\" data-cfemail=\"284b40495a44414d684d50494558444d064b4745\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\",\"<a class=\"__cf_email__\" data-cfemail=\"c0aba5ae80b3b4a1b4b3eeafb2a7\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\",\"<a class=\"__cf_email__\" data-cfemail=\"fd8e89988d9598939e888f8f84bd939f9cd39e9290\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\",\"<a class=\"__cf_email__\" data-cfemail=\"462527342a2935062123282f333568232233\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\"],\n    \"salary\" : [50000, 45000, 60000,20000,40000,30000],\n    \"department\" : [\"Engineering\", \"Marketing\", \"Finance\",\"Marketing\",\"Marketing\",\"Finance\"],\n    \"hire_date\" : [\"2010-01-01\", \"2012-05-15\", \"2015-10-01\", \"2010-04-01\",\"2009-10-30\",\"2005-11-12\"],\n    \"status\" : [\"Active\", \"Inactive\", \"Active\",\"Inactive\",\"Active\",\"Active\"],\n    \"salary_increase_percentage\" : [10, 5, 15,10,10,5],\n    \"years_of_service\" : [5, 3, 7,10,10,12],\n    \"bonus_amount\" : [2000, 1500, 3000,5000,3000,2000],\n    \"performance_rating\" : [4, 3, 5, 5, 4, 4],\n    \"performance_reviews_count\" : [2, 1, 3, 3, 4, 5],\n    \"performance_reviews_last_updated\" : [\"2022-05-01\", \"2021-07-15\", \"2022-08-31\", \"2024-10-30\",\"2023-01-02\",\"2024-12-12\"]\n})\n</pre>\n<h2 id=\"filter-select-summarize-across\">Filter, Select, Summarize, Across\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#filter-select-summarize-across\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>Filter records where age is greater and equal to 30</li>\n<li>return columns with name:address, and columns that starts with performance* and salary*</li>\n<li>return mean of values across all numeric data</li>\n</ul>\n<h4 id=\"tidyverse-1\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse-1\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df |&gt;\n  filter(age &gt;= 30) |&gt;\n  select(1:3, starts_with(\"performance\"), starts_with(\"salary\")) |&gt; \n  summarize(across(.cols = where(is.numeric), .fns = mean, .names = \"mean_{.col}\"))\n\n## # A tibble: 1 √ó 5\n##   mean_age mean_performance_rating mean_performance_reviews_count mean_salary\n##      &lt;dbl&gt;                   &lt;dbl&gt;                          &lt;dbl&gt;       &lt;dbl&gt;\n## 1     46.6                     4.4                            3.4       40000\n## # ‚Ñπ 1 more variable: mean_salary_increase_percentage &lt;dbl&gt;\n</pre>\n<h4 id=\"polars-1\">Polars\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#polars-1\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df \\\n    .filter(pl.col('age') &gt;= 30) \\\n    .select(df.columns[0:4]+['^performance.*$','^salary.*$']) \\\n    .select(pl.col(pl.Int64).mean().name.prefix('mean_'))\n</pre><div>\n<small>shape: (1, 5)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>mean_age</th><th>mean_performance_rating</th><th>mean_performance_reviews_count</th><th>mean_salary</th><th>mean_salary_increase_percentage</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>46.6</td><td>4.4</td><td>3.4</td><td>40000.0</td><td>10.0</td></tr></tbody></table></div>\n<p>For some reason, for the regex above, I have to use <code>^</code> and <code>$</code> sandwiched to return those column nams that I want to include. bizzare.</p>\n<h2 id=\"mutate-paste\">Mutate, Paste\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#mutate-paste\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>Test 1</p>\n<ul>\n<li>make a new column called <code>combination_of_character</code></li>\n<li>paste all columns with character datatype separated by ``, a space</li>\n<li>select the created column</li>\n</ul>\n<h4 id=\"tidyverse-2\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse-2\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df |&gt;\n  rowwise() |&gt;\n  transmute(combination_of_character = paste(\n      across(where(is.character)), \n      collapse = \" \"\n    )) |&gt;\n  select(combination_of_character)\n\n## # A tibble: 6 √ó 1\n## # Rowwise: \n##   combination_of_character                                                      \n##   &lt;chr&gt;                                                                         \n## 1 Alice New York 123 Main St, Ontario, OH 123-456-7890 <a class=\"__cf_email__\" data-cfemail=\"fd9c91949e98bd98859c908d9198d39e9290\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a> Engine‚Ä¶\n## 2 Bob San Francisco 123 Main St, Calgary, AB 987-654-3210 <a class=\"__cf_email__\" data-cfemail=\"c9aba6ab89acb1a8a4b9a5ace7aaa6a4\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a> Marke‚Ä¶\n## 3 Charlie Tokyo 456-7890, Tokyo, NY 098-765-4332 <a class=\"__cf_email__\" data-cfemail=\"1a79727b6876737f5a7f627b776a767f34797577\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a> Finance 20‚Ä¶\n## 4 Ken Toronto 49494 Exchange St, Toronto, ON 111-232-4141 <a class=\"__cf_email__\" data-cfemail=\"7318161d3300071207005d1c0114\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a> Marketi‚Ä¶\n## 5 Steven Lima 1010 Gb st, Lima, OH 505-402-6060 <a class=\"__cf_email__\" data-cfemail=\"700304150018151e1305020209301e12115e131f1d\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a> Marketing ‚Ä¶\n## 6 Carlos Cleveland 666 Heaven dr, Cleveland, OH 909-435-1000 <a class=\"__cf_email__\" data-cfemail=\"dfbcbeadb3b0ac9fb8bab1b6aaacf1babbaa\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a> ‚Ä¶\n</pre>\n<h4 id=\"polars-2\">Polars\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#polars-2\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df \\\n    .with_columns(\n        pl.concat_str(\n            pl.col(pl.String), separator=\" \"\n        ).alias('combination_of_character')\n    ) \\\n    .select(pl.col('combination_of_character'))\n</pre><div>\n<small>shape: (6, 1)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>combination_of_character</th></tr><tr><td>str</td></tr></thead><tbody><tr><td>\"Alice New York 123 Main St, On‚Ä¶</td></tr><tr><td>\"Bob San Francisco 123 Main St,‚Ä¶</td></tr><tr><td>\"Charlie Tokyo 456-7890, Tokyo,‚Ä¶</td></tr><tr><td>\"Ken Toronto 49494 Exchange St,‚Ä¶</td></tr><tr><td>\"Steven Lima 1010 Gb st, Lima, ‚Ä¶</td></tr><tr><td>\"Carlos Cleveland 666 Heaven dr‚Ä¶</td></tr></tbody></table></div>\n<h4 id=\"tidyverse-3\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse-3\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<p>Test 2</p>\n<ul>\n<li>make a new column called <code>age_salary</code></li>\n<li>glue column <code>age</code> and <code>salary</code> together with <code>-</code> between</li>\n<li>select columns <code>name</code> and <code>age_salary</code></li>\n</ul>\n<pre>df |&gt; \n  mutate(age_salary = paste0(age, \"-\", salary)) |&gt;\n  select(name, age_salary)\n\n## # A tibble: 6 √ó 2\n##   name    age_salary\n##   &lt;chr&gt;   &lt;chr&gt;     \n## 1 Alice   30-50000  \n## 2 Bob     25-45000  \n## 3 Charlie 35-60000  \n## 4 Ken     50-20000  \n## 5 Steven  60-40000  \n## 6 Carlos  58-30000\n</pre>\n<h4 id=\"polars-3\">Polars\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#polars-3\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df \\\n    .with_columns(\n        age_salary=pl.format('{}-{}',pl.col('age'),pl.col('salary'))\n    ) \\\n    .select(pl.col('name','age_salary'))\n</pre><div>\n<small>shape: (6, 2)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>name</th><th>age_salary</th></tr><tr><td>str</td><td>str</td></tr></thead><tbody><tr><td>\"Alice\"</td><td>\"30-50000\"</td></tr><tr><td>\"Bob\"</td><td>\"25-45000\"</td></tr><tr><td>\"Charlie\"</td><td>\"35-60000\"</td></tr><tr><td>\"Ken\"</td><td>\"50-20000\"</td></tr><tr><td>\"Steven\"</td><td>\"60-40000\"</td></tr><tr><td>\"Carlos\"</td><td>\"58-30000\"</td></tr></tbody></table></div>\n<p>If it‚Äôs just 1 column, you can use this format <code>age_salary=</code> to name the column, otherwise you‚Äôd have to use <code>alias</code> to name it if there are multple columns</p>\n<h2 id=\"extract\">Extract\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#extract\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>create a new column <code>area_code_and_salary</code></li>\n<li>paste street number (extract it from <code>address</code>) with a space and the the column <code>salary</code></li>\n<li>select <code>area_code_and_salary</code></li>\n</ul>\n<h4 id=\"tidyverse-4\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse-4\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df |&gt;\n  mutate(area_code_and_salary = paste0(str_extract(address, \"\\\\d{0,5}\"), \" \", salary)) |&gt;\n  select(area_code_and_salary)\n\n## # A tibble: 6 √ó 1\n##   area_code_and_salary\n##   &lt;chr&gt;               \n## 1 123 50000           \n## 2 123 45000           \n## 3 456 60000           \n## 4 49494 20000         \n## 5 1010 40000          \n## 6 666 30000\n</pre>\n<h4 id=\"polars-4\">Polars\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#polars-4\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df \\\n    .select(\n        pl.concat_str(\n            pl.col('address').str.extract(r'^(\\d{0,5})'),\n            pl.lit(\" \"),\n            pl.col('salary')\n        ).alias('area_code_and_salary')\n    )\n</pre><div>\n<small>shape: (6, 1)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>area_code_and_salary</th></tr><tr><td>str</td></tr></thead><tbody><tr><td>\"123 50000\"</td></tr><tr><td>\"123 45000\"</td></tr><tr><td>\"456 60000\"</td></tr><tr><td>\"49494 20000\"</td></tr><tr><td>\"1010 40000\"</td></tr><tr><td>\"666 30000\"</td></tr></tbody></table></div>\n<p>Have to use <code>pl.lit(' ')</code> for any constant string</p>\n<h2 id=\"case_when\">Case_when\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#case_when\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<p>Test 1</p>\n<ul>\n<li>create a new column called <code>familiarity</code></li>\n<li>if <code>address</code> contains <code>OH</code>, then return <code>local</code></li>\n<li>if <code>address</code> contains <code>NY</code>, then return <code>foodie</code></li>\n<li>otherwise return <code>elsewhere</code></li>\n</ul>\n<h4 id=\"tidyverse-5\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse-5\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df |&gt;\n  mutate(familiarity = case_when(\n    str_detect(address, \"OH\") ~ \"local\",\n    str_detect(address, \"NY\") ~ \"foodie\",\n    TRUE ~ \"elsewhere\"\n  )) \n\n## # A tibble: 6 √ó 17\n##   name      age city      address phone_number email salary department hire_date\n##   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    \n## 1 Alice      30 New York  123 Ma‚Ä¶ 123-456-7890 alic‚Ä¶  50000 Engineeri‚Ä¶ 2010-01-‚Ä¶\n## 2 Bob        25 San Fran‚Ä¶ 123 Ma‚Ä¶ 987-654-3210 bob@‚Ä¶  45000 Marketing  2012-05-‚Ä¶\n## 3 Charlie    35 Tokyo     456-78‚Ä¶ 098-765-4332 char‚Ä¶  60000 Finance    2015-10-‚Ä¶\n## 4 Ken        50 Toronto   49494 ‚Ä¶ 111-232-4141 ken@‚Ä¶  20000 Marketing  2010-04-‚Ä¶\n## 5 Steven     60 Lima      1010 G‚Ä¶ 505-402-6060 step‚Ä¶  40000 Marketing  2009-10-‚Ä¶\n## 6 Carlos     58 Cleveland 666 He‚Ä¶ 909-435-1000 carl‚Ä¶  30000 Finance    2005-11-‚Ä¶\n## # ‚Ñπ 8 more variables: status &lt;chr&gt;, salary_increase_percentage &lt;dbl&gt;,\n## #   years_of_service &lt;dbl&gt;, bonus_amount &lt;dbl&gt;, performance_rating &lt;dbl&gt;,\n## #   performance_reviews_count &lt;dbl&gt;, performance_reviews_last_updated &lt;chr&gt;,\n## #   familiarity &lt;chr&gt;\n</pre>\n<h4 id=\"polars-5\">Polars\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#polars-5\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df \\\n    .with_columns([  \n        pl.when(pl.col('address').str.contains('OH'))\n        .then(pl.lit('local'))\n        .when(pl.col('address').str.contains('NY'))\n        .then(pl.lit('foodie'))\n        .otherwise(pl.lit('elsewhere'))\n        .alias('familiarity')\n    ])\n</pre><div>\n<small>shape: (6, 17)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>name</th><th>age</th><th>city</th><th>address</th><th>phone_number</th><th>email</th><th>salary</th><th>department</th><th>hire_date</th><th>status</th><th>salary_increase_percentage</th><th>years_of_service</th><th>bonus_amount</th><th>performance_rating</th><th>performance_reviews_count</th><th>performance_reviews_last_updated</th><th>familiarity</th></tr><tr><td>str</td><td>i64</td><td>str</td><td>str</td><td>str</td><td>str</td><td>i64</td><td>str</td><td>str</td><td>str</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>str</td><td>str</td></tr></thead><tbody><tr><td>\"Alice\"</td><td>30</td><td>\"New York\"</td><td>\"123 Main St, Ontario, OH\"</td><td>\"123-456-7890\"</td><td>\"<a class=\"__cf_email__\" data-cfemail=\"492825202a2c092c31282439252c672a2624\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\"</td><td>50000</td><td>\"Engineering\"</td><td>\"2010-01-01\"</td><td>\"Active\"</td><td>10</td><td>5</td><td>2000</td><td>4</td><td>2</td><td>\"2022-05-01\"</td><td>\"local\"</td></tr><tr><td>\"Bob\"</td><td>25</td><td>\"San Francisco\"</td><td>\"123 Main St, Calgary, AB\"</td><td>\"987-654-3210\"</td><td>\"<a class=\"__cf_email__\" data-cfemail=\"dfbdb0bd9fbaa7beb2afb3baf1bcb0b2\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\"</td><td>45000</td><td>\"Marketing\"</td><td>\"2012-05-15\"</td><td>\"Inactive\"</td><td>5</td><td>3</td><td>1500</td><td>3</td><td>1</td><td>\"2021-07-15\"</td><td>\"elsewhere\"</td></tr><tr><td>\"Charlie\"</td><td>35</td><td>\"Tokyo\"</td><td>\"456-7890, Tokyo, NY\"</td><td>\"098-765-4332\"</td><td>\"<a class=\"__cf_email__\" data-cfemail=\"80e3e8e1f2ece9e5c0e5f8e1edf0ece5aee3efed\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\"</td><td>60000</td><td>\"Finance\"</td><td>\"2015-10-01\"</td><td>\"Active\"</td><td>15</td><td>7</td><td>3000</td><td>5</td><td>3</td><td>\"2022-08-31\"</td><td>\"foodie\"</td></tr><tr><td>\"Ken\"</td><td>50</td><td>\"Toronto\"</td><td>\"49494 Exchange St, Toronto, ON\"</td><td>\"111-232-4141\"</td><td>\"<a class=\"__cf_email__\" data-cfemail=\"c3a8a6ad83b0b7a2b7b0edacb1a4\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\"</td><td>20000</td><td>\"Marketing\"</td><td>\"2010-04-01\"</td><td>\"Inactive\"</td><td>10</td><td>10</td><td>5000</td><td>5</td><td>3</td><td>\"2024-10-30\"</td><td>\"elsewhere\"</td></tr><tr><td>\"Steven\"</td><td>60</td><td>\"Lima\"</td><td>\"1010 Gb st, Lima, OH\"</td><td>\"505-402-6060\"</td><td>\"<a class=\"__cf_email__\" data-cfemail=\"9be8effeebf3fef5f8eee9e9e2dbf5f9fab5f8f4f6\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\"</td><td>40000</td><td>\"Marketing\"</td><td>\"2009-10-30\"</td><td>\"Active\"</td><td>10</td><td>10</td><td>3000</td><td>4</td><td>4</td><td>\"2023-01-02\"</td><td>\"local\"</td></tr><tr><td>\"Carlos\"</td><td>58</td><td>\"Cleveland\"</td><td>\"666 Heaven dr, Cleveland, OH\"</td><td>\"909-435-1000\"</td><td>\"<a class=\"__cf_email__\" data-cfemail=\"c5a6a4b7a9aab685a2a0abacb0b6eba0a1b0\" href=\"/cdn-cgi/l/email-protection\">[email¬†protected]</a>\"</td><td>30000</td><td>\"Finance\"</td><td>\"2005-11-12\"</td><td>\"Active\"</td><td>5</td><td>12</td><td>2000</td><td>4</td><td>5</td><td>\"2024-12-12\"</td><td>\"local\"</td></tr></tbody></table></div>\n<p>Test 2</p>\n<ul>\n<li>convert <code>name</code> data to lowercase</li>\n<li>create new column called <code>email_name</code> and extract <code>email</code> before the <code>@</code></li>\n<li>select columns that starts with <code>name</code> or end with <code>name</code></li>\n<li>create a new column called <code>same?</code></li>\n<li>if <code>name</code> and <code>email_name</code> is the same, then return <code>yes</code></li>\n<li>otherwise return <code>no</code></li>\n</ul>\n<h4 id=\"tidyverse-6\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse-6\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df |&gt;\n  mutate(\n    name = tolower(name),\n    email_name = str_extract(email, \"^([\\\\d\\\\w]+)@\", group = 1)\n  ) |&gt;\n  select(starts_with(\"name\") | ends_with(\"name\")) |&gt;\n  mutate(`same?` = case_when(\n    name == email_name ~ \"yes\",\n    TRUE ~ \"no\"))\n\n## # A tibble: 6 √ó 3\n##   name    email_name   `same?`\n##   &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;  \n## 1 alice   alice        yes    \n## 2 bob     bob          yes    \n## 3 charlie charlie      yes    \n## 4 ken     ken          yes    \n## 5 steven  stephencurry no     \n## 6 carlos  carlos       yes\n</pre>\n<h4 id=\"polars-6\">Polars\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#polars-6\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df \\\n    .with_columns(\n        [\n        pl.col('name').str.to_lowercase(),    \n        pl.col('email').str.extract(r'^([\\d\\w]+)@', group_index = 1)\n        .alias('email_name')\n        ]\n    ) \\\n    .select([\n        pl.col('^name|.*name$'),\n        pl.when(\n            pl.col('name') == pl.col('email_name')).then(pl.lit('yes'))\n            .otherwise(pl.lit('no'))\n            .alias('same?')\n    ]\n        )\n</pre><div>\n<small>shape: (6, 3)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>name</th><th>email_name</th><th>same?</th></tr><tr><td>str</td><td>str</td><td>str</td></tr></thead><tbody><tr><td>\"alice\"</td><td>\"alice\"</td><td>\"yes\"</td></tr><tr><td>\"bob\"</td><td>\"bob\"</td><td>\"yes\"</td></tr><tr><td>\"charlie\"</td><td>\"charlie\"</td><td>\"yes\"</td></tr><tr><td>\"ken\"</td><td>\"ken\"</td><td>\"yes\"</td></tr><tr><td>\"steven\"</td><td>\"stephencurry\"</td><td>\"no\"</td></tr><tr><td>\"carlos\"</td><td>\"carlos\"</td><td>\"yes\"</td></tr></tbody></table></div>\n<p>Learnt that apparently we cannot use <code>look forward or backward</code> in polars. Such as <code>.*(?=@)</code> to capture the <code>email_name</code></p>\n<h2 id=\"group_by-shift-forward_fill\">Group_by, Shift, Forward_Fill\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#group_by-shift-forward_fill\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>group by <code>department</code> column</li>\n<li>summarize by selecting <code>name</code>, new column <code>salary_shift</code> with conditions:\n<ul>\n<li>if the department only has 1 row of <code>salary</code> data, do not <code>shift</code> salary</li>\n<li>if the department has more than 1 row of <code>salary</code> data, <code>shift by -1</code> of salary column</li>\n<li>reason: there was a mistake in entering data for those with more than 1 row of data, apparently the actualy salary data is 1 row more</li>\n</ul>\n</li>\n<li>then forward fill the <code>salary_shift</code> with the number prior in the same group</li>\n</ul>\n<h4 id=\"tidyverse-7\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse-7\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df |&gt;\n  group_by(department) |&gt;\n  summarize(\n    name = name,\n    salary_shift = case_when(\n      n() == 1 ~ salary,\n      TRUE ~ lead(salary)\n    )\n  ) |&gt;\n fill(salary_shift, .direction = \"down\")\n\n## Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in\n## dplyr 1.1.0.\n## ‚Ñπ Please use `reframe()` instead.\n## ‚Ñπ When switching from `summarise()` to `reframe()`, remember that `reframe()`\n##   always returns an ungrouped data frame and adjust accordingly.\n## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was\n## generated.\n\n## `summarise()` has grouped output by 'department'. You can override using the\n## `.groups` argument.\n\n## # A tibble: 6 √ó 3\n## # Groups:   department [3]\n##   department  name    salary_shift\n##   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;\n## 1 Engineering Alice          50000\n## 2 Finance     Charlie        30000\n## 3 Finance     Carlos         30000\n## 4 Marketing   Bob            20000\n## 5 Marketing   Ken            40000\n## 6 Marketing   Steven         40000\n</pre>\n<h4 id=\"polars-7\">Polars\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#polars-7\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df \\\n.group_by('department') \\\n.agg(\n    pl.col('name'),\n    pl.when(pl.col('salary').len()==1).then(pl.col('salary'))\n    .otherwise(pl.col('salary').shift(-1))\n    .alias('salary_shift')) \\\n.explode('name','salary_shift') \\\n.with_columns(\n    pl.col('salary_shift').forward_fill())\n</pre><div>\n<small>shape: (6, 3)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>department</th><th>name</th><th>salary_shift</th></tr><tr><td>str</td><td>str</td><td>i64</td></tr></thead><tbody><tr><td>\"Engineering\"</td><td>\"Alice\"</td><td>50000</td></tr><tr><td>\"Finance\"</td><td>\"Charlie\"</td><td>30000</td></tr><tr><td>\"Finance\"</td><td>\"Carlos\"</td><td>30000</td></tr><tr><td>\"Marketing\"</td><td>\"Bob\"</td><td>20000</td></tr><tr><td>\"Marketing\"</td><td>\"Ken\"</td><td>40000</td></tr><tr><td>\"Marketing\"</td><td>\"Steven\"</td><td>40000</td></tr></tbody></table></div>\n<p>Apparently polars would turn the column into a nested dataframe (list) when grouped and can‚Äôt do <code>fill</code> when it‚Äôs in list? will have to <code>unnest</code> by <code>explode</code> before <code>fill</code> can be used. Unless of coure if you merge the <code>fill</code> in the same line when shifting, such as</p>\n<pre>df \\\n.group_by('department') \\\n.agg(\n    pl.col('name'),\n    pl.when(pl.col('salary').len()==1).then(pl.col('salary'))\n    .otherwise(pl.col('salary').shift(-1))\n    .forward_fill() \n    .alias('salary_shift'))\n</pre>\n<h4 id=\"is-there-an-easier-way-to-unnest-without-typing-all-of-the-columns-in-polars\">Is There An Easier Way to <code>Unnest</code> without Typing ALL of the columns in Polars?\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#is-there-an-easier-way-to-unnest-without-typing-all-of-the-columns-in-polars\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<p>Yes! I believe <code>pl.col, pl.select, pl.filter</code> all take a list of conditions. First create a list of columns you want to unnest, then use <code>pl.col</code> to select them.</p>\n<pre>dt = [pl.List(pl.Int64),pl.List(pl.String)]\n\ndf \\\n    .group_by('department', maintain_order=True) \\\n    .agg(  \n        pl.col('name'),\n        pl.col('salary_increase_percentage'),\n        salary_shift = pl.when(pl.col('salary').count() == 1)  \n            .then(pl.col('salary'))\n            .otherwise(pl.col('salary').shift(-1))\n    ) \\\n    .explode(pl.col(dt)) \\\n    .with_columns(\n        pl.col('salary_shift').forward_fill()\n    ) \\\n    .with_columns(\n        new_raise = pl.col('salary_shift') * (1+pl.col('salary_increase_percentage')/100)\n    )\n</pre><div>\n<small>shape: (6, 5)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>department</th><th>name</th><th>salary_increase_percentage</th><th>salary_shift</th><th>new_raise</th></tr><tr><td>str</td><td>str</td><td>i64</td><td>i64</td><td>f64</td></tr></thead><tbody><tr><td>\"Engineering\"</td><td>\"Alice\"</td><td>10</td><td>50000</td><td>55000.0</td></tr><tr><td>\"Marketing\"</td><td>\"Bob\"</td><td>5</td><td>20000</td><td>21000.0</td></tr><tr><td>\"Marketing\"</td><td>\"Ken\"</td><td>10</td><td>40000</td><td>44000.0</td></tr><tr><td>\"Marketing\"</td><td>\"Steven\"</td><td>10</td><td>40000</td><td>44000.0</td></tr><tr><td>\"Finance\"</td><td>\"Charlie\"</td><td>15</td><td>30000</td><td>34500.0</td></tr><tr><td>\"Finance\"</td><td>\"Carlos\"</td><td>5</td><td>30000</td><td>31500.0</td></tr></tbody></table></div>\n<h2 id=\"merge--join\">Merge / Join\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#merge--join\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>Create another mock data with dataframe called <code>df_dept</code> with columns <code>department</code> and <code>dept_id</code></li>\n</ul>\n<h4 id=\"tidyverse-8\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse-8\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df_dept &lt;- tibble(\n  department = c(\"Engineering\", \"Marketing\", \"Finance\"),\n  dept_id = c(30, 25, 20)\n)\n</pre>\n<h4 id=\"polars-8\">Polars\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#polars-8\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df_dept = pl.DataFrame({\n    \"department\": [\"Engineering\", \"Marketing\", \"Finance\"],\n    \"dept_id\": [30, 25, 20]\n})\n</pre><ul>\n<li>left_join <code>df</code> with <code>df_dept</code></li>\n<li>create new column <code>employee_id</code> by pasting:\n<ul>\n<li>{dept_id}-{random 7 digit numbers}</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"tidyverse-9\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse-9\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df |&gt;\n  left_join(df_dept, by = \"department\") |&gt;\n  select(name, dept_id) |&gt;\n  mutate(employee_id = map_chr(dept_id, ~paste0(.x, \"-\", sample(1000000:9999999, 1))))\n\n## # A tibble: 6 √ó 3\n##   name    dept_id employee_id\n##   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;      \n## 1 Alice        30 30-1694470 \n## 2 Bob          25 25-1696036 \n## 3 Charlie      20 20-4463080 \n## 4 Ken          25 25-6942432 \n## 5 Steven       25 25-3012223 \n## 6 Carlos       20 20-8705991\n</pre>\n<h4 id=\"polars-9\">Polars\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#polars-9\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>import random\n\ndf \\\n    .join(df_dept, on=\"department\") \\\n    .select(['name','dept_id']) \\\n    .with_columns(\n        employee_id = pl.format(\n          '{}-{}',\n          'dept_id',\n          pl.Series([\n            random.randint(100000, 999999) for _ in range(len(df))\n            ])\n            )\n    )\n</pre><div>\n<small>shape: (6, 3)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>name</th><th>dept_id</th><th>employee_id</th></tr><tr><td>str</td><td>i64</td><td>str</td></tr></thead><tbody><tr><td>\"Alice\"</td><td>30</td><td>\"30-832410\"</td></tr><tr><td>\"Bob\"</td><td>25</td><td>\"25-883365\"</td></tr><tr><td>\"Charlie\"</td><td>20</td><td>\"20-484404\"</td></tr><tr><td>\"Ken\"</td><td>25</td><td>\"25-421175\"</td></tr><tr><td>\"Steven\"</td><td>25</td><td>\"25-670538\"</td></tr><tr><td>\"Carlos\"</td><td>20</td><td>\"20-638378\"</td></tr></tbody></table></div>\n<p>there is a function called <code>map_elements</code> in polars but the documentation stated that it‚Äôs inefficient, essentially using a for loop. I‚Äôm not entirely certain if list comprehension above is any more efficient. Another probably more efficent way of doing this is 2 separate process. The random number generation on another dataframe, then merge it.</p>\n<h2 id=\"to-dummies-pivot_longer--pivot_wider\">To Dummies, Pivot_longer / Pivot_wider\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#to-dummies-pivot_longer--pivot_wider\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>create dummy variables for <code>department</code> using <code>name</code> as index or id</li>\n</ul>\n<h4 id=\"tidyverse-10\">Tidyverse\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#tidyverse-10\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df |&gt;\n  select(name, department) |&gt;\n  pivot_wider(id_cols = \"name\", names_from = \"department\", values_from = \"department\", values_fill = 0, values_fn = length, names_prefix = \"department_\")\n\n## # A tibble: 6 √ó 4\n##   name    department_Engineering department_Marketing department_Finance\n##   &lt;chr&gt;                    &lt;int&gt;                &lt;int&gt;              &lt;int&gt;\n## 1 Alice                        1                    0                  0\n## 2 Bob                          0                    1                  0\n## 3 Charlie                      0                    0                  1\n## 4 Ken                          0                    1                  0\n## 5 Steven                       0                    1                  0\n## 6 Carlos                       0                    0                  1\n</pre>\n<h4 id=\"polars---to_dummies\">Polars - <code>to_dummies</code>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#polars---to_dummies\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df \\\n    .select(['name','department']) \\\n    .to_dummies(columns = 'department') \n</pre><div>\n<small>shape: (6, 4)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>name</th><th>department_Engineering</th><th>department_Finance</th><th>department_Marketing</th></tr><tr><td>str</td><td>u8</td><td>u8</td><td>u8</td></tr></thead><tbody><tr><td>\"Alice\"</td><td>1</td><td>0</td><td>0</td></tr><tr><td>\"Bob\"</td><td>0</td><td>0</td><td>1</td></tr><tr><td>\"Charlie\"</td><td>0</td><td>1</td><td>0</td></tr><tr><td>\"Ken\"</td><td>0</td><td>0</td><td>1</td></tr><tr><td>\"Steven\"</td><td>0</td><td>0</td><td>1</td></tr><tr><td>\"Carlos\"</td><td>0</td><td>1</td><td>0</td></tr></tbody></table></div>\n<h4 id=\"polars---pivot\">Polars - <code>pivot</code>\n<a href=\"https://www.kenkoonwong.com/blog/polars/#polars---pivot\" rel=\"nofollow\" target=\"_blank\"></a>\n</h4>\n<pre>df \\\n    .select(['name','address']) \\\n    .with_columns(\n        state = pl.col('address').str.extract(r'([A-Z]{2})$')\n    ) \\\n    .select('name','state') \\\n    .pivot(on = 'state', index = 'name', values='state', aggregate_function='len') \\\n    .with_columns(\n        pl.col(pl.UInt32).fill_null(0)\n    ) \n</pre><div>\n<small>shape: (6, 5)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>name</th><th>OH</th><th>AB</th><th>NY</th><th>ON</th></tr><tr><td>str</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td></tr></thead><tbody><tr><td>\"Alice\"</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>\"Bob\"</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>\"Charlie\"</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>\"Ken\"</td><td>0</td><td>0</td><td>0</td><td>1</td></tr><tr><td>\"Steven\"</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>\"Carlos\"</td><td>1</td><td>0</td><td>0</td><td>0</td></tr></tbody></table></div>\n<p>Essentially, <code>pivot_wider</code> is Polars‚Äô <code>pivot</code>. Whereas <code>pivot_longer</code> is Polars‚Äô <code>unpivot</code></p>\n<h2 id=\"helpful-resources\">Helpful Resources\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#helpful-resources\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li>\n<a href=\"https://docs.pola.rs/api/python/stable/reference/index.html\" rel=\"nofollow\" target=\"_blank\">Polars Python API documentation</a></li>\n<li>\n<a href=\"https://franzdiebold.github.io/polars-cheat-sheet/Polars_cheat_sheet.pdf\" rel=\"nofollow\" target=\"_blank\">Cheat sheet</a></li>\n<li>\n<a href=\"https://ddotta.github.io/cookbook-rpolars/\" rel=\"nofollow\" target=\"_blank\">cookbook Polars for R</a></li>\n</ul>\n<h2 id=\"lessons-learnt\">Lessons Learnt:\n  <a href=\"https://www.kenkoonwong.com/blog/polars/#lessons-learnt\" rel=\"nofollow\" target=\"_blank\"><svg aria-hidden=\"true\" class=\"anchor-symbol\" height=\"26\" viewbox=\"0 0 22 22\" width=\"26\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n<path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n</svg></a>\n</h2>\n<ul>\n<li><code>stringr::str_extract</code> has the parameter <code>group</code></li>\n<li>We cannot use <code>look forward or backward</code> in polars</li>\n<li><code>polars</code> also has <code>selector</code> for looking at <code>column names</code> more efficiently</li>\n<li>lots of trial and error</li>\n<li>going to try doing pure <code>Polars</code> for a month! Wish me luck!</li>\n</ul>\n<p>If you like this article:</p>\n<ul>\n<li>please feel free to send me a \n<a href=\"https://www.kenkoonwong.com/blog/\" rel=\"nofollow\" target=\"_blank\">comment or visit my other blogs</a></li>\n<li>please feel free to follow me on \n<a href=\"https://bsky.app/profile/kenkoonwong.bsky.social\" rel=\"nofollow\" target=\"_blank\">BlueSky</a>, \n<a href=\"https://twitter.com/kenkoonwong/\" rel=\"nofollow\" target=\"_blank\">twitter</a>, \n<a href=\"https://github.com/kenkoonwong/\" rel=\"nofollow\" target=\"_blank\">GitHub</a> or \n<a href=\"https://med-mastodon.com/@kenkoonwong\" rel=\"nofollow\" target=\"_blank\">Mastodon</a></li>\n<li>if you would like collaborate please feel free to \n<a href=\"https://www.kenkoonwong.com/contact/\" rel=\"nofollow\" target=\"_blank\">contact me</a></li>\n</ul>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://www.kenkoonwong.com/blog/polars/\"> r on Everyday Is A School Day</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
    "main_text": "Tidyverse ü™êto Polars üêª‚Äç‚ùÑÔ∏è: My Notes\nPosted on\nDecember 20, 2024\nby\nr on Everyday Is A School Day\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nr on Everyday Is A School Day\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nI found\nPolars\nsyntax is quite similar to\ndplyr\n. And the way that we can chain the functions makes it even more familiar! It was fun learning the nuances, now it‚Äôs time to put them into practice! Wish me luck! üçÄ\nMotivation\nIn preparation for using more Python in 2025 and also to speak more of the same language with our datathon team, I‚Äôve decided to practice\nPolars\nin Python thinking in R first. Below is my notes to myself, hopefully I‚Äôll be able to refer back and improve this more as I use more of this for the next month. Wish me luck!\nObjectives\nCreate A Dataframe\nFilter, Select, Summarize, Across\nMutate, Paste\nExtract\nCase_when\nJoin / Merge\nTo Dummies/Pivot/Unpivot\nHelpful Resources\nLessons Learnt\nCreate A Dataframe\nTidyverse\nlibrary(tidyverse)\nlibrary(reticulate)\nuse_virtualenv('path/to/your/environment')\n\ndf <- tibble(\n  name = c(\"Alice\", \"Bob\", \"Charlie\", \"Ken\", \"Steven\", \"Carlos\"),\n  age = c(30, 25, 35, 50, 60, 58),\n  city = c(\"New York\", \"San Francisco\", \"Tokyo\", \"Toronto\", \"Lima\", \"Cleveland\"),\n  address = c(\"123 Main St, Ontario, OH\", \"123 Main St, Calgary, AB\", \"456-7890, Tokyo, NY\",\n              \"49494 Exchange St, Toronto, ON\", \"1010 Gb st, Lima, OH\", \"666 Heaven dr, Cleveland, OH\"),\n  phone_number = c(\"123-456-7890\", \"987-654-3210\", \"098-765-4332\", \"111-232-4141\", \n                  \"505-402-6060\", \"909-435-1000\"),\n  email = c(\"\n[email¬†protected]\n\", \"\n[email¬†protected]\n\", \"\n[email¬†protected]\n\", \n            \"\n[email¬†protected]\n\", \"\n[email¬†protected]\n\", \"\n[email¬†protected]\n\"),\n  salary = c(50000, 45000, 60000, 20000, 40000, 30000),\n  department = c(\"Engineering\", \"Marketing\", \"Finance\", \"Marketing\", \"Marketing\", \"Finance\"),\n  hire_date = c(\"2010-01-01\", \"2012-05-15\", \"2015-10-01\", \"2010-04-01\", \n                \"2009-10-30\", \"2005-11-12\"),\n  status = c(\"Active\", \"Inactive\", \"Active\", \"Inactive\", \"Active\", \"Active\"),\n  salary_increase_percentage = c(10, 5, 15, 10, 10, 5),\n  years_of_service = c(5, 3, 7, 10, 10, 12),\n  bonus_amount = c(2000, 1500, 3000, 5000, 3000, 2000),\n  performance_rating = c(4, 3, 5, 5, 4, 4),\n  performance_reviews_count = c(2, 1, 3, 3, 4, 5),\n  performance_reviews_last_updated = c(\"2022-05-01\", \"2021-07-15\", \"2022-08-31\",\n                                     \"2024-10-30\", \"2023-01-02\", \"2024-12-12\")\n)\nPolars\nimport polars as pl\n\ndf = pl.DataFrame({\n    \"name\": [\"Alice\", \"Bob\", \"Charlie\",\"Ken\",\"Steven\",\"Carlos\"],\n    \"age\": [30, 25, 35, 50, 60, 58],\n    \"city\": [\"New York\", \"San Francisco\", \"Tokyo\",\"Toronto\",\"Lima\",\"Cleveland\"],\n    \"address\" : [\"123 Main St, Ontario, OH\",\"123 Main St, Calgary, AB\", \"456-7890, Tokyo, NY\",\"49494 Exchange St, Toronto, ON\",\"1010 Gb st, Lima, OH\",\"666 Heaven dr, Cleveland, OH\"],\n    \"phone_number\" : [\"123-456-7890\", \"987-654-3210\", \"098-765-4332\",\"111-232-4141\",\"505-402-6060\",\"909-435-1000\"],\n    \"email\" : [\"\n[email¬†protected]\n\", \"\n[email¬†protected]\n\", \"\n[email¬†protected]\n\",\"\n[email¬†protected]\n\",\"\n[email¬†protected]\n\",\"\n[email¬†protected]\n\"],\n    \"salary\" : [50000, 45000, 60000,20000,40000,30000],\n    \"department\" : [\"Engineering\", \"Marketing\", \"Finance\",\"Marketing\",\"Marketing\",\"Finance\"],\n    \"hire_date\" : [\"2010-01-01\", \"2012-05-15\", \"2015-10-01\", \"2010-04-01\",\"2009-10-30\",\"2005-11-12\"],\n    \"status\" : [\"Active\", \"Inactive\", \"Active\",\"Inactive\",\"Active\",\"Active\"],\n    \"salary_increase_percentage\" : [10, 5, 15,10,10,5],\n    \"years_of_service\" : [5, 3, 7,10,10,12],\n    \"bonus_amount\" : [2000, 1500, 3000,5000,3000,2000],\n    \"performance_rating\" : [4, 3, 5, 5, 4, 4],\n    \"performance_reviews_count\" : [2, 1, 3, 3, 4, 5],\n    \"performance_reviews_last_updated\" : [\"2022-05-01\", \"2021-07-15\", \"2022-08-31\", \"2024-10-30\",\"2023-01-02\",\"2024-12-12\"]\n})\nFilter, Select, Summarize, Across\nFilter records where age is greater and equal to 30\nreturn columns with name:address, and columns that starts with performance* and salary*\nreturn mean of values across all numeric data\nTidyverse\ndf |>\n  filter(age >= 30) |>\n  select(1:3, starts_with(\"performance\"), starts_with(\"salary\")) |> \n  summarize(across(.cols = where(is.numeric), .fns = mean, .names = \"mean_{.col}\"))\n\n## # A tibble: 1 √ó 5\n##   mean_age mean_performance_rating mean_performance_reviews_count mean_salary\n##      <dbl>                   <dbl>                          <dbl>       <dbl>\n## 1     46.6                     4.4                            3.4       40000\n## # ‚Ñπ 1 more variable: mean_salary_increase_percentage <dbl>\nPolars\ndf \\\n    .filter(pl.col('age') >= 30) \\\n    .select(df.columns[0:4]+['^performance.*$','^salary.*$']) \\\n    .select(pl.col(pl.Int64).mean().name.prefix('mean_'))\nshape: (1, 5)\nmean_age\nmean_performance_rating\nmean_performance_reviews_count\nmean_salary\nmean_salary_increase_percentage\nf64\nf64\nf64\nf64\nf64\n46.6\n4.4\n3.4\n40000.0\n10.0\nFor some reason, for the regex above, I have to use\n^\nand\n$\nsandwiched to return those column nams that I want to include. bizzare.\nMutate, Paste\nTest 1\nmake a new column called\ncombination_of_character\npaste all columns with character datatype separated by ``, a space\nselect the created column\nTidyverse\ndf |>\n  rowwise() |>\n  transmute(combination_of_character = paste(\n      across(where(is.character)), \n      collapse = \" \"\n    )) |>\n  select(combination_of_character)\n\n## # A tibble: 6 √ó 1\n## # Rowwise: \n##   combination_of_character                                                      \n##   <chr>                                                                         \n## 1 Alice New York 123 Main St, Ontario, OH 123-456-7890\n[email¬†protected]\nEngine‚Ä¶\n## 2 Bob San Francisco 123 Main St, Calgary, AB 987-654-3210\n[email¬†protected]\nMarke‚Ä¶\n## 3 Charlie Tokyo 456-7890, Tokyo, NY 098-765-4332\n[email¬†protected]\nFinance 20‚Ä¶\n## 4 Ken Toronto 49494 Exchange St, Toronto, ON 111-232-4141\n[email¬†protected]\nMarketi‚Ä¶\n## 5 Steven Lima 1010 Gb st, Lima, OH 505-402-6060\n[email¬†protected]\nMarketing ‚Ä¶\n## 6 Carlos Cleveland 666 Heaven dr, Cleveland, OH 909-435-1000\n[email¬†protected]\n‚Ä¶\nPolars\ndf \\\n    .with_columns(\n        pl.concat_str(\n            pl.col(pl.String), separator=\" \"\n        ).alias('combination_of_character')\n    ) \\\n    .select(pl.col('combination_of_character'))\nshape: (6, 1)\ncombination_of_character\nstr\n\"Alice New York 123 Main St, On‚Ä¶\n\"Bob San Francisco 123 Main St,‚Ä¶\n\"Charlie Tokyo 456-7890, Tokyo,‚Ä¶\n\"Ken Toronto 49494 Exchange St,‚Ä¶\n\"Steven Lima 1010 Gb st, Lima, ‚Ä¶\n\"Carlos Cleveland 666 Heaven dr‚Ä¶\nTidyverse\nTest 2\nmake a new column called\nage_salary\nglue column\nage\nand\nsalary\ntogether with\n-\nbetween\nselect columns\nname\nand\nage_salary\ndf |> \n  mutate(age_salary = paste0(age, \"-\", salary)) |>\n  select(name, age_salary)\n\n## # A tibble: 6 √ó 2\n##   name    age_salary\n##   <chr>   <chr>     \n## 1 Alice   30-50000  \n## 2 Bob     25-45000  \n## 3 Charlie 35-60000  \n## 4 Ken     50-20000  \n## 5 Steven  60-40000  \n## 6 Carlos  58-30000\nPolars\ndf \\\n    .with_columns(\n        age_salary=pl.format('{}-{}',pl.col('age'),pl.col('salary'))\n    ) \\\n    .select(pl.col('name','age_salary'))\nshape: (6, 2)\nname\nage_salary\nstr\nstr\n\"Alice\"\n\"30-50000\"\n\"Bob\"\n\"25-45000\"\n\"Charlie\"\n\"35-60000\"\n\"Ken\"\n\"50-20000\"\n\"Steven\"\n\"60-40000\"\n\"Carlos\"\n\"58-30000\"\nIf it‚Äôs just 1 column, you can use this format\nage_salary=\nto name the column, otherwise you‚Äôd have to use\nalias\nto name it if there are multple columns\nExtract\ncreate a new column\narea_code_and_salary\npaste street number (extract it from\naddress\n) with a space and the the column\nsalary\nselect\narea_code_and_salary\nTidyverse\ndf |>\n  mutate(area_code_and_salary = paste0(str_extract(address, \"\\\\d{0,5}\"), \" \", salary)) |>\n  select(area_code_and_salary)\n\n## # A tibble: 6 √ó 1\n##   area_code_and_salary\n##   <chr>               \n## 1 123 50000           \n## 2 123 45000           \n## 3 456 60000           \n## 4 49494 20000         \n## 5 1010 40000          \n## 6 666 30000\nPolars\ndf \\\n    .select(\n        pl.concat_str(\n            pl.col('address').str.extract(r'^(\\d{0,5})'),\n            pl.lit(\" \"),\n            pl.col('salary')\n        ).alias('area_code_and_salary')\n    )\nshape: (6, 1)\narea_code_and_salary\nstr\n\"123 50000\"\n\"123 45000\"\n\"456 60000\"\n\"49494 20000\"\n\"1010 40000\"\n\"666 30000\"\nHave to use\npl.lit(' ')\nfor any constant string\nCase_when\nTest 1\ncreate a new column called\nfamiliarity\nif\naddress\ncontains\nOH\n, then return\nlocal\nif\naddress\ncontains\nNY\n, then return\nfoodie\notherwise return\nelsewhere\nTidyverse\ndf |>\n  mutate(familiarity = case_when(\n    str_detect(address, \"OH\") ~ \"local\",\n    str_detect(address, \"NY\") ~ \"foodie\",\n    TRUE ~ \"elsewhere\"\n  )) \n\n## # A tibble: 6 √ó 17\n##   name      age city      address phone_number email salary department hire_date\n##   <chr>   <dbl> <chr>     <chr>   <chr>        <chr>  <dbl> <chr>      <chr>    \n## 1 Alice      30 New York  123 Ma‚Ä¶ 123-456-7890 alic‚Ä¶  50000 Engineeri‚Ä¶ 2010-01-‚Ä¶\n## 2 Bob        25 San Fran‚Ä¶ 123 Ma‚Ä¶ 987-654-3210 bob@‚Ä¶  45000 Marketing  2012-05-‚Ä¶\n## 3 Charlie    35 Tokyo     456-78‚Ä¶ 098-765-4332 char‚Ä¶  60000 Finance    2015-10-‚Ä¶\n## 4 Ken        50 Toronto   49494 ‚Ä¶ 111-232-4141 ken@‚Ä¶  20000 Marketing  2010-04-‚Ä¶\n## 5 Steven     60 Lima      1010 G‚Ä¶ 505-402-6060 step‚Ä¶  40000 Marketing  2009-10-‚Ä¶\n## 6 Carlos     58 Cleveland 666 He‚Ä¶ 909-435-1000 carl‚Ä¶  30000 Finance    2005-11-‚Ä¶\n## # ‚Ñπ 8 more variables: status <chr>, salary_increase_percentage <dbl>,\n## #   years_of_service <dbl>, bonus_amount <dbl>, performance_rating <dbl>,\n## #   performance_reviews_count <dbl>, performance_reviews_last_updated <chr>,\n## #   familiarity <chr>\nPolars\ndf \\\n    .with_columns([  \n        pl.when(pl.col('address').str.contains('OH'))\n        .then(pl.lit('local'))\n        .when(pl.col('address').str.contains('NY'))\n        .then(pl.lit('foodie'))\n        .otherwise(pl.lit('elsewhere'))\n        .alias('familiarity')\n    ])\nshape: (6, 17)\nname\nage\ncity\naddress\nphone_number\nemail\nsalary\ndepartment\nhire_date\nstatus\nsalary_increase_percentage\nyears_of_service\nbonus_amount\nperformance_rating\nperformance_reviews_count\nperformance_reviews_last_updated\nfamiliarity\nstr\ni64\nstr\nstr\nstr\nstr\ni64\nstr\nstr\nstr\ni64\ni64\ni64\ni64\ni64\nstr\nstr\n\"Alice\"\n30\n\"New York\"\n\"123 Main St, Ontario, OH\"\n\"123-456-7890\"\n\"\n[email¬†protected]\n\"\n50000\n\"Engineering\"\n\"2010-01-01\"\n\"Active\"\n10\n5\n2000\n4\n2\n\"2022-05-01\"\n\"local\"\n\"Bob\"\n25\n\"San Francisco\"\n\"123 Main St, Calgary, AB\"\n\"987-654-3210\"\n\"\n[email¬†protected]\n\"\n45000\n\"Marketing\"\n\"2012-05-15\"\n\"Inactive\"\n5\n3\n1500\n3\n1\n\"2021-07-15\"\n\"elsewhere\"\n\"Charlie\"\n35\n\"Tokyo\"\n\"456-7890, Tokyo, NY\"\n\"098-765-4332\"\n\"\n[email¬†protected]\n\"\n60000\n\"Finance\"\n\"2015-10-01\"\n\"Active\"\n15\n7\n3000\n5\n3\n\"2022-08-31\"\n\"foodie\"\n\"Ken\"\n50\n\"Toronto\"\n\"49494 Exchange St, Toronto, ON\"\n\"111-232-4141\"\n\"\n[email¬†protected]\n\"\n20000\n\"Marketing\"\n\"2010-04-01\"\n\"Inactive\"\n10\n10\n5000\n5\n3\n\"2024-10-30\"\n\"elsewhere\"\n\"Steven\"\n60\n\"Lima\"\n\"1010 Gb st, Lima, OH\"\n\"505-402-6060\"\n\"\n[email¬†protected]\n\"\n40000\n\"Marketing\"\n\"2009-10-30\"\n\"Active\"\n10\n10\n3000\n4\n4\n\"2023-01-02\"\n\"local\"\n\"Carlos\"\n58\n\"Cleveland\"\n\"666 Heaven dr, Cleveland, OH\"\n\"909-435-1000\"\n\"\n[email¬†protected]\n\"\n30000\n\"Finance\"\n\"2005-11-12\"\n\"Active\"\n5\n12\n2000\n4\n5\n\"2024-12-12\"\n\"local\"\nTest 2\nconvert\nname\ndata to lowercase\ncreate new column called\nemail_name\nand extract\nemail\nbefore the\n@\nselect columns that starts with\nname\nor end with\nname\ncreate a new column called\nsame?\nif\nname\nand\nemail_name\nis the same, then return\nyes\notherwise return\nno\nTidyverse\ndf |>\n  mutate(\n    name = tolower(name),\n    email_name = str_extract(email, \"^([\\\\d\\\\w]+)@\", group = 1)\n  ) |>\n  select(starts_with(\"name\") | ends_with(\"name\")) |>\n  mutate(`same?` = case_when(\n    name == email_name ~ \"yes\",\n    TRUE ~ \"no\"))\n\n## # A tibble: 6 √ó 3\n##   name    email_name   `same?`\n##   <chr>   <chr>        <chr>  \n## 1 alice   alice        yes    \n## 2 bob     bob          yes    \n## 3 charlie charlie      yes    \n## 4 ken     ken          yes    \n## 5 steven  stephencurry no     \n## 6 carlos  carlos       yes\nPolars\ndf \\\n    .with_columns(\n        [\n        pl.col('name').str.to_lowercase(),    \n        pl.col('email').str.extract(r'^([\\d\\w]+)@', group_index = 1)\n        .alias('email_name')\n        ]\n    ) \\\n    .select([\n        pl.col('^name|.*name$'),\n        pl.when(\n            pl.col('name') == pl.col('email_name')).then(pl.lit('yes'))\n            .otherwise(pl.lit('no'))\n            .alias('same?')\n    ]\n        )\nshape: (6, 3)\nname\nemail_name\nsame?\nstr\nstr\nstr\n\"alice\"\n\"alice\"\n\"yes\"\n\"bob\"\n\"bob\"\n\"yes\"\n\"charlie\"\n\"charlie\"\n\"yes\"\n\"ken\"\n\"ken\"\n\"yes\"\n\"steven\"\n\"stephencurry\"\n\"no\"\n\"carlos\"\n\"carlos\"\n\"yes\"\nLearnt that apparently we cannot use\nlook forward or backward\nin polars. Such as\n.*(?=@)\nto capture the\nemail_name\nGroup_by, Shift, Forward_Fill\ngroup by\ndepartment\ncolumn\nsummarize by selecting\nname\n, new column\nsalary_shift\nwith conditions:\nif the department only has 1 row of\nsalary\ndata, do not\nshift\nsalary\nif the department has more than 1 row of\nsalary\ndata,\nshift by -1\nof salary column\nreason: there was a mistake in entering data for those with more than 1 row of data, apparently the actualy salary data is 1 row more\nthen forward fill the\nsalary_shift\nwith the number prior in the same group\nTidyverse\ndf |>\n  group_by(department) |>\n  summarize(\n    name = name,\n    salary_shift = case_when(\n      n() == 1 ~ salary,\n      TRUE ~ lead(salary)\n    )\n  ) |>\n fill(salary_shift, .direction = \"down\")\n\n## Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in\n## dplyr 1.1.0.\n## ‚Ñπ Please use `reframe()` instead.\n## ‚Ñπ When switching from `summarise()` to `reframe()`, remember that `reframe()`\n##   always returns an ungrouped data frame and adjust accordingly.\n## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was\n## generated.\n\n## `summarise()` has grouped output by 'department'. You can override using the\n## `.groups` argument.\n\n## # A tibble: 6 √ó 3\n## # Groups:   department [3]\n##   department  name    salary_shift\n##   <chr>       <chr>          <dbl>\n## 1 Engineering Alice          50000\n## 2 Finance     Charlie        30000\n## 3 Finance     Carlos         30000\n## 4 Marketing   Bob            20000\n## 5 Marketing   Ken            40000\n## 6 Marketing   Steven         40000\nPolars\ndf \\\n.group_by('department') \\\n.agg(\n    pl.col('name'),\n    pl.when(pl.col('salary').len()==1).then(pl.col('salary'))\n    .otherwise(pl.col('salary').shift(-1))\n    .alias('salary_shift')) \\\n.explode('name','salary_shift') \\\n.with_columns(\n    pl.col('salary_shift').forward_fill())\nshape: (6, 3)\ndepartment\nname\nsalary_shift\nstr\nstr\ni64\n\"Engineering\"\n\"Alice\"\n50000\n\"Finance\"\n\"Charlie\"\n30000\n\"Finance\"\n\"Carlos\"\n30000\n\"Marketing\"\n\"Bob\"\n20000\n\"Marketing\"\n\"Ken\"\n40000\n\"Marketing\"\n\"Steven\"\n40000\nApparently polars would turn the column into a nested dataframe (list) when grouped and can‚Äôt do\nfill\nwhen it‚Äôs in list? will have to\nunnest\nby\nexplode\nbefore\nfill\ncan be used. Unless of coure if you merge the\nfill\nin the same line when shifting, such as\ndf \\\n.group_by('department') \\\n.agg(\n    pl.col('name'),\n    pl.when(pl.col('salary').len()==1).then(pl.col('salary'))\n    .otherwise(pl.col('salary').shift(-1))\n    .forward_fill() \n    .alias('salary_shift'))\nIs There An Easier Way to\nUnnest\nwithout Typing ALL of the columns in Polars?\nYes! I believe\npl.col, pl.select, pl.filter\nall take a list of conditions. First create a list of columns you want to unnest, then use\npl.col\nto select them.\ndt = [pl.List(pl.Int64),pl.List(pl.String)]\n\ndf \\\n    .group_by('department', maintain_order=True) \\\n    .agg(  \n        pl.col('name'),\n        pl.col('salary_increase_percentage'),\n        salary_shift = pl.when(pl.col('salary').count() == 1)  \n            .then(pl.col('salary'))\n            .otherwise(pl.col('salary').shift(-1))\n    ) \\\n    .explode(pl.col(dt)) \\\n    .with_columns(\n        pl.col('salary_shift').forward_fill()\n    ) \\\n    .with_columns(\n        new_raise = pl.col('salary_shift') * (1+pl.col('salary_increase_percentage')/100)\n    )\nshape: (6, 5)\ndepartment\nname\nsalary_increase_percentage\nsalary_shift\nnew_raise\nstr\nstr\ni64\ni64\nf64\n\"Engineering\"\n\"Alice\"\n10\n50000\n55000.0\n\"Marketing\"\n\"Bob\"\n5\n20000\n21000.0\n\"Marketing\"\n\"Ken\"\n10\n40000\n44000.0\n\"Marketing\"\n\"Steven\"\n10\n40000\n44000.0\n\"Finance\"\n\"Charlie\"\n15\n30000\n34500.0\n\"Finance\"\n\"Carlos\"\n5\n30000\n31500.0\nMerge / Join\nCreate another mock data with dataframe called\ndf_dept\nwith columns\ndepartment\nand\ndept_id\nTidyverse\ndf_dept <- tibble(\n  department = c(\"Engineering\", \"Marketing\", \"Finance\"),\n  dept_id = c(30, 25, 20)\n)\nPolars\ndf_dept = pl.DataFrame({\n    \"department\": [\"Engineering\", \"Marketing\", \"Finance\"],\n    \"dept_id\": [30, 25, 20]\n})\nleft_join\ndf\nwith\ndf_dept\ncreate new column\nemployee_id\nby pasting:\n{dept_id}-{random 7 digit numbers}\nTidyverse\ndf |>\n  left_join(df_dept, by = \"department\") |>\n  select(name, dept_id) |>\n  mutate(employee_id = map_chr(dept_id, ~paste0(.x, \"-\", sample(1000000:9999999, 1))))\n\n## # A tibble: 6 √ó 3\n##   name    dept_id employee_id\n##   <chr>     <dbl> <chr>      \n## 1 Alice        30 30-1694470 \n## 2 Bob          25 25-1696036 \n## 3 Charlie      20 20-4463080 \n## 4 Ken          25 25-6942432 \n## 5 Steven       25 25-3012223 \n## 6 Carlos       20 20-8705991\nPolars\nimport random\n\ndf \\\n    .join(df_dept, on=\"department\") \\\n    .select(['name','dept_id']) \\\n    .with_columns(\n        employee_id = pl.format(\n          '{}-{}',\n          'dept_id',\n          pl.Series([\n            random.randint(100000, 999999) for _ in range(len(df))\n            ])\n            )\n    )\nshape: (6, 3)\nname\ndept_id\nemployee_id\nstr\ni64\nstr\n\"Alice\"\n30\n\"30-832410\"\n\"Bob\"\n25\n\"25-883365\"\n\"Charlie\"\n20\n\"20-484404\"\n\"Ken\"\n25\n\"25-421175\"\n\"Steven\"\n25\n\"25-670538\"\n\"Carlos\"\n20\n\"20-638378\"\nthere is a function called\nmap_elements\nin polars but the documentation stated that it‚Äôs inefficient, essentially using a for loop. I‚Äôm not entirely certain if list comprehension above is any more efficient. Another probably more efficent way of doing this is 2 separate process. The random number generation on another dataframe, then merge it.\nTo Dummies, Pivot_longer / Pivot_wider\ncreate dummy variables for\ndepartment\nusing\nname\nas index or id\nTidyverse\ndf |>\n  select(name, department) |>\n  pivot_wider(id_cols = \"name\", names_from = \"department\", values_from = \"department\", values_fill = 0, values_fn = length, names_prefix = \"department_\")\n\n## # A tibble: 6 √ó 4\n##   name    department_Engineering department_Marketing department_Finance\n##   <chr>                    <int>                <int>              <int>\n## 1 Alice                        1                    0                  0\n## 2 Bob                          0                    1                  0\n## 3 Charlie                      0                    0                  1\n## 4 Ken                          0                    1                  0\n## 5 Steven                       0                    1                  0\n## 6 Carlos                       0                    0                  1\nPolars -\nto_dummies\ndf \\\n    .select(['name','department']) \\\n    .to_dummies(columns = 'department')\nshape: (6, 4)\nname\ndepartment_Engineering\ndepartment_Finance\ndepartment_Marketing\nstr\nu8\nu8\nu8\n\"Alice\"\n1\n0\n0\n\"Bob\"\n0\n0\n1\n\"Charlie\"\n0\n1\n0\n\"Ken\"\n0\n0\n1\n\"Steven\"\n0\n0\n1\n\"Carlos\"\n0\n1\n0\nPolars -\npivot\ndf \\\n    .select(['name','address']) \\\n    .with_columns(\n        state = pl.col('address').str.extract(r'([A-Z]{2})$')\n    ) \\\n    .select('name','state') \\\n    .pivot(on = 'state', index = 'name', values='state', aggregate_function='len') \\\n    .with_columns(\n        pl.col(pl.UInt32).fill_null(0)\n    )\nshape: (6, 5)\nname\nOH\nAB\nNY\nON\nstr\nu32\nu32\nu32\nu32\n\"Alice\"\n1\n0\n0\n0\n\"Bob\"\n0\n1\n0\n0\n\"Charlie\"\n0\n0\n1\n0\n\"Ken\"\n0\n0\n0\n1\n\"Steven\"\n1\n0\n0\n0\n\"Carlos\"\n1\n0\n0\n0\nEssentially,\npivot_wider\nis Polars‚Äô\npivot\n. Whereas\npivot_longer\nis Polars‚Äô\nunpivot\nHelpful Resources\nPolars Python API documentation\nCheat sheet\ncookbook Polars for R\nLessons Learnt:\nstringr::str_extract\nhas the parameter\ngroup\nWe cannot use\nlook forward or backward\nin polars\npolars\nalso has\nselector\nfor looking at\ncolumn names\nmore efficiently\nlots of trial and error\ngoing to try doing pure\nPolars\nfor a month! Wish me luck!\nIf you like this article:\nplease feel free to send me a\ncomment or visit my other blogs\nplease feel free to follow me on\nBlueSky\n,\ntwitter\n,\nGitHub\nor\nMastodon\nif you would like collaborate please feel free to\ncontact me\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nr on Everyday Is A School Day\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "I found Polars syntax is quite similar to dplyr. And the way that we can chain the functions makes it even more familiar! It was fun learning the nuances, now it‚Äôs time to put them into practice! Wish me luck! üçÄ Motivation In preparation for using more Python in 2025 and also to speak more of the same language with our datathon team, I‚Äôve decided to practice Polars in Python thinking in R first. Below is my notes to myself, hopefully I‚Äôll be able to refer back and improve this more as I use more of this for the next month. Wish me luck! Objectives Create A Dataframe Filter, Select, Summarize, Across Mutate, Paste Extract Case_when Join / Merge To Dummies/Pivot/Unpivot Helpful Resources Lessons Learnt Create A Dataframe Tidyverse library(tidyverse) library(reticulate) use_virtualenv('path/to/your/environment') df filter(age >= 30) |> select(1:3, starts_with(\"performance\"), starts_with(\"salary\")) |> summarize(across(.cols = where(is.numeric), .fns = mean, .names = \"mean_{.col}\")) ## # A tibble: 1 √ó 5 ## mean_age mean_performance_rating mean_performance_reviews_count mean_salary ## ## 1 46.6 4.4 3.4 40000 ## # ‚Ñπ 1 more variable: mean_salary_increase_percentage Polars df \\ .filter(pl.col('age') >= 30) \\ .select(df.columns[0:4]+['^performance.*$','^salary.*$']) \\ .select(pl.col(pl.Int64).mean().name.prefix('mean_')) shape: (1, 5)mean_agemean_performance_ratingmean_performance_reviews_countmean_salarymean_salary_increase_percentagef64f64f64f64f6446.64.43.440000.010.0 For some reason, for the regex above, I have to use ^ and $ sandwiched to return those column nams that I want to include. bizzare. Mutate, Paste Test 1 make a new column called combination_of_character paste all columns with character datatype separated by ``, a space select the created column Tidyverse df |> rowwise() |> transmute(combination_of_character = paste( across(where(is.character)), collapse = \" \" )) |> select(combination_of_character) ## # A tibble: 6 √ó 1 ## # Rowwise: ## combination_of_character ## ## 1 Alice New York 123 Main St, Ontario, OH 123-456-7890 alice@example.com Engine‚Ä¶ ## 2 Bob San Francisco 123 Main St, Calgary, AB 987-654-3210 bob@example.com Marke‚Ä¶ ## 3 Charlie Tokyo 456-7890, Tokyo, NY 098-765-4332 charlie@example.com Finance 20‚Ä¶ ## 4 Ken Toronto 49494 Exchange St, Toronto, ON 111-232-4141 ken@stats.org Marketi‚Ä¶ ## 5 Steven Lima 1010 Gb st, Lima, OH 505-402-6060 stephencurry@nba.com Marketing ‚Ä¶ ## 6 Carlos Cleveland 666 Heaven dr, Cleveland, OH 909-435-1000 carlos@genius.edu ‚Ä¶ Polars df \\ .with_columns( pl.concat_str( pl.col(pl.String), separator=\" \" ).alias('combination_of_character') ) \\ .select(pl.col('combination_of_character')) shape: (6, 1)combination_of_characterstr\"Alice New York 123 Main St, On‚Ä¶\"Bob San Francisco 123 Main St,‚Ä¶\"Charlie Tokyo 456-7890, Tokyo,‚Ä¶\"Ken Toronto 49494 Exchange St,‚Ä¶\"Steven Lima 1010 Gb st, Lima, ‚Ä¶\"Carlos Cleveland 666 Heaven dr‚Ä¶ Tidyverse Test 2 make a new column called age_salary glue column age and salary together with - between select columns name and age_salary df |> mutate(age_salary = paste0(age, \"-\", salary)) |> select(name, age_salary) ## # A tibble: 6 √ó 2 ## name age_salary ## ## 1 Alice 30-50000 ## 2 Bob 25-45000 ## 3 Charlie 35-60000 ## 4 Ken 50-20000 ## 5 Steven 60-40000 ## 6 Carlos 58-30000 Polars df \\ .with_columns( age_salary=pl.format('{}-{}',pl.col('age'),pl.col('salary')) ) \\ .select(pl.col('name','age_salary')) shape: (6, 2)nameage_salarystrstr\"Alice\"\"30-50000\"\"Bob\"\"25-45000\"\"Charlie\"\"35-60000\"\"Ken\"\"50-20000\"\"Steven\"\"60-40000\"\"Carlos\"\"58-30000\" If it‚Äôs just 1 column, you can use this format age_salary= to name the column, otherwise you‚Äôd have to use alias to name it if there are multple columns Extract create a new column area_code_and_salary paste street number (extract it from address) with a space and the the column salary select area_code_and_salary Tidyverse df |> mutate(area_code_and_salary = paste0(str_extract(address, \"\\d{0,5}\"), \" \", salary)) |> select(area_code_and_salary) ## # A tibble: 6 √ó 1 ## area_code_and_salary ## ## 1 123 50000 ## 2 123 45000 ## 3 456 60000 ## 4 49494 20000 ## 5 1010 40000 ## 6 666 30000 Polars df \\ .select( pl.concat_str( pl.col('address').str.extract(r'^(\\d{0,5})'), pl.lit(\" \"), pl.col('salary') ).alias('area_code_and_salary') ) shape: (6, 1)area_code_and_salarystr\"123 50000\"\"123 45000\"\"456 60000\"\"49494 20000\"\"1010 40000\"\"666 30000\" Have to use pl.lit(' ') for any constant string Case_when Test 1 create a new column called familiarity if address contains OH, then return local if address contains NY, then return foodie otherwise return elsewhere Tidyverse df |> mutate(familiarity = case_when( str_detect(address, \"OH\") ~ \"local\", str_detect(address, \"NY\") ~ \"foodie\", TRUE ~ \"elsewhere\" )) ## # A tibble: 6 √ó 17 ## name age city address phone_number email salary department hire_date ## ## 1 Alice 30 New York 123 Ma‚Ä¶ 123-456-7890 alic‚Ä¶ 50000 Engineeri‚Ä¶ 2010-01-‚Ä¶ ## 2 Bob 25 San Fran‚Ä¶ 123 Ma‚Ä¶ 987-654-3210 bob@‚Ä¶ 45000 Marketing 2012-05-‚Ä¶ ## 3 Charlie 35 Tokyo 456-78‚Ä¶ 098-765-4332 char‚Ä¶ 60000 Finance 2015-10-‚Ä¶ ## 4 Ken 50 Toronto 49494 ‚Ä¶ 111-232-4141 ken@‚Ä¶ 20000 Marketing 2010-04-‚Ä¶ ## 5 Steven 60 Lima 1010 G‚Ä¶ 505-402-6060 step‚Ä¶ 40000 Marketing 2009-10-‚Ä¶ ## 6 Carlos 58 Cleveland 666 He‚Ä¶ 909-435-1000 carl‚Ä¶ 30000 Finance 2005-11-‚Ä¶ ## # ‚Ñπ 8 more variables: status , salary_increase_percentage , ## # years_of_service , bonus_amount , performance_rating , ## # performance_reviews_count , performance_reviews_last_updated , ## # familiarity Polars df \\ .with_columns([ pl.when(pl.col('address').str.contains('OH')) .then(pl.lit('local')) .when(pl.col('address').str.contains('NY')) .then(pl.lit('foodie')) .otherwise(pl.lit('elsewhere')) .alias('familiarity') ]) shape: (6, 17)nameagecityaddressphone_numberemailsalarydepartmenthire_datestatussalary_increase_percentageyears_of_servicebonus_amountperformance_ratingperformance_reviews_countperformance_reviews_last_updatedfamiliaritystri64strstrstrstri64strstrstri64i64i64i64i64strstr\"Alice\"30\"New York\"\"123 Main St, Ontario, OH\"\"123-456-7890\"\"alice@example.com\"50000\"Engineering\"\"2010-01-01\"\"Active\"105200042\"2022-05-01\"\"local\"\"Bob\"25\"San Francisco\"\"123 Main St, Calgary, AB\"\"987-654-3210\"\"bob@example.com\"45000\"Marketing\"\"2012-05-15\"\"Inactive\"53150031\"2021-07-15\"\"elsewhere\"\"Charlie\"35\"Tokyo\"\"456-7890, Tokyo, NY\"\"098-765-4332\"\"charlie@example.com\"60000\"Finance\"\"2015-10-01\"\"Active\"157300053\"2022-08-31\"\"foodie\"\"Ken\"50\"Toronto\"\"49494 Exchange St, Toronto, ON\"\"111-232-4141\"\"ken@stats.org\"20000\"Marketing\"\"2010-04-01\"\"Inactive\"1010500053\"2024-10-30\"\"elsewhere\"\"Steven\"60\"Lima\"\"1010 Gb st, Lima, OH\"\"505-402-6060\"\"stephencurry@nba.com\"40000\"Marketing\"\"2009-10-30\"\"Active\"1010300044\"2023-01-02\"\"local\"\"Carlos\"58\"Cleveland\"\"666 Heaven dr, Cleveland, OH\"\"909-435-1000\"\"carlos@genius.edu\"30000\"Finance\"\"2005-11-12\"\"Active\"512200045\"2024-12-12\"\"local\" Test 2 convert name data to lowercase create new column called email_name and extract email before the @ select columns that starts with name or end with name create a new column called same? if name and email_name is the same, then return yes otherwise return no Tidyverse df |> mutate( name = tolower(name), email_name = str_extract(email, \"^([\\d\\w]+)@\", group = 1) ) |> select(starts_with(\"name\") | ends_with(\"name\")) |> mutate(`same?` = case_when( name == email_name ~ \"yes\", TRUE ~ \"no\")) ## # A tibble: 6 √ó 3 ## name email_name `same?` ## ## 1 alice alice yes ## 2 bob bob yes ## 3 charlie charlie yes ## 4 ken ken yes ## 5 steven stephencurry no ## 6 carlos carlos yes Polars df \\ .with_columns( [ pl.col('name').str.to_lowercase(), pl.col('email').str.extract(r'^([\\d\\w]+)@', group_index = 1) .alias('email_name') ] ) \\ .select([ pl.col('^name|.*name$'), pl.when( pl.col('name') == pl.col('email_name')).then(pl.lit('yes')) .otherwise(pl.lit('no')) .alias('same?') ] ) shape: (6, 3)nameemail_namesame?strstrstr\"alice\"\"alice\"\"yes\"\"bob\"\"bob\"\"yes\"\"charlie\"\"charlie\"\"yes\"\"ken\"\"ken\"\"yes\"\"steven\"\"stephencurry\"\"no\"\"carlos\"\"carlos\"\"yes\" Learnt that apparently we cannot use look forward or backward in polars. Such as .*(?=@) to capture the email_name Group_by, Shift, Forward_Fill group by department column summarize by selecting name, new column salary_shift with conditions: if the department only has 1 row of salary data, do not shift salary if the department has more than 1 row of salary data, shift by -1 of salary column reason: there was a mistake in entering data for those with more than 1 row of data, apparently the actualy salary data is 1 row more then forward fill the salary_shift with the number prior in the same group Tidyverse df |> group_by(department) |> summarize( name = name, salary_shift = case_when( n() == 1 ~ salary, TRUE ~ lead(salary) ) ) |> fill(salary_shift, .direction = \"down\") ## Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in ## dplyr 1.1.0. ## ‚Ñπ Please use `reframe()` instead. ## ‚Ñπ When switching from `summarise()` to `reframe()`, remember that `reframe()` ## always returns an ungrouped data frame and adjust accordingly. ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was ## generated. ## `summarise()` has grouped output by 'department'. You can override using the ## `.groups` argument. ## # A tibble: 6 √ó 3 ## # Groups: department [3] ## department name salary_shift ## ## 1 Engineering Alice 50000 ## 2 Finance Charlie 30000 ## 3 Finance Carlos 30000 ## 4 Marketing Bob 20000 ## 5 Marketing Ken 40000 ## 6 Marketing Steven 40000 Polars df \\ .group_by('department') \\ .agg( pl.col('name'), pl.when(pl.col('salary').len()==1).then(pl.col('salary')) .otherwise(pl.col('salary').shift(-1)) .alias('salary_shift')) \\ .explode('name','salary_shift') \\ .with_columns( pl.col('salary_shift').forward_fill()) shape: (6, 3)departmentnamesalary_shiftstrstri64\"Engineering\"\"Alice\"50000\"Finance\"\"Charlie\"30000\"Finance\"\"Carlos\"30000\"Marketing\"\"Bob\"20000\"Marketing\"\"Ken\"40000\"Marketing\"\"Steven\"40000 Apparently polars would turn the column into a nested dataframe (list) when grouped and can‚Äôt do fill when it‚Äôs in list? will have to unnest by explode before fill can be used. Unless of coure if you merge the fill in the same line when shifting, such as df \\ .group_by('department') \\ .agg( pl.col('name'), pl.when(pl.col('salary').len()==1).then(pl.col('salary')) .otherwise(pl.col('salary').shift(-1)) .forward_fill() .alias('salary_shift')) Is There An Easier Way to Unnest without Typing ALL of the columns in Polars? Yes! I believe pl.col, pl.select, pl.filter all take a list of conditions. First create a list of columns you want to unnest, then use pl.col to select them. dt = [pl.List(pl.Int64),pl.List(pl.String)] df \\ .group_by('department', maintain_order=True) \\ .agg( pl.col('name'), pl.col('salary_increase_percentage'), salary_shift = pl.when(pl.col('salary').count() == 1) .then(pl.col('salary')) .otherwise(pl.col('salary').shift(-1)) ) \\ .explode(pl.col(dt)) \\ .with_columns( pl.col('salary_shift').forward_fill() ) \\ .with_columns( new_raise = pl.col('salary_shift') * (1+pl.col('salary_increase_percentage')/100) ) shape: (6, 5)departmentnamesalary_increase_percentagesalary_shiftnew_raisestrstri64i64f64\"Engineering\"\"Alice\"105000055000.0\"Marketing\"\"Bob\"52000021000.0\"Marketing\"\"Ken\"104000044000.0\"Marketing\"\"Steven\"104000044000.0\"Finance\"\"Charlie\"153000034500.0\"Finance\"\"Carlos\"53000031500.0 Merge / Join Create another mock data with dataframe called df_dept with columns department and dept_id Tidyverse df_dept left_join(df_dept, by = \"department\") |> select(name, dept_id) |> mutate(employee_id = map_chr(dept_id, ~paste0(.x, \"-\", sample(1000000:9999999, 1)))) ## # A tibble: 6 √ó 3 ## name dept_id employee_id ## ## 1 Alice 30 30-1694470 ## 2 Bob 25 25-1696036 ## 3 Charlie 20 20-4463080 ## 4 Ken 25 25-6942432 ## 5 Steven 25 25-3012223 ## 6 Carlos 20 20-8705991 Polars import random df \\ .join(df_dept, on=\"department\") \\ .select(['name','dept_id']) \\ .with_columns( employee_id = pl.format( '{}-{}', 'dept_id', pl.Series([ random.randint(100000, 999999) for _ in range(len(df)) ]) ) ) shape: (6, 3)namedept_idemployee_idstri64str\"Alice\"30\"30-832410\"\"Bob\"25\"25-883365\"\"Charlie\"20\"20-484404\"\"Ken\"25\"25-421175\"\"Steven\"25\"25-670538\"\"Carlos\"20\"20-638378\" there is a function called map_elements in polars but the documentation stated that it‚Äôs inefficient, essentially using a for loop. I‚Äôm not entirely certain if list comprehension above is any more efficient. Another probably more efficent way of doing this is 2 separate process. The random number generation on another dataframe, then merge it. To Dummies, Pivot_longer / Pivot_wider create dummy variables for department using name as index or id Tidyverse df |> select(name, department) |> pivot_wider(id_cols = \"name\", names_from = \"department\", values_from = \"department\", values_fill = 0, values_fn = length, names_prefix = \"department_\") ## # A tibble: 6 √ó 4 ## name department_Engineering department_Marketing department_Finance ## ## 1 Alice 1 0 0 ## 2 Bob 0 1 0 ## 3 Charlie 0 0 1 ## 4 Ken 0 1 0 ## 5 Steven 0 1 0 ## 6 Carlos 0 0 1 Polars - to_dummies df \\ .select(['name','department']) \\ .to_dummies(columns = 'department') shape: (6, 4)namedepartment_Engineeringdepartment_Financedepartment_Marketingstru8u8u8\"Alice\"100\"Bob\"001\"Charlie\"010\"Ken\"001\"Steven\"001\"Carlos\"010 Polars - pivot df \\ .select(['name','address']) \\ .with_columns( state = pl.col('address').str.extract(r'([A-Z]{2})$') ) \\ .select('name','state') \\ .pivot(on = 'state', index = 'name', values='state', aggregate_function='len') \\ .with_columns( pl.col(pl.UInt32).fill_null(0) ) shape: (6, 5)nameOHABNYONstru32u32u32u32\"Alice\"1000\"Bob\"0100\"Charlie\"0010\"Ken\"0001\"Steven\"1000\"Carlos\"1000 Essentially, pivot_wider is Polars‚Äô pivot. Whereas pivot_longer is Polars‚Äô unpivot Helpful Resources Polars Python API documentation Cheat sheet cookbook Polars for R Lessons Learnt: stringr::str_extract has the parameter group We cannot use look forward or backward in polars polars also has selector for looking at column names more efficiently lots of trial and error going to try doing pure Polars for a month! Wish me luck! If you like this article: please feel free to send me a comment or visit my other blogs please feel free to follow me on BlueSky, twitter, GitHub or Mastodon if you would like collaborate please feel free to contact me",
    "meta_keywords": null,
    "og_description": "I found Polars syntax is quite similar to dplyr. And the way that we can chain the functions makes it even more familiar! It was fun learning the nuances, now it‚Äôs time to put them into practice! Wish me luck! üçÄ Motivation In preparation for using more Python in 2025 and also to speak more of the same language with our datathon team, I‚Äôve decided to practice Polars in Python thinking in R first. Below is my notes to myself, hopefully I‚Äôll be able to refer back and improve this more as I use more of this for the next month. Wish me luck! Objectives Create A Dataframe Filter, Select, Summarize, Across Mutate, Paste Extract Case_when Join / Merge To Dummies/Pivot/Unpivot Helpful Resources Lessons Learnt Create A Dataframe Tidyverse library(tidyverse) library(reticulate) use_virtualenv('path/to/your/environment') df filter(age >= 30) |> select(1:3, starts_with(\"performance\"), starts_with(\"salary\")) |> summarize(across(.cols = where(is.numeric), .fns = mean, .names = \"mean_{.col}\")) ## # A tibble: 1 √ó 5 ## mean_age mean_performance_rating mean_performance_reviews_count mean_salary ## ## 1 46.6 4.4 3.4 40000 ## # ‚Ñπ 1 more variable: mean_salary_increase_percentage Polars df \\ .filter(pl.col('age') >= 30) \\ .select(df.columns[0:4]+['^performance.*$','^salary.*$']) \\ .select(pl.col(pl.Int64).mean().name.prefix('mean_')) shape: (1, 5)mean_agemean_performance_ratingmean_performance_reviews_countmean_salarymean_salary_increase_percentagef64f64f64f64f6446.64.43.440000.010.0 For some reason, for the regex above, I have to use ^ and $ sandwiched to return those column nams that I want to include. bizzare. Mutate, Paste Test 1 make a new column called combination_of_character paste all columns with character datatype separated by ``, a space select the created column Tidyverse df |> rowwise() |> transmute(combination_of_character = paste( across(where(is.character)), collapse = \" \" )) |> select(combination_of_character) ## # A tibble: 6 √ó 1 ## # Rowwise: ## combination_of_character ## ## 1 Alice New York 123 Main St, Ontario, OH 123-456-7890 alice@example.com Engine‚Ä¶ ## 2 Bob San Francisco 123 Main St, Calgary, AB 987-654-3210 bob@example.com Marke‚Ä¶ ## 3 Charlie Tokyo 456-7890, Tokyo, NY 098-765-4332 charlie@example.com Finance 20‚Ä¶ ## 4 Ken Toronto 49494 Exchange St, Toronto, ON 111-232-4141 ken@stats.org Marketi‚Ä¶ ## 5 Steven Lima 1010 Gb st, Lima, OH 505-402-6060 stephencurry@nba.com Marketing ‚Ä¶ ## 6 Carlos Cleveland 666 Heaven dr, Cleveland, OH 909-435-1000 carlos@genius.edu ‚Ä¶ Polars df \\ .with_columns( pl.concat_str( pl.col(pl.String), separator=\" \" ).alias('combination_of_character') ) \\ .select(pl.col('combination_of_character')) shape: (6, 1)combination_of_characterstr\"Alice New York 123 Main St, On‚Ä¶\"Bob San Francisco 123 Main St,‚Ä¶\"Charlie Tokyo 456-7890, Tokyo,‚Ä¶\"Ken Toronto 49494 Exchange St,‚Ä¶\"Steven Lima 1010 Gb st, Lima, ‚Ä¶\"Carlos Cleveland 666 Heaven dr‚Ä¶ Tidyverse Test 2 make a new column called age_salary glue column age and salary together with - between select columns name and age_salary df |> mutate(age_salary = paste0(age, \"-\", salary)) |> select(name, age_salary) ## # A tibble: 6 √ó 2 ## name age_salary ## ## 1 Alice 30-50000 ## 2 Bob 25-45000 ## 3 Charlie 35-60000 ## 4 Ken 50-20000 ## 5 Steven 60-40000 ## 6 Carlos 58-30000 Polars df \\ .with_columns( age_salary=pl.format('{}-{}',pl.col('age'),pl.col('salary')) ) \\ .select(pl.col('name','age_salary')) shape: (6, 2)nameage_salarystrstr\"Alice\"\"30-50000\"\"Bob\"\"25-45000\"\"Charlie\"\"35-60000\"\"Ken\"\"50-20000\"\"Steven\"\"60-40000\"\"Carlos\"\"58-30000\" If it‚Äôs just 1 column, you can use this format age_salary= to name the column, otherwise you‚Äôd have to use alias to name it if there are multple columns Extract create a new column area_code_and_salary paste street number (extract it from address) with a space and the the column salary select area_code_and_salary Tidyverse df |> mutate(area_code_and_salary = paste0(str_extract(address, \"\\d{0,5}\"), \" \", salary)) |> select(area_code_and_salary) ## # A tibble: 6 √ó 1 ## area_code_and_salary ## ## 1 123 50000 ## 2 123 45000 ## 3 456 60000 ## 4 49494 20000 ## 5 1010 40000 ## 6 666 30000 Polars df \\ .select( pl.concat_str( pl.col('address').str.extract(r'^(\\d{0,5})'), pl.lit(\" \"), pl.col('salary') ).alias('area_code_and_salary') ) shape: (6, 1)area_code_and_salarystr\"123 50000\"\"123 45000\"\"456 60000\"\"49494 20000\"\"1010 40000\"\"666 30000\" Have to use pl.lit(' ') for any constant string Case_when Test 1 create a new column called familiarity if address contains OH, then return local if address contains NY, then return foodie otherwise return elsewhere Tidyverse df |> mutate(familiarity = case_when( str_detect(address, \"OH\") ~ \"local\", str_detect(address, \"NY\") ~ \"foodie\", TRUE ~ \"elsewhere\" )) ## # A tibble: 6 √ó 17 ## name age city address phone_number email salary department hire_date ## ## 1 Alice 30 New York 123 Ma‚Ä¶ 123-456-7890 alic‚Ä¶ 50000 Engineeri‚Ä¶ 2010-01-‚Ä¶ ## 2 Bob 25 San Fran‚Ä¶ 123 Ma‚Ä¶ 987-654-3210 bob@‚Ä¶ 45000 Marketing 2012-05-‚Ä¶ ## 3 Charlie 35 Tokyo 456-78‚Ä¶ 098-765-4332 char‚Ä¶ 60000 Finance 2015-10-‚Ä¶ ## 4 Ken 50 Toronto 49494 ‚Ä¶ 111-232-4141 ken@‚Ä¶ 20000 Marketing 2010-04-‚Ä¶ ## 5 Steven 60 Lima 1010 G‚Ä¶ 505-402-6060 step‚Ä¶ 40000 Marketing 2009-10-‚Ä¶ ## 6 Carlos 58 Cleveland 666 He‚Ä¶ 909-435-1000 carl‚Ä¶ 30000 Finance 2005-11-‚Ä¶ ## # ‚Ñπ 8 more variables: status , salary_increase_percentage , ## # years_of_service , bonus_amount , performance_rating , ## # performance_reviews_count , performance_reviews_last_updated , ## # familiarity Polars df \\ .with_columns([ pl.when(pl.col('address').str.contains('OH')) .then(pl.lit('local')) .when(pl.col('address').str.contains('NY')) .then(pl.lit('foodie')) .otherwise(pl.lit('elsewhere')) .alias('familiarity') ]) shape: (6, 17)nameagecityaddressphone_numberemailsalarydepartmenthire_datestatussalary_increase_percentageyears_of_servicebonus_amountperformance_ratingperformance_reviews_countperformance_reviews_last_updatedfamiliaritystri64strstrstrstri64strstrstri64i64i64i64i64strstr\"Alice\"30\"New York\"\"123 Main St, Ontario, OH\"\"123-456-7890\"\"alice@example.com\"50000\"Engineering\"\"2010-01-01\"\"Active\"105200042\"2022-05-01\"\"local\"\"Bob\"25\"San Francisco\"\"123 Main St, Calgary, AB\"\"987-654-3210\"\"bob@example.com\"45000\"Marketing\"\"2012-05-15\"\"Inactive\"53150031\"2021-07-15\"\"elsewhere\"\"Charlie\"35\"Tokyo\"\"456-7890, Tokyo, NY\"\"098-765-4332\"\"charlie@example.com\"60000\"Finance\"\"2015-10-01\"\"Active\"157300053\"2022-08-31\"\"foodie\"\"Ken\"50\"Toronto\"\"49494 Exchange St, Toronto, ON\"\"111-232-4141\"\"ken@stats.org\"20000\"Marketing\"\"2010-04-01\"\"Inactive\"1010500053\"2024-10-30\"\"elsewhere\"\"Steven\"60\"Lima\"\"1010 Gb st, Lima, OH\"\"505-402-6060\"\"stephencurry@nba.com\"40000\"Marketing\"\"2009-10-30\"\"Active\"1010300044\"2023-01-02\"\"local\"\"Carlos\"58\"Cleveland\"\"666 Heaven dr, Cleveland, OH\"\"909-435-1000\"\"carlos@genius.edu\"30000\"Finance\"\"2005-11-12\"\"Active\"512200045\"2024-12-12\"\"local\" Test 2 convert name data to lowercase create new column called email_name and extract email before the @ select columns that starts with name or end with name create a new column called same? if name and email_name is the same, then return yes otherwise return no Tidyverse df |> mutate( name = tolower(name), email_name = str_extract(email, \"^([\\d\\w]+)@\", group = 1) ) |> select(starts_with(\"name\") | ends_with(\"name\")) |> mutate(`same?` = case_when( name == email_name ~ \"yes\", TRUE ~ \"no\")) ## # A tibble: 6 √ó 3 ## name email_name `same?` ## ## 1 alice alice yes ## 2 bob bob yes ## 3 charlie charlie yes ## 4 ken ken yes ## 5 steven stephencurry no ## 6 carlos carlos yes Polars df \\ .with_columns( [ pl.col('name').str.to_lowercase(), pl.col('email').str.extract(r'^([\\d\\w]+)@', group_index = 1) .alias('email_name') ] ) \\ .select([ pl.col('^name|.*name$'), pl.when( pl.col('name') == pl.col('email_name')).then(pl.lit('yes')) .otherwise(pl.lit('no')) .alias('same?') ] ) shape: (6, 3)nameemail_namesame?strstrstr\"alice\"\"alice\"\"yes\"\"bob\"\"bob\"\"yes\"\"charlie\"\"charlie\"\"yes\"\"ken\"\"ken\"\"yes\"\"steven\"\"stephencurry\"\"no\"\"carlos\"\"carlos\"\"yes\" Learnt that apparently we cannot use look forward or backward in polars. Such as .*(?=@) to capture the email_name Group_by, Shift, Forward_Fill group by department column summarize by selecting name, new column salary_shift with conditions: if the department only has 1 row of salary data, do not shift salary if the department has more than 1 row of salary data, shift by -1 of salary column reason: there was a mistake in entering data for those with more than 1 row of data, apparently the actualy salary data is 1 row more then forward fill the salary_shift with the number prior in the same group Tidyverse df |> group_by(department) |> summarize( name = name, salary_shift = case_when( n() == 1 ~ salary, TRUE ~ lead(salary) ) ) |> fill(salary_shift, .direction = \"down\") ## Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in ## dplyr 1.1.0. ## ‚Ñπ Please use `reframe()` instead. ## ‚Ñπ When switching from `summarise()` to `reframe()`, remember that `reframe()` ## always returns an ungrouped data frame and adjust accordingly. ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was ## generated. ## `summarise()` has grouped output by 'department'. You can override using the ## `.groups` argument. ## # A tibble: 6 √ó 3 ## # Groups: department [3] ## department name salary_shift ## ## 1 Engineering Alice 50000 ## 2 Finance Charlie 30000 ## 3 Finance Carlos 30000 ## 4 Marketing Bob 20000 ## 5 Marketing Ken 40000 ## 6 Marketing Steven 40000 Polars df \\ .group_by('department') \\ .agg( pl.col('name'), pl.when(pl.col('salary').len()==1).then(pl.col('salary')) .otherwise(pl.col('salary').shift(-1)) .alias('salary_shift')) \\ .explode('name','salary_shift') \\ .with_columns( pl.col('salary_shift').forward_fill()) shape: (6, 3)departmentnamesalary_shiftstrstri64\"Engineering\"\"Alice\"50000\"Finance\"\"Charlie\"30000\"Finance\"\"Carlos\"30000\"Marketing\"\"Bob\"20000\"Marketing\"\"Ken\"40000\"Marketing\"\"Steven\"40000 Apparently polars would turn the column into a nested dataframe (list) when grouped and can‚Äôt do fill when it‚Äôs in list? will have to unnest by explode before fill can be used. Unless of coure if you merge the fill in the same line when shifting, such as df \\ .group_by('department') \\ .agg( pl.col('name'), pl.when(pl.col('salary').len()==1).then(pl.col('salary')) .otherwise(pl.col('salary').shift(-1)) .forward_fill() .alias('salary_shift')) Is There An Easier Way to Unnest without Typing ALL of the columns in Polars? Yes! I believe pl.col, pl.select, pl.filter all take a list of conditions. First create a list of columns you want to unnest, then use pl.col to select them. dt = [pl.List(pl.Int64),pl.List(pl.String)] df \\ .group_by('department', maintain_order=True) \\ .agg( pl.col('name'), pl.col('salary_increase_percentage'), salary_shift = pl.when(pl.col('salary').count() == 1) .then(pl.col('salary')) .otherwise(pl.col('salary').shift(-1)) ) \\ .explode(pl.col(dt)) \\ .with_columns( pl.col('salary_shift').forward_fill() ) \\ .with_columns( new_raise = pl.col('salary_shift') * (1+pl.col('salary_increase_percentage')/100) ) shape: (6, 5)departmentnamesalary_increase_percentagesalary_shiftnew_raisestrstri64i64f64\"Engineering\"\"Alice\"105000055000.0\"Marketing\"\"Bob\"52000021000.0\"Marketing\"\"Ken\"104000044000.0\"Marketing\"\"Steven\"104000044000.0\"Finance\"\"Charlie\"153000034500.0\"Finance\"\"Carlos\"53000031500.0 Merge / Join Create another mock data with dataframe called df_dept with columns department and dept_id Tidyverse df_dept left_join(df_dept, by = \"department\") |> select(name, dept_id) |> mutate(employee_id = map_chr(dept_id, ~paste0(.x, \"-\", sample(1000000:9999999, 1)))) ## # A tibble: 6 √ó 3 ## name dept_id employee_id ## ## 1 Alice 30 30-1694470 ## 2 Bob 25 25-1696036 ## 3 Charlie 20 20-4463080 ## 4 Ken 25 25-6942432 ## 5 Steven 25 25-3012223 ## 6 Carlos 20 20-8705991 Polars import random df \\ .join(df_dept, on=\"department\") \\ .select(['name','dept_id']) \\ .with_columns( employee_id = pl.format( '{}-{}', 'dept_id', pl.Series([ random.randint(100000, 999999) for _ in range(len(df)) ]) ) ) shape: (6, 3)namedept_idemployee_idstri64str\"Alice\"30\"30-832410\"\"Bob\"25\"25-883365\"\"Charlie\"20\"20-484404\"\"Ken\"25\"25-421175\"\"Steven\"25\"25-670538\"\"Carlos\"20\"20-638378\" there is a function called map_elements in polars but the documentation stated that it‚Äôs inefficient, essentially using a for loop. I‚Äôm not entirely certain if list comprehension above is any more efficient. Another probably more efficent way of doing this is 2 separate process. The random number generation on another dataframe, then merge it. To Dummies, Pivot_longer / Pivot_wider create dummy variables for department using name as index or id Tidyverse df |> select(name, department) |> pivot_wider(id_cols = \"name\", names_from = \"department\", values_from = \"department\", values_fill = 0, values_fn = length, names_prefix = \"department_\") ## # A tibble: 6 √ó 4 ## name department_Engineering department_Marketing department_Finance ## ## 1 Alice 1 0 0 ## 2 Bob 0 1 0 ## 3 Charlie 0 0 1 ## 4 Ken 0 1 0 ## 5 Steven 0 1 0 ## 6 Carlos 0 0 1 Polars - to_dummies df \\ .select(['name','department']) \\ .to_dummies(columns = 'department') shape: (6, 4)namedepartment_Engineeringdepartment_Financedepartment_Marketingstru8u8u8\"Alice\"100\"Bob\"001\"Charlie\"010\"Ken\"001\"Steven\"001\"Carlos\"010 Polars - pivot df \\ .select(['name','address']) \\ .with_columns( state = pl.col('address').str.extract(r'([A-Z]{2})$') ) \\ .select('name','state') \\ .pivot(on = 'state', index = 'name', values='state', aggregate_function='len') \\ .with_columns( pl.col(pl.UInt32).fill_null(0) ) shape: (6, 5)nameOHABNYONstru32u32u32u32\"Alice\"1000\"Bob\"0100\"Charlie\"0010\"Ken\"0001\"Steven\"1000\"Carlos\"1000 Essentially, pivot_wider is Polars‚Äô pivot. Whereas pivot_longer is Polars‚Äô unpivot Helpful Resources Polars Python API documentation Cheat sheet cookbook Polars for R Lessons Learnt: stringr::str_extract has the parameter group We cannot use look forward or backward in polars polars also has selector for looking at column names more efficiently lots of trial and error going to try doing pure Polars for a month! Wish me luck! If you like this article: please feel free to send me a comment or visit my other blogs please feel free to follow me on BlueSky, twitter, GitHub or Mastodon if you would like collaborate please feel free to contact me",
    "og_image": "https://www.kenkoonwong.com/blog/polars/polars.png",
    "og_title": "Tidyverse ü™êto Polars üêª‚Äç‚ùÑÔ∏è: My Notes | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 14.5,
    "sitemap_lastmod": null,
    "twitter_description": "I found Polars syntax is quite similar to dplyr. And the way that we can chain the functions makes it even more familiar! It was fun learning the nuances, now it‚Äôs time to put them into practice! Wish me luck! üçÄ Motivation In preparation for using more Python in 2025 and also to speak more of the same language with our datathon team, I‚Äôve decided to practice Polars in Python thinking in R first. Below is my notes to myself, hopefully I‚Äôll be able to refer back and improve this more as I use more of this for the next month. Wish me luck! Objectives Create A Dataframe Filter, Select, Summarize, Across Mutate, Paste Extract Case_when Join / Merge To Dummies/Pivot/Unpivot Helpful Resources Lessons Learnt Create A Dataframe Tidyverse library(tidyverse) library(reticulate) use_virtualenv('path/to/your/environment') df filter(age >= 30) |> select(1:3, starts_with(\"performance\"), starts_with(\"salary\")) |> summarize(across(.cols = where(is.numeric), .fns = mean, .names = \"mean_{.col}\")) ## # A tibble: 1 √ó 5 ## mean_age mean_performance_rating mean_performance_reviews_count mean_salary ## ## 1 46.6 4.4 3.4 40000 ## # ‚Ñπ 1 more variable: mean_salary_increase_percentage Polars df \\ .filter(pl.col('age') >= 30) \\ .select(df.columns[0:4]+['^performance.*$','^salary.*$']) \\ .select(pl.col(pl.Int64).mean().name.prefix('mean_')) shape: (1, 5)mean_agemean_performance_ratingmean_performance_reviews_countmean_salarymean_salary_increase_percentagef64f64f64f64f6446.64.43.440000.010.0 For some reason, for the regex above, I have to use ^ and $ sandwiched to return those column nams that I want to include. bizzare. Mutate, Paste Test 1 make a new column called combination_of_character paste all columns with character datatype separated by ``, a space select the created column Tidyverse df |> rowwise() |> transmute(combination_of_character = paste( across(where(is.character)), collapse = \" \" )) |> select(combination_of_character) ## # A tibble: 6 √ó 1 ## # Rowwise: ## combination_of_character ## ## 1 Alice New York 123 Main St, Ontario, OH 123-456-7890 alice@example.com Engine‚Ä¶ ## 2 Bob San Francisco 123 Main St, Calgary, AB 987-654-3210 bob@example.com Marke‚Ä¶ ## 3 Charlie Tokyo 456-7890, Tokyo, NY 098-765-4332 charlie@example.com Finance 20‚Ä¶ ## 4 Ken Toronto 49494 Exchange St, Toronto, ON 111-232-4141 ken@stats.org Marketi‚Ä¶ ## 5 Steven Lima 1010 Gb st, Lima, OH 505-402-6060 stephencurry@nba.com Marketing ‚Ä¶ ## 6 Carlos Cleveland 666 Heaven dr, Cleveland, OH 909-435-1000 carlos@genius.edu ‚Ä¶ Polars df \\ .with_columns( pl.concat_str( pl.col(pl.String), separator=\" \" ).alias('combination_of_character') ) \\ .select(pl.col('combination_of_character')) shape: (6, 1)combination_of_characterstr\"Alice New York 123 Main St, On‚Ä¶\"Bob San Francisco 123 Main St,‚Ä¶\"Charlie Tokyo 456-7890, Tokyo,‚Ä¶\"Ken Toronto 49494 Exchange St,‚Ä¶\"Steven Lima 1010 Gb st, Lima, ‚Ä¶\"Carlos Cleveland 666 Heaven dr‚Ä¶ Tidyverse Test 2 make a new column called age_salary glue column age and salary together with - between select columns name and age_salary df |> mutate(age_salary = paste0(age, \"-\", salary)) |> select(name, age_salary) ## # A tibble: 6 √ó 2 ## name age_salary ## ## 1 Alice 30-50000 ## 2 Bob 25-45000 ## 3 Charlie 35-60000 ## 4 Ken 50-20000 ## 5 Steven 60-40000 ## 6 Carlos 58-30000 Polars df \\ .with_columns( age_salary=pl.format('{}-{}',pl.col('age'),pl.col('salary')) ) \\ .select(pl.col('name','age_salary')) shape: (6, 2)nameage_salarystrstr\"Alice\"\"30-50000\"\"Bob\"\"25-45000\"\"Charlie\"\"35-60000\"\"Ken\"\"50-20000\"\"Steven\"\"60-40000\"\"Carlos\"\"58-30000\" If it‚Äôs just 1 column, you can use this format age_salary= to name the column, otherwise you‚Äôd have to use alias to name it if there are multple columns Extract create a new column area_code_and_salary paste street number (extract it from address) with a space and the the column salary select area_code_and_salary Tidyverse df |> mutate(area_code_and_salary = paste0(str_extract(address, \"\\d{0,5}\"), \" \", salary)) |> select(area_code_and_salary) ## # A tibble: 6 √ó 1 ## area_code_and_salary ## ## 1 123 50000 ## 2 123 45000 ## 3 456 60000 ## 4 49494 20000 ## 5 1010 40000 ## 6 666 30000 Polars df \\ .select( pl.concat_str( pl.col('address').str.extract(r'^(\\d{0,5})'), pl.lit(\" \"), pl.col('salary') ).alias('area_code_and_salary') ) shape: (6, 1)area_code_and_salarystr\"123 50000\"\"123 45000\"\"456 60000\"\"49494 20000\"\"1010 40000\"\"666 30000\" Have to use pl.lit(' ') for any constant string Case_when Test 1 create a new column called familiarity if address contains OH, then return local if address contains NY, then return foodie otherwise return elsewhere Tidyverse df |> mutate(familiarity = case_when( str_detect(address, \"OH\") ~ \"local\", str_detect(address, \"NY\") ~ \"foodie\", TRUE ~ \"elsewhere\" )) ## # A tibble: 6 √ó 17 ## name age city address phone_number email salary department hire_date ## ## 1 Alice 30 New York 123 Ma‚Ä¶ 123-456-7890 alic‚Ä¶ 50000 Engineeri‚Ä¶ 2010-01-‚Ä¶ ## 2 Bob 25 San Fran‚Ä¶ 123 Ma‚Ä¶ 987-654-3210 bob@‚Ä¶ 45000 Marketing 2012-05-‚Ä¶ ## 3 Charlie 35 Tokyo 456-78‚Ä¶ 098-765-4332 char‚Ä¶ 60000 Finance 2015-10-‚Ä¶ ## 4 Ken 50 Toronto 49494 ‚Ä¶ 111-232-4141 ken@‚Ä¶ 20000 Marketing 2010-04-‚Ä¶ ## 5 Steven 60 Lima 1010 G‚Ä¶ 505-402-6060 step‚Ä¶ 40000 Marketing 2009-10-‚Ä¶ ## 6 Carlos 58 Cleveland 666 He‚Ä¶ 909-435-1000 carl‚Ä¶ 30000 Finance 2005-11-‚Ä¶ ## # ‚Ñπ 8 more variables: status , salary_increase_percentage , ## # years_of_service , bonus_amount , performance_rating , ## # performance_reviews_count , performance_reviews_last_updated , ## # familiarity Polars df \\ .with_columns([ pl.when(pl.col('address').str.contains('OH')) .then(pl.lit('local')) .when(pl.col('address').str.contains('NY')) .then(pl.lit('foodie')) .otherwise(pl.lit('elsewhere')) .alias('familiarity') ]) shape: (6, 17)nameagecityaddressphone_numberemailsalarydepartmenthire_datestatussalary_increase_percentageyears_of_servicebonus_amountperformance_ratingperformance_reviews_countperformance_reviews_last_updatedfamiliaritystri64strstrstrstri64strstrstri64i64i64i64i64strstr\"Alice\"30\"New York\"\"123 Main St, Ontario, OH\"\"123-456-7890\"\"alice@example.com\"50000\"Engineering\"\"2010-01-01\"\"Active\"105200042\"2022-05-01\"\"local\"\"Bob\"25\"San Francisco\"\"123 Main St, Calgary, AB\"\"987-654-3210\"\"bob@example.com\"45000\"Marketing\"\"2012-05-15\"\"Inactive\"53150031\"2021-07-15\"\"elsewhere\"\"Charlie\"35\"Tokyo\"\"456-7890, Tokyo, NY\"\"098-765-4332\"\"charlie@example.com\"60000\"Finance\"\"2015-10-01\"\"Active\"157300053\"2022-08-31\"\"foodie\"\"Ken\"50\"Toronto\"\"49494 Exchange St, Toronto, ON\"\"111-232-4141\"\"ken@stats.org\"20000\"Marketing\"\"2010-04-01\"\"Inactive\"1010500053\"2024-10-30\"\"elsewhere\"\"Steven\"60\"Lima\"\"1010 Gb st, Lima, OH\"\"505-402-6060\"\"stephencurry@nba.com\"40000\"Marketing\"\"2009-10-30\"\"Active\"1010300044\"2023-01-02\"\"local\"\"Carlos\"58\"Cleveland\"\"666 Heaven dr, Cleveland, OH\"\"909-435-1000\"\"carlos@genius.edu\"30000\"Finance\"\"2005-11-12\"\"Active\"512200045\"2024-12-12\"\"local\" Test 2 convert name data to lowercase create new column called email_name and extract email before the @ select columns that starts with name or end with name create a new column called same? if name and email_name is the same, then return yes otherwise return no Tidyverse df |> mutate( name = tolower(name), email_name = str_extract(email, \"^([\\d\\w]+)@\", group = 1) ) |> select(starts_with(\"name\") | ends_with(\"name\")) |> mutate(`same?` = case_when( name == email_name ~ \"yes\", TRUE ~ \"no\")) ## # A tibble: 6 √ó 3 ## name email_name `same?` ## ## 1 alice alice yes ## 2 bob bob yes ## 3 charlie charlie yes ## 4 ken ken yes ## 5 steven stephencurry no ## 6 carlos carlos yes Polars df \\ .with_columns( [ pl.col('name').str.to_lowercase(), pl.col('email').str.extract(r'^([\\d\\w]+)@', group_index = 1) .alias('email_name') ] ) \\ .select([ pl.col('^name|.*name$'), pl.when( pl.col('name') == pl.col('email_name')).then(pl.lit('yes')) .otherwise(pl.lit('no')) .alias('same?') ] ) shape: (6, 3)nameemail_namesame?strstrstr\"alice\"\"alice\"\"yes\"\"bob\"\"bob\"\"yes\"\"charlie\"\"charlie\"\"yes\"\"ken\"\"ken\"\"yes\"\"steven\"\"stephencurry\"\"no\"\"carlos\"\"carlos\"\"yes\" Learnt that apparently we cannot use look forward or backward in polars. Such as .*(?=@) to capture the email_name Group_by, Shift, Forward_Fill group by department column summarize by selecting name, new column salary_shift with conditions: if the department only has 1 row of salary data, do not shift salary if the department has more than 1 row of salary data, shift by -1 of salary column reason: there was a mistake in entering data for those with more than 1 row of data, apparently the actualy salary data is 1 row more then forward fill the salary_shift with the number prior in the same group Tidyverse df |> group_by(department) |> summarize( name = name, salary_shift = case_when( n() == 1 ~ salary, TRUE ~ lead(salary) ) ) |> fill(salary_shift, .direction = \"down\") ## Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in ## dplyr 1.1.0. ## ‚Ñπ Please use `reframe()` instead. ## ‚Ñπ When switching from `summarise()` to `reframe()`, remember that `reframe()` ## always returns an ungrouped data frame and adjust accordingly. ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was ## generated. ## `summarise()` has grouped output by 'department'. You can override using the ## `.groups` argument. ## # A tibble: 6 √ó 3 ## # Groups: department [3] ## department name salary_shift ## ## 1 Engineering Alice 50000 ## 2 Finance Charlie 30000 ## 3 Finance Carlos 30000 ## 4 Marketing Bob 20000 ## 5 Marketing Ken 40000 ## 6 Marketing Steven 40000 Polars df \\ .group_by('department') \\ .agg( pl.col('name'), pl.when(pl.col('salary').len()==1).then(pl.col('salary')) .otherwise(pl.col('salary').shift(-1)) .alias('salary_shift')) \\ .explode('name','salary_shift') \\ .with_columns( pl.col('salary_shift').forward_fill()) shape: (6, 3)departmentnamesalary_shiftstrstri64\"Engineering\"\"Alice\"50000\"Finance\"\"Charlie\"30000\"Finance\"\"Carlos\"30000\"Marketing\"\"Bob\"20000\"Marketing\"\"Ken\"40000\"Marketing\"\"Steven\"40000 Apparently polars would turn the column into a nested dataframe (list) when grouped and can‚Äôt do fill when it‚Äôs in list? will have to unnest by explode before fill can be used. Unless of coure if you merge the fill in the same line when shifting, such as df \\ .group_by('department') \\ .agg( pl.col('name'), pl.when(pl.col('salary').len()==1).then(pl.col('salary')) .otherwise(pl.col('salary').shift(-1)) .forward_fill() .alias('salary_shift')) Is There An Easier Way to Unnest without Typing ALL of the columns in Polars? Yes! I believe pl.col, pl.select, pl.filter all take a list of conditions. First create a list of columns you want to unnest, then use pl.col to select them. dt = [pl.List(pl.Int64),pl.List(pl.String)] df \\ .group_by('department', maintain_order=True) \\ .agg( pl.col('name'), pl.col('salary_increase_percentage'), salary_shift = pl.when(pl.col('salary').count() == 1) .then(pl.col('salary')) .otherwise(pl.col('salary').shift(-1)) ) \\ .explode(pl.col(dt)) \\ .with_columns( pl.col('salary_shift').forward_fill() ) \\ .with_columns( new_raise = pl.col('salary_shift') * (1+pl.col('salary_increase_percentage')/100) ) shape: (6, 5)departmentnamesalary_increase_percentagesalary_shiftnew_raisestrstri64i64f64\"Engineering\"\"Alice\"105000055000.0\"Marketing\"\"Bob\"52000021000.0\"Marketing\"\"Ken\"104000044000.0\"Marketing\"\"Steven\"104000044000.0\"Finance\"\"Charlie\"153000034500.0\"Finance\"\"Carlos\"53000031500.0 Merge / Join Create another mock data with dataframe called df_dept with columns department and dept_id Tidyverse df_dept left_join(df_dept, by = \"department\") |> select(name, dept_id) |> mutate(employee_id = map_chr(dept_id, ~paste0(.x, \"-\", sample(1000000:9999999, 1)))) ## # A tibble: 6 √ó 3 ## name dept_id employee_id ## ## 1 Alice 30 30-1694470 ## 2 Bob 25 25-1696036 ## 3 Charlie 20 20-4463080 ## 4 Ken 25 25-6942432 ## 5 Steven 25 25-3012223 ## 6 Carlos 20 20-8705991 Polars import random df \\ .join(df_dept, on=\"department\") \\ .select(['name','dept_id']) \\ .with_columns( employee_id = pl.format( '{}-{}', 'dept_id', pl.Series([ random.randint(100000, 999999) for _ in range(len(df)) ]) ) ) shape: (6, 3)namedept_idemployee_idstri64str\"Alice\"30\"30-832410\"\"Bob\"25\"25-883365\"\"Charlie\"20\"20-484404\"\"Ken\"25\"25-421175\"\"Steven\"25\"25-670538\"\"Carlos\"20\"20-638378\" there is a function called map_elements in polars but the documentation stated that it‚Äôs inefficient, essentially using a for loop. I‚Äôm not entirely certain if list comprehension above is any more efficient. Another probably more efficent way of doing this is 2 separate process. The random number generation on another dataframe, then merge it. To Dummies, Pivot_longer / Pivot_wider create dummy variables for department using name as index or id Tidyverse df |> select(name, department) |> pivot_wider(id_cols = \"name\", names_from = \"department\", values_from = \"department\", values_fill = 0, values_fn = length, names_prefix = \"department_\") ## # A tibble: 6 √ó 4 ## name department_Engineering department_Marketing department_Finance ## ## 1 Alice 1 0 0 ## 2 Bob 0 1 0 ## 3 Charlie 0 0 1 ## 4 Ken 0 1 0 ## 5 Steven 0 1 0 ## 6 Carlos 0 0 1 Polars - to_dummies df \\ .select(['name','department']) \\ .to_dummies(columns = 'department') shape: (6, 4)namedepartment_Engineeringdepartment_Financedepartment_Marketingstru8u8u8\"Alice\"100\"Bob\"001\"Charlie\"010\"Ken\"001\"Steven\"001\"Carlos\"010 Polars - pivot df \\ .select(['name','address']) \\ .with_columns( state = pl.col('address').str.extract(r'([A-Z]{2})$') ) \\ .select('name','state') \\ .pivot(on = 'state', index = 'name', values='state', aggregate_function='len') \\ .with_columns( pl.col(pl.UInt32).fill_null(0) ) shape: (6, 5)nameOHABNYONstru32u32u32u32\"Alice\"1000\"Bob\"0100\"Charlie\"0010\"Ken\"0001\"Steven\"1000\"Carlos\"1000 Essentially, pivot_wider is Polars‚Äô pivot. Whereas pivot_longer is Polars‚Äô unpivot Helpful Resources Polars Python API documentation Cheat sheet cookbook Polars for R Lessons Learnt: stringr::str_extract has the parameter group We cannot use look forward or backward in polars polars also has selector for looking at column names more efficiently lots of trial and error going to try doing pure Polars for a month! Wish me luck! If you like this article: please feel free to send me a comment or visit my other blogs please feel free to follow me on BlueSky, twitter, GitHub or Mastodon if you would like collaborate please feel free to contact me",
    "twitter_title": "Tidyverse ü™êto Polars üêª‚Äç‚ùÑÔ∏è: My Notes | R-bloggers",
    "url": "https://www.r-bloggers.com/2024/12/tidyverse-%F0%9F%AA%90to-polars-%F0%9F%90%BB%E2%80%8D%E2%9D%84%EF%B8%8F-my-notes/",
    "word_count": 2897
  }
}