{
  "uuid": "4a5d1dfd-0aaa-4d35-9501-7e1755f42d46",
  "created_at": "2025-11-17 20:38:45",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2023/12/powerquery-puzzle-solved-with-r-6/",
    "crawled_at": "2025-11-17T09:26:08.735675",
    "external_links": [
      {
        "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-54e7874691e3",
        "text": "Numbers around us - Medium"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://www.linkedin.com/posts/excelbi_challenge-powerquerychallenge-daxchallenge-activity-7144176565151600640-CoaZ",
        "text": "content"
      },
      {
        "href": "https://lnkd.in/dBhXAfxC",
        "text": "file"
      },
      {
        "href": "https://www.linkedin.com/posts/excelbi_challenge-powerquerychallenge-daxchallenge-activity-7144537173998854145-8LVg",
        "text": "content"
      },
      {
        "href": "https://lnkd.in/gjRguwRZ",
        "text": "file"
      },
      {
        "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-54e7874691e3",
        "text": "PowerQuery Puzzle solved with R"
      },
      {
        "href": "https://medium.com/number-around-us",
        "text": "Numbers around us"
      },
      {
        "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-54e7874691e3",
        "text": "Numbers around us - Medium"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "PowerQuery Puzzle solved with R | R-bloggers",
    "images": [
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*14NV469NFU8xWVV7mXhWlw.jpeg?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*wcIgd2eK1y55vHf2SiUkiw.png?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*16DORSTcK6PYEkcrYrpaSw.png?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": "data:application/octet-stream;base64,R0lGODlhAQABAO+/vQAA77+977+977+9AAAAIe+/vQQBAAAAACwAAAAAAQABAAACAkQBADs=",
        "src": "https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=54e7874691e3"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/numbers-around-us/",
        "text": "Numbers around us"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-381137 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">PowerQuery Puzzle solved with R</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">December 26, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/numbers-around-us/\">Numbers around us</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-54e7874691e3\"> Numbers around us - Medium</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9--><p># 141–142</p><figure><img alt=\"\" data-lazy-src=\"https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*14NV469NFU8xWVV7mXhWlw.jpeg?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*14NV469NFU8xWVV7mXhWlw.jpeg?w=578&amp;ssl=1\"/></noscript></figure><h3>Puzzles:</h3><p>PQ_141: <a href=\"https://www.linkedin.com/posts/excelbi_challenge-powerquerychallenge-daxchallenge-activity-7144176565151600640-CoaZ\" rel=\"nofollow\" target=\"_blank\">content</a> <a href=\"https://lnkd.in/dBhXAfxC\" rel=\"nofollow\" target=\"_blank\">file</a><br/>PQ_142: <a href=\"https://www.linkedin.com/posts/excelbi_challenge-powerquerychallenge-daxchallenge-activity-7144537173998854145-8LVg\" rel=\"nofollow\" target=\"_blank\">content</a> <a href=\"https://lnkd.in/gjRguwRZ\" rel=\"nofollow\" target=\"_blank\">file</a></p><p>Last time I noted that usually PQ Puzzles are focused on times and dates. And… it confirms this week. Lets count it.</p><h3>PQ_141</h3><figure><img alt=\"\" data-lazy-src=\"https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*wcIgd2eK1y55vHf2SiUkiw.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*wcIgd2eK1y55vHf2SiUkiw.png?w=578&amp;ssl=1\"/></noscript></figure><p>Rolling averages and other rolling calculations are very useful concepts because it can show us main trend cleaned from lower time granulation anomalies. In R we can play with comparison of dates to dates with lagged measurements. It is not hard but can complex task. Every complex task has much bigger chance for mistakes. Thats why I use dedicated package for out today puzzle. We have measurements for months and all we need is to calculate mean average from last 3 and 5 months.</p><h4>Load libraries and data</h4><pre>library(tidyverse)\nlibrary(slider)\nlibrary(readxl)\n\ninput = read_excel(\"Power Query/PQ_Challenge_141.xlsx\", range = \"A1:C35\")\ntest  = read_excel(\"Power Query/PQ_Challenge_141.xlsx\", range = \"E1:I35\")</pre><h4>Transformation</h4><pre>result = input %&gt;%\n  group_by(Month) %&gt;%\n  mutate(\n    `3 Year MV` = slide_dbl(Defects, mean,  \n                            .after = -1, \n                            .before = 3, \n                            .complete = TRUE) %&gt;% round(0),\n    `5 Year MV` = slide_dbl(Defects, mean, \n                            .after = -1, \n                            .before = 5, \n                            .complete = TRUE) %&gt;% round(0)\n  ) %&gt;% \n  ungroup()</pre><h4>Validation</h4><pre>identical(result, test)\n#&gt; [1] TRUE</pre><h3>PQ_142</h3><figure><img alt=\"\" data-lazy-src=\"https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*16DORSTcK6PYEkcrYrpaSw.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/cdn-images-1.medium.com/max/1024/1*16DORSTcK6PYEkcrYrpaSw.png?w=578&amp;ssl=1\"/></noscript></figure><p>In this puzzle we calculate something that HR called “head count”, which means number of people hired or working in certain period of time. In our task we have to create head count for each quarter of hour from 9AM to 9PM, having start and end time for 3 people. It can be tricky in some ways but I will explain it later.</p><h4>Load data and libraries</h4><pre>library(tidyverse)\nlibrary(readxl)\nlibrary(lubridate)\n\ninput = read_excel(\"Power Query/PQ_Challenge_142.xlsx\", range = \"A1:C4\") \n  %&gt;% janitor::clean_names()\ntest = read_excel(\"Power Query/PQ_Challenge_142.xlsx\", range = \"E1:F49\")</pre><h4>Transformation</h4><pre>input &lt;- input %&gt;%\n  mutate(interval = interval(ymd_hms(start_time), ymd_hms(end_time)))\n\nquarter_table &lt;- tibble(\n  interval = interval(\n    seq(ymd_hms(\"1899-12-31 09:00:00\"), \n        ymd_hms(\"1899-12-31 20:45:00\"), \n        by = \"15 mins\"),\n    seq(ymd_hms(\"1899-12-31 09:14:59\"), \n        ymd_hms(\"1899-12-31 20:59:59\"), \n        by = \"15 mins\")\n  )\n)\nhead_count &lt;- quarter_table %&gt;%\n  mutate(\n    Count = map_dbl(interval, ~sum(int_overlaps(.x, input$interval))),\n    Time = paste(format(int_start(interval), \"%I:%M:%S %p\"), \n                 format(int_end(interval), \"%I:%M:%S %p\"), \n                 sep = \" - \")\n  ) %&gt;%\n  select(Time, Count)</pre><h4>Validation</h4><blockquote>You can validate it by your eyes, because there is one issue. If we want to have disjoint time intervals we need to finish previous one second before the next started. But if we do it that way we have problem with person who ends its job at 19:00:00 because it would look like working only one second in next interval. That is why I cannot validate it with given results, but except one line values are exactly the same.</blockquote><p>Thanks for your engagement, and let me know if you have any comments. Stay tuned, because this Thursday article about memoization will be online.</p><img alt=\"\" data-lazy-src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=54e7874691e3\" height=\"1\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"1\"/><noscript><img alt=\"\" height=\"1\" loading=\"lazy\" src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=54e7874691e3\" width=\"1\"/></noscript><hr/><p><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-54e7874691e3\" rel=\"nofollow\" target=\"_blank\">PowerQuery Puzzle solved with R</a> was originally published in <a href=\"https://medium.com/number-around-us\" rel=\"nofollow\" target=\"_blank\">Numbers around us</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-54e7874691e3\"> Numbers around us - Medium</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
    "main_text": "PowerQuery Puzzle solved with R\nPosted on\nDecember 26, 2023\nby\nNumbers around us\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nNumbers around us - Medium\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\n# 141–142\nPuzzles:\nPQ_141:\ncontent\nfile\nPQ_142:\ncontent\nfile\nLast time I noted that usually PQ Puzzles are focused on times and dates. And… it confirms this week. Lets count it.\nPQ_141\nRolling averages and other rolling calculations are very useful concepts because it can show us main trend cleaned from lower time granulation anomalies. In R we can play with comparison of dates to dates with lagged measurements. It is not hard but can complex task. Every complex task has much bigger chance for mistakes. Thats why I use dedicated package for out today puzzle. We have measurements for months and all we need is to calculate mean average from last 3 and 5 months.\nLoad libraries and data\nlibrary(tidyverse)\nlibrary(slider)\nlibrary(readxl)\n\ninput = read_excel(\"Power Query/PQ_Challenge_141.xlsx\", range = \"A1:C35\")\ntest  = read_excel(\"Power Query/PQ_Challenge_141.xlsx\", range = \"E1:I35\")\nTransformation\nresult = input %>%\n  group_by(Month) %>%\n  mutate(\n    `3 Year MV` = slide_dbl(Defects, mean,  \n                            .after = -1, \n                            .before = 3, \n                            .complete = TRUE) %>% round(0),\n    `5 Year MV` = slide_dbl(Defects, mean, \n                            .after = -1, \n                            .before = 5, \n                            .complete = TRUE) %>% round(0)\n  ) %>% \n  ungroup()\nValidation\nidentical(result, test)\n#> [1] TRUE\nPQ_142\nIn this puzzle we calculate something that HR called “head count”, which means number of people hired or working in certain period of time. In our task we have to create head count for each quarter of hour from 9AM to 9PM, having start and end time for 3 people. It can be tricky in some ways but I will explain it later.\nLoad data and libraries\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(lubridate)\n\ninput = read_excel(\"Power Query/PQ_Challenge_142.xlsx\", range = \"A1:C4\") \n  %>% janitor::clean_names()\ntest = read_excel(\"Power Query/PQ_Challenge_142.xlsx\", range = \"E1:F49\")\nTransformation\ninput <- input %>%\n  mutate(interval = interval(ymd_hms(start_time), ymd_hms(end_time)))\n\nquarter_table <- tibble(\n  interval = interval(\n    seq(ymd_hms(\"1899-12-31 09:00:00\"), \n        ymd_hms(\"1899-12-31 20:45:00\"), \n        by = \"15 mins\"),\n    seq(ymd_hms(\"1899-12-31 09:14:59\"), \n        ymd_hms(\"1899-12-31 20:59:59\"), \n        by = \"15 mins\")\n  )\n)\nhead_count <- quarter_table %>%\n  mutate(\n    Count = map_dbl(interval, ~sum(int_overlaps(.x, input$interval))),\n    Time = paste(format(int_start(interval), \"%I:%M:%S %p\"), \n                 format(int_end(interval), \"%I:%M:%S %p\"), \n                 sep = \" - \")\n  ) %>%\n  select(Time, Count)\nValidation\nYou can validate it by your eyes, because there is one issue. If we want to have disjoint time intervals we need to finish previous one second before the next started. But if we do it that way we have problem with person who ends its job at 19:00:00 because it would look like working only one second in next interval. That is why I cannot validate it with given results, but except one line values are exactly the same.\nThanks for your engagement, and let me know if you have any comments. Stay tuned, because this Thursday article about memoization will be online.\nPowerQuery Puzzle solved with R\nwas originally published in\nNumbers around us\non Medium, where people are continuing the conversation by highlighting and responding to this story.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nNumbers around us - Medium\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "# 141–142Puzzles:PQ_141: content filePQ_142: content fileLast time I noted that usually PQ Puzzles are focused on times and dates. And… it confirms this week. Lets count it.PQ_141Rolling averages and other rolling calculations are very useful concepts ...",
    "meta_keywords": null,
    "og_description": "# 141–142Puzzles:PQ_141: content filePQ_142: content fileLast time I noted that usually PQ Puzzles are focused on times and dates. And… it confirms this week. Lets count it.PQ_141Rolling averages and other rolling calculations are very useful concepts ...",
    "og_image": "https://cdn-images-1.medium.com/max/1024/1*14NV469NFU8xWVV7mXhWlw.jpeg",
    "og_title": "PowerQuery Puzzle solved with R | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 3.2,
    "sitemap_lastmod": "2023-12-26T12:25:21+00:00",
    "twitter_description": "# 141–142Puzzles:PQ_141: content filePQ_142: content fileLast time I noted that usually PQ Puzzles are focused on times and dates. And… it confirms this week. Lets count it.PQ_141Rolling averages and other rolling calculations are very useful concepts ...",
    "twitter_title": "PowerQuery Puzzle solved with R | R-bloggers",
    "url": "https://www.r-bloggers.com/2023/12/powerquery-puzzle-solved-with-r-6/",
    "word_count": 638
  }
}