{
  "uuid": "f6fdadb8-3c5c-4f1b-8ba3-07452fd9b537",
  "created_at": "2025-11-22 19:59:31",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2025/01/using-gganimate-and-ggflags-to-look-at-democratic-progress/",
    "crawled_at": "2025-11-22T10:56:04.000272",
    "external_links": [
      {
        "href": "https://www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/",
        "text": "John Russell"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://github.com/rfordatascience/tidytuesday/blob/main/data/2024/2024-11-05/readme.md",
        "text": "Democracy and Dictatorship"
      },
      {
        "href": "https://github.com/jimjam-slam/ggflags",
        "text": "ggflags"
      },
      {
        "href": "https://github.com/vincentarelbundock/countrycode",
        "text": "countrycodes"
      },
      {
        "href": "https://gist.github.com/metal3d",
        "text": "Patrice Ferlet"
      },
      {
        "href": "https://github.com/eliocamp/metR",
        "text": "metR"
      },
      {
        "href": "https://drjohnrussell.github.io/posts/2024-01-13-gganimate-ggflag/",
        "text": "https://drjohnrussell.github.io/posts/2024-01-13-gganimate-ggflag/"
      },
      {
        "href": "https://www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/",
        "text": "John Russell"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Using gganimate and ggflags to look at democratic progress | R-bloggers",
    "images": [
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/index_files/figure-html/unnamed-chunk-5-1.png?w=450&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i0.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/index_files/figure-html/unnamed-chunk-8-1.png?w=450&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i2.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/index_files/figure-html/unnamed-chunk-9-1.png?w=450&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i1.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/img/Europe.gif?w=578&ssl=1"
      },
      {
        "alt": null,
        "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
        "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
      },
      {
        "alt": null,
        "base64": null,
        "src": "https://i0.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/img/Africa.gif?w=578&ssl=1"
      }
    ],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/john-russell/",
        "text": "John Russell"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-389849 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Using gganimate and ggflags to look at democratic progress</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">January 12, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/john-russell/\">John Russell</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/\"> John Russell</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<section class=\"level2\" id=\"loading-and-exploring-a-tidy-tuesday-dataset\">\n<h2 class=\"anchored\" data-anchor-id=\"loading-and-exploring-a-tidy-tuesday-dataset\">Loading and Exploring a Tidy Tuesday Dataset</h2>\n<p>One of my New Year’s resolutions was to become less of a lurker and more of a doer within the Tidy Tuesday community. There had been one dataset that I was super interested in exploring, based on <a href=\"https://github.com/rfordatascience/tidytuesday/blob/main/data/2024/2024-11-05/readme.md\" rel=\"nofollow\" target=\"_blank\">Democracy and Dictatorship</a>. Loaded the dataset and a few packages.</p>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>library(tidytuesdayR)\nlibrary(tidyverse)\nlibrary(countrycode) #this package looks up ISO codes, which can be useful\nlibrary(ggflags) #pulls flags\nlibrary(gganimate) #animations\n\ndat &lt;- tidytuesdayR::tt_load(2024, week = 45)\ndemocracy &lt;- dat$democracy_data\n\nhead(democracy)</pre>\n</details>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 6 × 43\n  country_name country_code  year regime_category_index regime_category   \n  &lt;chr&gt;        &lt;chr&gt;        &lt;dbl&gt;                 &lt;dbl&gt; &lt;chr&gt;             \n1 Afghanistan  AFG           1950                     5 Royal dictatorship\n2 Afghanistan  AFG           1951                     5 Royal dictatorship\n3 Afghanistan  AFG           1952                     5 Royal dictatorship\n4 Afghanistan  AFG           1953                     5 Royal dictatorship\n5 Afghanistan  AFG           1954                     5 Royal dictatorship\n6 Afghanistan  AFG           1955                     5 Royal dictatorship\n# ℹ 38 more variables: is_monarchy &lt;lgl&gt;, is_commonwealth &lt;lgl&gt;,\n#   monarch_name &lt;chr&gt;, monarch_accession_year &lt;dbl&gt;, monarch_birthyear &lt;dbl&gt;,\n#   is_female_monarch &lt;lgl&gt;, is_democracy &lt;lgl&gt;, is_presidential &lt;lgl&gt;,\n#   president_name &lt;chr&gt;, president_accesion_year &lt;dbl&gt;,\n#   president_birthyear &lt;dbl&gt;, is_interim_phase &lt;lgl&gt;,\n#   is_female_president &lt;lgl&gt;, is_colony &lt;lgl&gt;, colony_of &lt;chr&gt;,\n#   colony_administrated_by &lt;chr&gt;, is_communist &lt;lgl&gt;, …</pre>\n</div>\n</div>\n<p>This dataset shows, for every year from 1950 to 2000, classifications for countries around the world. In the spirit of January 6th, I chose to focus on whether countries have free and fair elections, here shown as <code>has_free_and_fair_election</code>.</p>\n<p>In the interest of this exploration, I’m not interested in colonies, which are shown as <code>NA</code> in the <code>regime_category_index</code>.</p>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>democracy &lt;- democracy |&gt; \n  ## removing colonies as much as possible to get down to countries\n  filter(!is.na(regime_category_index),\n         ## British Virgin Islands oddly keeps showing up in spite of status as colony\n         country_code!=\"VGB\") </pre>\n</details>\n</div>\n<section class=\"level3\" id=\"first-exploration---understanding-areas-with-democratic-changes\">\n<h3 class=\"anchored\" data-anchor-id=\"first-exploration---understanding-areas-with-democratic-changes\">First exploration - understanding areas with democratic changes</h3>\n<p>My first inclination in the dataset was to take out the countries that only had free and fair elections or a lack thereof, in order to understand places that had democratic progress and democratic backsliding. This required setting up a filter for this work. <code>tabyl</code> from the janitor package is well set up for this, as it will quickly come up with cross counts.</p>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>democracyfilter &lt;- democracy |&gt; \n  janitor::tabyl(country_name,has_free_and_fair_election) |&gt; \n  filter(`TRUE` &gt; 0 &amp; `FALSE` &gt; 0)</pre>\n</details>\n</div>\n<p>This gives a nice filter for this work. In order to use the <a href=\"https://github.com/jimjam-slam/ggflags\" rel=\"nofollow\" target=\"_blank\">ggflags</a> package, you need for the countries to be spelled out in iso2c format. Fortunately, the amazing <a href=\"https://github.com/vincentarelbundock/countrycode\" rel=\"nofollow\" target=\"_blank\">countrycodes</a> package will do that for you, and in addition, it can provide the continent for you as well, for additional explorations.</p>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>democraticchanges &lt;- democracy |&gt; \n  inner_join(democracyfilter) |&gt; \n  mutate(iso2=countrycode(country_name,\"country.name\",\"iso2c\"),\n         continent = countrycode(iso2, \"iso2c\", \"continent\")) |&gt; \n  arrange(continent,`FALSE`) |&gt; \n         mutate(country_name=fct_inorder(country_name))</pre>\n</details>\n</div>\n<p>Now we are ready to plot this with the help of the <code>ggflags</code> package. Let’s look at Europe and Africa, two continents associated with democratic progress and backsliding.</p>\n<p>There is one big issue - we would like for this to show up as continuous bars, which your typical geoms will not do. However, we can think of the bars as parts of a rectangle, that extend from the beginning to end of each year. If we factor the countries, we can then plot them and rename the y axis at the end.</p>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>## Let's create the y-labels for later on\ny_lab &lt;- democraticchanges |&gt; \n  distinct(country_name,iso2,continent)  |&gt; \n  mutate(y_mid = as.numeric(country_name),\n         name=country_name)\n## For Africa\nAfrica &lt;- democraticchanges |&gt; \n  filter(continent==\"Africa\") |&gt; \n  ggplot(aes(xmin=year, #left boundary of the rectangle\n             xmax=year+1, #right boundary of the rectangle\n             ymin=as.numeric(country_name)-.3, #lower boundary of the rectangle\n             ymax=as.numeric(country_name)+.3, #upper boundary of the rectangle\n             fill=has_free_and_fair_election)) +\n  geom_rect() +\n  # now let's plot flags between the rectangles and the y axis\n  ggflags::geom_flag(data=y_lab |&gt; \n                       filter(continent==\"Africa\"),\n                     mapping=aes(y=y_mid,\n                                 country=tolower(iso2), #ggflags needs lowercase iso2 to work\n                                 x=1945),\n                     inherit.aes=FALSE) + #we want this to be individual to this layer\n                     #now to rename the y axis\n  scale_y_continuous(breaks=y_lab$y_mid,labels=y_lab$country_name) +\n  theme_minimal() +\n  theme(legend.position=\"bottom\",\n        legend.text=element_text(size=7),\n        legend.title=element_text(size=7)) +\n  labs(x=\"\",\n       y=\"\",\n       fill=\"Has Free and Fair Elections\") +\n  scale_fill_brewer(palette=\"Set1\") +\n  facet_wrap(~continent,ncol=1,scales=\"free\",strip.position=\"right\")\n\nEurope &lt;- democraticchanges |&gt; \n  filter(continent==\"Europe\") |&gt; \n  ggplot(aes(xmin=year,\n             xmax=year+1,\n             ymin=as.numeric(country_name)-.3,\n             ymax=as.numeric(country_name)+.3,\n             fill=has_free_and_fair_election)) +\n  geom_rect() +\n  ggflags::geom_flag(data=y_lab |&gt; \n                       filter(continent==\"Europe\"),\n                     mapping=aes(y=y_mid,country=tolower(iso2),x=1945),inherit.aes=FALSE) +\n  scale_y_continuous(breaks=y_lab$y_mid,labels=y_lab$country_name) +\n  theme_minimal() +\n  theme(legend.position=\"bottom\",\n        legend.text=element_text(size=7),\n        legend.title=element_text(size=7)) +\n  labs(x=\"\",\n       y=\"\",\n       fill=\"Has Free and Fair Elections\") +\n  scale_fill_brewer(palette=\"Set1\") +\n  facet_wrap(~continent,ncol=1,scales=\"free\",strip.position=\"right\")\n\n## Let's take advantage of patchwork to plot these graphs next to each other with a common legend\nlibrary(patchwork)\nEurope + Africa + plot_layout(guides = 'collect') &amp; theme(legend.position = 'bottom')</pre>\n</details>\n<div class=\"cell-output-display\">\n<div>\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i2.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/index_files/figure-html/unnamed-chunk-5-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/index_files/figure-html/unnamed-chunk-5-1.png?w=450&amp;ssl=1\"/></noscript></p>\n</figure>\n</div>\n</div>\n</div>\n<p>This is fun! Let’s make a map and animate it.</p>\n</section>\n<section class=\"level3\" id=\"gganimation-for-a-map-to-show-progressbacksliding\">\n<h3 class=\"anchored\" data-anchor-id=\"gganimation-for-a-map-to-show-progressbacksliding\">gganimation for a map to show progress/backsliding</h3>\n<p>One can see at a glance that, in Europe, there appears to be a democratic progression. Similarly, in Africa, there is a progression, but there is also backsliding. It would also be really useful to see this as a map - moreover, it would be really interesting to see as an animated map.</p>\n<p><code>rnaturalearth</code> is a package that allows you to easily download map borders. <a href=\"https://gist.github.com/metal3d\" rel=\"nofollow\" target=\"_blank\">Patrice Ferlet</a> keeps a dataset of the centroid for countries that we can plot the flags on as well.</p>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>library(rnaturalearth)\n\nworld &lt;- ne_countries(type=\"countries\",returnclass=\"sf\")\n\ncoord &lt;- read_csv(\"https://gist.github.com/metal3d/5b925077e66194551df949de64e910f6/raw/c5f20a037409d96958553e2eb6b8251265c6fd63/country-coord.csv\") |&gt; \n  mutate(`Alpha-2 code`=replace_na(`Alpha-2 code`,\"NA\")) |&gt; \n  rename(code=`Alpha-2 code`,\n         lat=`Latitude (average)`,\n         lon=`Longitude (average)`)</pre>\n</details>\n</div>\n<p>Now let’s take the democracy dataset from earlier, and <code>left_join</code> the dataset to the lat/long dataset as well as the world dataset</p>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>democracymap &lt;- democracy |&gt; \n  mutate(iso2=countrycode(country_name,\"country.name\",\"iso2c\"),\n         continent = countrycode(iso2, \"iso2c\", \"continent\")) |&gt; \n  select(country_name,year,has_free_and_fair_election,iso2,continent) |&gt; \n  left_join(coord |&gt;\n              select(code,lat,lon),by=c(\"iso2\"=\"code\"))\n\ndemocracymap &lt;- democracymap |&gt; \n  select(country_name,year,has_free_and_fair_election,iso2,lat,lon) |&gt; \n  left_join(world, by=c(\"iso2\"=\"iso_a2_eh\")) |&gt; \n  filter(!is.na(geometry)) |&gt; \n  mutate(year=as.integer(year)) #this is necessary for the animation to progress frame by frame</pre>\n</details>\n</div>\n<p>We build this layer by layer. We want a base map of current boundaries, so we can take the current dataset and bring in one year’s worth of data.</p>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>map &lt;- democracymap |&gt; \n  filter(year==2020, !is.na(geometry)) |&gt; \n  select(-year)\n\nmap |&gt; \n  ggplot() + geom_sf(aes(geometry=geometry))</pre>\n</details>\n<div class=\"cell-output-display\">\n<div class=\"quarto-figure quarto-figure-center\">\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i0.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/index_files/figure-html/unnamed-chunk-8-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/index_files/figure-html/unnamed-chunk-8-1.png?w=450&amp;ssl=1\"/></noscript></p>\n<figcaption>World Map</figcaption>\n</figure>\n</div>\n</div>\n</div>\n<p>Then we can layer this map easily. Notice that the latitude and longitude signs are not typical of a map - the excellent <a href=\"https://github.com/eliocamp/metR\" rel=\"nofollow\" target=\"_blank\">metR</a> package includes helpful themes and scales for meteorological data, which applies to maps as well!</p>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>democracymap2 &lt;- democracymap |&gt; \n  filter(has_free_and_fair_election==TRUE)\n\nlibrary(metR)\n\nmap |&gt; \n  ggplot() +\n  geom_sf(mapping=aes(geometry=geometry),fill=\"white\",color=\"black\") +\n  geom_sf(data=democracymap2,\n          mapping=aes(geometry=geometry),color=NA,fill=\"blue\",\n          show.legend=FALSE)+\n  scale_x_longitude() +\n  scale_y_latitude() +\n  facet_wrap(~year) +\n  theme_bw() +\n  theme(axis.text=element_blank(),\n        axis.ticks=element_blank(),\n        strip.text=element_text(size=8,\n                                margin = margin(0,0,0,0, \"cm\")))</pre>\n</details>\n<div class=\"cell-output-display\">\n<div class=\"quarto-figure quarto-figure-center\">\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i2.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/index_files/figure-html/unnamed-chunk-9-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/index_files/figure-html/unnamed-chunk-9-1.png?w=450&amp;ssl=1\"/></noscript></p>\n<figcaption>A facet of the world</figcaption>\n</figure>\n</div>\n</div>\n</div>\n<p>This map is a bit overwhelming, let’s use <code>gganimate</code> and focus on Europe and Africa. Comments below to walk through the European one. Because it’s tough to render, I saved it locally and then loaded it up on the website. Hooray!</p>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>#Europe\n#First a base layer\nEurope2 &lt;- map |&gt; \n  filter(continent==\"Europe\") |&gt; \n  ggplot() +\n  # note that fill is the inside and color is the border in geom_sf\n  geom_sf(mapping=aes(geometry=geometry),fill=\"white\",color=\"black\") +\n#Then the democracy data\n  geom_sf(data=democracymap2 |&gt; \n            filter(continent==\"Europe\"),\n          mapping=aes(geometry=geometry),\n          color=\"black\",\n          show.legend=FALSE) +\n  ggflags::geom_flag(data=democracymap2 |&gt; \n                       filter(continent==\"Europe\",\n                              has_free_and_fair_election==TRUE),\n                     mapping=aes(y=lat,x=lon,country=tolower(iso2)),\n                     inherit.aes=FALSE) +\n  # gganimate allows you to use {closest_state} to fill in the transition label\n  labs(title= 'Year: {closest_state}') +\n  #metR scales\n  scale_x_longitude() +\n  scale_y_latitude() +\n  #gganimate transitions for the gif\n  transition_states(year) +\n  theme_bw() +\n  coord_sf(xlim=c(-20,40),\n           ylim=c(30,70),\n           default_crs=sf::st_crs(4326))\n\n#anim_save(filename=\"img/Europe.gif\",animation=Europe2)</pre>\n</details>\n</div>\n<div class=\"quarto-figure quarto-figure-center\">\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i1.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/img/Europe.gif?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/img/Europe.gif?w=578&amp;ssl=1\"/></noscript></p>\n<figcaption>Free and Fair Elections in Europe</figcaption>\n</figure>\n</div>\n<div class=\"cell\">\n<details class=\"code-fold\" open=\"\">\n<summary>Code in R</summary>\n<pre>#Africa\nAfrica2 &lt;- map |&gt; \n  filter(continent==\"Africa\") |&gt; \n  ggplot() +\n  geom_sf(mapping=aes(geometry=geometry),fill=\"white\",color=\"black\") +\n  geom_sf(data=democracymap2 |&gt; \n            filter(continent==\"Africa\"),\n          mapping=aes(geometry=geometry),color=\"black\",\n          show.legend=FALSE) +\n  scale_x_longitude() +\n  scale_y_latitude() +\n  ggflags::geom_flag(data=democracymap2 |&gt; \n                       filter(continent==\"Africa\",\n                              has_free_and_fair_election==TRUE),\n                     mapping=aes(y=lat,x=lon,\n                                 country=tolower(iso2)),\n                     inherit.aes=FALSE) +\n  labs(title = 'Year: {closest_state}') +\n  theme_bw() +\n  transition_states(year) +\n  coord_sf(default_crs=sf::st_crs(4326))\n\n#anim_save(filename=\"img/Africa.gif\",animation=Africa2)</pre>\n</details>\n</div>\n<div class=\"quarto-figure quarto-figure-center\">\n<figure class=\"figure\">\n<p><img class=\"img-fluid figure-img\" data-lazy-src=\"https://i0.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/img/Africa.gif?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img class=\"img-fluid figure-img\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/img/Africa.gif?w=578&amp;ssl=1\"/></noscript></p>\n<figcaption>Free and Fair Elections in Africa</figcaption>\n</figure>\n</div>\n</section>\n</section>\n<div class=\"default\" id=\"quarto-appendix\"><section class=\"quarto-appendix-contents\" id=\"quarto-citation\"><h2 class=\"anchored quarto-appendix-heading\">Citation</h2><div><div class=\"quarto-appendix-secondary-label\">BibTeX citation:</div><pre>@online{russell2025,\n  author = {Russell, John},\n  title = {Using Gganimate and Ggflags to Look at Democratic Progress},\n  date = {2025-01-13},\n  url = {https://drjohnrussell.github.io/posts/2024-01-13-gganimate-ggflag/},\n  langid = {en}\n}\n</pre><div class=\"quarto-appendix-secondary-label\">For attribution, please cite this work as:</div><div class=\"csl-entry quarto-appendix-citeas\" id=\"ref-russell2025\">\nRussell, John. 2025. <span>“Using Gganimate and Ggflags to Look at\nDemocratic Progress.”</span> January 13, 2025. <a href=\"https://drjohnrussell.github.io/posts/2024-01-13-gganimate-ggflag/\" rel=\"nofollow\" target=\"_blank\">https://drjohnrussell.github.io/posts/2024-01-13-gganimate-ggflag/</a>.\n</div></div></section></div>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/\"> John Russell</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
    "main_text": "Using gganimate and ggflags to look at democratic progress\nPosted on\nJanuary 12, 2025\nby\nJohn Russell\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nJohn Russell\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nLoading and Exploring a Tidy Tuesday Dataset\nOne of my New Year’s resolutions was to become less of a lurker and more of a doer within the Tidy Tuesday community. There had been one dataset that I was super interested in exploring, based on\nDemocracy and Dictatorship\n. Loaded the dataset and a few packages.\nCode in R\nlibrary(tidytuesdayR)\nlibrary(tidyverse)\nlibrary(countrycode) #this package looks up ISO codes, which can be useful\nlibrary(ggflags) #pulls flags\nlibrary(gganimate) #animations\n\ndat <- tidytuesdayR::tt_load(2024, week = 45)\ndemocracy <- dat$democracy_data\n\nhead(democracy)\n# A tibble: 6 × 43\n  country_name country_code  year regime_category_index regime_category   \n  <chr>        <chr>        <dbl>                 <dbl> <chr>             \n1 Afghanistan  AFG           1950                     5 Royal dictatorship\n2 Afghanistan  AFG           1951                     5 Royal dictatorship\n3 Afghanistan  AFG           1952                     5 Royal dictatorship\n4 Afghanistan  AFG           1953                     5 Royal dictatorship\n5 Afghanistan  AFG           1954                     5 Royal dictatorship\n6 Afghanistan  AFG           1955                     5 Royal dictatorship\n# ℹ 38 more variables: is_monarchy <lgl>, is_commonwealth <lgl>,\n#   monarch_name <chr>, monarch_accession_year <dbl>, monarch_birthyear <dbl>,\n#   is_female_monarch <lgl>, is_democracy <lgl>, is_presidential <lgl>,\n#   president_name <chr>, president_accesion_year <dbl>,\n#   president_birthyear <dbl>, is_interim_phase <lgl>,\n#   is_female_president <lgl>, is_colony <lgl>, colony_of <chr>,\n#   colony_administrated_by <chr>, is_communist <lgl>, …\nThis dataset shows, for every year from 1950 to 2000, classifications for countries around the world. In the spirit of January 6th, I chose to focus on whether countries have free and fair elections, here shown as\nhas_free_and_fair_election\n.\nIn the interest of this exploration, I’m not interested in colonies, which are shown as\nNA\nin the\nregime_category_index\n.\nCode in R\ndemocracy <- democracy |> \n  ## removing colonies as much as possible to get down to countries\n  filter(!is.na(regime_category_index),\n         ## British Virgin Islands oddly keeps showing up in spite of status as colony\n         country_code!=\"VGB\")\nFirst exploration - understanding areas with democratic changes\nMy first inclination in the dataset was to take out the countries that only had free and fair elections or a lack thereof, in order to understand places that had democratic progress and democratic backsliding. This required setting up a filter for this work.\ntabyl\nfrom the janitor package is well set up for this, as it will quickly come up with cross counts.\nCode in R\ndemocracyfilter <- democracy |> \n  janitor::tabyl(country_name,has_free_and_fair_election) |> \n  filter(`TRUE` > 0 & `FALSE` > 0)\nThis gives a nice filter for this work. In order to use the\nggflags\npackage, you need for the countries to be spelled out in iso2c format. Fortunately, the amazing\ncountrycodes\npackage will do that for you, and in addition, it can provide the continent for you as well, for additional explorations.\nCode in R\ndemocraticchanges <- democracy |> \n  inner_join(democracyfilter) |> \n  mutate(iso2=countrycode(country_name,\"country.name\",\"iso2c\"),\n         continent = countrycode(iso2, \"iso2c\", \"continent\")) |> \n  arrange(continent,`FALSE`) |> \n         mutate(country_name=fct_inorder(country_name))\nNow we are ready to plot this with the help of the\nggflags\npackage. Let’s look at Europe and Africa, two continents associated with democratic progress and backsliding.\nThere is one big issue - we would like for this to show up as continuous bars, which your typical geoms will not do. However, we can think of the bars as parts of a rectangle, that extend from the beginning to end of each year. If we factor the countries, we can then plot them and rename the y axis at the end.\nCode in R\n## Let's create the y-labels for later on\ny_lab <- democraticchanges |> \n  distinct(country_name,iso2,continent)  |> \n  mutate(y_mid = as.numeric(country_name),\n         name=country_name)\n## For Africa\nAfrica <- democraticchanges |> \n  filter(continent==\"Africa\") |> \n  ggplot(aes(xmin=year, #left boundary of the rectangle\n             xmax=year+1, #right boundary of the rectangle\n             ymin=as.numeric(country_name)-.3, #lower boundary of the rectangle\n             ymax=as.numeric(country_name)+.3, #upper boundary of the rectangle\n             fill=has_free_and_fair_election)) +\n  geom_rect() +\n  # now let's plot flags between the rectangles and the y axis\n  ggflags::geom_flag(data=y_lab |> \n                       filter(continent==\"Africa\"),\n                     mapping=aes(y=y_mid,\n                                 country=tolower(iso2), #ggflags needs lowercase iso2 to work\n                                 x=1945),\n                     inherit.aes=FALSE) + #we want this to be individual to this layer\n                     #now to rename the y axis\n  scale_y_continuous(breaks=y_lab$y_mid,labels=y_lab$country_name) +\n  theme_minimal() +\n  theme(legend.position=\"bottom\",\n        legend.text=element_text(size=7),\n        legend.title=element_text(size=7)) +\n  labs(x=\"\",\n       y=\"\",\n       fill=\"Has Free and Fair Elections\") +\n  scale_fill_brewer(palette=\"Set1\") +\n  facet_wrap(~continent,ncol=1,scales=\"free\",strip.position=\"right\")\n\nEurope <- democraticchanges |> \n  filter(continent==\"Europe\") |> \n  ggplot(aes(xmin=year,\n             xmax=year+1,\n             ymin=as.numeric(country_name)-.3,\n             ymax=as.numeric(country_name)+.3,\n             fill=has_free_and_fair_election)) +\n  geom_rect() +\n  ggflags::geom_flag(data=y_lab |> \n                       filter(continent==\"Europe\"),\n                     mapping=aes(y=y_mid,country=tolower(iso2),x=1945),inherit.aes=FALSE) +\n  scale_y_continuous(breaks=y_lab$y_mid,labels=y_lab$country_name) +\n  theme_minimal() +\n  theme(legend.position=\"bottom\",\n        legend.text=element_text(size=7),\n        legend.title=element_text(size=7)) +\n  labs(x=\"\",\n       y=\"\",\n       fill=\"Has Free and Fair Elections\") +\n  scale_fill_brewer(palette=\"Set1\") +\n  facet_wrap(~continent,ncol=1,scales=\"free\",strip.position=\"right\")\n\n## Let's take advantage of patchwork to plot these graphs next to each other with a common legend\nlibrary(patchwork)\nEurope + Africa + plot_layout(guides = 'collect') & theme(legend.position = 'bottom')\nThis is fun! Let’s make a map and animate it.\ngganimation for a map to show progress/backsliding\nOne can see at a glance that, in Europe, there appears to be a democratic progression. Similarly, in Africa, there is a progression, but there is also backsliding. It would also be really useful to see this as a map - moreover, it would be really interesting to see as an animated map.\nrnaturalearth\nis a package that allows you to easily download map borders.\nPatrice Ferlet\nkeeps a dataset of the centroid for countries that we can plot the flags on as well.\nCode in R\nlibrary(rnaturalearth)\n\nworld <- ne_countries(type=\"countries\",returnclass=\"sf\")\n\ncoord <- read_csv(\"https://gist.github.com/metal3d/5b925077e66194551df949de64e910f6/raw/c5f20a037409d96958553e2eb6b8251265c6fd63/country-coord.csv\") |> \n  mutate(`Alpha-2 code`=replace_na(`Alpha-2 code`,\"NA\")) |> \n  rename(code=`Alpha-2 code`,\n         lat=`Latitude (average)`,\n         lon=`Longitude (average)`)\nNow let’s take the democracy dataset from earlier, and\nleft_join\nthe dataset to the lat/long dataset as well as the world dataset\nCode in R\ndemocracymap <- democracy |> \n  mutate(iso2=countrycode(country_name,\"country.name\",\"iso2c\"),\n         continent = countrycode(iso2, \"iso2c\", \"continent\")) |> \n  select(country_name,year,has_free_and_fair_election,iso2,continent) |> \n  left_join(coord |>\n              select(code,lat,lon),by=c(\"iso2\"=\"code\"))\n\ndemocracymap <- democracymap |> \n  select(country_name,year,has_free_and_fair_election,iso2,lat,lon) |> \n  left_join(world, by=c(\"iso2\"=\"iso_a2_eh\")) |> \n  filter(!is.na(geometry)) |> \n  mutate(year=as.integer(year)) #this is necessary for the animation to progress frame by frame\nWe build this layer by layer. We want a base map of current boundaries, so we can take the current dataset and bring in one year’s worth of data.\nCode in R\nmap <- democracymap |> \n  filter(year==2020, !is.na(geometry)) |> \n  select(-year)\n\nmap |> \n  ggplot() + geom_sf(aes(geometry=geometry))\nWorld Map\nThen we can layer this map easily. Notice that the latitude and longitude signs are not typical of a map - the excellent\nmetR\npackage includes helpful themes and scales for meteorological data, which applies to maps as well!\nCode in R\ndemocracymap2 <- democracymap |> \n  filter(has_free_and_fair_election==TRUE)\n\nlibrary(metR)\n\nmap |> \n  ggplot() +\n  geom_sf(mapping=aes(geometry=geometry),fill=\"white\",color=\"black\") +\n  geom_sf(data=democracymap2,\n          mapping=aes(geometry=geometry),color=NA,fill=\"blue\",\n          show.legend=FALSE)+\n  scale_x_longitude() +\n  scale_y_latitude() +\n  facet_wrap(~year) +\n  theme_bw() +\n  theme(axis.text=element_blank(),\n        axis.ticks=element_blank(),\n        strip.text=element_text(size=8,\n                                margin = margin(0,0,0,0, \"cm\")))\nA facet of the world\nThis map is a bit overwhelming, let’s use\ngganimate\nand focus on Europe and Africa. Comments below to walk through the European one. Because it’s tough to render, I saved it locally and then loaded it up on the website. Hooray!\nCode in R\n#Europe\n#First a base layer\nEurope2 <- map |> \n  filter(continent==\"Europe\") |> \n  ggplot() +\n  # note that fill is the inside and color is the border in geom_sf\n  geom_sf(mapping=aes(geometry=geometry),fill=\"white\",color=\"black\") +\n#Then the democracy data\n  geom_sf(data=democracymap2 |> \n            filter(continent==\"Europe\"),\n          mapping=aes(geometry=geometry),\n          color=\"black\",\n          show.legend=FALSE) +\n  ggflags::geom_flag(data=democracymap2 |> \n                       filter(continent==\"Europe\",\n                              has_free_and_fair_election==TRUE),\n                     mapping=aes(y=lat,x=lon,country=tolower(iso2)),\n                     inherit.aes=FALSE) +\n  # gganimate allows you to use {closest_state} to fill in the transition label\n  labs(title= 'Year: {closest_state}') +\n  #metR scales\n  scale_x_longitude() +\n  scale_y_latitude() +\n  #gganimate transitions for the gif\n  transition_states(year) +\n  theme_bw() +\n  coord_sf(xlim=c(-20,40),\n           ylim=c(30,70),\n           default_crs=sf::st_crs(4326))\n\n#anim_save(filename=\"img/Europe.gif\",animation=Europe2)\nFree and Fair Elections in Europe\nCode in R\n#Africa\nAfrica2 <- map |> \n  filter(continent==\"Africa\") |> \n  ggplot() +\n  geom_sf(mapping=aes(geometry=geometry),fill=\"white\",color=\"black\") +\n  geom_sf(data=democracymap2 |> \n            filter(continent==\"Africa\"),\n          mapping=aes(geometry=geometry),color=\"black\",\n          show.legend=FALSE) +\n  scale_x_longitude() +\n  scale_y_latitude() +\n  ggflags::geom_flag(data=democracymap2 |> \n                       filter(continent==\"Africa\",\n                              has_free_and_fair_election==TRUE),\n                     mapping=aes(y=lat,x=lon,\n                                 country=tolower(iso2)),\n                     inherit.aes=FALSE) +\n  labs(title = 'Year: {closest_state}') +\n  theme_bw() +\n  transition_states(year) +\n  coord_sf(default_crs=sf::st_crs(4326))\n\n#anim_save(filename=\"img/Africa.gif\",animation=Africa2)\nFree and Fair Elections in Africa\nCitation\nBibTeX citation:\n@online{russell2025,\n  author = {Russell, John},\n  title = {Using Gganimate and Ggflags to Look at Democratic Progress},\n  date = {2025-01-13},\n  url = {https://drjohnrussell.github.io/posts/2024-01-13-gganimate-ggflag/},\n  langid = {en}\n}\nFor attribution, please cite this work as:\nRussell, John. 2025.\n“Using Gganimate and Ggflags to Look at\nDemocratic Progress.”\nJanuary 13, 2025.\nhttps://drjohnrussell.github.io/posts/2024-01-13-gganimate-ggflag/\n.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nJohn Russell\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "Loading and Exploring a Tidy Tuesday Dataset One of my New Year’s resolutions was to become less of a lurker and more of a doer within the Tidy Tuesday community. There had been one dataset that I was super interested in exploring, based on Dem...",
    "meta_keywords": null,
    "og_description": "Loading and Exploring a Tidy Tuesday Dataset One of my New Year’s resolutions was to become less of a lurker and more of a doer within the Tidy Tuesday community. There had been one dataset that I was super interested in exploring, based on Dem...",
    "og_image": "https://www.drjohnrussell.com/posts/2024-01-13-gganimate-ggflag/index_files/figure-html/unnamed-chunk-5-1.png",
    "og_title": "Using gganimate and ggflags to look at democratic progress | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 8.4,
    "sitemap_lastmod": null,
    "twitter_description": "Loading and Exploring a Tidy Tuesday Dataset One of my New Year’s resolutions was to become less of a lurker and more of a doer within the Tidy Tuesday community. There had been one dataset that I was super interested in exploring, based on Dem...",
    "twitter_title": "Using gganimate and ggflags to look at democratic progress | R-bloggers",
    "url": "https://www.r-bloggers.com/2025/01/using-gganimate-and-ggflags-to-look-at-democratic-progress/",
    "word_count": 1673
  }
}