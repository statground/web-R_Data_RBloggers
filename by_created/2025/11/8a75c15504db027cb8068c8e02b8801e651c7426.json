{
  "id": "8a75c15504db027cb8068c8e02b8801e651c7426",
  "url": "https://www.r-bloggers.com/2009/11/tactical-asset-allocation-using-blotter/",
  "created_at_utc": "2025-11-17T20:39:57Z",
  "data": null,
  "raw_original": {
    "uuid": "7e9ca934-eb3a-461e-bebd-db25d4e6fe75",
    "created_at": "2025-11-17 20:39:57",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2009/11/tactical-asset-allocation-using-blotter/",
      "crawled_at": "2025-11-17T10:16:18.874725",
      "external_links": [
        {
          "href": "https://feedproxy.google.com/~r/FossTrading/~3/fEDZCwKfi_4/tactical-asset-allocation-using-blotter.html",
          "text": "FOSS Trading"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://r-forge.r-project.org/projects/blotter",
          "text": "blotter"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "http://www.braverock.com/~peter/",
          "text": "Peter Carl"
        },
        {
          "href": "http://www.braverock.com/~brian/",
          "text": "Brian Peterson"
        },
        {
          "href": "http://finance.yahoo.com/q?s=SPY",
          "text": "SPY"
        },
        {
          "href": "http://finance.yahoo.com/q?s=IEF",
          "text": "IEF"
        },
        {
          "href": "https://i2.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_buyhold2.png",
          "text": null
        },
        {
          "href": "http://www.mebanefaber.com/",
          "text": "Mebane Faber’s"
        },
        {
          "href": "http://ssrn.com/abstract=962461",
          "text": "Faber’s article"
        },
        {
          "href": "https://i2.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_strategy2.png",
          "text": null
        },
        {
          "href": "https://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/0/da",
          "text": null
        },
        {
          "href": "https://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/1/da",
          "text": null
        },
        {
          "href": "https://feeds.feedburner.com/~ff/FossTrading?a=fEDZCwKfi_4:0WMaKk5nDxQ:yIl2AUoC8zA",
          "text": null
        },
        {
          "href": "https://feeds.feedburner.com/~ff/FossTrading?a=fEDZCwKfi_4:0WMaKk5nDxQ:F7zBnMyn0Lo",
          "text": null
        },
        {
          "href": "https://feeds.feedburner.com/~ff/FossTrading?a=fEDZCwKfi_4:0WMaKk5nDxQ:V_sGLiPBpWU",
          "text": null
        },
        {
          "href": "https://feeds.feedburner.com/~ff/FossTrading?a=fEDZCwKfi_4:0WMaKk5nDxQ:qj6IDK7rITs",
          "text": null
        },
        {
          "href": "https://feeds.feedburner.com/~ff/FossTrading?a=fEDZCwKfi_4:0WMaKk5nDxQ:I9og5sOYxJI",
          "text": null
        },
        {
          "href": "https://feedproxy.google.com/~r/FossTrading/~3/fEDZCwKfi_4/tactical-asset-allocation-using-blotter.html",
          "text": "FOSS Trading"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Tactical asset allocation using blotter | R-bloggers",
      "images": [
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_buyhold3.png?resize=400%2C400"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_buyhold3.png?resize=400%2C400"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i2.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_strategy3.png?resize=400%2C400"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i2.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_strategy3.png?resize=400%2C400"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://blogger.googleusercontent.com/tracker/5815834906618132494-8332842223445511674?l=blog.fosstrading.com"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://blogger.googleusercontent.com/tracker/5815834906618132494-8332842223445511674?l=blog.fosstrading.com"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/0/di"
        },
        {
          "alt": null,
          "base64": null,
          "src": "http://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/0/di"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/1/di"
        },
        {
          "alt": null,
          "base64": null,
          "src": "http://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/1/di"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~ff/FossTrading?d=yIl2AUoC8zA"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~ff/FossTrading?d=yIl2AUoC8zA"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~ff/FossTrading?i=fEDZCwKfi_4:0WMaKk5nDxQ:F7zBnMyn0Lo"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~ff/FossTrading?i=fEDZCwKfi_4:0WMaKk5nDxQ:F7zBnMyn0Lo"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~ff/FossTrading?i=fEDZCwKfi_4:0WMaKk5nDxQ:V_sGLiPBpWU"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~ff/FossTrading?i=fEDZCwKfi_4:0WMaKk5nDxQ:V_sGLiPBpWU"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~ff/FossTrading?d=qj6IDK7rITs"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~ff/FossTrading?d=qj6IDK7rITs"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~ff/FossTrading?d=I9og5sOYxJI"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~ff/FossTrading?d=I9og5sOYxJI"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~r/FossTrading/~4/fEDZCwKfi_4"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://feeds.feedburner.com/~r/FossTrading/~4/fEDZCwKfi_4"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/joshua-ulrich/",
          "text": "Joshua Ulrich"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/tag/blotter/",
          "text": "blotter"
        },
        {
          "href": "https://www.r-bloggers.com/tag/code/",
          "text": "code"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-479 post type-post status-publish format-standard hentry category-r-bloggers tag-blotter tag-code\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Tactical asset allocation using blotter</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">November 18, 2009</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/joshua-ulrich/\">Joshua Ulrich</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<p class=\"syndicated-attribution\"><!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://feedproxy.google.com/~r/FossTrading/~3/fEDZCwKfi_4/tactical-asset-allocation-using-blotter.html\"> FOSS Trading</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div></p>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.0--><a href=\"https://r-forge.r-project.org/projects/blotter\" rel=\"nofollow\" target=\"_blank\">blotter</a> is an <a href=\"https://www.r-project.org/\" rel=\"nofollow\" target=\"_blank\">R</a> package that tracks the P&amp;L of your trading systems (or simulations), even if your portfolio spans many security types and/or currencies.  This post uses blotter to track a simple two-ETF trading system.<br/>\n<br/>\nThe contents of this post borrow heavily from code and comments in the “longtrend” demo script in the blotter package.  Many thanks to <a href=\"http://www.braverock.com/~peter/\" rel=\"nofollow\" target=\"_blank\">Peter Carl</a> and <a href=\"http://www.braverock.com/~brian/\" rel=\"nofollow\" target=\"_blank\">Brian Peterson</a> for their hard work.<br/>\n<br/>\nThe first chart shows the result of holding an equal-weight portfolio of <a href=\"http://finance.yahoo.com/q?s=SPY\" rel=\"nofollow\" target=\"_blank\">SPY</a> and <a href=\"http://finance.yahoo.com/q?s=IEF\" rel=\"nofollow\" target=\"_blank\">IEF</a> from 2002-07-31 to 2009-10-31.  The 2008 bear market led to a 30% drawdown in this portfolio.<br/>\n<br/>\n<div class=\"separator\" style=\"clear: both; text-align: center;\"><a href=\"https://i2.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_buyhold2.png\" rel=\"nofollow\" style=\"margin-left: 1em; margin-right: 1em;\" target=\"_blank\"><img border=\"0\" class=\"jetpack-lazy-image\" data-lazy-src=\"https://i0.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_buyhold3.png?resize=400%2C400&amp;is-pending-load=1\" data-recalc-dims=\"1\" height=\"400\" loading=\"lazy\" src=\"https://i0.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_buyhold3.png?resize=400%2C400\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" width=\"400\"/><noscript><img border=\"0\" data-recalc-dims=\"1\" height=\"400\" loading=\"lazy\" src=\"https://i0.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_buyhold3.png?resize=400%2C400\" width=\"400\"/></noscript></a></div><br/>\nThe second chart shows the result of following <a href=\"http://www.mebanefaber.com/\" rel=\"nofollow\" target=\"_blank\">Mebane Faber’s</a> tactical asset allocation approach using the same ETFs and time period.  Though it did not perform as well as buy-and-hold through 2007, the 2008 bear market only caused a 5% drawdown for this strategy.  Both observations are consistent with the conclusion in <a href=\"http://ssrn.com/abstract=962461\" rel=\"nofollow\" target=\"_blank\">Faber’s article</a>.<br/>\n<br/>\n<div class=\"separator\" style=\"clear: both; text-align: center;\"><a href=\"https://i2.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_strategy2.png\" rel=\"nofollow\" style=\"margin-left: 1em; margin-right: 1em;\" target=\"_blank\"><img border=\"0\" class=\"jetpack-lazy-image\" data-lazy-src=\"https://i2.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_strategy3.png?resize=400%2C400&amp;is-pending-load=1\" data-recalc-dims=\"1\" height=\"400\" loading=\"lazy\" src=\"https://i2.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_strategy3.png?resize=400%2C400\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" width=\"400\"/><noscript><img border=\"0\" data-recalc-dims=\"1\" height=\"400\" loading=\"lazy\" src=\"https://i2.wp.com/www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_strategy3.png?resize=400%2C400\" width=\"400\"/></noscript></a></div><br/>\nWithout further ado, here’s the code:<br/>\n<br/>\n<div courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"><span style=\"font-size: x-small;\"># This code implements the strategy found in:<br/>\n# Faber, Mebane T., “A Quantitative Approach to Tactical Asset Allocation.”<br/>\n# Journal of Risk Management (Spring 2007).<br/>\n<br/>\n# The article implements a simpler version of the 200-day SMA, opting for a<br/>\n# 10-month SMA because monthly data are more easily available in earlier<br/>\n# periods and lower granularity should translate to lower transaction costs.<br/>\n<br/>\n# The rules of the system are relatively simple:<br/>\n# – Buy when monthly price &gt; 10-month SMA<br/>\n# – Sell and move to cash when monthly price &lt; 10-month SMA<br/>\n<br/>\n# 1. All entry and exit prices are on the day of the signal at the close.<br/>\n# 2. All data series are total return series including dividends, updated monthly.<br/>\n#    NOTE: For the purposes of this demo, we only use price returns.<br/>\n# 3. Cash returns are estimated with 90-day commercial paper.  Margin rates for<br/>\n#    leveraged models are estimated with the broker call rate.<br/>\n#    NOTE: For the purposes of this demo, we ignore interest and leverage.<br/>\n# 4. Taxes, commissions, and slippage are excluded.<br/>\n<br/>\n# Data:<br/>\n# This demo uses monthly data downloaded from Yahoo Finance for two ETFs: SPY and<br/>\n# IEF.  These were chosen to illustrate the classic stock/bond asset portfolio.<br/>\n# Though longer serires would be preferred, data for IEF begin in mid-2002.<br/>\n<br/>\n# Load required libraries<br/>\nlibrary(quantmod)<br/>\nlibrary(TTR)<br/>\nlibrary(blotter) # r-forge revision 193<br/>\nlibrary(PerformanceAnalytics)</span></div><div courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"><span style=\"font-size: x-small;\"><br/>\n# Set initial values<br/>\ninitDate=’2002-07-31′<br/>\nendDate=’2009-10-31′<br/>\ninitEq=100000</span></div><div courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"><span style=\"font-size: x-small;\"><br/>\n</span></div><div courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"><span style=\"font-size: x-small;\"># Set currency and instruments<br/>\ncurrency(“USD”)<br/>\nstock(“IEF”,currency=”USD”,multiplier=1)<br/>\nstock(“SPY”,currency=”USD”,multiplier=1)</span></div><div courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"><span style=\"font-size: x-small;\"><br/>\n</span></div><div courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"><span style=\"font-size: x-small;\"># Load data with quantmod<br/>\nprint(“Loading data”)<br/>\nsymbols = c(“IEF”, “SPY”)<br/>\ngetSymbols(symbols, from=initDate, to=endDate, index.class=c(“POSIXt”,”POSIXct”))<br/>\n<br/>\n# Adjust prices for splits/dividends (thanks pg)<br/>\n#IEF = adjustOHLC(IEF)<br/>\n</span><span style=\"font-size: x-small;\">#SPY = adjustOHLC(</span><span style=\"font-size: x-small;\">SPY</span><span style=\"font-size: x-small;\">)<br/>\n<br/>\n</span><span style=\"font-size: x-small;\"># Convert data to monthly frequency (to.weekly() needs drop.time=FALSE)<br/>\nIEF = to.monthly(IEF, indexAt=’endof’)<br/>\nSPY = to.monthly(SPY, indexAt=’endof’)<br/>\n</span><span style=\"font-size: x-small;\"><br/>\n</span><span style=\"font-size: x-small;\"># Set up indicators with TTR<br/>\nprint(“Setting up indicators”)<br/>\nIEF$SMA = SMA(Cl(IEF), 10)<br/>\nSPY$SMA = SMA(Cl(SPY), 10)<br/>\n<br/>\n# Set up a portfolio object and an account object in blotter<br/>\ninitPortf(name=’default’, symbols=symbols, initDate=initDate)<br/>\ninitAcct(name=’default’, portfolios=’default’, initDate=initDate, initEq=initEq)<br/>\nverbose = TRUE<br/>\n<br/>\n# Create trades<br/>\nfor( i in 10:NROW(SPY) ) {<br/>\n  CurrentDate=time(SPY)[i]<br/>\n  equity = getEndEq(Account=’default’, CurrentDate)<br/>\n<br/>\n  for( symbol in symbols ) {<br/>\n    sym = get(symbol)<br/>\n    ClosePrice = as.numeric(Cl(sym[i,]))<br/>\n    Posn = getPosQty(Portfolio=’default’, Symbol=symbol, Date=CurrentDate)<br/>\n    UnitSize = as.numeric(trunc((equity/NROW(symbols))/ClosePrice))<br/>\n<br/>\n    # Position Entry (assume fill at close)<br/>\n    if( Posn == 0 ) {<br/>\n    # No position, so test to initiate Long position<br/>\n      if( Cl(sym[i,]) &gt; sym[i,’SMA’] ) {<br/>\n        # Store trade with blotter<br/>\n        addTxn(‘default’, Symbol=symbol, TxnDate=CurrentDate,<br/>\n          TxnPrice=ClosePrice, TxnQty=UnitSize, TxnFees=0, verbose=verbose)<br/>\n      }<br/>\n    } else {<br/>\n      # Have a position, so check exit<br/>\n      if( Cl(sym[i,]) &lt; sym[i,'SMA'] ) {<br/>\n        # Store trade with blotter<br/>\n        addTxn(Portfolio=’default’, Symbol=symbol, TxnDate=CurrentDate,<br/>\n          TxnPrice=ClosePrice, TxnQty=-Posn, TxnFees=0, verbose=verbose)<br/>\n      }<br/>\n    }<br/>\n  } # End symbols loop<br/>\n<br/>\n  # Calculate P&amp;L and resulting equity with blotter<br/>\n  updatePortf(Portfolio=’default’, Dates=CurrentDate)<br/>\n  updateAcct(name=’default’, Dates=CurrentDate)<br/>\n  updateEndEq(Account=’default’, Dates=CurrentDate)<br/>\n<br/>\n} # End dates loop<br/>\n </span></div><div courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"><span style=\"font-size: x-small;\"># Buy and Hold cumulative equity<br/>\nbuyhold = cumprod( ( 1 + 0.5*ROC(Cl(IEF)) + 0.5*ROC(Cl(SPY)) )[-1] )<br/>\n<br/>\n# Final values<br/>\ncat(‘Tactical Asset Allocation Return: ‘,(getEndEq(Account=’default’, Date=CurrentDate)-initEq)/initEq,’n’)<br/>\ncat(‘Buy and Hold Return: ‘,tail(buyhold,1)-1,’n’)<br/>\n<br/>\n# Plot Strategy Summary<br/>\npng(filename=”20091118_blotter_strategy.png”, 720, 720)</span></div><div class=\"ii gt\" courier=\"\" id=\":ud\" new\",courier,monospace;\"=\"\" style=\"font-family: \"><span style=\"font-size: x-small;\">charts.PerformanceSummary(ROC(</span><wbr/><span style=\"font-size: x-small;\">getAccount(‘default’)$TOTAL$End.</span><wbr/><span style=\"font-size: x-small;\">Eq)[-1],main=”Tactical Asset Allocation”)</span></div><span style=\"font-size: x-small;\"><span courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \">dev.off()</span><br courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"/> <br courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"/><span courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"> # Plot Buy and Hold Summary</span><br courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"/><span courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"> png(filename=”20091118_blotter_buyhold.png”, 720, 720)</span><br courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"/><span courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"> charts.PerformanceSummary(ROC(buyhold)[-1],main=”Buy &amp; Hold”)</span><br courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"/><span courier=\"\" new\",courier,monospace;\"=\"\" style=\"font-family: \"> dev.off()</span><br/>\n</span><div class=\"blogger-post-footer\"><img alt=\"\" class=\"jetpack-lazy-image\" data-lazy-src=\"https://blogger.googleusercontent.com/tracker/5815834906618132494-8332842223445511674?l=blog.fosstrading.com&amp;is-pending-load=1\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5815834906618132494-8332842223445511674?l=blog.fosstrading.com\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" width=\"1\"/><noscript><img alt=\"\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5815834906618132494-8332842223445511674?l=blog.fosstrading.com\" width=\"1\"/></noscript></div>\n<p><a href=\"https://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/0/da\" rel=\"nofollow\" target=\"_blank\"><img border=\"0\" class=\"jetpack-lazy-image\" data-lazy-src=\"http://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/0/di?is-pending-load=1\" ismap=\"true\" src=\"https://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/0/di\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"/><noscript><img border=\"0\" ismap=\"true\" src=\"http://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/0/di\"/></noscript></a><br/>\n<a href=\"https://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/1/da\" rel=\"nofollow\" target=\"_blank\"><img border=\"0\" class=\"jetpack-lazy-image\" data-lazy-src=\"http://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/1/di?is-pending-load=1\" ismap=\"true\" src=\"https://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/1/di\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"/><noscript><img border=\"0\" ismap=\"true\" src=\"http://feedads.g.doubleclick.net/~a/opeFWtU-2hkvTXaX8xtje1EHBD0/1/di\"/></noscript></a></p><div class=\"feedflare\">\n<a href=\"https://feeds.feedburner.com/~ff/FossTrading?a=fEDZCwKfi_4:0WMaKk5nDxQ:yIl2AUoC8zA\" rel=\"nofollow\" target=\"_blank\"><img border=\"0\" class=\"jetpack-lazy-image\" data-lazy-src=\"https://feeds.feedburner.com/~ff/FossTrading?d=yIl2AUoC8zA&amp;is-pending-load=1\" src=\"https://feeds.feedburner.com/~ff/FossTrading?d=yIl2AUoC8zA\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"/><noscript><img border=\"0\" src=\"https://feeds.feedburner.com/~ff/FossTrading?d=yIl2AUoC8zA\"/></noscript></a> <a href=\"https://feeds.feedburner.com/~ff/FossTrading?a=fEDZCwKfi_4:0WMaKk5nDxQ:F7zBnMyn0Lo\" rel=\"nofollow\" target=\"_blank\"><img border=\"0\" class=\"jetpack-lazy-image\" data-lazy-src=\"https://feeds.feedburner.com/~ff/FossTrading?i=fEDZCwKfi_4%3A0WMaKk5nDxQ%3AF7zBnMyn0Lo&amp;is-pending-load=1\" src=\"https://feeds.feedburner.com/~ff/FossTrading?i=fEDZCwKfi_4:0WMaKk5nDxQ:F7zBnMyn0Lo\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"/><noscript><img border=\"0\" src=\"https://feeds.feedburner.com/~ff/FossTrading?i=fEDZCwKfi_4:0WMaKk5nDxQ:F7zBnMyn0Lo\"/></noscript></a> <a href=\"https://feeds.feedburner.com/~ff/FossTrading?a=fEDZCwKfi_4:0WMaKk5nDxQ:V_sGLiPBpWU\" rel=\"nofollow\" target=\"_blank\"><img border=\"0\" class=\"jetpack-lazy-image\" data-lazy-src=\"https://feeds.feedburner.com/~ff/FossTrading?i=fEDZCwKfi_4%3A0WMaKk5nDxQ%3AV_sGLiPBpWU&amp;is-pending-load=1\" src=\"https://feeds.feedburner.com/~ff/FossTrading?i=fEDZCwKfi_4:0WMaKk5nDxQ:V_sGLiPBpWU\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"/><noscript><img border=\"0\" src=\"https://feeds.feedburner.com/~ff/FossTrading?i=fEDZCwKfi_4:0WMaKk5nDxQ:V_sGLiPBpWU\"/></noscript></a> <a href=\"https://feeds.feedburner.com/~ff/FossTrading?a=fEDZCwKfi_4:0WMaKk5nDxQ:qj6IDK7rITs\" rel=\"nofollow\" target=\"_blank\"><img border=\"0\" class=\"jetpack-lazy-image\" data-lazy-src=\"https://feeds.feedburner.com/~ff/FossTrading?d=qj6IDK7rITs&amp;is-pending-load=1\" src=\"https://feeds.feedburner.com/~ff/FossTrading?d=qj6IDK7rITs\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"/><noscript><img border=\"0\" src=\"https://feeds.feedburner.com/~ff/FossTrading?d=qj6IDK7rITs\"/></noscript></a> <a href=\"https://feeds.feedburner.com/~ff/FossTrading?a=fEDZCwKfi_4:0WMaKk5nDxQ:I9og5sOYxJI\" rel=\"nofollow\" target=\"_blank\"><img border=\"0\" class=\"jetpack-lazy-image\" data-lazy-src=\"https://feeds.feedburner.com/~ff/FossTrading?d=I9og5sOYxJI&amp;is-pending-load=1\" src=\"https://feeds.feedburner.com/~ff/FossTrading?d=I9og5sOYxJI\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"/><noscript><img border=\"0\" src=\"https://feeds.feedburner.com/~ff/FossTrading?d=I9og5sOYxJI\"/></noscript></a>\n</div><img class=\"jetpack-lazy-image\" data-lazy-src=\"https://feeds.feedburner.com/~r/FossTrading/~4/fEDZCwKfi_4?is-pending-load=1\" height=\"1\" loading=\"lazy\" src=\"https://feeds.feedburner.com/~r/FossTrading/~4/fEDZCwKfi_4\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" width=\"1\"/><noscript><img height=\"1\" loading=\"lazy\" src=\"https://feeds.feedburner.com/~r/FossTrading/~4/fEDZCwKfi_4\" width=\"1\"/></noscript>\n\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.0-->\n<p class=\"syndicated-attribution\"><div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://feedproxy.google.com/~r/FossTrading/~3/fEDZCwKfi_4/tactical-asset-allocation-using-blotter.html\"> FOSS Trading</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div></p> </div>\n<div class=\"post-tags clearfix\"><ul><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/blotter/\" rel=\"tag\">blotter</a></li><li class=\"round-corners\"><a href=\"https://www.r-bloggers.com/tag/code/\" rel=\"tag\">code</a></li></ul></div></article>",
      "main_text": "Tactical asset allocation using blotter\nPosted on\nNovember 18, 2009\nby\nJoshua Ulrich\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nFOSS Trading\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nblotter\nis an\nR\npackage that tracks the P&L of your trading systems (or simulations), even if your portfolio spans many security types and/or currencies.  This post uses blotter to track a simple two-ETF trading system.\nThe contents of this post borrow heavily from code and comments in the “longtrend” demo script in the blotter package.  Many thanks to\nPeter Carl\nand\nBrian Peterson\nfor their hard work.\nThe first chart shows the result of holding an equal-weight portfolio of\nSPY\nand\nIEF\nfrom 2002-07-31 to 2009-10-31.  The 2008 bear market led to a 30% drawdown in this portfolio.\nThe second chart shows the result of following\nMebane Faber’s\ntactical asset allocation approach using the same ETFs and time period.  Though it did not perform as well as buy-and-hold through 2007, the 2008 bear market only caused a 5% drawdown for this strategy.  Both observations are consistent with the conclusion in\nFaber’s article\n.\nWithout further ado, here’s the code:\n# This code implements the strategy found in:\n# Faber, Mebane T., “A Quantitative Approach to Tactical Asset Allocation.”\n# Journal of Risk Management (Spring 2007).\n# The article implements a simpler version of the 200-day SMA, opting for a\n# 10-month SMA because monthly data are more easily available in earlier\n# periods and lower granularity should translate to lower transaction costs.\n# The rules of the system are relatively simple:\n# – Buy when monthly price > 10-month SMA\n# – Sell and move to cash when monthly price < 10-month SMA\n# 1. All entry and exit prices are on the day of the signal at the close.\n# 2. All data series are total return series including dividends, updated monthly.\n#    NOTE: For the purposes of this demo, we only use price returns.\n# 3. Cash returns are estimated with 90-day commercial paper.  Margin rates for\n#    leveraged models are estimated with the broker call rate.\n#    NOTE: For the purposes of this demo, we ignore interest and leverage.\n# 4. Taxes, commissions, and slippage are excluded.\n# Data:\n# This demo uses monthly data downloaded from Yahoo Finance for two ETFs: SPY and\n# IEF.  These were chosen to illustrate the classic stock/bond asset portfolio.\n# Though longer serires would be preferred, data for IEF begin in mid-2002.\n# Load required libraries\nlibrary(quantmod)\nlibrary(TTR)\nlibrary(blotter) # r-forge revision 193\nlibrary(PerformanceAnalytics)\n# Set initial values\ninitDate=’2002-07-31′\nendDate=’2009-10-31′\ninitEq=100000\n# Set currency and instruments\ncurrency(“USD”)\nstock(“IEF”,currency=”USD”,multiplier=1)\nstock(“SPY”,currency=”USD”,multiplier=1)\n# Load data with quantmod\nprint(“Loading data”)\nsymbols = c(“IEF”, “SPY”)\ngetSymbols(symbols, from=initDate, to=endDate, index.class=c(“POSIXt”,”POSIXct”))\n# Adjust prices for splits/dividends (thanks pg)\n#IEF = adjustOHLC(IEF)\n#SPY = adjustOHLC(\nSPY\n)\n# Convert data to monthly frequency (to.weekly() needs drop.time=FALSE)\nIEF = to.monthly(IEF, indexAt=’endof’)\nSPY = to.monthly(SPY, indexAt=’endof’)\n# Set up indicators with TTR\nprint(“Setting up indicators”)\nIEF$SMA = SMA(Cl(IEF), 10)\nSPY$SMA = SMA(Cl(SPY), 10)\n# Set up a portfolio object and an account object in blotter\ninitPortf(name=’default’, symbols=symbols, initDate=initDate)\ninitAcct(name=’default’, portfolios=’default’, initDate=initDate, initEq=initEq)\nverbose = TRUE\n# Create trades\nfor( i in 10:NROW(SPY) ) {\nCurrentDate=time(SPY)[i]\nequity = getEndEq(Account=’default’, CurrentDate)\nfor( symbol in symbols ) {\nsym = get(symbol)\nClosePrice = as.numeric(Cl(sym[i,]))\nPosn = getPosQty(Portfolio=’default’, Symbol=symbol, Date=CurrentDate)\nUnitSize = as.numeric(trunc((equity/NROW(symbols))/ClosePrice))\n# Position Entry (assume fill at close)\nif( Posn == 0 ) {\n# No position, so test to initiate Long position\nif( Cl(sym[i,]) > sym[i,’SMA’] ) {\n# Store trade with blotter\naddTxn(‘default’, Symbol=symbol, TxnDate=CurrentDate,\nTxnPrice=ClosePrice, TxnQty=UnitSize, TxnFees=0, verbose=verbose)\n}\n} else {\n# Have a position, so check exit\nif( Cl(sym[i,]) < sym[i,'SMA'] ) {\n# Store trade with blotter\naddTxn(Portfolio=’default’, Symbol=symbol, TxnDate=CurrentDate,\nTxnPrice=ClosePrice, TxnQty=-Posn, TxnFees=0, verbose=verbose)\n}\n}\n} # End symbols loop\n# Calculate P&L and resulting equity with blotter\nupdatePortf(Portfolio=’default’, Dates=CurrentDate)\nupdateAcct(name=’default’, Dates=CurrentDate)\nupdateEndEq(Account=’default’, Dates=CurrentDate)\n} # End dates loop\n# Buy and Hold cumulative equity\nbuyhold = cumprod( ( 1 + 0.5*ROC(Cl(IEF)) + 0.5*ROC(Cl(SPY)) )[-1] )\n# Final values\ncat(‘Tactical Asset Allocation Return: ‘,(getEndEq(Account=’default’, Date=CurrentDate)-initEq)/initEq,’n’)\ncat(‘Buy and Hold Return: ‘,tail(buyhold,1)-1,’n’)\n# Plot Strategy Summary\npng(filename=”20091118_blotter_strategy.png”, 720, 720)\ncharts.PerformanceSummary(ROC(\ngetAccount(‘default’)$TOTAL$End.\nEq)[-1],main=”Tactical Asset Allocation”)\ndev.off()\n# Plot Buy and Hold Summary\npng(filename=”20091118_blotter_buyhold.png”, 720, 720)\ncharts.PerformanceSummary(ROC(buyhold)[-1],main=”Buy & Hold”)\ndev.off()\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nFOSS Trading\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nblotter\ncode",
      "meta_description": "blotter is an R package that tracks the P&L of your trading systems (or simulations), even if your portfolio spans many security types and/or currencies. This post uses blotter to track a simple two-ETF trading system. The contents of this post b...",
      "meta_keywords": "blotter,code",
      "og_description": "blotter is an R package that tracks the P&L of your trading systems (or simulations), even if your portfolio spans many security types and/or currencies. This post uses blotter to track a simple two-ETF trading system. The contents of this post b...",
      "og_image": "https://www.r-bloggers.com/wp-content/uploads/2009/11/20091118_blotter_buyhold3.png",
      "og_title": "Tactical asset allocation using blotter | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 4.6,
      "sitemap_lastmod": "2011-05-11T21:26:40+00:00",
      "twitter_description": "blotter is an R package that tracks the P&L of your trading systems (or simulations), even if your portfolio spans many security types and/or currencies. This post uses blotter to track a simple two-ETF trading system. The contents of this post b...",
      "twitter_title": "Tactical asset allocation using blotter | R-bloggers",
      "url": "https://www.r-bloggers.com/2009/11/tactical-asset-allocation-using-blotter/",
      "word_count": 912
    }
  }
}