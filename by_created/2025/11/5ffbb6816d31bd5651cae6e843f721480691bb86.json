{
  "id": "5ffbb6816d31bd5651cae6e843f721480691bb86",
  "url": "https://www.r-bloggers.com/2023/11/r-tidy-evaluation-in-ggplot2-part-2/",
  "created_at_utc": "2025-11-17T20:39:19Z",
  "data": null,
  "raw_original": {
    "uuid": "673d3411-b3ed-4531-8cbd-085938d8edba",
    "created_at": "2025-11-17 20:39:19",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2023/11/r-tidy-evaluation-in-ggplot2-part-2/",
      "crawled_at": "2025-11-17T09:57:39.743280",
      "external_links": [
        {
          "href": "https://fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/",
          "text": "R on Zhenguo Zhang's Blog"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://search.r-project.org/CRAN/refmans/rlang/help/.data.html",
          "text": "tidy eval pronouns"
        },
        {
          "href": "https://ggplot2.tidyverse.org/articles/ggplot2-in-packages.html",
          "text": "https://ggplot2.tidyverse.org/articles/ggplot2-in-packages.html"
        },
        {
          "href": "https://dcl-prog.stanford.edu/tidy-eval-detailed.html",
          "text": "https://dcl-prog.stanford.edu/tidy-eval-detailed.html"
        },
        {
          "href": "https://search.r-project.org/CRAN/refmans/rlang/html/topic-metaprogramming.html",
          "text": "https://search.r-project.org/CRAN/refmans/rlang/html/topic-metaprogramming.html"
        },
        {
          "href": "https://search.r-project.org/CRAN/refmans/rlang/html/topic-data-mask-programming.html",
          "text": "https://search.r-project.org/CRAN/refmans/rlang/html/topic-data-mask-programming.html"
        },
        {
          "href": "https://fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/",
          "text": "R on Zhenguo Zhang's Blog"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "[R] tidy evaluation in ggplot2 (part 2) | R-bloggers",
      "images": [
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i2.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-3-1.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i1.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-4-1.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i1.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-5-1.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i0.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-6-1.png?w=450&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i1.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-7-1.png?w=450&ssl=1"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/zhenguo-zhang/",
          "text": "Zhenguo Zhang"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-379979 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">[R] tidy evaluation in ggplot2 (part 2)</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">November 10, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/zhenguo-zhang/\">Zhenguo Zhang</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/\"> R on Zhenguo Zhang's Blog</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->Zhenguo Zhang’s Blog /2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/ –\n\n\n<pre>knitr::opts_chunk$set(echo=T, fig.align = \"center\", fig.width = 6, fig.height = 5, dpi=150, warning=FALSE)\r\nlibrary(knitr)\nlibrary(ggplot2)</pre>\n<div class=\"section level2\" id=\"how-to-use-variables-to-refer-columns-in-ggplot2\">\n<h2>How to use variables to refer columns in ggplot2</h2>\n<p>Let’s start an example of making a scatter plot by using the\ndataset <code>mtcars</code>.</p>\n<pre>head(mtcars)\r\n##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb\n## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4\n## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4\n## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1\n## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1\n## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2\n## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</pre>\n<p>We can make a plot using the following commands</p>\n<pre>plt&lt;-ggplot(mtcars, aes(x=wt, y=mpg, color=factor(cyl))) + theme_bw()\nplt&lt;-plt+geom_point()\nplt</pre>\n<p><img data-lazy-src=\"https://i2.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-3-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" style=\"display: block; margin: auto;\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i2.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-3-1.png?w=450&amp;ssl=1\" style=\"display: block; margin: auto;\"/></noscript></p>\n<p>If we create a function, how can we make the sample plot:</p>\n<div class=\"section level3\" id=\"use\">\n<h3>use ‘{{}}’</h3>\n<pre>make_scatter_plot1&lt;-function(colorVar) {\n  plt&lt;-ggplot(mtcars, aes(x=wt, y=mpg, color=factor({{colorVar}}))) + theme_bw()\n  plt&lt;-plt+geom_point()\n  plt\n}\nmake_scatter_plot1(cyl)</pre>\n<p><img data-lazy-src=\"https://i1.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-4-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" style=\"display: block; margin: auto;\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i1.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-4-1.png?w=450&amp;ssl=1\" style=\"display: block; margin: auto;\"/></noscript></p>\n<p>The embrace operator ‘⁠{{’⁠ is used to create functions that call other data-masking functions. It transports a data-masked argument (an argument that can refer to columns of a data frame) from one function to another.</p>\n</div>\n<div class=\"section level3\" id=\"use-.data\">\n<h3>use .data</h3>\n<pre>make_scatter_plot2&lt;-function(colorVar) {\n  plt&lt;-ggplot(mtcars, aes(x=wt, y=mpg, color=factor(.data[[colorVar]]))) + theme_bw()\n  plt&lt;-plt+geom_point()\n  plt\n}\nmake_scatter_plot2(\"cyl\")</pre>\n<p><img data-lazy-src=\"https://i1.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-5-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" style=\"display: block; margin: auto;\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i1.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-5-1.png?w=450&amp;ssl=1\" style=\"display: block; margin: auto;\"/></noscript></p>\n</div>\n<div class=\"section level3\" id=\"use-sym\">\n<h3>use sym()</h3>\n<pre>make_scatter_plot3&lt;-function(colorVar) {\n  plt&lt;-ggplot(mtcars, aes(x=wt, y=mpg, color=factor(!!sym(colorVar)) )) + theme_bw()\n  plt&lt;-plt+geom_point()\n  plt\n}\nmake_scatter_plot3(\"cyl\")</pre>\n<p><img data-lazy-src=\"https://i0.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-6-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" style=\"display: block; margin: auto;\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i0.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-6-1.png?w=450&amp;ssl=1\" style=\"display: block; margin: auto;\"/></noscript></p>\n</div>\n<div class=\"section level3\" id=\"use-quo\">\n<h3>use quo()</h3>\n<pre>make_scatter_plot4&lt;-function(colorVar) {\n  plt&lt;-ggplot(mtcars, aes(x=wt, y=mpg, color=factor(!!colorVar) )) + theme_bw()\n  plt&lt;-plt+geom_point()\n  plt\n}\nmyvar&lt;-quo(cyl)\nmake_scatter_plot4(myvar)</pre>\n<p><img data-lazy-src=\"https://i1.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-7-1.png?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" style=\"display: block; margin: auto;\"/><noscript><img data-recalc-dims=\"1\" src=\"https://i1.wp.com/fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-7-1.png?w=450&amp;ssl=1\" style=\"display: block; margin: auto;\"/></noscript></p>\n</div>\n</div>\n<div class=\"section level2\" id=\"key-concepts\">\n<h2>Key concepts</h2>\n<div class=\"section level3\" id=\"defusing\">\n<h3>defusing</h3>\n<p>When a piece of R code is defused, R doesn’t return its value, but returns the\nexpression in a tree-like object to describe how to compute a value, which can\nbe evaluated later in a specific environment.</p>\n<p>For example, one can use <code>expr()</code> to create a defused object.</p>\n<pre># return result\n1+1\r\n## [1] 2\r\n# return defused object\nexpr(1+1)\r\n## 1 + 1</pre>\n<p>One application of using defused object is to resume its evaluation in data\nmask, see the example below:</p>\n<pre>e &lt;- expr(mean(cyl))\neval(e, mtcars)\r\n## [1] 6.1875</pre>\n<p>Some functions defuse their arguments, and when these function are called from\nanother function, its argument must be provided with embrace operator {{, which\nis a combination of <code>enquo()</code> and <code>!!</code>.</p>\n<p>Defused expressions can also be created by using other functions\nsuch as <code>sym()</code> and <code>call()</code>, for example:</p>\n<pre># create a symbol\nvName&lt;-\"mtcars\"\nsym(vName)\n\n# make a call\ncall(\"head\", sym(vName))</pre>\n<p>There are two ways to defuse expressions, one can use\n<code>expr()</code> to defuse one’s own expression and use <code>enquo()</code> to defuse user-provided\nexpressions to your function.</p>\n<p>Defusing is known as quoting in other frameworks.</p>\n<ul>\n<li><p>The equivalent of <code>expr()</code> is [base::bquote()].</p></li>\n<li><p>The equivalent of <code>enquo()</code> is [base::substitute()]. The latter returns a naked expression instead of a quosure.</p></li>\n<li><p>There is no equivalent for enquos(…) but you can defuse dots as a list of naked expressions with eval(substitute(alist(…))).</p></li>\n</ul>\n</div>\n<div class=\"section level3\" id=\"data-masking\">\n<h3>data-masking</h3>\n<p>Data masking means that a data.frame is inserted at the bottom of the current\nchain of environment and it takes higher precedence than the user environment.</p>\n<p>For example, if we assign a value to a variable, but this variable is invisible\nin data-masking functions as below:</p>\n<pre>mpg&lt;-100\n# the following function can't see it\ndplyr::summarise(mtcars, mean(mpg))\r\n##   mean(mpg)\n## 1  20.09062</pre>\n<p>As you can see, the function used the column <code>mpg</code> from the dataframe <code>mtcars</code>.</p>\n<p>One way to disambiguate the user and mask environments is to use\n<a href=\"https://search.r-project.org/CRAN/refmans/rlang/help/.data.html\" rel=\"nofollow\" target=\"_blank\">tidy eval pronouns</a>.</p>\n<pre>dplyr::summarise(mtcars, mean(.env$mpg))\r\n##   mean(.env$mpg)\n## 1            100</pre>\n</div>\n</div>\n<div class=\"section level2\" id=\"summary\">\n<h2>Summary</h2>\n<p>Basically, when one wants to evaluate a variable in a different context, he should\ndefuse the variable (using function such as <code>quo()</code> and <code>enquo()</code>) and\nthen inject it (using <code>{{}}</code>, <code>!!</code>, <code>!!sym()</code>, etc) when evaluation is needed.</p>\n</div>\n<div class=\"section level2\" id=\"references\">\n<h2>References</h2>\n<ul>\n<li><p>Using ggplot2 in packages: <a class=\"uri\" href=\"https://ggplot2.tidyverse.org/articles/ggplot2-in-packages.html\" rel=\"nofollow\" target=\"_blank\">https://ggplot2.tidyverse.org/articles/ggplot2-in-packages.html</a></p></li>\n<li><p>Functional programming: <a class=\"uri\" href=\"https://dcl-prog.stanford.edu/tidy-eval-detailed.html\" rel=\"nofollow\" target=\"_blank\">https://dcl-prog.stanford.edu/tidy-eval-detailed.html</a></p></li>\n<li><p>Defuse and inject patterns: <a class=\"uri\" href=\"https://search.r-project.org/CRAN/refmans/rlang/html/topic-metaprogramming.html\" rel=\"nofollow\" target=\"_blank\">https://search.r-project.org/CRAN/refmans/rlang/html/topic-metaprogramming.html</a></p></li>\n<li><p>Data-masking programming: <a class=\"uri\" href=\"https://search.r-project.org/CRAN/refmans/rlang/html/topic-data-mask-programming.html\" rel=\"nofollow\" target=\"_blank\">https://search.r-project.org/CRAN/refmans/rlang/html/topic-data-mask-programming.html</a></p></li>\n</ul>\n</div>\n- /2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/ - \n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/\"> R on Zhenguo Zhang's Blog</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
      "main_text": "[R] tidy evaluation in ggplot2 (part 2)\nPosted on\nNovember 10, 2023\nby\nZhenguo Zhang\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nR on Zhenguo Zhang's Blog\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nZhenguo Zhang’s Blog /2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/ –\nknitr::opts_chunk$set(echo=T, fig.align = \"center\", fig.width = 6, fig.height = 5, dpi=150, warning=FALSE)\nlibrary(knitr)\nlibrary(ggplot2)\nHow to use variables to refer columns in ggplot2\nLet’s start an example of making a scatter plot by using the\ndataset\nmtcars\n.\nhead(mtcars)\n##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb\n## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4\n## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4\n## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1\n## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1\n## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2\n## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1\nWe can make a plot using the following commands\nplt<-ggplot(mtcars, aes(x=wt, y=mpg, color=factor(cyl))) + theme_bw()\nplt<-plt+geom_point()\nplt\nIf we create a function, how can we make the sample plot:\nuse ‘{{}}’\nmake_scatter_plot1<-function(colorVar) {\n  plt<-ggplot(mtcars, aes(x=wt, y=mpg, color=factor({{colorVar}}))) + theme_bw()\n  plt<-plt+geom_point()\n  plt\n}\nmake_scatter_plot1(cyl)\nThe embrace operator ‘⁠{{’⁠ is used to create functions that call other data-masking functions. It transports a data-masked argument (an argument that can refer to columns of a data frame) from one function to another.\nuse .data\nmake_scatter_plot2<-function(colorVar) {\n  plt<-ggplot(mtcars, aes(x=wt, y=mpg, color=factor(.data[[colorVar]]))) + theme_bw()\n  plt<-plt+geom_point()\n  plt\n}\nmake_scatter_plot2(\"cyl\")\nuse sym()\nmake_scatter_plot3<-function(colorVar) {\n  plt<-ggplot(mtcars, aes(x=wt, y=mpg, color=factor(!!sym(colorVar)) )) + theme_bw()\n  plt<-plt+geom_point()\n  plt\n}\nmake_scatter_plot3(\"cyl\")\nuse quo()\nmake_scatter_plot4<-function(colorVar) {\n  plt<-ggplot(mtcars, aes(x=wt, y=mpg, color=factor(!!colorVar) )) + theme_bw()\n  plt<-plt+geom_point()\n  plt\n}\nmyvar<-quo(cyl)\nmake_scatter_plot4(myvar)\nKey concepts\ndefusing\nWhen a piece of R code is defused, R doesn’t return its value, but returns the\nexpression in a tree-like object to describe how to compute a value, which can\nbe evaluated later in a specific environment.\nFor example, one can use\nexpr()\nto create a defused object.\n# return result\n1+1\n## [1] 2\n# return defused object\nexpr(1+1)\n## 1 + 1\nOne application of using defused object is to resume its evaluation in data\nmask, see the example below:\ne <- expr(mean(cyl))\neval(e, mtcars)\n## [1] 6.1875\nSome functions defuse their arguments, and when these function are called from\nanother function, its argument must be provided with embrace operator {{, which\nis a combination of\nenquo()\nand\n!!\n.\nDefused expressions can also be created by using other functions\nsuch as\nsym()\nand\ncall()\n, for example:\n# create a symbol\nvName<-\"mtcars\"\nsym(vName)\n\n# make a call\ncall(\"head\", sym(vName))\nThere are two ways to defuse expressions, one can use\nexpr()\nto defuse one’s own expression and use\nenquo()\nto defuse user-provided\nexpressions to your function.\nDefusing is known as quoting in other frameworks.\nThe equivalent of\nexpr()\nis [base::bquote()].\nThe equivalent of\nenquo()\nis [base::substitute()]. The latter returns a naked expression instead of a quosure.\nThere is no equivalent for enquos(…) but you can defuse dots as a list of naked expressions with eval(substitute(alist(…))).\ndata-masking\nData masking means that a data.frame is inserted at the bottom of the current\nchain of environment and it takes higher precedence than the user environment.\nFor example, if we assign a value to a variable, but this variable is invisible\nin data-masking functions as below:\nmpg<-100\n# the following function can't see it\ndplyr::summarise(mtcars, mean(mpg))\n##   mean(mpg)\n## 1  20.09062\nAs you can see, the function used the column\nmpg\nfrom the dataframe\nmtcars\n.\nOne way to disambiguate the user and mask environments is to use\ntidy eval pronouns\n.\ndplyr::summarise(mtcars, mean(.env$mpg))\n##   mean(.env$mpg)\n## 1            100\nSummary\nBasically, when one wants to evaluate a variable in a different context, he should\ndefuse the variable (using function such as\nquo()\nand\nenquo()\n) and\nthen inject it (using\n{{}}\n,\n!!\n,\n!!sym()\n, etc) when evaluation is needed.\nReferences\nUsing ggplot2 in packages:\nhttps://ggplot2.tidyverse.org/articles/ggplot2-in-packages.html\nFunctional programming:\nhttps://dcl-prog.stanford.edu/tidy-eval-detailed.html\nDefuse and inject patterns:\nhttps://search.r-project.org/CRAN/refmans/rlang/html/topic-metaprogramming.html\nData-masking programming:\nhttps://search.r-project.org/CRAN/refmans/rlang/html/topic-data-mask-programming.html\n- /2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/ -\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nR on Zhenguo Zhang's Blog\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "Zhenguo Zhang's Blog /2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/ - knitr::opts_chunk$set(echo=T, fig.align = \"center\", fig.width = 6, fig.height = 5, dpi=150, warning=FALSE) library(knitr) library(ggplot2) How to use variables to refe...",
      "meta_keywords": null,
      "og_description": "Zhenguo Zhang's Blog /2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/ - knitr::opts_chunk$set(echo=T, fig.align = \"center\", fig.width = 6, fig.height = 5, dpi=150, warning=FALSE) library(knitr) library(ggplot2) How to use variables to refe...",
      "og_image": "https://fortune9.netlify.app/2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/index_files/figure-html/unnamed-chunk-3-1.png",
      "og_title": "[R] tidy evaluation in ggplot2 (part 2) | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 4.7,
      "sitemap_lastmod": "2023-11-11T00:00:00+00:00",
      "twitter_description": "Zhenguo Zhang's Blog /2023/11/11/r-tidy-evaluation-in-ggplot2-part-2/ - knitr::opts_chunk$set(echo=T, fig.align = \"center\", fig.width = 6, fig.height = 5, dpi=150, warning=FALSE) library(knitr) library(ggplot2) How to use variables to refe...",
      "twitter_title": "[R] tidy evaluation in ggplot2 (part 2) | R-bloggers",
      "url": "https://www.r-bloggers.com/2023/11/r-tidy-evaluation-in-ggplot2-part-2/",
      "word_count": 943
    }
  }
}