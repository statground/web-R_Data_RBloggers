{
  "id": "776462d5759d316ab7e6fabb481b3f8bec02c0ce",
  "url": "https://www.r-bloggers.com/2025/05/animated-population-pyramids-for-the-pacific-by-ellis2013nz/",
  "created_at_utc": "2025-11-22T19:58:35Z",
  "data": null,
  "raw_original": {
    "uuid": "c1323bb5-c683-4466-a456-c1af3cc7bdcb",
    "created_at": "2025-11-22 19:58:35",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2025/05/animated-population-pyramids-for-the-pacific-by-ellis2013nz/",
      "crawled_at": "2025-11-22T10:48:53.385096",
      "external_links": [
        {
          "href": "https://freerangestats.info/blog/2025/05/17/animated-population-pyramids",
          "text": "free range statistics - R"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://stats.pacificdata.org/",
          "text": "Pacific Data Hub “PDH.stat”"
        },
        {
          "href": "https://imagemagick.org/index.php",
          "text": "ImageMagick"
        },
        {
          "href": "https://freerangestats.info/blog/2025/05/17/animated-population-pyramids",
          "text": "free range statistics - R"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "Animated population pyramids for the Pacific by @ellis2013nz | R-bloggers",
      "images": [
        {
          "alt": "Animated population pyramids of the Pacific islands from 1950 to 2050",
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": "Animated population pyramids of the Pacific islands from 1950 to 2050",
          "base64": null,
          "src": "https://i0.wp.com/freerangestats.info/img/0291-pac_pyramids.gif?w=450&ssl=1"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/free-range-statistics-r/",
          "text": "free range statistics - R"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-392459 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Animated population pyramids for the Pacific by @ellis2013nz</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">May 16, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/free-range-statistics-r/\">free range statistics - R</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://freerangestats.info/blog/2025/05/17/animated-population-pyramids\"> free range statistics - R</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47--><p>A short blog post today which is just all about producing this animation, which I used for a work presentation yesterday:</p>\n<p><img alt=\"Animated population pyramids of the Pacific islands from 1950 to 2050\" data-lazy-src=\"https://i0.wp.com/freerangestats.info/img/0291-pac_pyramids.gif?w=450&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"Animated population pyramids of the Pacific islands from 1950 to 2050\" data-recalc-dims=\"1\" src=\"https://i0.wp.com/freerangestats.info/img/0291-pac_pyramids.gif?w=450&amp;ssl=1\"/></noscript></p>\n<p>It’s super easy and it’s worth putting out there how to do it, if only to encourage people to think more about demography in the Pacific. And animated population pyramids are cool.</p>\n<p>Regarding the substance, it’s a familiar pattern for those in the field. The populations start at small, fast growing and heavy in young people; and over time become more evenly spread over age groups and indeed in some cases positively elderly. There are a few interesting quirks such as the very high number of males in Guam early in the period, reflecting the predominance of the US military in the population numbers at that time. Some smaller countries with read outwards immigration options, like Niue, have been shrinking right from the very beginning of the period.</p>\n<p>It’s a simple three step process. First, we download the data from the <a href=\"https://stats.pacificdata.org/\" rel=\"nofollow\" target=\"_blank\">Pacific Data Hub “PDH.stat”</a>, and do some formatting and reshaping to make it easy to draw the chart with the right country names and population totals in the facet labels:</p>\n<figure class=\"highlight\"><pre>library(tidyverse)\nlibrary(rsdmx)\nlibrary(scales)\nlibrary(janitor)\nlibrary(ISOcodes)\nlibrary(glue)\nrequire(spcstyle)\n\n#============Animated population pyramids=====================\n\nif(!exists(\"proj_raw\")){\n  # This is quite slow - several minutes - but the slow part is apparently parsing\n  # the XML in the as_tibble\n  proj_raw &lt;- readSDMX(providerId = \"PDH\", \n                       resource = \"data\", \n                       flowRef = \"DF_POP_PROJ\")  |&gt;\n    as_tibble() |&gt;\n    clean_names()\n}\n\n#' Format a number as millions or thousands\nformat_num &lt;- function(x){\n  y &lt;- dplyr::case_when(\n    # had to use round explicitly because of something funny happening later with pops' creation:\n    x &gt; 1e6 ~ paste0(format(round(x / 1e6, digits = 1), nsmall = 1, scientific = FALSE), \"m\"),\n    x &gt; 1e3 ~ paste0(format(round(x / 1e3, digits = 1), nsmall = 1, scientific = FALSE), \"k\"),\n    TRUE    ~ as.character(round(x))\n  )\n  return(str_squish(y))\n}\n\n# test that function works as expected\nstopifnot(format_num(1234567.1234) == \"1.2m\")\nstopifnot(format_num(1234.1234) == \"1.2k\")\nstopifnot(format_num(12) == \"12\")\n\n# create a pops data frame, complete with country names that include\n# the population in that year\npops &lt;- proj_raw |&gt;\n  # eliminate the totals we only want male, female, and particular age groups:\n  filter(sex != \"_T\" &amp; age != \"_T\") |&gt;\n  # eliminate the subregional groupings - we only want countries / territories\n  filter(!geo_pict %in% c(\"_T\", \"_TXPNG\", \"MELXPNG\", \"MEL\", \"POL\", \"MIC\")) |&gt;\n  # choose the right indicator\n  filter(indicator == \"MIDYEARPOPEST\") |&gt;\n  # fiddle a bit with the age categories to make sure we have them correctly\n  # in order:\n  mutate(age = gsub(\"^Y\", \"\", age)) |&gt;\n  separate(age, into = c(\"from\", \"to\"), sep = \"T\", remove = FALSE) |&gt;\n  mutate(age = gsub(\"T\", \"-\", age),\n         age = gsub(\"-999\", \"+\", age, fixed = TRUE),\n         sex = case_when(\n           sex == \"M\" ~ \"Male\",\n           sex == \"F\" ~ \"Female\"\n         )) |&gt;\n  mutate(age = factor(age),\n         sex = fct_relevel(sex, \"Male\"))|&gt;\n  # join the geo_pict country codes to the full country names:\n  left_join(ISO_3166_1, by = c(\"geo_pict\" = \"Alpha_2\")) |&gt;\n  # calculate total population in any given year, for displaying in facet label:\n  group_by(geo_pict, obs_time) |&gt; \n  mutate(total_pop = sum(obs_value)) |&gt; \n  # population in 2024 which we'll use for ordering the facets in the chart\n  # (we want the ordering to be stable over time):\n  group_by(geo_pict) |&gt; \n  mutate(total_pop_2024 = sum(obs_value[obs_time == 2024])) |&gt; \n  ungroup() |&gt; \n  # Fiddle a bit with the country names so they fit nicely\n  mutate(short_name = gsub(\"Federated States of\", \"Fed Sts\", Name),\n         short_name = gsub(\"Mariana Islands\", \"Marianas\", short_name)) |&gt; \n  mutate(pict = glue(\"{short_name}: {format_num(total_pop)}\")) |&gt; \n  mutate(pict = fct_reorder(pict, total_pop_2024))</pre></figure>\n<p>Second, we draw 101 plots, one for each year, and save them as images in a temporary folder. I like to do this explicitly (saving each frame of the animation in a loop) as I find it generally easier to troubleshoot this way:</p>\n<figure class=\"highlight\"><pre>#-----------------------Draw plot--------------------\n# see https://blog.datawrapper.de/gendercolor/\npal &lt;- c(\"#D4855A\", \"#C5CB81\")\nnames(pal) &lt;- c(\"Female\", \"Male\")\n\n# Reverse order so Male appears on left in legend:\npal &lt;- pal[2:1]\n\nff &lt;- \"Calibri\"\n\ndir.create(\"tmp_pyramids\", showWarnings = FALSE)\n\nfor(y in 1950:2050){\n\n  p1 &lt;- ggplot(filter(pops, obs_time == y), aes(y = age, fill = sex)) +\n    facet_wrap(~pict, scales = \"free_x\", ncol = 7) +\n    geom_col(data = filter(pops, sex == \"Male\" &amp; obs_time == y), \n             aes(x = -obs_value)) +\n    geom_col(data = filter(pops, sex == \"Female\" &amp; obs_time == y), \n             aes(x = obs_value)) +\n    scale_fill_manual(values = pal) +\n    scale_x_continuous(label = comma) +\n    theme_void(base_family = ff) +\n    theme(axis.text.y = element_text(hjust = 1, size = 6),\n          axis.title.x = element_text(),\n          legend.position = \"top\",\n          plot.caption = element_text(hjust = 0.5, colour = \"grey20\"),\n          panel.background = element_rect(fill = \"grey95\", colour = NA),\n          plot.margin = unit(c(3,3,3,3), \"mm\")) +\n    labs(title = glue(\"Population estimates and projections in {y}\"),\n         subtitle = \"Pacific Island Country and Territory members of the Pacific Community\",\n         x = \"Number of people\",\n         fill = \"\",\n         caption = \"Source: UN Population Projections in the Pacific Data Hub\")\n  \n  sc &lt;- 5\n  png(glue(\"tmp_pyramids/{y}.png\"), \n      width = 7000 / sc, height = 4000 / sc, res = 600 / sc, type = \"cairo-png\")\n  print(p1)\n  dev.off()\n\n}</pre></figure>\n<p>Finally, we use <a href=\"https://imagemagick.org/index.php\" rel=\"nofollow\" target=\"_blank\">ImageMagick</a> to convert those 101 PNG images into a single GIF. This is a single line of code on the command line; if we want to do it without leaving R it is easy enough:</p>\n<figure class=\"highlight\"><pre># next step requires imagemagick to be installed. Takes about 30 seconds.\nwd &lt;- setwd(\"tmp_pyramids\")\nsystem('magick -loop -50 -delay 10 *.png \"0291-pac_pyramids.gif\"')\nsetwd(wd) # go back to original working directory</pre></figure>\n<p>And that’s it!</p>\n<p>The source for these population projections (at least right now) is the UN Population Prospects. It would be easy to adapt this code to work with any other combination of countries, of course. I’ve just used the version in PDH.stat because I wanted to highlight that for work, and it made it easier for me to get just the countries and age groups I needed for a presentation that was put together in a bit of a rush.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://freerangestats.info/blog/2025/05/17/animated-population-pyramids\"> free range statistics - R</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
      "main_text": "Animated population pyramids for the Pacific by @ellis2013nz\nPosted on\nMay 16, 2025\nby\nfree range statistics - R\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nfree range statistics - R\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nA short blog post today which is just all about producing this animation, which I used for a work presentation yesterday:\nIt’s super easy and it’s worth putting out there how to do it, if only to encourage people to think more about demography in the Pacific. And animated population pyramids are cool.\nRegarding the substance, it’s a familiar pattern for those in the field. The populations start at small, fast growing and heavy in young people; and over time become more evenly spread over age groups and indeed in some cases positively elderly. There are a few interesting quirks such as the very high number of males in Guam early in the period, reflecting the predominance of the US military in the population numbers at that time. Some smaller countries with read outwards immigration options, like Niue, have been shrinking right from the very beginning of the period.\nIt’s a simple three step process. First, we download the data from the\nPacific Data Hub “PDH.stat”\n, and do some formatting and reshaping to make it easy to draw the chart with the right country names and population totals in the facet labels:\nlibrary(tidyverse)\nlibrary(rsdmx)\nlibrary(scales)\nlibrary(janitor)\nlibrary(ISOcodes)\nlibrary(glue)\nrequire(spcstyle)\n\n#============Animated population pyramids=====================\n\nif(!exists(\"proj_raw\")){\n  # This is quite slow - several minutes - but the slow part is apparently parsing\n  # the XML in the as_tibble\n  proj_raw <- readSDMX(providerId = \"PDH\", \n                       resource = \"data\", \n                       flowRef = \"DF_POP_PROJ\")  |>\n    as_tibble() |>\n    clean_names()\n}\n\n#' Format a number as millions or thousands\nformat_num <- function(x){\n  y <- dplyr::case_when(\n    # had to use round explicitly because of something funny happening later with pops' creation:\n    x > 1e6 ~ paste0(format(round(x / 1e6, digits = 1), nsmall = 1, scientific = FALSE), \"m\"),\n    x > 1e3 ~ paste0(format(round(x / 1e3, digits = 1), nsmall = 1, scientific = FALSE), \"k\"),\n    TRUE    ~ as.character(round(x))\n  )\n  return(str_squish(y))\n}\n\n# test that function works as expected\nstopifnot(format_num(1234567.1234) == \"1.2m\")\nstopifnot(format_num(1234.1234) == \"1.2k\")\nstopifnot(format_num(12) == \"12\")\n\n# create a pops data frame, complete with country names that include\n# the population in that year\npops <- proj_raw |>\n  # eliminate the totals we only want male, female, and particular age groups:\n  filter(sex != \"_T\" & age != \"_T\") |>\n  # eliminate the subregional groupings - we only want countries / territories\n  filter(!geo_pict %in% c(\"_T\", \"_TXPNG\", \"MELXPNG\", \"MEL\", \"POL\", \"MIC\")) |>\n  # choose the right indicator\n  filter(indicator == \"MIDYEARPOPEST\") |>\n  # fiddle a bit with the age categories to make sure we have them correctly\n  # in order:\n  mutate(age = gsub(\"^Y\", \"\", age)) |>\n  separate(age, into = c(\"from\", \"to\"), sep = \"T\", remove = FALSE) |>\n  mutate(age = gsub(\"T\", \"-\", age),\n         age = gsub(\"-999\", \"+\", age, fixed = TRUE),\n         sex = case_when(\n           sex == \"M\" ~ \"Male\",\n           sex == \"F\" ~ \"Female\"\n         )) |>\n  mutate(age = factor(age),\n         sex = fct_relevel(sex, \"Male\"))|>\n  # join the geo_pict country codes to the full country names:\n  left_join(ISO_3166_1, by = c(\"geo_pict\" = \"Alpha_2\")) |>\n  # calculate total population in any given year, for displaying in facet label:\n  group_by(geo_pict, obs_time) |> \n  mutate(total_pop = sum(obs_value)) |> \n  # population in 2024 which we'll use for ordering the facets in the chart\n  # (we want the ordering to be stable over time):\n  group_by(geo_pict) |> \n  mutate(total_pop_2024 = sum(obs_value[obs_time == 2024])) |> \n  ungroup() |> \n  # Fiddle a bit with the country names so they fit nicely\n  mutate(short_name = gsub(\"Federated States of\", \"Fed Sts\", Name),\n         short_name = gsub(\"Mariana Islands\", \"Marianas\", short_name)) |> \n  mutate(pict = glue(\"{short_name}: {format_num(total_pop)}\")) |> \n  mutate(pict = fct_reorder(pict, total_pop_2024))\nSecond, we draw 101 plots, one for each year, and save them as images in a temporary folder. I like to do this explicitly (saving each frame of the animation in a loop) as I find it generally easier to troubleshoot this way:\n#-----------------------Draw plot--------------------\n# see https://blog.datawrapper.de/gendercolor/\npal <- c(\"#D4855A\", \"#C5CB81\")\nnames(pal) <- c(\"Female\", \"Male\")\n\n# Reverse order so Male appears on left in legend:\npal <- pal[2:1]\n\nff <- \"Calibri\"\n\ndir.create(\"tmp_pyramids\", showWarnings = FALSE)\n\nfor(y in 1950:2050){\n\n  p1 <- ggplot(filter(pops, obs_time == y), aes(y = age, fill = sex)) +\n    facet_wrap(~pict, scales = \"free_x\", ncol = 7) +\n    geom_col(data = filter(pops, sex == \"Male\" & obs_time == y), \n             aes(x = -obs_value)) +\n    geom_col(data = filter(pops, sex == \"Female\" & obs_time == y), \n             aes(x = obs_value)) +\n    scale_fill_manual(values = pal) +\n    scale_x_continuous(label = comma) +\n    theme_void(base_family = ff) +\n    theme(axis.text.y = element_text(hjust = 1, size = 6),\n          axis.title.x = element_text(),\n          legend.position = \"top\",\n          plot.caption = element_text(hjust = 0.5, colour = \"grey20\"),\n          panel.background = element_rect(fill = \"grey95\", colour = NA),\n          plot.margin = unit(c(3,3,3,3), \"mm\")) +\n    labs(title = glue(\"Population estimates and projections in {y}\"),\n         subtitle = \"Pacific Island Country and Territory members of the Pacific Community\",\n         x = \"Number of people\",\n         fill = \"\",\n         caption = \"Source: UN Population Projections in the Pacific Data Hub\")\n  \n  sc <- 5\n  png(glue(\"tmp_pyramids/{y}.png\"), \n      width = 7000 / sc, height = 4000 / sc, res = 600 / sc, type = \"cairo-png\")\n  print(p1)\n  dev.off()\n\n}\nFinally, we use\nImageMagick\nto convert those 101 PNG images into a single GIF. This is a single line of code on the command line; if we want to do it without leaving R it is easy enough:\n# next step requires imagemagick to be installed. Takes about 30 seconds.\nwd <- setwd(\"tmp_pyramids\")\nsystem('magick -loop -50 -delay 10 *.png \"0291-pac_pyramids.gif\"')\nsetwd(wd) # go back to original working directory\nAnd that’s it!\nThe source for these population projections (at least right now) is the UN Population Prospects. It would be easy to adapt this code to work with any other combination of countries, of course. I’ve just used the version in PDH.stat because I wanted to highlight that for work, and it made it easier for me to get just the countries and age groups I needed for a presentation that was put together in a bit of a rush.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nfree range statistics - R\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "A short blog post today which is just all about producing this animation, which I used for a work presentation yesterday: It’s super easy and it’s worth putting out there how to do it, if only to encourage people to think more about demography in th...",
      "meta_keywords": null,
      "og_description": "A short blog post today which is just all about producing this animation, which I used for a work presentation yesterday: It’s super easy and it’s worth putting out there how to do it, if only to encourage people to think more about demography in th...",
      "og_image": "https://freerangestats.info/img/0291-pac_pyramids.gif",
      "og_title": "Animated population pyramids for the Pacific by @ellis2013nz | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 5.4,
      "sitemap_lastmod": null,
      "twitter_description": "A short blog post today which is just all about producing this animation, which I used for a work presentation yesterday: It’s super easy and it’s worth putting out there how to do it, if only to encourage people to think more about demography in th...",
      "twitter_title": "Animated population pyramids for the Pacific by @ellis2013nz | R-bloggers",
      "url": "https://www.r-bloggers.com/2025/05/animated-population-pyramids-for-the-pacific-by-ellis2013nz/",
      "word_count": 1086
    }
  }
}