{
  "uuid": "545b4475-83c6-4e94-893e-3123a2ee8da4",
  "created_at": "2025-11-22 19:57:46",
  "raw_json": {
    "article_author": null,
    "article_headline": null,
    "article_modified": null,
    "article_published": null,
    "article_section": null,
    "article_tags": null,
    "canonical_url": "https://www.r-bloggers.com/2025/08/efficiently-merging-multiple-datasets/",
    "crawled_at": "2025-11-22T10:43:34.430398",
    "external_links": [
      {
        "href": "https://pacha.dev/blog/2025/08/31/",
        "text": "pacha.dev/blog"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      },
      {
        "href": "https://buymeacoffee.com/pacha/e/80976",
        "text": "Buy Me a Coffee"
      },
      {
        "href": "https://www.fiverr.com/sellers/msepulveda3",
        "text": "Fiverr"
      },
      {
        "href": "https://pacha.dev/blog/2025/08/11/",
        "text": "A Personal Message from an Open Source Contributor"
      },
      {
        "href": "https://docs.google.com/forms/d/e/1FAIpQLScMpMtKjDe2h53iHUvlYHDdBNMD1_x9WO5wg5wi_EO7ak_DRA/viewform?usp=sharing&ouid=115091451666829859711",
        "text": "this form"
      },
      {
        "href": "https://pacha.dev/blog/2025/08/31/",
        "text": "pacha.dev/blog"
      },
      {
        "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
        "text": "daily e-mail updates"
      },
      {
        "href": "https://www.r-project.org/",
        "text": "R"
      },
      {
        "href": "https://www.r-users.com/",
        "text": "Click here if you're looking to post or find an R/data-science job"
      },
      {
        "href": "http://r-posts.com/",
        "text": "here"
      }
    ],
    "h1_title": "R-bloggers",
    "html_title": "Efficiently merging multiple datasets | R-bloggers",
    "images": [],
    "internal_links": [
      {
        "href": "https://www.r-bloggers.com/author/pacha-dev-blog/",
        "text": "pacha.dev/blog"
      },
      {
        "href": "https://www.r-bloggers.com/category/r-bloggers/",
        "text": "R bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers"
      },
      {
        "href": "https://www.r-bloggers.com/contact-us/",
        "text": "here"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      },
      {
        "href": "https://www.r-bloggers.com/",
        "text": "R-bloggers.com"
      },
      {
        "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
        "text": "learning R"
      },
      {
        "href": "https://www.r-bloggers.com/add-your-blog/",
        "text": "click here"
      }
    ],
    "lang": "en-US",
    "main_html": "<article class=\"post-395103 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">Efficiently merging multiple datasets</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">August 30, 2025</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/pacha-dev-blog/\">pacha.dev/blog</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://pacha.dev/blog/2025/08/31/\"> pacha.dev/blog</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<p><em>Because of delays with my scholarship payment, if this post is useful to you I kindly ask a minimal donation on <a href=\"https://buymeacoffee.com/pacha/e/80976\" rel=\"nofollow\" target=\"_blank\">Buy Me a Coffee</a> that shall be used to continue my Open Source efforts. If you need an R package or Shiny dashboard for your team, you can email me or inquiry on <a href=\"https://www.fiverr.com/sellers/msepulveda3\" rel=\"nofollow\" target=\"_blank\">Fiverr</a>. The full explanation is here: <a href=\"https://pacha.dev/blog/2025/08/11/\" rel=\"nofollow\" target=\"_blank\">A Personal Message from an Open Source Contributor</a></em></p>\n<p><em>You can send me questions for the blog using <a href=\"https://docs.google.com/forms/d/e/1FAIpQLScMpMtKjDe2h53iHUvlYHDdBNMD1_x9WO5wg5wi_EO7ak_DRA/viewform?usp=sharing&amp;ouid=115091451666829859711\" rel=\"nofollow\" target=\"_blank\">this form</a> and subscribe to receive an email when there is a new post.</em></p>\n<p>I tend to observe that my students repeat a lot of code when we have partitioned data across different tables. For example, when we have to read multiple CSV files that result in a structure similar to the following tables created by intentionally subsetting the original Palmer’s Penguins dataset:</p>\n<div class=\"cell\" data-messages=\"false\" data-warnings=\"false\">\n<pre>library(palmerpenguins)</pre>\n<div class=\"cell-output cell-output-stderr\">\n<pre>\nAttaching package: 'palmerpenguins'</pre>\n</div>\n<div class=\"cell-output cell-output-stderr\">\n<pre>The following objects are masked from 'package:datasets':\n\n    penguins, penguins_raw</pre>\n</div>\n<pre>library(dplyr)</pre>\n<div class=\"cell-output cell-output-stderr\">\n<pre>\nAttaching package: 'dplyr'</pre>\n</div>\n<div class=\"cell-output cell-output-stderr\">\n<pre>The following objects are masked from 'package:stats':\n\n    filter, lag</pre>\n</div>\n<div class=\"cell-output cell-output-stderr\">\n<pre>The following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union</pre>\n</div>\n<pre>library(purrr)\n\nspecies &lt;- penguins %&gt;%\n  distinct(species) %&gt;%\n  pull()\n\nmap(\n  species,\n  function(s) {\n    assign(\n      paste0(\"penguins_\", tolower(s)),\n      filter(penguins, species == s),\n      envir = .GlobalEnv\n    )\n  }\n)</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre>[[1]]\n# A tibble: 152 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# ℹ 142 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;\n\n[[2]]\n# A tibble: 124 × 8\n   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Gentoo  Biscoe           46.1          13.2               211        4500\n 2 Gentoo  Biscoe           50            16.3               230        5700\n 3 Gentoo  Biscoe           48.7          14.1               210        4450\n 4 Gentoo  Biscoe           50            15.2               218        5700\n 5 Gentoo  Biscoe           47.6          14.5               215        5400\n 6 Gentoo  Biscoe           46.5          13.5               210        4550\n 7 Gentoo  Biscoe           45.4          14.6               211        4800\n 8 Gentoo  Biscoe           46.7          15.3               219        5200\n 9 Gentoo  Biscoe           43.3          13.4               209        4400\n10 Gentoo  Biscoe           46.8          15.4               215        5150\n# ℹ 114 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;\n\n[[3]]\n# A tibble: 68 × 8\n   species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Chinstrap Dream            46.5          17.9               192        3500\n 2 Chinstrap Dream            50            19.5               196        3900\n 3 Chinstrap Dream            51.3          19.2               193        3650\n 4 Chinstrap Dream            45.4          18.7               188        3525\n 5 Chinstrap Dream            52.7          19.8               197        3725\n 6 Chinstrap Dream            45.2          17.8               198        3950\n 7 Chinstrap Dream            46.1          18.2               178        3250\n 8 Chinstrap Dream            51.3          18.2               197        3750\n 9 Chinstrap Dream            46            18.9               195        4150\n10 Chinstrap Dream            51.3          19.9               198        3700\n# ℹ 58 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</pre>\n</div>\n<pre>penguins_adelie</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 152 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# ℹ 142 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</pre>\n</div>\n<pre>penguins_chinstrap</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 68 × 8\n   species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Chinstrap Dream            46.5          17.9               192        3500\n 2 Chinstrap Dream            50            19.5               196        3900\n 3 Chinstrap Dream            51.3          19.2               193        3650\n 4 Chinstrap Dream            45.4          18.7               188        3525\n 5 Chinstrap Dream            52.7          19.8               197        3725\n 6 Chinstrap Dream            45.2          17.8               198        3950\n 7 Chinstrap Dream            46.1          18.2               178        3250\n 8 Chinstrap Dream            51.3          18.2               197        3750\n 9 Chinstrap Dream            46            18.9               195        4150\n10 Chinstrap Dream            51.3          19.9               198        3700\n# ℹ 58 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</pre>\n</div>\n<pre>penguins_gentoo</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 124 × 8\n   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Gentoo  Biscoe           46.1          13.2               211        4500\n 2 Gentoo  Biscoe           50            16.3               230        5700\n 3 Gentoo  Biscoe           48.7          14.1               210        4450\n 4 Gentoo  Biscoe           50            15.2               218        5700\n 5 Gentoo  Biscoe           47.6          14.5               215        5400\n 6 Gentoo  Biscoe           46.5          13.5               210        4550\n 7 Gentoo  Biscoe           45.4          14.6               211        4800\n 8 Gentoo  Biscoe           46.7          15.3               219        5200\n 9 Gentoo  Biscoe           43.3          13.4               209        4400\n10 Gentoo  Biscoe           46.8          15.4               215        5150\n# ℹ 114 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</pre>\n</div>\n</div>\n<p>One common operation I have seen when my students use dplyr is a variation of this:</p>\n<div class=\"cell\">\n<pre>penguins_adelie %&gt;%\n  bind_rows(penguins_chinstrap) %&gt;% \n  bind_rows(penguins_gentoo)</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 344 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# ℹ 334 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</pre>\n</div>\n<pre>bind_rows(penguins_adelie, penguins_chinstrap, penguins_gentoo)</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 344 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# ℹ 334 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</pre>\n</div>\n</div>\n<p>A similar pattern appears when they decide to use base R with something like this</p>\n<div class=\"cell\">\n<pre>rbind(penguins_adelie, penguins_chinstrap, penguins_gentoo)</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 344 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# ℹ 334 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</pre>\n</div>\n</div>\n<p>There are many ways to achieve the same result in R, and one option is to use the “{}” operator:</p>\n<div class=\"cell\">\n<pre># either\n{penguins_adelie; penguins_chinstrap; penguins_gentoo} %&gt;%\n  list() %&gt;%\n  bind_rows()</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 124 × 8\n   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Gentoo  Biscoe           46.1          13.2               211        4500\n 2 Gentoo  Biscoe           50            16.3               230        5700\n 3 Gentoo  Biscoe           48.7          14.1               210        4450\n 4 Gentoo  Biscoe           50            15.2               218        5700\n 5 Gentoo  Biscoe           47.6          14.5               215        5400\n 6 Gentoo  Biscoe           46.5          13.5               210        4550\n 7 Gentoo  Biscoe           45.4          14.6               211        4800\n 8 Gentoo  Biscoe           46.7          15.3               219        5200\n 9 Gentoo  Biscoe           43.3          13.4               209        4400\n10 Gentoo  Biscoe           46.8          15.4               215        5150\n# ℹ 114 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</pre>\n</div>\n<pre># or\n{\n  penguins_adelie\n  penguins_chinstrap\n  penguins_gentoo\n} %&gt;%\n  bind_rows()</pre>\n<div class=\"cell-output cell-output-stdout\">\n<pre># A tibble: 124 × 8\n   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;\n 1 Gentoo  Biscoe           46.1          13.2               211        4500\n 2 Gentoo  Biscoe           50            16.3               230        5700\n 3 Gentoo  Biscoe           48.7          14.1               210        4450\n 4 Gentoo  Biscoe           50            15.2               218        5700\n 5 Gentoo  Biscoe           47.6          14.5               215        5400\n 6 Gentoo  Biscoe           46.5          13.5               210        4550\n 7 Gentoo  Biscoe           45.4          14.6               211        4800\n 8 Gentoo  Biscoe           46.7          15.3               219        5200\n 9 Gentoo  Biscoe           43.3          13.4               209        4400\n10 Gentoo  Biscoe           46.8          15.4               215        5150\n# ℹ 114 more rows\n# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</pre>\n</div>\n</div>\n<p>The previous examples quickly become impractical when dealing with a large number of datasets. In such cases, we can leverage the <code>purrr</code> package to streamline the process.</p>\n<p>One practical example is the UN Comtrade data, which is partitioned by country and year into thousands of CSV files (at some point I saved those as RDS to save disk space). By using <code>map_df</code> to efficiently merge multiple datasets without repeating code, we can do the following:</p>\n<pre># list Canadian data 1990-1999\ncanada_files &lt;- list.files(\"~/Documents/uncomtrade/input/data\", pattern = \"_CAN_199\",\n  full.names = TRUE)\n\nhead(canada_files)\n\ncanada &lt;- map_df(\n  canada_files,\n  readRDS\n)\n\ncanada\n\n&gt; canada\n# A tibble: 1,971,197 × 34\n   dataset_code      type_code freq_code ref_period_id ref_year ref_month period\n   &lt;chr&gt;             &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt; \n 1 20124199001052100 C         A         19900101      1990     52        1990  \n 2 20124199001052100 C         A         19900101      1990     52        1990  \n 3 20124199001052100 C         A         19900101      1990     52        1990  \n 4 20124199001052100 C         A         19900101      1990     52        1990  \n 5 20124199001052100 C         A         19900101      1990     52        1990  \n 6 20124199001052100 C         A         19900101      1990     52        1990  \n 7 20124199001052100 C         A         19900101      1990     52        1990  \n 8 20124199001052100 C         A         19900101      1990     52        1990  \n 9 20124199001052100 C         A         19900101      1990     52        1990  \n10 20124199001052100 C         A         19900101      1990     52        1990  \n# ℹ 1,971,187 more rows\n# ℹ 27 more variables: reporter_code &lt;chr&gt;, flow_code &lt;chr&gt;,\n#   partner_code &lt;chr&gt;, partner2code &lt;chr&gt;, classification_search_code &lt;chr&gt;,\n#   classification_code &lt;chr&gt;, is_original_classification &lt;chr&gt;,\n#   cmd_code &lt;chr&gt;, customs_code &lt;chr&gt;, mos_code &lt;chr&gt;, mot_code &lt;chr&gt;,\n#   qty_unit_code &lt;chr&gt;, qty &lt;chr&gt;, is_qty_estimated &lt;chr&gt;,\n#   alt_qty_unit_code &lt;chr&gt;, alt_qty &lt;chr&gt;, is_alt_qty_estimated &lt;chr&gt;, …\n# ℹ Use `print(n = ...)` to see more rows</pre>\n<p>Then it is possible to conduct diferent operations, such as total bilateral exports reporting FOB and CIF to see the mismatch between the exporter and the importer:</p>\n<pre>canada %&gt;%\n  select(partner_code, fobvalue, cifvalue) %&gt;%\n  mutate(\n    fobvalue = as.numeric(fobvalue),\n    cifvalue = as.numeric(cifvalue)\n  ) %&gt;%\n  group_by(partner_code) %&gt;%\n  summarise(\n    fobvalue = sum(fobvalue, na.rm = TRUE),\n    cifvalue = sum(cifvalue, na.rm = TRUE)\n  )\n\n&gt; canada %&gt;%\n+   select(partner_code, fobvalue, cifvalue) %&gt;%\n+   mutate(\n+     fobvalue = as.numeric(fobvalue),\n+     cifvalue = as.numeric(cifvalue)\n+   ) %&gt;%\n+   group_by(partner_code) %&gt;%\n+   summarise(\n+     fobvalue = sum(fobvalue, na.rm = TRUE),\n+     cifvalue = sum(cifvalue, na.rm = TRUE)\n+   )\n# A tibble: 219 × 3\n   partner_code fobvalue cifvalue\n   &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;\n 1 0             1.34e13        0\n 2 100           1.44e 9        0\n 3 104           4.18e 8        0\n 4 108           2.58e 7        0\n 5 112           1.26e 8        0\n 6 116           1.77e 8        0\n 7 12            2.22e10        0\n 8 120           7.34e 8        0\n 9 132           6.95e 6        0\n10 136           2.32e 8        0\n# ℹ 209 more rows\n# ℹ Use `print(n = ...)` to see more rows</pre>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 4.0.47-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://pacha.dev/blog/2025/08/31/\"> pacha.dev/blog</a></strong>.</div>\n<hr/>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div> </div>\n</article>",
    "main_text": "Efficiently merging multiple datasets\nPosted on\nAugust 30, 2025\nby\npacha.dev/blog\nin\nR bloggers\n| 0 Comments\n[This article was first published on\npacha.dev/blog\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\nBecause of delays with my scholarship payment, if this post is useful to you I kindly ask a minimal donation on\nBuy Me a Coffee\nthat shall be used to continue my Open Source efforts. If you need an R package or Shiny dashboard for your team, you can email me or inquiry on\nFiverr\n. The full explanation is here:\nA Personal Message from an Open Source Contributor\nYou can send me questions for the blog using\nthis form\nand subscribe to receive an email when there is a new post.\nI tend to observe that my students repeat a lot of code when we have partitioned data across different tables. For example, when we have to read multiple CSV files that result in a structure similar to the following tables created by intentionally subsetting the original Palmer’s Penguins dataset:\nlibrary(palmerpenguins)\nAttaching package: 'palmerpenguins'\nThe following objects are masked from 'package:datasets':\n\n    penguins, penguins_raw\nlibrary(dplyr)\nAttaching package: 'dplyr'\nThe following objects are masked from 'package:stats':\n\n    filter, lag\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\nlibrary(purrr)\n\nspecies <- penguins %>%\n  distinct(species) %>%\n  pull()\n\nmap(\n  species,\n  function(s) {\n    assign(\n      paste0(\"penguins_\", tolower(s)),\n      filter(penguins, species == s),\n      envir = .GlobalEnv\n    )\n  }\n)\n[[1]]\n# A tibble: 152 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>              <dbl>         <dbl>             <int>       <int>\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# ℹ 142 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\n\n[[2]]\n# A tibble: 124 × 8\n   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>           <dbl>         <dbl>             <int>       <int>\n 1 Gentoo  Biscoe           46.1          13.2               211        4500\n 2 Gentoo  Biscoe           50            16.3               230        5700\n 3 Gentoo  Biscoe           48.7          14.1               210        4450\n 4 Gentoo  Biscoe           50            15.2               218        5700\n 5 Gentoo  Biscoe           47.6          14.5               215        5400\n 6 Gentoo  Biscoe           46.5          13.5               210        4550\n 7 Gentoo  Biscoe           45.4          14.6               211        4800\n 8 Gentoo  Biscoe           46.7          15.3               219        5200\n 9 Gentoo  Biscoe           43.3          13.4               209        4400\n10 Gentoo  Biscoe           46.8          15.4               215        5150\n# ℹ 114 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\n\n[[3]]\n# A tibble: 68 × 8\n   species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>     <fct>           <dbl>         <dbl>             <int>       <int>\n 1 Chinstrap Dream            46.5          17.9               192        3500\n 2 Chinstrap Dream            50            19.5               196        3900\n 3 Chinstrap Dream            51.3          19.2               193        3650\n 4 Chinstrap Dream            45.4          18.7               188        3525\n 5 Chinstrap Dream            52.7          19.8               197        3725\n 6 Chinstrap Dream            45.2          17.8               198        3950\n 7 Chinstrap Dream            46.1          18.2               178        3250\n 8 Chinstrap Dream            51.3          18.2               197        3750\n 9 Chinstrap Dream            46            18.9               195        4150\n10 Chinstrap Dream            51.3          19.9               198        3700\n# ℹ 58 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\npenguins_adelie\n# A tibble: 152 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>              <dbl>         <dbl>             <int>       <int>\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# ℹ 142 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\npenguins_chinstrap\n# A tibble: 68 × 8\n   species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>     <fct>           <dbl>         <dbl>             <int>       <int>\n 1 Chinstrap Dream            46.5          17.9               192        3500\n 2 Chinstrap Dream            50            19.5               196        3900\n 3 Chinstrap Dream            51.3          19.2               193        3650\n 4 Chinstrap Dream            45.4          18.7               188        3525\n 5 Chinstrap Dream            52.7          19.8               197        3725\n 6 Chinstrap Dream            45.2          17.8               198        3950\n 7 Chinstrap Dream            46.1          18.2               178        3250\n 8 Chinstrap Dream            51.3          18.2               197        3750\n 9 Chinstrap Dream            46            18.9               195        4150\n10 Chinstrap Dream            51.3          19.9               198        3700\n# ℹ 58 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\npenguins_gentoo\n# A tibble: 124 × 8\n   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>           <dbl>         <dbl>             <int>       <int>\n 1 Gentoo  Biscoe           46.1          13.2               211        4500\n 2 Gentoo  Biscoe           50            16.3               230        5700\n 3 Gentoo  Biscoe           48.7          14.1               210        4450\n 4 Gentoo  Biscoe           50            15.2               218        5700\n 5 Gentoo  Biscoe           47.6          14.5               215        5400\n 6 Gentoo  Biscoe           46.5          13.5               210        4550\n 7 Gentoo  Biscoe           45.4          14.6               211        4800\n 8 Gentoo  Biscoe           46.7          15.3               219        5200\n 9 Gentoo  Biscoe           43.3          13.4               209        4400\n10 Gentoo  Biscoe           46.8          15.4               215        5150\n# ℹ 114 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\nOne common operation I have seen when my students use dplyr is a variation of this:\npenguins_adelie %>%\n  bind_rows(penguins_chinstrap) %>% \n  bind_rows(penguins_gentoo)\n# A tibble: 344 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>              <dbl>         <dbl>             <int>       <int>\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# ℹ 334 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\nbind_rows(penguins_adelie, penguins_chinstrap, penguins_gentoo)\n# A tibble: 344 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>              <dbl>         <dbl>             <int>       <int>\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# ℹ 334 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\nA similar pattern appears when they decide to use base R with something like this\nrbind(penguins_adelie, penguins_chinstrap, penguins_gentoo)\n# A tibble: 344 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>              <dbl>         <dbl>             <int>       <int>\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# ℹ 334 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\nThere are many ways to achieve the same result in R, and one option is to use the “{}” operator:\n# either\n{penguins_adelie; penguins_chinstrap; penguins_gentoo} %>%\n  list() %>%\n  bind_rows()\n# A tibble: 124 × 8\n   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>           <dbl>         <dbl>             <int>       <int>\n 1 Gentoo  Biscoe           46.1          13.2               211        4500\n 2 Gentoo  Biscoe           50            16.3               230        5700\n 3 Gentoo  Biscoe           48.7          14.1               210        4450\n 4 Gentoo  Biscoe           50            15.2               218        5700\n 5 Gentoo  Biscoe           47.6          14.5               215        5400\n 6 Gentoo  Biscoe           46.5          13.5               210        4550\n 7 Gentoo  Biscoe           45.4          14.6               211        4800\n 8 Gentoo  Biscoe           46.7          15.3               219        5200\n 9 Gentoo  Biscoe           43.3          13.4               209        4400\n10 Gentoo  Biscoe           46.8          15.4               215        5150\n# ℹ 114 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\n# or\n{\n  penguins_adelie\n  penguins_chinstrap\n  penguins_gentoo\n} %>%\n  bind_rows()\n# A tibble: 124 × 8\n   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>           <dbl>         <dbl>             <int>       <int>\n 1 Gentoo  Biscoe           46.1          13.2               211        4500\n 2 Gentoo  Biscoe           50            16.3               230        5700\n 3 Gentoo  Biscoe           48.7          14.1               210        4450\n 4 Gentoo  Biscoe           50            15.2               218        5700\n 5 Gentoo  Biscoe           47.6          14.5               215        5400\n 6 Gentoo  Biscoe           46.5          13.5               210        4550\n 7 Gentoo  Biscoe           45.4          14.6               211        4800\n 8 Gentoo  Biscoe           46.7          15.3               219        5200\n 9 Gentoo  Biscoe           43.3          13.4               209        4400\n10 Gentoo  Biscoe           46.8          15.4               215        5150\n# ℹ 114 more rows\n# ℹ 2 more variables: sex <fct>, year <int>\nThe previous examples quickly become impractical when dealing with a large number of datasets. In such cases, we can leverage the\npurrr\npackage to streamline the process.\nOne practical example is the UN Comtrade data, which is partitioned by country and year into thousands of CSV files (at some point I saved those as RDS to save disk space). By using\nmap_df\nto efficiently merge multiple datasets without repeating code, we can do the following:\n# list Canadian data 1990-1999\ncanada_files <- list.files(\"~/Documents/uncomtrade/input/data\", pattern = \"_CAN_199\",\n  full.names = TRUE)\n\nhead(canada_files)\n\ncanada <- map_df(\n  canada_files,\n  readRDS\n)\n\ncanada\n\n> canada\n# A tibble: 1,971,197 × 34\n   dataset_code      type_code freq_code ref_period_id ref_year ref_month period\n   <chr>             <chr>     <chr>     <chr>         <chr>    <chr>     <chr> \n 1 20124199001052100 C         A         19900101      1990     52        1990  \n 2 20124199001052100 C         A         19900101      1990     52        1990  \n 3 20124199001052100 C         A         19900101      1990     52        1990  \n 4 20124199001052100 C         A         19900101      1990     52        1990  \n 5 20124199001052100 C         A         19900101      1990     52        1990  \n 6 20124199001052100 C         A         19900101      1990     52        1990  \n 7 20124199001052100 C         A         19900101      1990     52        1990  \n 8 20124199001052100 C         A         19900101      1990     52        1990  \n 9 20124199001052100 C         A         19900101      1990     52        1990  \n10 20124199001052100 C         A         19900101      1990     52        1990  \n# ℹ 1,971,187 more rows\n# ℹ 27 more variables: reporter_code <chr>, flow_code <chr>,\n#   partner_code <chr>, partner2code <chr>, classification_search_code <chr>,\n#   classification_code <chr>, is_original_classification <chr>,\n#   cmd_code <chr>, customs_code <chr>, mos_code <chr>, mot_code <chr>,\n#   qty_unit_code <chr>, qty <chr>, is_qty_estimated <chr>,\n#   alt_qty_unit_code <chr>, alt_qty <chr>, is_alt_qty_estimated <chr>, …\n# ℹ Use `print(n = ...)` to see more rows\nThen it is possible to conduct diferent operations, such as total bilateral exports reporting FOB and CIF to see the mismatch between the exporter and the importer:\ncanada %>%\n  select(partner_code, fobvalue, cifvalue) %>%\n  mutate(\n    fobvalue = as.numeric(fobvalue),\n    cifvalue = as.numeric(cifvalue)\n  ) %>%\n  group_by(partner_code) %>%\n  summarise(\n    fobvalue = sum(fobvalue, na.rm = TRUE),\n    cifvalue = sum(cifvalue, na.rm = TRUE)\n  )\n\n> canada %>%\n+   select(partner_code, fobvalue, cifvalue) %>%\n+   mutate(\n+     fobvalue = as.numeric(fobvalue),\n+     cifvalue = as.numeric(cifvalue)\n+   ) %>%\n+   group_by(partner_code) %>%\n+   summarise(\n+     fobvalue = sum(fobvalue, na.rm = TRUE),\n+     cifvalue = sum(cifvalue, na.rm = TRUE)\n+   )\n# A tibble: 219 × 3\n   partner_code fobvalue cifvalue\n   <chr>           <dbl>    <dbl>\n 1 0             1.34e13        0\n 2 100           1.44e 9        0\n 3 104           4.18e 8        0\n 4 108           2.58e 7        0\n 5 112           1.26e 8        0\n 6 116           1.77e 8        0\n 7 12            2.22e10        0\n 8 120           7.34e 8        0\n 9 132           6.95e 6        0\n10 136           2.32e 8        0\n# ℹ 209 more rows\n# ℹ Use `print(n = ...)` to see more rows\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\npacha.dev/blog\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
    "meta_description": "Because of delays with my scholarship payment, if this post is useful to you I kindly ask a minimal donation on Buy Me a Coffee that shall be used to continue my Open Source efforts. If you need an R package or Shiny dashboard for your team, you ...",
    "meta_keywords": null,
    "og_description": "Because of delays with my scholarship payment, if this post is useful to you I kindly ask a minimal donation on Buy Me a Coffee that shall be used to continue my Open Source efforts. If you need an R package or Shiny dashboard for your team, you ...",
    "og_image": "https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png",
    "og_title": "Efficiently merging multiple datasets | R-bloggers",
    "raw_jsonld_article": null,
    "reading_time_min": 10.5,
    "sitemap_lastmod": null,
    "twitter_description": "Because of delays with my scholarship payment, if this post is useful to you I kindly ask a minimal donation on Buy Me a Coffee that shall be used to continue my Open Source efforts. If you need an R package or Shiny dashboard for your team, you ...",
    "twitter_title": "Efficiently merging multiple datasets | R-bloggers",
    "url": "https://www.r-bloggers.com/2025/08/efficiently-merging-multiple-datasets/",
    "word_count": 2109
  }
}