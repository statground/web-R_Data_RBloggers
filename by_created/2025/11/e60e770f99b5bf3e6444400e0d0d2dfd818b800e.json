{
  "id": "e60e770f99b5bf3e6444400e0d0d2dfd818b800e",
  "url": "https://www.r-bloggers.com/2023/12/powerquery-puzzle-solved-with-r-5/",
  "created_at_utc": "2025-11-17T20:38:49Z",
  "data": null,
  "raw_original": {
    "uuid": "4411c7c1-4bf6-4de9-97f6-ec554efc4a9a",
    "created_at": "2025-11-17 20:38:49",
    "raw_json": {
      "article_author": null,
      "article_headline": null,
      "article_modified": null,
      "article_published": null,
      "article_section": null,
      "article_tags": null,
      "canonical_url": "https://www.r-bloggers.com/2023/12/powerquery-puzzle-solved-with-r-5/",
      "crawled_at": "2025-11-17T09:31:47.869535",
      "external_links": [
        {
          "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-f62c442b2dbb",
          "text": "Numbers around us - Medium"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        },
        {
          "href": "https://www.linkedin.com/posts/excelbi_challenge-powerquerychallenge-daxchallenge-activity-7141638071652958208-ephZ",
          "text": "content"
        },
        {
          "href": "https://lnkd.in/dbeP4mm7",
          "text": "file"
        },
        {
          "href": "https://www.linkedin.com/posts/excelbi_challenge-powerquerychallenge-daxchallenge-activity-7142000487175819264-8ypm",
          "text": "content"
        },
        {
          "href": "https://lnkd.in/dgyyDm_j",
          "text": "file"
        },
        {
          "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-f62c442b2dbb",
          "text": "PowerQuery Puzzle solved with R"
        },
        {
          "href": "https://medium.com/number-around-us",
          "text": "Numbers around us"
        },
        {
          "href": "https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-f62c442b2dbb",
          "text": "Numbers around us - Medium"
        },
        {
          "href": "https://feedburner.google.com/fb/a/mailverify?uri=RBloggers",
          "text": "daily e-mail updates"
        },
        {
          "href": "https://www.r-project.org/",
          "text": "R"
        },
        {
          "href": "https://www.r-users.com/",
          "text": "Click here if you're looking to post or find an R/data-science job"
        },
        {
          "href": "http://r-posts.com/",
          "text": "here"
        }
      ],
      "h1_title": "R-bloggers",
      "html_title": "PowerQuery Puzzle solved with R | R-bloggers",
      "images": [
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i2.wp.com/cdn-images-1.medium.com/max/1024/1*wv5eHNZFUuqSiuNVCGIA1g.jpeg?w=578&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*N9xnmd9Y5SoJQZHahnyy-A.png?w=578&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": null,
          "src": "https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*sKCFt74T_777dIINGmXOwg.png?w=578&ssl=1"
        },
        {
          "alt": null,
          "base64": "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",
          "src": "https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif"
        },
        {
          "alt": null,
          "base64": "data:application/octet-stream;base64,R0lGODlhAQABAO+/vQAA77+977+977+9AAAAIe+/vQQBAAAAACwAAAAAAQABAAACAkQBADs=",
          "src": "https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=f62c442b2dbb"
        }
      ],
      "internal_links": [
        {
          "href": "https://www.r-bloggers.com/author/numbers-around-us/",
          "text": "Numbers around us"
        },
        {
          "href": "https://www.r-bloggers.com/category/r-bloggers/",
          "text": "R bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers"
        },
        {
          "href": "https://www.r-bloggers.com/contact-us/",
          "text": "here"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        },
        {
          "href": "https://www.r-bloggers.com/",
          "text": "R-bloggers.com"
        },
        {
          "href": "https://www.r-bloggers.com/how-to-learn-r-2/",
          "text": "learning R"
        },
        {
          "href": "https://www.r-bloggers.com/add-your-blog/",
          "text": "click here"
        }
      ],
      "lang": "en-US",
      "main_html": "<article class=\"post-380973 post type-post status-publish format-standard hentry category-r-bloggers\">\n<header class=\"post-header\">\n<h1 class=\"entry-title\">PowerQuery Puzzle solved with R</h1>\n<p class=\"meta post-meta\">Posted on <span class=\"updated\">December 19, 2023</span>  by <span class=\"vcard author\"><a class=\"fn\" href=\"https://www.r-bloggers.com/author/numbers-around-us/\">Numbers around us</a></span>  in <a href=\"https://www.r-bloggers.com/category/r-bloggers/\" rel=\"category tag\">R bloggers</a> | 0 Comments</p>\n</header>\n<div class=\"entry clearfix\">\n<!-- \r\n<div style=\"min-height: 30px;\">\r\n[social4i size=\"small\" align=\"align-left\"]\r\n</div>\r\n-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\r\n[This article was first published on  <strong><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-f62c442b2dbb\"> Numbers around us - Medium</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</div>\n\n<!-- Share buttons by mashshare.net - Version: 3.8.9--><p># 139–140</p><figure><img alt=\"\" data-lazy-src=\"https://i2.wp.com/cdn-images-1.medium.com/max/1024/1*wv5eHNZFUuqSiuNVCGIA1g.jpeg?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i2.wp.com/cdn-images-1.medium.com/max/1024/1*wv5eHNZFUuqSiuNVCGIA1g.jpeg?w=578&amp;ssl=1\"/></noscript></figure><h3>Puzzles:</h3><p>PQ_139: <a href=\"https://www.linkedin.com/posts/excelbi_challenge-powerquerychallenge-daxchallenge-activity-7141638071652958208-ephZ\" rel=\"nofollow\" target=\"_blank\">content</a> <a href=\"https://lnkd.in/dbeP4mm7\" rel=\"nofollow\" target=\"_blank\">file</a><br/>PQ_140: <a href=\"https://www.linkedin.com/posts/excelbi_challenge-powerquerychallenge-daxchallenge-activity-7142000487175819264-8ypm\" rel=\"nofollow\" target=\"_blank\">content</a> <a href=\"https://lnkd.in/dgyyDm_j\" rel=\"nofollow\" target=\"_blank\">file</a></p><p>I noticed that usually Power Query puzzles are about time. Does it really a case in PQ that time related calculations are hard or tricky?</p><h3>PQ_139</h3><figure><img alt=\"\" data-lazy-src=\"https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*N9xnmd9Y5SoJQZHahnyy-A.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*N9xnmd9Y5SoJQZHahnyy-A.png?w=578&amp;ssl=1\"/></noscript></figure><p>In this puzzle we have to extract informations about people days off for vacation. Table has person and date when that person was on day of. Our goal is to find start and end date of break but with one important factor. We do not count weekends.</p><p>Lets check it out.</p><h4>Load data and libraries</h4><pre>library(tidyverse)\nlibrary(readxl)\nlibrary(lubridate)\n\ninput = read_excel(\"PQ_Challenge_139.xlsx\", range = \"A1:B20\") %&gt;% janitor::clean_names()\ntest  = read_excel(\"PQ_Challenge_139.xlsx\", range = \"D1:H7\") %&gt;% janitor::clean_names()</pre><h4>Modification</h4><pre>result = input %&gt;%\n  group_by(name) %&gt;% \n  mutate(lagged = lag(vacation_date, 1),\n         diff = as.numeric(difftime(vacation_date, lagged, units = \"days\")),\n         diff = ifelse(is.na(diff), 0, diff),\n         vacation_no = cumsum(ifelse(diff != 1, 1, 0)),\n         wd = wday(vacation_date, week_start = 1)) %&gt;%\n  ungroup() %&gt;%\n  filter(!wd %in% c(6, 7))  %&gt;%\n  group_by(name, vacation_no) %&gt;%\n  summarise(vacation_from_date = min(vacation_date),\n            vacation_end_date = max(vacation_date),\n            number_of_workdays = as.numeric(n())) %&gt;%\n  ungroup() %&gt;%\n  arrange(desc(name))</pre><h4>Validation</h4><pre>identical(test, result)\n# [1] TRUE</pre><h3>PQ_140</h3><figure><img alt=\"\" data-lazy-src=\"https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*sKCFt74T_777dIINGmXOwg.png?w=578&amp;ssl=1\" data-recalc-dims=\"1\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\"/><noscript><img alt=\"\" data-recalc-dims=\"1\" src=\"https://i1.wp.com/cdn-images-1.medium.com/max/1024/1*sKCFt74T_777dIINGmXOwg.png?w=578&amp;ssl=1\"/></noscript></figure><p>And once again we have warehouse management task. We have opening stock level for first day, and withdrawals with dates and amounts. But manager needs to have values for end of a day.</p><p>Let help him out!</p><h4>Load data and libraries</h4><pre>library(tidyverse)\nlibrary(readxl)\nlibrary(lubridate)\n\nT1 = read_excel(\"PQ_Challenge_140.xlsx\", range = \"A1:D10\") %&gt;% janitor::clean_names()\nT2 = read_excel(\"PQ_Challenge_140.xlsx\", range = \"F1:G7\") %&gt;% janitor::clean_names()\n\ntest = read_excel(\"PQ_Challenge_140.xlsx\", range = \"I1:M10\") %&gt;% janitor::clean_names()</pre><h4>Transformation</h4><pre>combined_data = T1 %&gt;%\n  left_join(T2, by = \"item\")%&gt;%\n  arrange(item, date, time) %&gt;%\n# when I read data date for time column is in 1890s and I need to fix it\n  mutate(time1 = date + hours(hour(time))+ minutes(minute(time)) + seconds(second(time))) %&gt;%\n  group_by(item) %&gt;%\n  mutate(cum_quantity = cumsum(quantity),\n         cum_stock = stock - cum_quantity) %&gt;%\n  ungroup() %&gt;%\n  group_by(item, date) %&gt;%\n  mutate(end_of_day = max(time1) == time1, \n         end_of_day_stock = ifelse(end_of_day, cum_stock, NA)) %&gt;%\n  ungroup() %&gt;%\n  select(1:4,10)</pre><h4>Verification</h4><pre>identical(combined_data, test)\n# [1] TRUE</pre><p>We’ve seen some nice puzzles considering time changes and it shows little bit out of the box thinking. Feel free to ask, like and share.<br/>Lets be in touch for article about the memoization.</p><img alt=\"\" data-lazy-src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=f62c442b2dbb\" height=\"1\" loading=\"lazy\" src=\"https://www.r-bloggers.com/wp-content/plugins/jetpack/modules/lazy-images/images/1x1.trans.gif\" width=\"1\"/><noscript><img alt=\"\" height=\"1\" loading=\"lazy\" src=\"https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=f62c442b2dbb\" width=\"1\"/></noscript><hr/><p><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-f62c442b2dbb\" rel=\"nofollow\" target=\"_blank\">PowerQuery Puzzle solved with R</a> was originally published in <a href=\"https://medium.com/number-around-us\" rel=\"nofollow\" target=\"_blank\">Numbers around us</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>\n<div class=\"jp-relatedposts\" id=\"jp-relatedposts\">\n<h3 class=\"jp-relatedposts-headline\"><em>Related</em></h3>\n</div>\n<!-- Share buttons by mashshare.net - Version: 3.8.9-->\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://medium.com/number-around-us/powerquery-puzzle-solved-with-r-f62c442b2dbb\"> Numbers around us - Medium</a></strong>.</div>\n<hr>\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a href=\"https://www.r-project.org/\" rel=\"nofollow\" title=\"The R Project for Statistical Computing\">R</a> news and tutorials about <a href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\" title=\"R tutorials\">learning R</a> and many other topics. <a href=\"https://www.r-users.com/\" rel=\"nofollow\" title=\"Data science jobs\">Click here if you're looking to post or find an R/data-science job</a>.\r\n\r\n<hr/>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\r\n</hr></div> </div>\n</article>",
      "main_text": "PowerQuery Puzzle solved with R\nPosted on\nDecember 19, 2023\nby\nNumbers around us\nin\nR bloggers\n| 0 Comments\n[This article was first published on\nNumbers around us - Medium\n, and kindly contributed to\nR-bloggers\n].  (You can report issue about the content on this page\nhere\n)\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.\n# 139–140\nPuzzles:\nPQ_139:\ncontent\nfile\nPQ_140:\ncontent\nfile\nI noticed that usually Power Query puzzles are about time. Does it really a case in PQ that time related calculations are hard or tricky?\nPQ_139\nIn this puzzle we have to extract informations about people days off for vacation. Table has person and date when that person was on day of. Our goal is to find start and end date of break but with one important factor. We do not count weekends.\nLets check it out.\nLoad data and libraries\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(lubridate)\n\ninput = read_excel(\"PQ_Challenge_139.xlsx\", range = \"A1:B20\") %>% janitor::clean_names()\ntest  = read_excel(\"PQ_Challenge_139.xlsx\", range = \"D1:H7\") %>% janitor::clean_names()\nModification\nresult = input %>%\n  group_by(name) %>% \n  mutate(lagged = lag(vacation_date, 1),\n         diff = as.numeric(difftime(vacation_date, lagged, units = \"days\")),\n         diff = ifelse(is.na(diff), 0, diff),\n         vacation_no = cumsum(ifelse(diff != 1, 1, 0)),\n         wd = wday(vacation_date, week_start = 1)) %>%\n  ungroup() %>%\n  filter(!wd %in% c(6, 7))  %>%\n  group_by(name, vacation_no) %>%\n  summarise(vacation_from_date = min(vacation_date),\n            vacation_end_date = max(vacation_date),\n            number_of_workdays = as.numeric(n())) %>%\n  ungroup() %>%\n  arrange(desc(name))\nValidation\nidentical(test, result)\n# [1] TRUE\nPQ_140\nAnd once again we have warehouse management task. We have opening stock level for first day, and withdrawals with dates and amounts. But manager needs to have values for end of a day.\nLet help him out!\nLoad data and libraries\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(lubridate)\n\nT1 = read_excel(\"PQ_Challenge_140.xlsx\", range = \"A1:D10\") %>% janitor::clean_names()\nT2 = read_excel(\"PQ_Challenge_140.xlsx\", range = \"F1:G7\") %>% janitor::clean_names()\n\ntest = read_excel(\"PQ_Challenge_140.xlsx\", range = \"I1:M10\") %>% janitor::clean_names()\nTransformation\ncombined_data = T1 %>%\n  left_join(T2, by = \"item\")%>%\n  arrange(item, date, time) %>%\n# when I read data date for time column is in 1890s and I need to fix it\n  mutate(time1 = date + hours(hour(time))+ minutes(minute(time)) + seconds(second(time))) %>%\n  group_by(item) %>%\n  mutate(cum_quantity = cumsum(quantity),\n         cum_stock = stock - cum_quantity) %>%\n  ungroup() %>%\n  group_by(item, date) %>%\n  mutate(end_of_day = max(time1) == time1, \n         end_of_day_stock = ifelse(end_of_day, cum_stock, NA)) %>%\n  ungroup() %>%\n  select(1:4,10)\nVerification\nidentical(combined_data, test)\n# [1] TRUE\nWe’ve seen some nice puzzles considering time changes and it shows little bit out of the box thinking. Feel free to ask, like and share.\nLets be in touch for article about the memoization.\nPowerQuery Puzzle solved with R\nwas originally published in\nNumbers around us\non Medium, where people are continuing the conversation by highlighting and responding to this story.\nRelated\nTo\nleave a comment\nfor the author, please follow the link and comment on their blog:\nNumbers around us - Medium\n.\nR-bloggers.com\noffers\ndaily e-mail updates\nabout\nR\nnews and tutorials about\nlearning R\nand many other topics.\nClick here if you're looking to post or find an R/data-science job\n.\nWant to share your content on R-bloggers?\nclick here\nif you have a blog, or\nhere\nif you don't.",
      "meta_description": "# 139–140Puzzles:PQ_139: content filePQ_140: content fileI noticed that usually Power Query puzzles are about time. Does it really a case in PQ that time related calculations are hard or tricky?PQ_139In this puzzle we have to extract informations about...",
      "meta_keywords": null,
      "og_description": "# 139–140Puzzles:PQ_139: content filePQ_140: content fileI noticed that usually Power Query puzzles are about time. Does it really a case in PQ that time related calculations are hard or tricky?PQ_139In this puzzle we have to extract informations about...",
      "og_image": "https://cdn-images-1.medium.com/max/1024/1*wv5eHNZFUuqSiuNVCGIA1g.jpeg",
      "og_title": "PowerQuery Puzzle solved with R | R-bloggers",
      "raw_jsonld_article": null,
      "reading_time_min": 2.7,
      "sitemap_lastmod": "2023-12-19T13:34:32+00:00",
      "twitter_description": "# 139–140Puzzles:PQ_139: content filePQ_140: content fileI noticed that usually Power Query puzzles are about time. Does it really a case in PQ that time related calculations are hard or tricky?PQ_139In this puzzle we have to extract informations about...",
      "twitter_title": "PowerQuery Puzzle solved with R | R-bloggers",
      "url": "https://www.r-bloggers.com/2023/12/powerquery-puzzle-solved-with-r-5/",
      "word_count": 537
    }
  }
}